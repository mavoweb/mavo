{"version":3,"sources":["wysie.js"],"names":[],"mappings":"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","file":"wysie.es5.js","sourcesContent":["/*\n * Stretchy: Form element autosizing, the way it should be.\n * by Lea Verou http://lea.verou.me\n * MIT license\n */\n(function() {\n\nif (!self.Element) {\n\treturn; // super old browser\n}\n\nif (!Element.prototype.matches) {\n\tElement.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;\n}\n\nif (!Element.prototype.matches) {\n\treturn;\n}\n\nfunction $$(expr, con) {\n\treturn expr instanceof Node || expr instanceof Window? [expr] :\n\t       [].slice.call(typeof expr == \"string\"? (con || document).querySelectorAll(expr) : expr || []);\n}\n\nvar _ = self.Stretchy = {\n\tselectors: {\n\t\tbase: 'textarea, select:not([size]), input:not([type]), input[type=\"' + \"text url email tel\".split(\" \").join('\"], input[type=\"') + '\"]',\n\t\tfilter: \"*\"\n\t},\n\n\t// Script element this was included with, if any\n\tscript: document.currentScript || $$(\"script\").pop(),\n\n\t// Autosize one element. The core of Stretchy.\n\tresize: function(element) {\n\t\tif (!_.resizes(element)) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar cs = getComputedStyle(element);\n\t\tvar offset = 0;\n\n\t\tif (!element.value && element.placeholder) {\n\t\t\tvar empty = true;\n\t\t\telement.value = element.placeholder;\n\t\t}\n\n\t\tvar type = element.nodeName.toLowerCase();\n\n\t\tif (type == \"textarea\") {\n\t\t\telement.style.height = \"0\";\n\n\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\toffset = element.offsetHeight;\n\t\t\t}\n\t\t\telse if (cs.boxSizing == \"content-box\") {\n\t\t\t\toffset = -element.clientHeight;\n\t\t\t}\n\n\t\t\telement.style.height = element.scrollHeight + offset + \"px\";\n\t\t}\n\t\telse if(type == \"input\") {\n\t\t\telement.style.width = \"0\";\n\n\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\toffset = element.offsetWidth;\n\t\t\t}\n\t\t\telse if (cs.boxSizing == \"padding-box\") {\n\t\t\t\toffset = element.clientWidth;\n\t\t\t}\n\n\t\t\t// Safari misreports scrollWidth, so we will instead set scrollLeft to a\n\t\t\t// huge number, and read that back to see what it was clipped to\n\t\t\telement.scrollLeft = 1e+10;\n\n\t\t\tvar width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);\n\n\t\t\telement.style.width = width + \"px\";\n\t\t}\n\t\telse if (type == \"select\") {\n\t\t\tvar selectedIndex = element.selectedIndex > 0? element.selectedIndex : 0;\n\n\t\t\t// Need to use dummy element to measure :(\n\t\t\tvar option = document.createElement(\"_\");\n\t\t\toption.textContent = element.options[selectedIndex].textContent;\n\t\t\telement.parentNode.insertBefore(option, element.nextSibling);\n\n\t\t\t// The name of the appearance property, as it might be prefixed\n\t\t\tvar appearance;\n\n\t\t\tfor (var property in cs) {\n\t\t\t\tvar value = cs[property];\n\t\t\t\tif (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == \"string\") {\n\t\t\t\t\t//console.log(property, option.offsetWidth, cs[property]);\n\t\t\t\t\toption.style[property] = value;\n\n\t\t\t\t\tif (/appearance$/i.test(property)) {\n\t\t\t\t\t\tappearance = property;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toption.style.width = \"\";\n\n\t\t\tif (option.offsetWidth > 0) {\n\t\t\t\telement.style.width = option.offsetWidth + \"px\";\n\n\t\t\t\tif (!cs[appearance] || cs[appearance] !== \"none\") {\n\t\t\t\t\t// Account for arrow\n\t\t\t\t\telement.style.width = \"calc(\" + element.style.width + \" + 2em)\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\toption.parentNode.removeChild(option);\n\t\t\toption = null;\n\t\t}\n\n\t\tif (empty) {\n\t\t\telement.value = \"\";\n\t\t}\n\t},\n\n\t// Autosize multiple elements\n\tresizeAll: function(elements) {\n\t\t$$(elements || _.selectors.base).forEach(function (element) {\n\t\t\t_.resize(element);\n\t\t});\n\t},\n\n\tactive: true,\n\n\t// Will stretchy do anything for this element?\n\tresizes: function(element) {\n\t\treturn element &&\n\t\t       element.parentNode &&\n\t\t       element.matches &&\n\t\t       element.matches(_.selectors.base) &&\n\t\t       element.matches(_.selectors.filter);\n\t},\n\n\tinit: function(){\n\t\t_.selectors.filter = _.script.getAttribute(\"data-filter\") ||\n\t\t                     ($$(\"[data-stretchy-filter]\").pop() || document.body).getAttribute(\"data-stretchy-filter\") || Stretchy.selectors.filter || \"*\";\n\n\t\t_.resizeAll();\n\t},\n\n\t$$: $$\n};\n\n// Autosize all elements once the DOM is loaded\n\n// DOM already loaded?\nif (document.readyState !== \"loading\") {\n\t_.init();\n}\nelse {\n\t// Wait for it\n\tdocument.addEventListener(\"DOMContentLoaded\", _.init);\n}\n\n// Listen for changes\nvar listener = function(evt) {\n\tif (_.active) {\n\t\t_.resize(evt.target);\n\t}\n};\n\ndocument.documentElement.addEventListener(\"input\", listener);\n\n// Firefox fires a change event instead of an input event\ndocument.documentElement.addEventListener(\"change\", listener);\n\n// Listen for new elements\nif (self.MutationObserver) {\n\t(new MutationObserver(function(mutations) {\n\t\tif (_.active) {\n\t\t\tmutations.forEach(function(mutation) {\n\t\t\t\tif (mutation.type == \"childList\") {\n\t\t\t\t\tStretchy.resizeAll(mutation.addedNodes);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t})).observe(document.documentElement, {\n\t\tchildList: true,\n\t\tsubtree: true\n\t});\n}\n\n})();\n\n(function() {\n\"use strict\";\n\nfunction overload(callback, start, end) {\n\tstart = start === undefined ? 1 : start;\n\tend = end || start + 1;\n\n\tif (end - start <= 1) {\n\t\treturn function() {\n\t\t\tif (arguments.length <= start || $.type(arguments[start]) === \"string\") {\n\t\t\t\treturn callback.apply(this, arguments);\n\t\t\t}\n\n\t\t\tvar obj = arguments[start], ret;\n\n\t\t\tfor (var key in obj) {\n\t\t\t\tvar args = Array.from(arguments);\n\t\t\t\targs.splice(start, 1, key, obj[key]);\n\t\t\t\tret = callback.apply(this, args);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t};\n\t}\n\n\treturn overload(overload(callback, start + 1, end), start, end - 1);\n}\n\n// Copy properties from one object to another. Overwrites allowed.\nfunction extend(to, from, whitelist) {\n\tfor (var property in from) {\n\t\tif (whitelist) {\n\t\t\tvar type = $.type(whitelist);\n\n\t\t\tif (whitelist === \"own\" && !from.hasOwnProperty(property) ||\n\t\t\t\ttype === \"array\" && whitelist.indexOf(property) === -1 ||\n\t\t\t\ttype === \"regexp\" && !whitelist.test(property) ||\n\t\t\t\ttype === \"function\" && !whitelist.call(from, property)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// To copy gettters/setters, preserve flags etc\n\t\tvar descriptor = Object.getOwnPropertyDescriptor(from, property);\n\n\t\tif (descriptor && (!descriptor.writable || !descriptor.configurable || !descriptor.enumerable || descriptor.get || descriptor.set)) {\n\t\t\tdelete to[property];\n\t\t\tObject.defineProperty(to, property, descriptor);\n\t\t}\n\t\telse {\n\t\t\tto[property] = from[property];\n\t\t}\n\t}\n\n\treturn to;\n}\n\nvar $ = self.Bliss = extend(function(expr, context) {\n\treturn $.type(expr) === \"string\"? (context || document).querySelector(expr) : expr || null;\n}, self.Bliss);\n\nextend($, {\n\textend: extend,\n\n\toverload: overload,\n\n\tproperty: $.property || \"_\",\n\n\tsources: {},\n\n\tnoop: function() {},\n\n\t$: function(expr, context) {\n\t\tif (expr instanceof Node || expr instanceof Window) {\n\t\t\treturn [expr];\n\t\t}\n\n\t\treturn Array.from(typeof expr == \"string\"? (context || document).querySelectorAll(expr) : expr || []);\n\t},\n\n\t/**\n\t * Returns the [[Class]] of an object in lowercase (eg. array, date, regexp, string etc)\n\t */\n\ttype: function(obj) {\n\t\tif (obj === null) {\n\t\t\treturn \"null\";\n\t\t}\n\n\t\tif (obj === undefined) {\n\t\t\treturn \"undefined\";\n\t\t}\n\n\t\tvar ret = (Object.prototype.toString.call(obj).match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n\n\t\tif (ret == \"number\" && isNaN(obj)) {\n\t\t\treturn \"nan\";\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t/*\n\t * Return first non-undefined value. Mainly used internally.\n\t */\n\tdefined: function () {\n\t\tfor (var i=0; i<arguments.length; i++) {\n\t\t\tif (arguments[i] !== undefined) {\n\t\t\t\treturn arguments[i];\n\t\t\t}\n\t\t}\n\t},\n\n\tcreate: function (tag, o) {\n\t\tif (tag instanceof Node) {\n\t\t\treturn $.set(tag, o);\n\t\t}\n\n\t\t// 4 signatures: (tag, o), (tag), (o), ()\n\t\tif (arguments.length === 1) {\n\t\t\tif ($.type(tag) === \"string\") {\n\t\t\t\to = {};\n\t\t\t}\n\t\t\telse {\n\t\t\t\to = tag;\n\t\t\t\ttag = o.tag;\n\t\t\t\to = $.extend({}, o, function(property) {\n\t\t\t\t\treturn property !== \"tag\";\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn $.set(document.createElement(tag || \"div\"), o);\n\t},\n\n\teach: function(obj, callback, ret) {\n\t\tret = ret || {};\n\n\t\tfor (var property in obj) {\n\t\t\tret[property] = callback.call(obj, property, obj[property]);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tready: function(context) {\n\t\tcontext = context || document;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (context.readyState !== \"loading\") {\n\t\t\t\tresolve();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcontext.addEventListener(\"DOMContentLoaded\", function() {\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\t// Helper for defining OOP-like classes\n\tClass: function(o) {\n\t\tvar special = [\"constructor\", \"extends\", \"abstract\", \"static\"].concat(Object.keys($.classProps));\n\t\tvar init = o.hasOwnProperty(\"constructor\")? o.constructor : $.noop;\n\n\t\tvar Class = function() {\n\t\t\tif (this.constructor.__abstract && this.constructor === Class) {\n\t\t\t\tthrow new Error(\"Abstract classes cannot be directly instantiated.\");\n\t\t\t}\n\n\t\t\tClass.super && Class.super.apply(this, arguments);\n\n\t\t\tinit.apply(this, arguments);\n\t\t};\n\n\t\tClass.super = o.extends || null;\n\n\t\tClass.prototype = $.extend(Object.create(Class.super? Class.super.prototype : Object), {\n\t\t\tconstructor: Class\n\t\t});\n\n\t\tvar specialFilter = function(property) {\n\t\t\treturn this.hasOwnProperty(property) && special.indexOf(property) === -1;\n\t\t};\n\n\t\t// Static methods\n\t\tif (o.static) {\n\t\t\t$.extend(Class, o.static, specialFilter);\n\n\t\t\tfor (var property in $.classProps) {\n\t\t\t\tif (property in o.static) {\n\t\t\t\t\t$.classProps[property](Class, o.static[property]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Instance methods\n\t\t$.extend(Class.prototype, o, specialFilter);\n\n\t\tfor (var property in $.classProps) {\n\t\t\tif (property in o) {\n\t\t\t\t$.classProps[property](Class.prototype, o[property]);\n\t\t\t}\n\t\t}\n\n\t\t// For easier calling of super methods\n\t\t// This doesn't save us from having to use .call(this) though\n\t\tClass.prototype.super = Class.super? Class.super.prototype : null;\n\n\t\tClass.__abstract = !!o.abstract;\n\n\t\treturn Class;\n\t},\n\n\t// Properties with special handling in classes\n\tclassProps: {\n\t\t// Lazily evaluated properties\n\t\tlazy: overload(function(obj, property, getter) {\n\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\tvar value = getter.call(this);\n\n\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t});\n\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\tset: function(value) {\n\t\t\t\t\t// Blind write: skip running the getter\n\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\twritable: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: true\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t}),\n\n\t\t// Properties that behave like normal properties but also execute code upon getting/setting\n\t\tlive: overload(function(obj, property, descriptor) {\n\t\t\tif ($.type(descriptor) === \"function\") {\n\t\t\t\tdescriptor = {set: descriptor};\n\t\t\t}\n\n\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\tget: function() {\n\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\tvar ret = descriptor.get && descriptor.get.call(this, value);\n\t\t\t\t\treturn ret !== undefined? ret : value;\n\t\t\t\t},\n\t\t\t\tset: function(v) {\n\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\tvar ret = descriptor.set && descriptor.set.call(this, v, value);\n\t\t\t\t\tthis[\"_\" + property] = ret !== undefined? ret : v;\n\t\t\t\t},\n\t\t\t\tconfigurable: descriptor.configurable,\n\t\t\t\tenumerable: descriptor.enumerable\n\t\t\t});\n\n\t\t\treturn obj;\n\t\t})\n\n\t},\n\n\t// Includes a script, returns a promise\n\tinclude: function() {\n\t\tvar url = arguments[arguments.length - 1];\n\t\tvar loaded = arguments.length === 2? arguments[0] : false;\n\n\t\tvar script = document.createElement(\"script\");\n\n\t\treturn loaded? Promise.resolve() : new Promise(function(resolve, reject) {\n\t\t\t$.set(script, {\n\t\t\t\tasync: true,\n\t\t\t\tonload: function() {\n\t\t\t\t\tresolve();\n\t\t\t\t\t$.remove(script);\n\t\t\t\t},\n\t\t\t\tonerror: function() {\n\t\t\t\t\treject();\n\t\t\t\t},\n\t\t\t\tsrc: url,\n\t\t\t\tinside: document.head\n\t\t\t});\n\t\t});\n\n\t},\n\n\t/*\n\t * Fetch API inspired XHR wrapper. Returns promise.\n\t */\n\tfetch: function(url, o) {\n\t\tif (!url) {\n\t\t\tthrow new TypeError(\"URL parameter is mandatory and cannot be \" + url);\n\t\t}\n\n\t\t// Set defaults & fixup arguments\n\t\tvar env = extend({\n\t\t\turl: new URL(url, location),\n\t\t\tdata: \"\",\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {},\n\t\t\txhr: new XMLHttpRequest()\n\t\t}, o);\n\n\t\tenv.method = env.method.toUpperCase();\n\n\t\t$.hooks.run(\"fetch-args\", env);\n\n\t\t// Start sending the request\n\n\t\tif (env.method === \"GET\" && env.data) {\n\t\t\tenv.url.search += env.data;\n\t\t}\n\n\t\tdocument.body.setAttribute(\"data-loading\", env.url);\n\n\t\tenv.xhr.open(env.method, env.url.href, env.async !== false, env.user, env.password);\n\n\t\tfor (var property in o) {\n\t\t\tif (property in env.xhr) {\n\t\t\t\ttry {\n\t\t\t\t\tenv.xhr[property] = o[property];\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tself.console && console.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (env.method !== \"GET\" && !env.headers[\"Content-type\"] && !env.headers[\"Content-Type\"]) {\n\t\t\tenv.xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\t\t}\n\n\t\tfor (var header in env.headers) {\n\t\t\tenv.xhr.setRequestHeader(header, env.headers[header]);\n\t\t}\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tenv.xhr.onload = function() {\n\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\n\t\t\t\tif (env.xhr.status === 0 || env.xhr.status >= 200 && env.xhr.status < 300 || env.xhr.status === 304) {\n\t\t\t\t\t// Success!\n\t\t\t\t\tresolve(env.xhr);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treject($.extend(Error(env.xhr.statusText), {\n\t\t\t\t\t\txhr: env.xhr,\n\t\t\t\t\t\tget status() {\n\t\t\t\t\t\t\treturn this.xhr.status;\n\t\t\t\t\t\t}\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tenv.xhr.onerror = function() {\n\t\t\t\tdocument.body.removeAttribute(\"data-loading\");\n\t\t\t\treject($.extend(Error(\"Network Error\"), {xhr: env.xhr}));\n\t\t\t};\n\n\t\t\tenv.xhr.ontimeout = function() {\n\t\t\t    document.body.removeAttribute(\"data-loading\");\n\t\t\t    reject($.extend(Error(\"Network Timeout\"), {xhr: env.xhr}));\n\t\t\t};\n\n\t\t\tenv.xhr.send(env.method === \"GET\"? null : env.data);\n\t\t});\n\t},\n\n\tvalue: function(obj) {\n\t\tvar hasRoot = $.type(obj) !== \"string\";\n\n\t\treturn $.$(arguments).slice(+hasRoot).reduce(function(obj, property) {\n\t        return obj && obj[property];\n\t    }, hasRoot? obj : self);\n\t}\n});\n\n$.Hooks = new $.Class({\n\tadd: function (name, callback, first) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name][first? \"unshift\" : \"push\"](callback);\n\t},\n\n\trun: function (name, env) {\n\t\tthis[name] = this[name] || [];\n\t\tthis[name].forEach(function(callback) {\n\t\t\tcallback.call(env && env.context? env.context : env, env);\n\t\t});\n\t}\n});\n\n$.hooks = new $.Hooks();\n\nvar _ = $.property;\n\n$.Element = function (subject) {\n\tthis.subject = subject;\n\n\t// Author-defined element-related data\n\tthis.data = {};\n\n\t// Internal Bliss element-related data\n\tthis.bliss = {};\n};\n\n$.Element.prototype = {\n\tset: overload(function(property, value) {\n\n\t\tif (property in $.setProps) {\n\t\t\t$.setProps[property].call(this, value);\n\t\t}\n\t\telse if (property in this) {\n\t\t\tthis[property] = value;\n\t\t}\n\t\telse {\n\t\t\tthis.setAttribute(property, value);\n\t\t}\n\n\t}, 0),\n\n\t// Run a CSS transition, return promise\n\ttransition: function(props, duration) {\n\t\tduration = +duration || 400;\n\n\t\treturn new Promise(function(resolve, reject) {\n\t\t\tif (\"transition\" in this.style) {\n\t\t\t\t// Get existing style\n\t\t\t\tvar previous = $.extend({}, this.style, /^transition(Duration|Property)$/);\n\n\t\t\t\t$.style(this, {\n\t\t\t\t\ttransitionDuration: (duration || 400) + \"ms\",\n\t\t\t\t\ttransitionProperty: Object.keys(props).join(\", \")\n\t\t\t\t});\n\n\t\t\t\t$.once(this, \"transitionend\", function() {\n\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t$.style(this, previous);\n\t\t\t\t\tresolve(this);\n\t\t\t\t});\n\n\t\t\t\t// Failsafe, in case transitionend doesnt fire\n\t\t\t\tvar i = setTimeout(resolve, duration+50, this);\n\n\t\t\t\t$.style(this, props);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.style(this, props);\n\t\t\t\tresolve(this);\n\t\t\t}\n\t\t}.bind(this));\n\t},\n\n\t// Fire a synthesized event on the element\n\tfire: function (type, properties) {\n\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\n\t\tevt.initEvent(type, true, true );\n\n\t\t// Return the result of dispatching the event, so we\n\t\t// can know if `e.preventDefault` was called inside it\n\t\treturn this.dispatchEvent($.extend(evt, properties));\n\t},\n\n\tunbind: overload(function(events, callback) {\n\t\t(events || \"\").split(/\\s+/).forEach(function (type) {\n\t\t\tif ((_ in this) && (type.indexOf(\".\") > -1 || !callback)) {\n\t\t\t\t// Mass unbinding, need to go through listeners\n\t\t\t\ttype = (type || \"\").split(\".\");\n\t\t\t\tvar className = type[1];\n\t\t\t\ttype = type[0];\n\t\t\t\t// man, cant wait to be able to do [type, className] = type.split(\".\");\n\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tfor (var ltype in listeners) {\n\t\t\t\t\tif (!type || ltype === type) {\n\t\t\t\t\t\t// No forEach, because were mutating the array\n\t\t\t\t\t\tfor (var i=0, l; l=listeners[ltype][i]; i++) {\n\t\t\t\t\t\t\tif ((!className || className === l.className) &&\n\t\t\t\t\t\t\t    (!callback || callback === l.callback )) { // TODO what about capture?\n\t\t\t\t\t\t\t\tthis.removeEventListener(ltype, l.callback, l.capture);\n\t\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Normal event unbinding, defer to native JS\n\t\t\t\tthis.removeEventListener(type, callback);\n\t\t\t}\n\t\t}, this);\n\t}, 0)\n};\n\n/*\n * Properties with custom handling in $.set()\n * Also available as functions directly on element._ and on $\n */\n$.setProps = {\n\t// Set a bunch of inline CSS styles\n\tstyle: function (val) {\n\t\t$.extend(this.style, val);\n\t},\n\n\t// Set a bunch of attributes\n\tattributes: function (o) {\n\t\tfor (var attribute in o) {\n\t\t\tthis.setAttribute(attribute, o[attribute]);\n\t\t}\n\t},\n\n\t// Set a bunch of properties on the element\n\tproperties: function (val) {\n\t\t$.extend(this, val);\n\t},\n\n\t// Bind one or more events to the element\n\tevents: function (val) {\n\t\tif (val && val.addEventListener) {\n\t\t\t// Copy events from other element (requires Bliss Full)\n\t\t\tvar me = this;\n\n\t\t\t// Copy listeners\n\t\t\tif (val[_] && val[_].bliss) {\n\t\t\t\tvar listeners = val[_].bliss.listeners;\n\n\t\t\t\tfor (var type in listeners) {\n\t\t\t\t\tlisteners[type].forEach(function(l) {\n\t\t\t\t\t\tme.addEventListener(type, l.callback, l.capture);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Copy inline events\n\t\t\tfor (var onevent in val) {\n\t\t\t\tif (onevent.indexOf(\"on\") === 0) {\n\t\t\t\t\tthis[onevent] = val[onevent];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (arguments.length > 1 && $.type(val) === \"string\") {\n\t\t\tvar callback = arguments[1], capture = arguments[2];\n\n\t\t\tval.split(/\\s+/).forEach(function (event) {\n\t\t\t\tthis.addEventListener(event, callback, capture);\n\t\t\t}, this);\n\t\t}\n\t\telse {\n\t\t\tfor (var events in val) {\n\t\t\t\t$.events(this, events, val[events]);\n\t\t\t}\n\t\t}\n\t},\n\n\tonce: overload(function(events, callback) {\n\t\tevents = events.split(/\\s+/);\n\t\tvar me = this;\n\t\tvar once = function() {\n\t\t\tevents.forEach(function(event) {\n\t\t\t\tme.removeEventListener(event, once);\n\t\t\t});\n\n\t\t\treturn callback.apply(me, arguments);\n\t\t};\n\n\t\tevents.forEach(function (event) {\n\t\t\tme.addEventListener(event, once);\n\t\t});\n\t}, 0),\n\n\t// Event delegation\n\tdelegate: overload(function (type, selector, callback) {\n\t\tthis.addEventListener(type, function(evt) {\n\t\t\tif (evt.target.closest(selector)) {\n\t\t\t\tcallback.call(this, evt);\n\t\t\t}\n\t\t});\n\t}, 0, 2),\n\n\t// Set the contents as a string, an element, an object to create an element or an array of these\n\tcontents: function (val) {\n\t\tif (val || val === 0) {\n\t\t\t(Array.isArray(val)? val : [val]).forEach(function (child) {\n\t\t\t\tvar type = $.type(child);\n\n\t\t\t\tif (/^(string|number)$/.test(type)) {\n\t\t\t\t\tchild = document.createTextNode(child + \"\");\n\t\t\t\t}\n\t\t\t\telse if (type === \"object\") {\n\t\t\t\t\tchild = $.create(child);\n\t\t\t\t}\n\n\t\t\t\tif (child instanceof Node) {\n\t\t\t\t\tthis.appendChild(child);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}\n\t},\n\n\t// Append the element inside another element\n\tinside: function (element) {\n\t\telement.appendChild(this);\n\t},\n\n\t// Insert the element before another element\n\tbefore: function (element) {\n\t\telement.parentNode.insertBefore(this, element);\n\t},\n\n\t// Insert the element after another element\n\tafter: function (element) {\n\t\telement.parentNode.insertBefore(this, element.nextSibling);\n\t},\n\n\t// Insert the element before another element's contents\n\tstart: function (element) {\n\t\telement.insertBefore(this, element.firstChild);\n\t},\n\n\t// Wrap the element around another element\n\taround: function (element) {\n\t\tif (element.parentNode) {\n\t\t\t$.before(this, element);\n\t\t}\n\n\t\t(/^template$/i.test(this.nodeName)? this.content || this : this).appendChild(element);\n\t}\n};\n\n$.Array = function (subject) {\n\tthis.subject = subject;\n};\n\n$.Array.prototype = {\n\tall: function(method) {\n\t\tvar args = $$(arguments).slice(1);\n\n\t\treturn this[method].apply(this, args);\n\t}\n};\n\n// Extends Bliss with more methods\n$.add = overload(function(method, callback, on, noOverwrite) {\n\ton = $.extend({$: true, element: true, array: true}, on);\n\n\tif ($.type(callback) == \"function\") {\n\t\tif (on.element && (!(method in $.Element.prototype) || !noOverwrite)) {\n\t\t\t$.Element.prototype[method] = function () {\n\t\t\t\treturn this.subject && $.defined(callback.apply(this.subject, arguments), this.subject);\n\t\t\t};\n\t\t}\n\n\t\tif (on.array && (!(method in $.Array.prototype) || !noOverwrite)) {\n\t\t\t$.Array.prototype[method] = function() {\n\t\t\t\tvar args = arguments;\n\t\t\t\treturn this.subject.map(function(element) {\n\t\t\t\t\treturn element && $.defined(callback.apply(element, args), element);\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\n\t\tif (on.$) {\n\t\t\t$.sources[method] = $[method] = callback;\n\n\t\t\tif (on.array || on.element) {\n\t\t\t\t$[method] = function () {\n\t\t\t\t\tvar args = [].slice.apply(arguments);\n\t\t\t\t\tvar subject = args.shift();\n\t\t\t\t\tvar Type = on.array && Array.isArray(subject)? \"Array\" : \"Element\";\n\n\t\t\t\t\treturn $[Type].prototype[method].apply({subject: subject}, args);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n}, 0);\n\n$.add($.Array.prototype, {element: false});\n$.add($.Element.prototype);\n$.add($.setProps);\n$.add($.classProps, {element: false, array: false});\n\n// Add native methods on $ and _\nvar dummy = document.createElement(\"_\");\n$.add($.extend({}, HTMLElement.prototype, function(method) {\n\treturn $.type(dummy[method]) === \"function\";\n}), null, true);\n\n\n})();\n\n(function($) {\n\"use strict\";\n\nif (!Bliss || Bliss.shy) {\n\treturn;\n}\n\nvar _ = Bliss.property;\n\n// Methods requiring Bliss Full\n$.add({\n\t// Clone elements, with events and data\n\tclone: function () {\n\t\tvar clone = this.cloneNode(true);\n\t\tvar descendants = $.$(\"*\", clone).concat(clone);\n\n\t\t$.$(\"*\", this).concat(this).forEach(function(element, i, arr) {\n\t\t\t$.events(descendants[i], element);\n\t\t\tdescendants[i]._.data = $.extend({}, element._.data);\n\t\t});\n\n\t\treturn clone;\n\t}\n}, {array: false});\n\n// Define the _ property on arrays and elements\n\nObject.defineProperty(Node.prototype, _, {\n\t// Written for IE compatability (see #49)\n\tget: function getter () {\n\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\tget: undefined\n\t\t});\n\t\tObject.defineProperty(this, _, {\n\t\t\tvalue: new $.Element(this)\n\t\t});\n\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\tget: getter\n\t\t});\n\t\treturn this[_];\n\t},\n\tconfigurable: true\n});\n\nObject.defineProperty(Array.prototype, _, {\n\tget: function () {\n\t\tObject.defineProperty(this, _, {\n\t\t\tvalue: new $.Array(this)\n\t\t});\n\n\t\treturn this[_];\n\t},\n\tconfigurable: true\n});\n\n// Hijack addEventListener and removeEventListener to store callbacks\n\nif (self.EventTarget && \"addEventListener\" in EventTarget.prototype) {\n\tvar addEventListener = EventTarget.prototype.addEventListener,\n\t    removeEventListener = EventTarget.prototype.removeEventListener,\n\t    equal = function(callback, capture, l) {\n\t\t\treturn l.callback === callback && l.capture == capture;\n\t    },\n\t    notEqual = function() { \n\t\t\treturn !equal.apply(this, arguments); \n\t\t};\n\n\tEventTarget.prototype.addEventListener = function(type, callback, capture) {\n\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\tif (type.indexOf(\".\") > -1) {\n\t\t\t\ttype = type.split(\".\");\n\t\t\t\tvar className = type[1];\n\t\t\t\ttype = type[0];\n\t\t\t}\n\n\t\t\tlisteners[type] = listeners[type] || [];\n\n\t\t\tif (listeners[type].filter(equal.bind(null, callback, capture)).length === 0) {\n\t\t\t\tlisteners[type].push({callback: callback, capture: capture, className: className});\n\t\t\t}\n\t\t}\n\n\t\treturn addEventListener.call(this, type, callback, capture);\n\t};\n\n\tEventTarget.prototype.removeEventListener = function(type, callback, capture) {\n\t\tif (this && this[_] && this[_].bliss  && callback) {\n\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\tif (listeners[type]) {\n\t\t\t\tlisteners[type] = listeners[type].filter(notEqual.bind(null, callback, capture));\n\t\t\t}\n\t\t}\n\n\t\treturn removeEventListener.call(this, type, callback, capture);\n\t};\n}\n\n// Set $ and $$ convenience methods, if not taken\nself.$ = self.$ || $;\nself.$$ = self.$$ || $.$;\n\n})(Bliss);\n\n(function ($, $$) {\n\n\"use strict\";\n\nvar _ = self.Wysie = $.Class({\n\tconstructor: function (element) {\n\t\t_.all.push(this);\n\n\t\t// TODO escaping of # and \\\n\t\tvar dataStore = element.getAttribute(\"data-store\") || \"\";\n\t\tthis.store = dataStore === \"none\"? null : dataStore;\n\n\t\t// Assign a unique (for the page) id to this wysie instance\n\t\tthis.id = Wysie.Node.normalizeProperty(element) || element.id || \"wysie-\" + _.all.length;\n\n\t\tthis.autoEdit = _.has(\"autoedit\", element);\n\n\t\tthis.element = _.is(\"scope\", element)? element : $(_.selectors.rootScope, element);\n\n\t\tif (!this.element) {\n\t\t\telement.setAttribute(\"typeof\", element.getAttribute(\"property\") || \"\");\n\t\t\telement.removeAttribute(\"property\");\n\t\t\tthis.element = element;\n\t\t}\n\n\t\tthis.element.classList.add(\"wysie-root\");\n\n\t\t// Apply heuristic for collections\n\t\t$$(_.selectors.property + \", \" + _.selectors.scope).concat([this.element]).forEach(element => {\n\t\t\tif (_.is(\"autoMultiple\", element) && !element.hasAttribute(\"data-multiple\")) {\n\t\t\t\telement.setAttribute(\"data-multiple\", \"\");\n\t\t\t}\n\t\t});\n\n\t\tthis.wrapper = element.closest(\".wysie-wrapper\") || element;\n\n\t\t// Ctrl + S or Cmd + S to save\n\t\tthis.wrapper.addEventListener(\"keydown\", evt => {\n\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\tevt.preventDefault();\n\t\t\t\tthis.save();\n\t\t\t}\n\t\t});\n\n\t\t// Apply heuristic for scopes\n\t\t$$(_.selectors.primitive).forEach(element => {\n\t\t\tvar isScope = $(Wysie.selectors.property, element) && (// Contains other properties and...\n\t\t\t                Wysie.is(\"multiple\", element) || // is a collection...\n\t\t\t                Wysie.Primitive.getValueAttribute(element) === null\n\t\t\t\t\t      ); // ...or its content is not in an attribute\n\n\t\t\tif (isScope) {\n\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t}\n\t\t});\n\n\t\tif (this.wrapper === this.element && _.is(\"multiple\", element)) {\n\t\t\t// Need to create a wrapper\n\t\t\tvar around = this.element;\n\n\t\t\t// Avoid producing invalid HTML\n\t\t\tif (this.element.matches(\"li, option\")) {\n\t\t\t\taround = around.parentNode;\n\t\t\t}\n\t\t\telse if (this.element.matches(\"td, tr, tbody, thead, tfoot\")) {\n\t\t\t\taround = around.closest(\"table\");\n\t\t\t}\n\n\t\t\tthis.wrapper = $.create({ around });\n\t\t}\n\n\t\tthis.wrapper.classList.add(\"wysie-wrapper\");\n\n\t\telement.removeAttribute(\"data-store\");\n\n\t\t// Normalize property names\n\t\tthis.propertyNames = $$(_.selectors.property, this.wrapper).map(element => {\n\t\t\treturn Wysie.Node.normalizeProperty(element);\n\t\t}).sort((a, b) => b.length - a.length);\n\n\t\t// Is there any control that requires an edit button?\n\t\tthis.needsEdit = false;\n\n\t\t// Build wysie objects\n\t\tWysie.hooks.run(\"init-tree-before\", this);\n\t\tthis.root = Wysie.Node.create(this.element, this);\n\t\tWysie.hooks.run(\"init-tree-after\", this);\n\n\t\tthis.permissions = new Wysie.Permissions(null, this);\n\n\t\tthis.ui = {\n\t\t\tbar: $(\".wysie-bar\", this.wrapper) || $.create({\n\t\t\t\tclassName: \"wysie-bar wysie-ui\",\n\t\t\t\tstart: this.wrapper,\n\t\t\t\tcontents: {\n\t\t\t\t\ttag: \"span\",\n\t\t\t\t\tclassName: \"status\",\n\t\t\t\t}\n\t\t\t})\n\t\t};\n\n\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], () => {\n\t\t\tthis.ui.edit = $.create(\"button\", {\n\t\t\t\tclassName: \"edit\",\n\t\t\t\ttextContent: \"Edit\",\n\t\t\t\tonclick: e => this.editing? this.done() : this.edit()\n\t\t\t});\n\n\t\t\tthis.ui.save = $.create(\"button\", {\n\t\t\t\tclassName: \"save\",\n\t\t\t\ttextContent: \"Save\",\n\t\t\t\tevents: {\n\t\t\t\t\tclick: e => this.save(),\n\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\tthis.wrapper.classList.add(\"save-hovered\");\n\t\t\t\t\t\tthis.unsavedChanges = this.calculateUnsavedChanges();\n\t\t\t\t\t},\n\t\t\t\t\t\"mouseleave blur\": e => this.wrapper.classList.remove(\"save-hovered\")\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.ui.revert = $.create(\"button\", {\n\t\t\t\tclassName: \"revert\",\n\t\t\t\ttextContent: \"Revert\",\n\t\t\t\tdisabled: true,\n\t\t\t\tevents: {\n\t\t\t\t\tclick: e => this.revert(),\n\t\t\t\t\t\"mouseenter focus\": e => {\n\t\t\t\t\t\tif (this.everSaved) {\n\t\t\t\t\t\t\tthis.wrapper.classList.add(\"revert-hovered\");\n\t\t\t\t\t\t\tthis.unsavedChanges = this.calculateUnsavedChanges();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"mouseleave blur\": e => this.wrapper.classList.remove(\"revert-hovered\")\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.ui.editButtons = [this.ui.edit, this.ui.save, this.ui.revert];\n\n\t\t\t$.contents(this.ui.bar, this.ui.editButtons);\n\n\t\t\tif (this.autoEdit) {\n\t\t\t\trequestAnimationFrame(() => this.ui.edit.click());\n\t\t\t}\n\t\t}, () => { // cannot\n\t\t\t$.remove(this.ui.editButtons);\n\n\t\t\tif (this.editing) {\n\t\t\t\tthis.done();\n\t\t\t}\n\t\t});\n\n\t\tthis.permissions.can([\"delete\"], () => {\n\t\t\tthis.ui.clear = $.create(\"button\", {\n\t\t\t\tclassName: \"clear\",\n\t\t\t\ttextContent: \"Clear\",\n\t\t\t\tonclick: e => this.clear()\n\t\t\t});\n\n\t\t\tthis.ui.editButtons.push(this.ui.clear);\n\n\t\t\tthis.ui.bar.appendChild(this.ui.clear);\n\t\t}, () => { // cannot\n\t\t\t$.remove(this.ui.clear);\n\t\t});\n\n\t\t// Fetch existing data\n\n\t\tif (this.store) {\n\t\t\tthis.storage = new _.Storage(this);\n\n\t\t\tthis.permissions.can(\"read\", () => this.storage.load());\n\t\t}\n\t\telse {\n\t\t\t// No storage\n\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\tthis.root.import();\n\n\t\t\t$.fire(this.wrapper, \"wysie:load\");\n\t\t}\n\n\t\tif (!this.needsEdit) {\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\t\t}\n\n\t\tWysie.hooks.run(\"init-end\", this);\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetData: function(o) {\n\t\treturn this.root.getData(o);\n\t},\n\n\ttoJSON: function(data = this.data) {\n\t\treturn _.toJSON(data);\n\t},\n\n\trender: function(data) {\n\t\t_.hooks.run(\"render-start\", {context: this, data});\n\n\t\tif (!data) {\n\t\t\tthis.root.import();\n\t\t}\n\t\telse {\n\t\t\tthis.everSaved = true;\n\t\t\tthis.root.render(data.data || data);\n\t\t}\n\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tclear: function() {\n\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\tthis.storage && this.storage.clear();\n\t\t\tthis.root.clear();\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.editing = true;\n\n\t\tthis.root.edit();\n\n\t\t$.events(this.wrapper, \"mouseenter.wysie:edit mouseleave.wysie:edit\", evt => {\n\t\t\tif (evt.target.matches(\".wysie-item-controls .delete\")) {\n\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\titem.classList.toggle(\"delete-hover\", evt.type == \"mouseenter\");\n\t\t\t}\n\n\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\tevt.target.classList.remove(\"has-hovered-item\");\n\n\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\tif (parent) {\n\t\t\t\t\tparent.classList.toggle(\"has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.unsavedChanges = this.calculateUnsavedChanges();\n\t},\n\n\tcalculateUnsavedChanges: function() {\n\t\tvar unsavedChanges = false;\n\n\t\tthis.walk(obj => {\n\t\t\tif (obj.unsavedChanges) {\n\t\t\t\tunsavedChanges = true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn unsavedChanges;\n\t},\n\n\t// Conclude editing\n\tdone: function() {\n\t\tthis.root.done();\n\t\t$.unbind(this.wrapper, \".wysie:edit\");\n\t\tthis.editing = false;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tsave: function() {\n\t\tthis.root.save();\n\n\t\tif (this.storage) {\n\t\t\tthis.storage.save();\n\t\t}\n\n\t\tthis.everSaved = true;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\trevert: function() {\n\t\tthis.root.revert();\n\t},\n\n\twalk: function(callback) {\n\t\tthis.root.walk(callback);\n\t},\n\n\tlive: {\n\t\tediting: {\n\t\t\tset: function(value) {\n\t\t\t\tthis.wrapper.classList.toggle(\"editing\", value);\n\n\t\t\t\tif (value) {\n\t\t\t\t\tthis.wrapper.setAttribute(\"data-editing\", \"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.wrapper.removeAttribute(\"data-editing\");\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tthis.wrapper.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\tthis.ui.save.disabled = !value;\n\t\t\t\tthis.ui.revert.disabled = !this.everSaved || !value;\n\t\t\t}\n\t\t},\n\n\t\teverSaved: function(value) {\n\t\t\tif (this.ui && this.ui.revert) {\n\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: [],\n\n\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0? \"metaKey\" : \"ctrlKey\",\n\n\t\tinit: (container) => $$(\"[data-store]\", container).map(element => new _(element)),\n\n\t\ttoJSON: data => {\n\t\t\tif (data === null) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\n\t\t\tif (typeof data === \"string\") {\n\t\t\t\t// Do not stringify twice!\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\treturn JSON.stringify(data, null, \"\\t\");\n\t\t},\n\n\t\t// Convert an identifier to readable text that can be used as a label\n\t\treadable: function (identifier) {\n\t\t\t// Is it camelCase?\n\t\t\treturn identifier && identifier\n\t\t\t         .replace(/([a-z])([A-Z])(?=[a-z])/g, ($0, $1, $2) => $1 + \" \" + $2.toLowerCase()) // camelCase?\n\t\t\t         .replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t         .replace(/^[a-z]/, $0 => $0.toUpperCase()); // Capitalize\n\t\t},\n\n\t\t// Inverse of _.readable(): Take a readable string and turn it into an identifier\n\t\tidentifier: function (readable) {\n\t\t\treadable = readable + \"\";\n\t\t\treturn readable && readable\n\t\t\t         .replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t         .replace(/[^\\w-]/g, \"\") // Remove weird characters\n\t\t\t         .toLowerCase();\n\t\t},\n\n\t\tqueryJSON: function(data, path) {\n\t\t\tif (!path || !data) {\n\t\t\t\treturn data;\n\t\t\t}\n\n\t\t\treturn $.value.apply($, [data].concat(path.split(\"/\")));\n\t\t},\n\n\t\tobserve: function(element, attribute, callback, oldValue) {\n\t\t\tvar observer = $.type(callback) == \"function\"? new MutationObserver(callback) : callback;\n\n\t\t\tvar options = attribute? {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeFilter: [attribute],\n\t\t\t\t\tattributeOldValue: !!oldValue\n\t\t\t\t} : {\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tcharacterDataOldValue: !!oldValue\n\t\t\t\t};\n\n\t\t\tobserver.observe(element, options);\n\n\t\t\treturn observer;\n\t\t},\n\n\t\t// If the passed value is not an array, convert to an array\n\t\ttoArray: arr => {\n\t\t\treturn Array.isArray(arr)? arr : [arr];\n\t\t},\n\n\t\t// Recursively flatten a multi-dimensional array\n\t\tflatten: arr => {\n\t\t\tif (!Array.isArray(arr)) {\n\t\t\t\treturn [arr];\n\t\t\t}\n\n\t\t\treturn arr.reduce((prev, c) => _.toArray(prev).concat(_.flatten(c)), []);\n\t\t},\n\n\t\tis: function(thing, element) {\n\t\t\treturn element.matches && element.matches(_.selectors[thing]);\n\t\t},\n\n\t\thas: function(option, element) {\n\t\t\treturn element.matches && element.matches(_.selectors.option(option));\n\t\t},\n\n\t\thooks: new $.Hooks()\n\t}\n});\n\n{\n\nlet s = _.selectors = {\n\tproperty: \"[property], [itemprop]\",\n\tspecificProperty: name => `[property=${name}], [itemprop=${name}]`,\n\tscope: \"[typeof], [itemscope], [itemtype], .scope\",\n\tmultiple: \"[multiple], [data-multiple], .multiple\",\n\trequired: \"[required], [data-required], .required\",\n\tformControl: \"input, select, textarea\",\n\tcomputed: \".computed\", // Properties or scopes with computed properties, will not be saved\n\titem: \".wysie-item\",\n\tui: \".wysie-ui\",\n\toption: name => `[${name}], [data-${name}], [data-wysie-options~='${name}'], .${name}`,\n\tcontainer: {\n\t\t\"li\": \"ul, ol\",\n\t\t\"tr\": \"table\",\n\t\t\"option\": \"select\",\n\t\t\"dt\": \"dl\",\n\t\t\"dd\": \"dl\"\n\t}\n};\n\nlet arr = s.arr = selector => selector.split(/\\s*,\\s*/g);\nlet not = s.not = selector => arr(selector).map(s => `:not(${s})`).join(\"\");\nlet or = s.or = (selector1, selector2) => selector1 + \", \" + selector2;\nlet and = s.and = (selector1, selector2) => _.flatten(\n\t\tarr(selector1).map(s1 => arr(selector2).map(s2 => s1 + s2))\n\t).join(\", \");\nlet andNot = s.andNot = (selector1, selector2) => and(selector1, not(selector2));\n\n$.extend(_.selectors, {\n\tprimitive: andNot(s.property, s.scope),\n\trootScope: andNot(s.scope, s.property),\n\toutput: or(s.specificProperty(\"output\"), \".output, .value\"),\n\tautoMultiple: and(\"li, tr, option\", \":only-of-type\")\n});\n\n}\n\n// Bliss plugins\n\n// Provide shortcuts to long property chains\n$.proxy = $.classProps.proxy = $.overload(function(obj, property, proxy) {\n\tObject.defineProperty(obj, property, {\n\t\tget: function() {\n\t\t\treturn this[proxy][property];\n\t\t},\n\t\tset: function(value) {\n\t\t\tthis[proxy][property] = value;\n\t\t},\n\t\tconfigurable: true,\n\t\tenumerable: true\n\t});\n\n\treturn obj;\n});\n\n$.classProps.propagated = function(proto, names) {\n\tWysie.toArray(names).forEach(name => {\n\t\tvar existing = proto[name];\n\n\t\tproto[name] = function() {\n\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\tthis.propagate(name);\n\t\t\t}\n\t\t};\n\t});\n};\n\n// :focus-within shim\ndocument.addEventListener(\"focus\", evt => {\n\t$$(\".focus-within\").forEach(el => el.classList.remove(\"focus-within\"));\n\n\tvar element = evt.target;\n\n\twhile (element = element.parentNode) {\n\t\tif (element.classList) {\n\t\t\telement.classList.add(\"focus-within\");\n\t\t}\n\t}\n}, true);\n\n// Init wysie\nPromise.all([\n\t$.ready(),\n\t$.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")\n])\n.then(() => Wysie.init())\n.catch(err => {\n\tconsole.error(err);\n\tWysie.init();\n});\n\nStretchy.selectors.filter = \".wysie-editor:not([property])\";\n\n})(Bliss, Bliss.$);\n\n(function($) {\n\nvar _ = Wysie.Permissions = $.Class({\n\tconstructor: function(o, wysie) {\n\t\tthis.triggers = [];\n\t\tthis.wysie = wysie;\n\n\t\tthis.set(o);\n\t},\n\n\t// Set multiple permissions at once\n\tset: function(o) {\n\t\tfor (var action in o) {\n\t\t\tthis[action] = o[action];\n\t\t}\n\t},\n\n\t// Set a bunch of permissions to true. Chainable.\n\ton: function(actions) {\n\t\tWysie.toArray(actions).forEach(action => this[action] = true);\n\n\t\treturn this;\n\t},\n\n\t// Set a bunch of permissions to false. Chainable.\n\toff: function(actions) {\n\t\tactions = Array.isArray(actions)? actions : [actions];\n\n\t\tactions.forEach(action => this[action] = false);\n\n\t\treturn this;\n\t},\n\n\t// Fired once at least one of the actions passed can be performed\n\t// Kind of like a Promise that can be resolved multiple times.\n\tcan: function(actions, callback, cannot) {\n\t\tthis.observe(actions, true, callback);\n\n\t\tif (cannot) {\n\t\t\t// Fired once the action cannot be done anymore, even though it could be done before\n\t\t\tthis.observe(actions, false, cannot);\n\t\t}\n\t},\n\n\t// Like this.can(), but returns a promise\n\t// Useful for things that you want to do only once\n\twhen: function(actions) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.can(actions, resolve, reject);\n\t\t});\n\t},\n\n\t// Schedule a callback for when a set of permissions changes value\n\tobserve: function(actions, value, callback) {\n\t\tactions = Array.isArray(actions)? actions : [actions];\n\n\t\tif (this.is(actions, value)) {\n\t\t\t// Should be fired immediately\n\t\t\tcallback();\n\t\t}\n\n\t\t// For future transitions\n\t\tthis.triggers.push({ actions, value, callback, active: true });\n\t},\n\n\t// Compare a set of permissions with true or false\n\t// If comparing with true, we want at least one to be true, i.e. OR\n\t// If comparing with false, we want ALL to be false, i.e. NOR\n\tis: function(actions, able) {\n\t\tvar or = actions.map(action => !!this[action])\n\t\t                .reduce((prev, current) => prev || current);\n\n\t\treturn able? or : !or;\n\t},\n\n\t// A single permission changed value\n\tchanged: function(action, value, from) {\n\t\tfrom = !!from;\n\t\tvalue = !!value;\n\n\t\tif (value == from) {\n\t\t\t// Nothing changed\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.wysie) {\n\t\t\tthis.wysie.wrapper.classList.toggle(`can-${action}`, value);\n\t\t}\n\n\t\t// $.live() calls the setter before the actual property is set so we\n\t\t// need to set it manually, otherwise it still has its previous value\n\t\tthis[\"_\" + action] = value;\n\n\t\t// TODO add classes to wrapper\n\t\tthis.triggers.forEach(trigger => {\n\t\t\tvar match = this.is(trigger.actions, trigger.value);\n\n\t\t\tif (trigger.active && trigger.actions.indexOf(action) > -1 && match) {\n\n\t\t\t\ttrigger.active = false;\n\t\t\t\ttrigger.callback();\n\t\t\t}\n\t\t\telse if (!match) {\n\t\t\t\t// This is so that triggers can only be executed in an actual transition\n\t\t\t\t// And that if there is a trigger for [a,b] it won't be executed twice\n\t\t\t\t// if a and b are set to true one after the other\n\t\t\t\ttrigger.active = true;\n\t\t\t}\n\t\t});\n\t},\n\n\tor: function(permissions) {\n\t\t_.actions.forEach(action => {\n\t\t\tthis[action] = this[action] || permissions[action];\n\t\t});\n\n\t\treturn this;\n\t},\n\n\tstatic: {\n\t\tactions: [],\n\n\t\t// Register a new permission type\n\t\tregister: function(action, setter) {\n\t\t\tif (Array.isArray(action)) {\n\t\t\t\taction.forEach(action => _.register(action, setter));\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.live(_.prototype, action, function(able, previous) {\n\t\t\t\tif (setter) {\n\t\t\t\t\tsetter.call(this, able, previous);\n\t\t\t\t}\n\n\t\t\t\tthis.changed(action, able, previous);\n\t\t\t});\n\n\t\t\t_.actions.push(action);\n\t\t}\n\t}\n});\n\n_.register([\"read\", \"save\"]);\n\n_.register(\"login\", function(can) {\n\tif (can && this.logout) {\n\t\tthis.logout = false;\n\t}\n});\n\n_.register(\"logout\", function(can) {\n\tif (can && this.login) {\n\t\tthis.login = false;\n\t}\n});\n\n_.register(\"edit\", function(can) {\n\tif (can) {\n\t\tthis.add = this.delete = true;\n\t}\n});\n\n_.register([\"add\", \"delete\"], function(can) {\n\tif (!can) {\n\t\tthis.edit = false;\n\t}\n});\n\n})(Bliss);\n\n(function($) {\n\nvar _ = Wysie.Storage = $.Class({\n\tconstructor: function(wysie) {\n\t\tthis.wysie = wysie;\n\n\t\tvar keywords = RegExp(`^(?:${_.Backend.backends.map(a => a.id).join(\"|\")})$`, \"i\");\n\t\tthis.urls = wysie.store.split(/\\s+/).map(url => {\n\t\t\treturn keywords.test(url)? url : new URL(url, location);\n\t\t});\n\n\t\tthis.backends = Wysie.flatten(this.urls.map(url => _.Backend.create(url, this)));\n\n\t\tthis.backends[0].permissions = this.wysie.permissions.or(this.backends[0].permissions);\n\n\t\tthis.ready = Promise.all(this.backends.map(backend => backend.ready));\n\n\t\tthis.loaded = new Promise((resolve, reject) => {\n\t\t\tthis.wysie.wrapper.addEventListener(\"wysie:load\", resolve);\n\t\t});\n\n\t\tthis.authControls = {};\n\n\t\tthis.permissions.can(\"login\", () => {\n\t\t\t// #login authenticates if only 1 wysie on the page, or if the first.\n\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\tthis.loginHash = \"#login\" + (Wysie.all[0] === this.wysie? \"\" : \"-\" + this.wysie.id);\n\n\t\t\tthis.authControls.login = $.create({\n\t\t\t\ttag: \"a\",\n\t\t\t\thref: this.loginHash,\n\t\t\t\ttextContent: \"Login\",\n\t\t\t\tclassName: \"login button\",\n\t\t\t\tevents: {\n\t\t\t\t\tclick: evt => {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\tthis.login();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tafter: $(\".status\", this.wysie.bar)\n\t\t\t});\n\n\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\tvar login;\n\t\t\t(login = () => {\n\t\t\t\tif (location.hash === this.loginHash) {\n\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\tthis.login();\n\t\t\t\t}\n\t\t\t})();\n\t\t\twindow.addEventListener(\"hashchange.wysie\", login);\n\t\t}, () => {\n\t\t\t$.remove(this.authControls.login);\n\t\t\tthis.wysie.wrapper._.unbind(\"hashchange.wysie\");\n\t\t});\n\n\t\t// Update login status\n\t\tthis.wysie.wrapper.addEventListener(\"wysie:login.wysie\", evt => {\n\t\t\tvar status = $(\".status\", this.wysie.bar);\n\t\t\tstatus.innerHTML = \"\";\n\t\t\tstatus._.contents([\n\t\t\t\t\"Logged in to \" + evt.backend.id + \" as \",\n\t\t\t\t{tag: \"strong\", innerHTML: evt.name},\n\t\t\t\t{\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\tclassName: \"logout\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: e => evt.backend.logout()\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t]);\n\t\t});\n\n\t\tthis.wysie.wrapper.addEventListener(\"wysie:logout.wysie\", evt => {\n\t\t\t$(\".status\", this.wysie.bar).textContent = \"\";\n\t\t});\n\t},\n\n\tget getBackends () {\n\t\treturn this.backends.filter(backend => !!backend.get);\n\t},\n\n\tget putBackends () {\n\t\treturn this.backends.filter(backend => !!backend.put);\n\t},\n\n\tget authBackends () {\n\t\treturn this.backends.filter(backend => !!backend.login);\n\t},\n\n\tproxy: {\n\t\tpermissions: \"wysie\"\n\t},\n\n\t/**\n\t * load - Fetch data from source and render it.\n\t *\n\t * @return {Promise}  A promise that resolves when the data is loaded.\n\t */\n\tload: function() {\n\t\tvar ret = this.ready;\n\n\t\tthis.inProgress = \"Loading\";\n\n\t\tvar getBackend = this.getBackends[0];\n\n\t\tif (getBackend) {\n\t\t\tgetBackend.ready\n\t\t\t.then(() => getBackend.get())\n\t\t\t.then(response => {\n\t\t\t\tthis.inProgress = false;\n\t\t\t\tthis.wysie.wrapper._.fire(\"wysie:load\");\n\n\t\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t}\n\n\t\t\t\tvar data = Wysie.queryJSON(response, this.param(\"root\"));\n\n\t\t\t\tthis.wysie.render(data);\n\t\t\t}).catch(err => {\n\t\t\t\t// TODO try more backends if this fails\n\t\t\t\tthis.inProgress = false;\n\n\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\tthis.wysie.render(\"\");\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\n\t\t\t\tthis.wysie.wrapper._.fire(\"wysie:load\");\n\t\t\t});\n\t\t}\n\t},\n\n\tsave: function(data = this.wysie.data) {\n\t\tthis.inProgress = \"Saving\";\n\n\t\tPromise.all(this.putBackends.map(backend => {\n\t\t\treturn backend.login().then(() => {\n\t\t\t\treturn backend.put({\n\t\t\t\t\tname: backend.filename,\n\t\t\t\t\tpath: backend.path,\n\t\t\t\t\tdata: data\n\t\t\t\t});\n\t\t\t});\n\t\t})).then(() => {\n\t\t\tthis.wysie.wrapper._.fire(\"wysie:save\");\n\n\t\t\tthis.inProgress = false;\n\t\t}).catch(err => {\n\t\t\tthis.inProgress = false;\n\n\t\t\tif (err) {\n\t\t\t\tconsole.error(err);\n\t\t\t\tconsole.log(err.stack);\n\t\t\t}\n\t\t});\n\t},\n\n\tlogin: function() {\n\t\treturn this.authBackends[0] && this.authBackends[0].login();\n\t},\n\n\tlogout: function() {\n\t\treturn this.authBackends[0] && this.authBackends[0].logout();\n\t},\n\n\tclear: function() {\n\t\tthis.save(null);\n\t},\n\n\t// Get storage parameters from the main element and cache them. Used for API keys and the like.\n\tparam: function(id) {\n\t\t// TODO traverse all properties and cache params in constructor, to avoid\n\t\t// collection items carrying all of these\n\t\tthis.params = this.params || {};\n\n\t\tif (!(id in this.params)) {\n\t\t\tvar attribute = \"data-store-\" + id;\n\n\t\t\tthis.params[id] = this.wysie.wrapper.getAttribute(attribute) || this.wysie.element.getAttribute(attribute);\n\n\t\t\tthis.wysie.wrapper.removeAttribute(attribute);\n\t\t\tthis.wysie.element.removeAttribute(attribute);\n\t\t}\n\n\t\treturn this.params[id];\n\t},\n\n\tlive: {\n\t\tinProgress: function(value) {\n\t\t\tif (value) {\n\t\t\t\tvar p = $.create(\"div\", {\n\t\t\t\t\ttextContent: value + \"\",\n\t\t\t\t\tclassName: \"progress\",\n\t\t\t\t\tinside: this.wysie.wrapper\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$.remove($(\".progress\", this.wysie.wrapper));\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tisHash: url => (url.origin === location.origin) && (url.pathname === location.pathname) && !!url.hash,\n\t}\n});\n\n// Base class for all backends\n_.Backend = $.Class({\n\tconstructor: function(url, storage) {\n\t\tthis.url = url;\n\t\tthis.storage = storage;\n\t\tthis.id = this.constructor.id;\n\n\t\t// Permissions of this particular backend.\n\t\t// Global permissions are OR(all permissions)\n\t\tthis.permissions = new Wysie.Permissions();\n\n\t\tWysie.Permissions.actions.forEach(action => {\n\t\t\tthis.permissions.can(action, () => {\n\t\t\t\tthis.storage.permissions.on(action);\n\t\t\t}, () => {\n\t\t\t\t// TODO off\n\t\t\t});\n\t\t});\n\t},\n\n\t// To be be overriden by subclasses\n\tready: Promise.resolve(),\n\tlogin: () => Promise.resolve(),\n\tlogout: () => Promise.resolve(),\n\n\tproxy: {\n\t\twysie: \"storage\"\n\t},\n\n\tstatic: {\n\t\t// Return the appropriate backend(s) for this url\n\t\tcreate: function(url, storage) {\n\t\t\tvar ret = [];\n\n\t\t\t_.Backend.backends.forEach(Backend => {\n\t\t\t\tif (Backend && Backend.test(url)) {\n\t\t\t\t\tvar backend = new Backend(url, storage);\n\t\t\t\t\tbackend.id = Backend.id;\n\t\t\t\t\tret.push(backend);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tbackends: [],\n\n\t\tadd: function(name, Class, first) {\n\t\t\t_.Backend[name] = Class;\n\t\t\t_.Backend.backends[first? \"unshift\" : \"push\"](Class);\n\t\t\tClass.id = name;\n\t\t}\n\t}\n});\n\n// Save in an element\n_.Backend.add(\"Element\", $.Class({ extends: _.Backend,\n\tconstructor: function () {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\n\t\tthis.element = $(this.url.hash);\n\t},\n\n\tget: function() {\n\t\treturn Promise.resolve(this.element.textContent);\n\t},\n\n\tput: function({data = \"\"}) {\n\t\tthis.element.textContent = this.wysie.toJSON(data);\n\t\treturn Promise.resolve();\n\t},\n\n\tstatic: {\n\t\ttest: (url) => {\n\t\t\tif (_.isHash(url)) {\n\t\t\t\treturn !!$(url.hash);\n\t\t\t}\n\t\t}\n\t}\n}));\n\n// Load from a remote URL, no save\n_.Backend.add(\"Remote\", $.Class({ extends: _.Backend,\n\tconstructor: function() {\n\t\tthis.permissions.on([\"read\"]);\n\t},\n\n\tget: function() {\n\t\treturn $.fetch(this.url.href, {\n\t\t\tresponseType: \"json\"\n\t\t})\n\t\t.then(xhr => Promise.resolve(xhr.response), () => Promise.resolve(null));\n\t},\n\n\tstatic: {\n\t\ttest: url => url instanceof URL && !_.isHash(url)\n\t}\n}));\n\n// Save in localStorage\n_.Backend.add(\"Local\", $.Class({ extends: _.Backend,\n\tconstructor: function() {\n\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t\tthis.key = this.wysie.id;\n\t},\n\n\tget: function() {\n\t\treturn Promise.resolve(localStorage[this.key]);\n\t},\n\n\tput: function({data = \"\"}) {\n\t\tlocalStorage[this.key] = this.wysie.toJSON(data);\n\t\treturn Promise.resolve();\n\t},\n\n\tstatic: {\n\t\ttest: (value) => value == \"local\"\n\t}\n}));\n\n})(Bliss);\n\n(function($, $$) {\n\nvar _ = Wysie.Node = $.Class({\n\tabstract: true,\n\tconstructor: function (element, wysie, o = {}) {\n\t\tif (!element || !wysie) {\n\t\t\tthrow new Error(\"Wysie.Node constructor requires an element argument and a wysie object\");\n\t\t}\n\n\t\tthis.element = element;\n\t\tthis.template = o.template;\n\n\t\tthis.wysie = wysie;\n\t\tthis.property = element.getAttribute(\"property\");\n\t\tthis.type = Wysie.Scope.normalize(element);\n\n\t\tWysie.hooks.run(\"node-init-end\", this);\n\t},\n\n\tget isRoot() {\n\t\treturn !this.property;\n\t},\n\n\tget name() {\n\t\treturn Wysie.readable(this.property || this.type).toLowerCase();\n\t},\n\n\tget data() {\n\t\treturn this.getData();\n\t},\n\n\tgetRelativeData: function(o = { dirty: true, computed: true, null: true }) {\n\t\tvar ret = this.getData(o);\n\n\t\tif (self.Proxy && ret && typeof ret === \"object\") {\n\t\t\tret = new Proxy(ret, {\n\t\t\t\tget: (data, property) => {\n\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\treturn data[property];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\treturn this.index + 1;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Look in ancestors\n\t\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t// TODO decouple\n\t\t\t\t\t\t\tscope.expressions.updateAlso.add(this.expressions);\n\n\t\t\t\t\t\t\treturn scope.properties[property].getRelativeData(o);\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\thas: (data, property) => {\n\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Property does not exist, look for it elsewhere\n\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// First look in ancestors\n\t\t\t\t\tvar ret = this.walkUp(scope => {\n\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\treturn ret;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\tret = this.find(property);\n\n\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\t\tret = ret.map(item => item.getData(o))\n\t\t\t\t\t\t\t         .filter(item => item !== null);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tret = ret.getData(o);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\tset: function(data, property, value) {\n\t\t\t\t\tthrow Error(\"You cant set data via expressions.\");\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\twalk: function(callback) {\n\t\tvar walker = obj => {\n\t\t\tvar ret = callback(obj);\n\n\t\t\tif (ret !== false) {\n\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t}\n\t\t};\n\n\t\twalker(this);\n\t},\n\n\twalkUp: function(callback) {\n\t\tvar scope = this;\n\n\t\twhile (scope = scope.parentScope) {\n\t\t\tvar ret = callback(scope);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tcall: function(callback, ...args) {\n\t\targs = args || [];\n\n\t\tif (typeof callback === \"string\") {\n\t\t\treturn this[callback](...args);\n\t\t}\n\t\telse {\n\t\t\treturn callback.apply(this, [this, ...args]);\n\t\t}\n\t},\n\n\tedit: function() {\n\t\tthis.propagate(obj => obj[obj.preEdit? \"preEdit\" : \"edit\"]());\n\t},\n\n\tpropagated: [\"save\", \"revert\", \"done\", \"import\"],\n\n\ttoJSON: Wysie.prototype.toJSON,\n\n\tstatic: {\n\t\tcreate: function(element, wysie, o = {}) {\n\t\t\tif (Wysie.is(\"multiple\", element) && !o.collection) {\n\t\t\t\treturn new Wysie.Collection(element, wysie, o);\n\t\t\t}\n\n\t\t\treturn Wysie.Unit.create(...arguments);\n\t\t},\n\n\t\tnormalizeProperty: function(element) {\n\t\t\t// Get & normalize property name, if exists\n\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t}\n\n\t\t\tif (property) {\n\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t}\n\n\t\t\treturn property;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n/*\n * Wysie Unit: Super class that Scope and Primitive inherit from\n */\n(function($, $$) {\n\nvar _ = Wysie.Unit = $.Class({\n\tabstract: true,\n\textends: Wysie.Node,\n\tconstructor: function(element, wysie, o = {}) {\n\t\tthis.constructor.all.set(this.element, this);\n\n\t\tthis.collection = o.collection;\n\n\t\tif (this.collection) {\n\t\t\t// This is a collection item\n\t\t\tthis.scope = this.parentScope = this.collection.parentScope;\n\t\t}\n\n\t\tif (this.template) {\n\t\t\t$.extend(this, this.template, [\"computed\", \"required\"]);\n\t\t}\n\t\telse {\n\t\t\tthis.computed = Wysie.is(\"computed\", this.element);\n\t\t\tthis.required = Wysie.is(\"required\", this.element);\n\t\t}\n\n\t\tWysie.hooks.run(\"unit-init-end\", this);\n\t},\n\n\t/**\n\t * Check if this unit is either deleted or inside a deleted scope\n\t */\n\tisDeleted: function() {\n\t\tvar ret = this.deleted;\n\n\t\tif (this.deleted) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn !!this.parentScope && this.parentScope.isDeleted();\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar isNull = unit => !unit.everSaved && !o.dirty ||\n\t\t                      unit.deleted && o.dirty ||\n\t\t                      unit.computed && !o.computed ||\n\t\t                      unit.placeholder;\n\n\t\tif (isNull(this)) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Check if any of the parent scopes doesn't return data\n\t\tthis.walkUp(scope => {\n\t\t\tif (isNull(scope)) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t},\n\n\tlazy: {\n\t\tclosestCollection: function() {\n\t\t\tif (this.collection) {\n\t\t\t\treturn this.collection;\n\t\t\t}\n\n\t\t\treturn this.walkUp(scope => {\n\t\t\t\tif (scope.collection) {\n\t\t\t\t\treturn scope.collection;\n\t\t\t\t}\n\t\t\t}) || null;\n\t\t}\n\t},\n\n\tlive: {\n\t\tdeleted: function(value) {\n\t\t\tthis.element.classList.toggle(\"deleted\", value);\n\n\t\t\tif (value) {\n\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t$$(this.element.childNodes).forEach(node => {\n\t\t\t\t\tthis.elementContents.appendChild(node);\n\t\t\t\t});\n\n\t\t\t\t$.contents(this.element, [\n\t\t\t\t\t\"Deleted \" + this.name,\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.deleted = false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]);\n\n\t\t\t\tthis.element.classList.remove(\"delete-hover\");\n\t\t\t}\n\t\t\telse if (this.deleted) {\n\t\t\t\t// Undelete\n\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\tthis._deleted = false;\n\n\t\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\t\tunit: this.collection,\n\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\taction: \"undelete\",\n\t\t\t\t\titem: this\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tunsavedChanges: function(value) {\n\t\t\tif (this.placeholder) {\n\t\t\t\tvalue = false;\n\t\t\t}\n\n\t\t\tthis.element.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\treturn value;\n\t\t},\n\n\t\tplaceholder: function(value) {\n\t\t\tthis.element.classList.toggle(\"placeholder\", value);\n\t\t}\n\t},\n\n\tstatic: {\n\t\tget: function(element, prioritizePrimitive) {\n\t\t\tvar scope = Wysie.Scope.all.get(element);\n\n\t\t\treturn (prioritizePrimitive || !scope)? Wysie.Primitive.all.get(element) : scope;\n\t\t},\n\n\t\tcreate: function(element, wysie, o = {}) {\n\t\t\tif (!element || !wysie) {\n\t\t\t\tthrow new TypeError(\"Wysie.Unit.create() requires an element argument and a wysie object\");\n\t\t\t}\n\n\t\t\treturn new Wysie[Wysie.is(\"scope\", element)? \"Scope\" : \"Primitive\"](element, wysie, o);\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Wysie.Expression = $.Class({\n\tconstructor: function(expression) {\n\t\tthis.expression = expression;\n\t},\n\n\teval: function(data) {\n\t\tthis.oldValue = this.value;\n\n\t\t// TODO convert to new Function() which is more optimizable by JS engines.\n\t\t// Also, cache the function, since only data changes across invocations.\n\t\tWysie.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\ttry {\n\t\t\tif (!this.function) {\n\t\t\t\tthis.function = this.createFunction();\n\t\t\t}\n\n\t\t\tthis.value = this.function(data);\n\t\t}\n\t\tcatch (exception) {\n\t\t\tWysie.hooks.run(\"expression-eval-error\", {context: this, exception});\n\n\t\t\tthis.value = _.ERROR;\n\t\t}\n\n\t\treturn this.value;\n\t},\n\n\ttoString() {\n\t\treturn `=(${this.expression})`;\n\t},\n\n\tcreateFunction: function() {\n\t\tvar code = this.expression;\n\n\t\tif (/^if\\([\\S\\s]+\\)$/i.test(code)) {\n\t\t\tcode = code.replace(/^if\\(/, \"iff(\");\n\t\t}\n\n\t\t// Transform simple operators to array-friendly math functions\n\t\tcode = code.replace(_.simpleOperation, (expr, operand1, operator, operand2) => {\n\t\t\tvar ret = `(${Wysie.Functions.operators[operator]}(${operand1}, ${operand2}))`;\n\t\t\treturn ret;\n\t\t});\n\n\t\t_.simpleOperation.lastIndex = 0;\n\n\t\treturn new Function(\"data\", `with(Wysie.Functions._Trap)\n\t\t\t\twith(data) {\n\t\t\t\t\treturn ${code};\n\t\t\t\t}`);\n\t},\n\n\tlive: {\n\t\texpression: function(value) {\n\t\t\tvar code = value = value.trim();\n\n\t\t\tthis.function = null;\n\t\t}\n\t},\n\n\tstatic: {\n\t\tERROR: \"N/A\",\n\n\t\tlazy: {\n\t\t\tsimpleOperation: function() {\n\t\t\t\tvar operator = Object.keys(Wysie.Functions.operators).map(o => o.replace(/[|*+]/g, \"\\\\$&\")).join(\"|\");\n\t\t\t\tvar operand = \"\\\\s*(\\\\b[\\\\w.]+\\\\b)\\\\s*\";\n\n\t\t\t\treturn RegExp(`(?:^|\\\\()${operand}(${operator})${operand}(?:$|\\\\))`, \"g\");\n\t\t\t}\n\t\t}\n\t}\n});\n\n(function() {\n\nvar _ = Wysie.Expression.Text = $.Class({\n\tconstructor: function(o) {\n\t\tthis.all = o.all; // the Wysie.Expressions object that this belongs to\n\t\tthis.node = o.node;\n\t\tthis.path = o.path;\n\n\t\tif (!this.node) {\n\t\t\t// No node provided, figure it out from path\n\t\t\tthis.node = this.path.reduce((node, index) => {\n\t\t\t\treturn node.childNodes[index];\n\t\t\t}, this.all.scope.element);\n\t\t}\n\n\t\tthis.element = this.node;\n\n\t\tthis.attribute = o.attribute || null;\n\n\t\tif (this.node.nodeType === 3) {\n\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\tthis.node = this.element;\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\t\t}\n\n\t\tthis.expression = this.text.trim();\n\t\tthis.template = this.tokenize(this.expression);\n\n\t\tWysie.hooks.run(\"expressiontext-init-end\", this);\n\n\t\t_.elements.set(this.element, [...(_.elements.get(this.element) || []), this]);\n\t},\n\n\tget text() {\n\t\treturn this.attribute? this.node.getAttribute(this.attribute) : this.node.textContent;\n\t},\n\n\tset text(value) {\n\t\tthis.oldText = this.text;\n\n\t\tWysie.Primitive.setValue(this.node, value, this.attribute);\n\t},\n\n\tupdate: function(data) {\n\t\tthis.value = [];\n\t\tthis.data = data;\n\n\t\tthis.text = this.template.map(expr => {\n\t\t\tif (expr instanceof Wysie.Expression) {\n\t\t\t\tvar env = {context: this, expr};\n\n\t\t\t\tWysie.hooks.run(\"expressiontext-update-beforeeval\", env);\n\n\t\t\t\tenv.value = env.expr.eval(data);\n\n\t\t\t\tWysie.hooks.run(\"expressiontext-update-aftereval\", env);\n\n\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t// Dont print things like \"undefined\" or \"null\"\n\t\t\t\t\tthis.value.push(\"\");\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\tthis.value.push(env.value);\n\n\t\t\t\tif (typeof env.value === \"number\" && !this.attribute) {\n\t\t\t\t\tenv.value = _.formatNumber(env.value);\n\t\t\t\t}\n\t\t\t\telse if (Array.isArray(env.value)) {\n\t\t\t\t\tenv.value = env.value.join(\", \");\n\t\t\t\t};\n\n\t\t\t\treturn env.value;\n\t\t\t}\n\n\t\t\tthis.value.push(expr);\n\t\t\treturn expr;\n\t\t}).join(\"\");\n\n\t\tif (this.primitive && this.template.length === 1) {\n\t\t\tif (typeof this.value[0] === \"number\") {\n\t\t\t\tthis.primitive.datatype = \"number\";\n\t\t\t}\n\t\t\telse if (typeof this.value[0] === \"boolean\") {\n\t\t\t\tthis.primitive.datatype = \"boolean\";\n\t\t\t}\n\t\t}\n\n\t\tthis.value = this.value.join(\"\");\n\n\t\tif (this.primitive) {\n\t\t\tif (!this.attribute) {\n\t\t\t\tWysie.Primitive.setValue(this.element, this.value, \"content\");\n\t\t\t}\n\t\t}\n\t},\n\n\ttokenize: function(template) {\n\t\tvar regex = this.expressionRegex;\n\t\tvar match, ret = [], lastIndex = 0;\n\n\t\tregex.lastIndex = 0;\n\n\t\twhile ((match = regex.exec(template)) !== null) {\n\t\t\t// Literal before the expression\n\t\t\tif (match.index > lastIndex) {\n\t\t\t\tret.push(template.substring(lastIndex, match.index));\n\t\t\t}\n\n\t\t\tlastIndex = regex.lastIndex = _.findEnd(template.slice(match.index)) + match.index + 1;\n\t\t\tvar expression = template.slice(match.index + 1, lastIndex - 1);\n\n\t\t\tret.push(new Wysie.Expression(expression));\n\t\t}\n\n\t\t// Literal at the end\n\t\tif (lastIndex < template.length) {\n\t\t\tret.push(template.substring(lastIndex));\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tlazy: {},\n\n\tproxy: {\n\t\tscope: \"all\",\n\t\texpressionRegex: \"all\"\n\t},\n\n\tstatic: {\n\t\telements: new WeakMap(),\n\n\t\t// Find where a ( or [ or { ends.\n\t\tfindEnd: function(expr) {\n\t\t\tvar stack = [];\n\t\t\tvar inside, insides = \"\\\"'`\";\n\t\t\tvar open = \"([{\", close = \")]}\";\n\t\t\tvar isEscape;\n\n\t\t\tfor (var i=0; expr[i]; i++) {\n\t\t\t\tvar char = expr[i];\n\n\t\t\t\tif (inside) {\n\t\t\t\t\tif (char === inside && !isEscape) {\n\t\t\t\t\t\tinside = \"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (!isEscape && insides.indexOf(char) > -1) {\n\t\t\t\t\tinside = char;\n\t\t\t\t}\n\t\t\t\telse if (open.indexOf(char) > -1) {\n\t\t\t\t\tstack.push(char);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tvar peek = stack[stack.length - 1];\n\n\t\t\t\t\tif (char === close[open.indexOf(peek)]) {\n\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (stack.length === 0) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tisEscape = char == \"\\\\\";\n\t\t\t}\n\n\t\t\treturn i;\n\t\t},\n\n\t\tlazy: {\n\t\t\tformatNumber: () => {\n\t\t\t\tvar numberFormat = new Intl.NumberFormat(\"en-US\", {maximumFractionDigits:2});\n\n\t\t\t\treturn function(value) {\n\t\t\t\t\tif (value === Infinity || value === -Infinity) {\n\t\t\t\t\t\t// Pretty print infinity\n\t\t\t\t\t\treturn value < 0? \"-\" : \"\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn numberFormat.format(value);\n\t\t\t\t};\n\t\t\t},\n\n\t\t\trootFunctionRegExp: () => RegExp(\"^=\\\\s*(?:\" + Wysie.Expressions.rootFunctions.join(\"|\") + \")\\\\($\", \"i\")\n\t\t}\n\t}\n});\n\n})();\n\n(function() {\n\nvar _ = Wysie.Expressions = $.Class({\n\tconstructor: function(scope) {\n\t\tif (scope) {\n\t\t\tthis.scope = scope;\n\t\t\tthis.scope.expressions = this;\n\t\t}\n\n\t\tthis.all = []; // all Expression.Text objects in this scope\n\n\t\tWysie.hooks.run(\"expressions-init-start\", this);\n\n\t\tif (this.scope) {\n\t\t\tvar template = this.scope.template;\n\t\t\tif (template && template.expressions) {\n\t\t\t\t// We know which expressions we have, don't traverse again\n\t\t\t\ttemplate.expressions.all.forEach(et => {\n\t\t\t\t\tthis.all.push(new Wysie.Expression.Text({\n\t\t\t\t\t\tpath: et.path,\n\t\t\t\t\t\tattribute: et.attribute,\n\t\t\t\t\t\tall: this\n\t\t\t\t\t}));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.traverse();\n\t\t\t}\n\t\t}\n\n\t\t// TODO less stupid name?\n\t\tthis.updateAlso = new Set();\n\n\t\tthis.active = true;\n\t},\n\n\tinit: function() {\n\t\tif (this.all.length > 0) {\n\t\t\tthis.lastUpdated = 0;\n\n\t\t\tthis.update();\n\n\t\t\t// Watch changes and update value\n\t\t\tthis.scope.element.addEventListener(\"wysie:datachange\", evt => this.update());\n\t\t}\n\t},\n\n\t/**\n\t * Update all expressions in this scope\n\t */\n\tupdate: function callee() {\n\t\tif (!this.active || this.scope.isDeleted()) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar env = { context: this, data: this.scope.getRelativeData() };\n\n\t\tWysie.hooks.run(\"expressions-update-start\", env);\n\n\t\t$$(this.all).forEach(ref => {\n\t\t\tref.update(env.data);\n\t\t});\n\n\t\tthis.updateAlso.forEach(exp => exp.update());\n\t},\n\n\textract: function(node, attribute, path) {\n\t\tthis.expressionRegex.lastIndex = 0;\n\n\t\tif (this.expressionRegex.test(attribute? attribute.value : node.textContent)) {\n\t\t\tthis.all.push(new Wysie.Expression.Text({\n\t\t\t\tnode,\n\t\t\t\tpath: (path || \"\").slice(1).split(\"/\").map(i => +i),\n\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\tall: this\n\t\t\t}));\n\t\t}\n\t},\n\n\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\ttraverse: function(node, path) {\n\t\tnode = node || this.scope.element;\n\t\tpath = path || \"\";\n\n\t\tif (node.matches && node.matches(_.escape)) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.nodeType === 3) { // Text node\n\t\t\t// Leaf node, extract references from content\n\t\t\tthis.extract(node, null, path);\n\t\t}\n\n\t\t// Traverse children and attributes as long as this is NOT the root of a child scope\n\t\t// (otherwise, it will be taken care of its own Expressions object)\n\t\tif (node == this.scope.element || !Wysie.is(\"scope\", node)) {\n\t\t\t$$(node.attributes).forEach(attribute => this.extract(node, attribute, path));\n\t\t\t$$(node.childNodes).forEach((child, i) => this.traverse(child, `${path}/${i}`));\n\t\t}\n\t},\n\n\tlazy: {\n\t\t// Regex that loosely matches all possible expressions\n\t\t// False positives are ok, but false negatives are not.\n\t\texpressionRegex: function() {\n\t\t\tvar properties = this.scope.wysie.propertyNames.concat(_.special);\n\t\t\tvar propertyRegex = \"(?:\" + properties.join(\"|\").replace(/\\$/g, \"\\\\$\") + \")\";\n\n\t\t\treturn RegExp(`\\\\[[\\\\S\\\\s]*?${propertyRegex}[\\\\S\\\\s]*?\\\\]`, \"gi\");\n\t\t}\n\t},\n\n\tstatic: {\n\t\tescape: \".ignore-expressions\",\n\n\t\t// Special property names\n\t\tspecial: [\"$index\"],\n\n\t\tlazy: {\n\t\t\trootFunctions: () => [\n\t\t\t\t...Object.keys(Wysie.Functions),\n\t\t\t\t...Object.getOwnPropertyNames(Math),\n\t\t\t\t\"if\", \"\"\n\t\t\t]\n\t\t}\n\t}\n});\n\n})();\n\nWysie.hooks.add(\"scope-init-start\", function() {\n\tnew Wysie.Expressions(this);\n});\n\nWysie.hooks.add(\"scope-init-end\", function() {\n\tthis.expressions.init();\n});\n\n})(Bliss, Bliss.$);\n\n/**\n * Functions available inside Wysie expressions\n */\n\n(function() {\n\nvar _ = Wysie.Functions = {\n\toperators: {},\n\n\t/**\n\t * Aggregate sum\n\t */\n\tsum: function(array) {\n\t\treturn numbers(array, arguments).reduce((prev, current) => {\n\t\t\treturn +prev + (+current || 0);\n\t\t}, 0);\n\t},\n\n\t/**\n\t * Average of an array of numbers\n\t */\n\taverage: function(array) {\n\t\tarray = numbers(array, arguments);\n\n\t\treturn array.length && _.sum(array) / array.length;\n\t},\n\n\t/**\n\t * Min of an array of numbers\n\t */\n\tmin: function(array) {\n\t\treturn Math.min(...numbers(array, arguments));\n\t},\n\n\t/**\n\t * Max of an array of numbers\n\t */\n\tmax: function(array) {\n\t\treturn Math.max(...numbers(array, arguments));\n\t},\n\n\tcount: function(array) {\n\t\treturn Wysie.toArray(array).filter(a => a !== null && a !== false).length;\n\t},\n\n\tround: function(num, decimals) {\n\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\treturn Math.round(num);\n\t\t}\n\n\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\tuseGrouping: false,\n\t\t\tmaximumFractionDigits: decimals\n\t\t});\n\t},\n\n\tiff: function(condition, iftrue, iffalse=\"\") {\n\t\treturn condition? iftrue : iffalse;\n\t}\n};\n\n/**\n * Addition for elements and scalars.\n * Addition between arrays happens element-wise.\n * Addition between scalars returns their scalar sum (same as +)\n * Addition between a scalar and an array will result in the scalar being added to every array element.\n * Ordered by precedence (higher to lower)\n */\noperator(\"not\", a => a => !a);\noperator(\"multiply\", (a, b) => a * b, {identity: 1, symbol: \"*\"});\noperator(\"divide\", (a, b) => a / b, {identity: 1, symbol: \"/\"});\noperator(\"add\", (a, b) => +a + +b, {symbol: \"+\"});\noperator(\"subtract\", (a, b) => a - b, {symbol: \"-\"});\noperator(\"lte\", (a, b) => a <= b, {symbol: \"<=\"});\noperator(\"lt\", (a, b) => a < b, {symbol: \"<\"});\noperator(\"gte\", (a, b) => a >= b, {symbol: \">=\"});\noperator(\"gt\", (a, b) => a > b, {symbol: \">\"});\noperator(\"eq\", (a, b) => a == b, {symbol: \"==\"});\noperator(\"and\", (a, b) => !!a && !!b, { identity: true, symbol: \"&&\" });\noperator(\"or\", (a, b) => !!a || !!b, { identity: false, symbol: \"||\" } );\n\nvar aliases = {\n\taverage: \"avg\",\n\tiff: \"iff IF\",\n\tsubtract: \"minus\",\n\tmultiply: \"mult product\",\n\tdivide: \"div\",\n\tlt: \"lessThan smaller\",\n\tgt: \"moreThan greater greaterThan bigger\",\n\teq: \"equal equality\"\n};\n\nfor (name in aliases) {\n\taliases[name].split(/\\s+/g).forEach(alias => _[alias] = _[name]);\n}\n\n// Make function names case insensitive\nWysie.Functions._Trap = self.Proxy? new Proxy(_, {\n\tget: (functions, property) => {\n\t\tif (property in functions) {\n\t\t\treturn functions[property];\n\t\t}\n\n\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\treturn functions[propertyL];\n\t\t}\n\n\t\tif (property in Math || propertyL in Math) {\n\t\t\treturn Math[property] || Math[propertyL];\n\t\t}\n\n\t\tif (property in self) {\n\t\t\treturn self[property];\n\t\t}\n\n\t\t// Prevent undefined at all costs\n\t\treturn property;\n\t},\n\n\t// Super ugly hack, but otherwise data is not\n\t// the local variable it should be, but the string \"data\"\n\t// so all property lookups fail.\n\thas: (functions, property) => property != \"data\"\n}) : Wysie.Functions;\n\n/**\n * Private helper methods\n */\nfunction numbers(array, args) {\n\tarray = Array.isArray(array)? array : (args? $$(args) : [array]);\n\n\treturn array.filter(number => !isNaN(number)).map(n => +n);\n}\n\n/**\n * Extend a scalar operator to arrays, or arrays and scalars\n * The operation between arrays is applied element-wise.\n * The operation operation between a scalar and an array will result in\n * the operation being applied between the scalar and every array element.\n * @param op {Function} The operation between two scalars\n * @param identity The operations identity element. Defaults to 0.\n */\nfunction operator(name, op, o = {}) {\n\tif (op.length < 2) {\n\t\t// Unary operator\n\t\treturn operand => Array.isArray(operand)? operand.map(op) : op(operand);\n\t}\n\n\tif (o.symbol) {\n\t\t_.operators[o.symbol] = name;\n\t}\n\n\treturn _[name] = function(...operands) {\n\t\tif (operands.length === 1) {\n\t\t\toperands = [...operands, o.identity];\n\t\t}\n\n\t\treturn operands.reduce((a, b) => {\n\t\t\tif (Array.isArray(b)) {\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = numbers(b);\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\t...b.map((n, i) => op(a[i] === undefined? o.identity : a[i], n)),\n\t\t\t\t\t\t...a.slice(b.length)\n\t\t\t\t\t];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn b.map(n => op(a, n));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Operand is scalar\n\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\tb = +b;\n\t\t\t\t}\n\n\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\treturn a.map(n => op(n, b));\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn op(a, b);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n}\n\n})();\n\n(function($, $$) {\n\nvar _ = Wysie.Scope = $.Class({\n\textends: Wysie.Unit,\n\tconstructor: function (element, wysie, o) {\n\t\tthis.properties = {};\n\n\t\tthis.scope = this;\n\n\t\tWysie.hooks.run(\"scope-init-start\", this);\n\n\t\t// Should this element also create a primitive?\n\t\tif (Wysie.Primitive.getValueAttribute(this.element)) {\n\t\t\tvar obj = this.properties[this.property] = new Wysie.Primitive(this.element, this.wysie);\n\t\t\tobj.scope = obj.parentScope = this;\n\t\t}\n\n\t\t// Create Wysie objects for all properties in this scope (primitives or scopes),\n\t\t// but not properties in descendant scopes (they will be handled by their scope)\n\t\t$$(Wysie.selectors.property, this.element).forEach(element => {\n\t\t\tvar property = element.getAttribute(\"property\");\n\n\t\t\tif (this.contains(element)) {\n\t\t\t\tvar existing = this.properties[property];\n\t\t\t\tvar template = this.template? this.template.properties[property] : null;\n\n\t\t\t\tif (existing) {\n\t\t\t\t\t// Two scopes with the same property, convert to static collection\n\t\t\t\t\tvar collection = existing;\n\n\t\t\t\t\tif (!(existing instanceof Wysie.Collection)) {\n\t\t\t\t\t\tcollection = new Wysie.Collection(existing.element, this.wysie, {template});\n\t\t\t\t\t\tcollection.parentScope = this;\n\t\t\t\t\t\tthis.properties[property] = existing.collection = collection;\n\t\t\t\t\t\tcollection.add(existing);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!collection.mutable && Wysie.is(\"multiple\", element)) {\n\t\t\t\t\t\tcollection.mutable = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tcollection.add(element);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// No existing properties with this id, normal case\n\t\t\t\t\tvar obj = Wysie.Node.create(element, this.wysie, {template});\n\t\t\t\t\tobj.scope = obj instanceof _? obj : this;\n\n\t\t\t\t\tobj.parentScope = this;\n\t\t\t\t\tthis.properties[property] = obj;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tWysie.hooks.run(\"scope-init-end\", this);\n\t},\n\n\tget propertyNames () {\n\t\treturn Object.keys(this.properties);\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar ret = this.super.getData.call(this, o);\n\n\t\tif (ret !== undefined) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tret = {};\n\n\t\tthis.propagate(obj => {\n\t\t\tif ((!obj.computed || o.computed) && !(obj.property in ret)) {\n\t\t\t\tvar data = obj.getData(o);\n\n\t\t\t\tif (data !== null || o.null) {\n\t\t\t\t\tret[obj.property] = data;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!o.dirty) {\n\t\t\t$.extend(ret, this.unhandled);\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\t/**\n\t * Search entire subtree for property, return relative value\n\t * @return {Wysie.Unit}\n\t */\n\tfind: function(property) {\n\t\tif (this.property == property) {\n\t\t\treturn this;\n\t\t}\n\n\t\tif (property in this.properties) {\n\t\t\treturn this.properties[property].find(property);\n\t\t}\n\n\t\tfor (var prop in this.properties) {\n\t\t\tvar ret = this.properties[prop].find(property);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t},\n\n\tpropagate: function(callback) {\n\t\t$.each(this.properties, (property, obj) => {\n\t\t\tobj.call(...arguments);\n\t\t});\n\t},\n\n\tsave: function() {\n\t\tif (this.placeholder) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.everSaved = true;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tdone: function() {\n\t\t$.unbind(this.element, \".wysie:edit\");\n\t},\n\n\timport: function() {\n\t\tthis.everSaved = true;\n\t},\n\n\tpropagated: [\"save\", \"done\", \"import\", \"clear\"],\n\n\t// Inject data in this element\n\trender: function(data) {\n\t\tif (!data) {\n\t\t\tthis.clear();\n\t\t\treturn;\n\t\t}\n\n\t\tthis.expressions.active = false;\n\n\t\tdata = data.isArray? data[0] : data;\n\n\t\t// TODO what if it was a primitive and now it's a scope?\n\t\t// In that case, render the this.properties[this.property] with it\n\n\t\tthis.unhandled = $.extend({}, data, property => {\n\t\t\treturn !(property in this.properties);\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tobj.render(data[obj.property]);\n\t\t});\n\n\t\tthis.save();\n\n\t\trequestAnimationFrame(() => {\n\t\t\tthis.expressions.active = true;\n\t\t\tthis.expressions.update();\n\t\t});\n\t},\n\n\t// Check if this scope contains a property\n\t// property can be either a Wysie.Unit or a Node\n\tcontains: function(property) {\n\t\tif (property instanceof Wysie.Unit) {\n\t\t\treturn property.parentScope === this;\n\t\t}\n\n\t\treturn property.parentNode && (this.element === property.parentNode.closest(Wysie.selectors.scope));\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\n\t\tnormalize: function(element) {\n\t\t\t// Get & normalize typeof name, if exists\n\t\t\tif (Wysie.is(\"scope\", element)) {\n\t\t\t\tvar type = element.getAttribute(\"typeof\") || element.getAttribute(\"itemtype\") || \"Item\";\n\n\t\t\t\telement.setAttribute(\"typeof\", type);\n\n\t\t\t\treturn type;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n(function($, $$) {\n\nvar _ = Wysie.Primitive = $.Class({\n\textends: Wysie.Unit,\n\tconstructor: function (element, wysie, o) {\n\t\tif (this.template) {\n\t\t\t$.extend(this, this.template, [\"attribute\", \"datatype\", \"humanReadable\"]);\n\t\t}\n\t\telse {\n\t\t\t// Which attribute holds the data, if any?\n\t\t\t// \"null\" or null for none (i.e. data is in content).\n\t\t\tthis.attribute = _.getValueAttribute(this.element);\n\n\t\t\tif (this.attribute) {\n\t\t\t\tthis.humanReadable = this.attribute.humanReadable;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.element.normalize();\n\t\t\t}\n\n\t\t\tthis.datatype = _.getDatatype(this.element, this.attribute);\n\t\t}\n\n\t\t// Primitives containing an expression as their value are implicitly computed\n\t\tvar expressions = Wysie.Expression.Text.elements.get(this.element);\n\t\tvar expressionText = expressions && expressions.filter(e => e.attribute == this.attribute)[0];\n\n\t\tif (expressionText) {\n\t\t\texpressionText.primitive = this;\n\t\t\tthis.computed = true;\n\t\t}\n\n\t\t/**\n\t\t * Set up input widget\n\t\t */\n\n\t\t// Exposed widgets (visible always)\n\t\tif (Wysie.is(\"formControl\", this.element)) {\n\t\t\tthis.editor = this.element;\n\n\t\t\tthis.edit();\n\t\t}\n\t\t// Nested widgets\n\t\telse if (!this.editor) {\n\n\t\t\tthis.editor = $$(this.element.children).filter(function (el) {\n\t\t\t    return el.matches(Wysie.selectors.formControl) && !el.matches(Wysie.selectors.property);\n\t\t\t})[0];\n\n\t\t\t$.remove(this.editor);\n\t\t}\n\n\t\tif (!this.exposed && !this.computed) {\n\t\t\tthis.wysie.needsEdit = true;\n\t\t}\n\n\t\tthis.default = this.element.getAttribute(\"data-default\");\n\n\t\t// Observe future mutations to this property, if possible\n\t\t// Properties like input.checked or input.value cannot be observed that way\n\t\t// so we cannot depend on mutation observers for everything :(\n\t\tthis.observer = Wysie.observe(this.element, this.attribute, record => {\n\t\t\tif (this.attribute || !this.wysie.editing || this.computed) {\n\t\t\t\tthis.value = this.getValue();\n\t\t\t}\n\t\t}, true);\n\n\t\tthis.templateValue = this.getValue();\n\n\t\tif (this.computed || this.default === \"\") { // attribute exists, no value, default is template value\n\t\t\tthis.default = this.templateValue;\n\t\t}\n\t\telse {\n\t\t\tif (this.default === null) { // attribute does not exist\n\t\t\t\tthis.default = this.editor? this.editorValue : this.emptyValue;\n\t\t\t}\n\n\t\t\tthis.value = this.default;\n\t\t}\n\n\t\tif (this.collection) {\n\t\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\t\tvar swapUI = callback => {\n\t\t\t\tthis.unobserve();\n\t\t\t\tvar ui = $.remove($(Wysie.selectors.ui, this.element));\n\n\t\t\t\tvar ret = callback();\n\n\t\t\t\t$.inside(ui, this.element);\n\t\t\t\tthis.observe();\n\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\t// Intercept certain properties so that any Wysie UI inside this primitive will not be destroyed\n\t\t\t[\"textContent\", \"innerHTML\"].forEach(property => {\n\t\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\t\tObject.defineProperty(this.element, property, {\n\t\t\t\t\tget: function() {\n\t\t\t\t\t\treturn swapUI(() => descriptor.get.call(this));\n\t\t\t\t\t},\n\n\t\t\t\t\tset: function(value) {\n\t\t\t\t\t\tswapUI(() => descriptor.set.call(this, value));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tthis.initialized = true;\n\n\t\tthis.value = this.getValue();\n\t},\n\n\tget editorValue() {\n\t\tif (this.editor) {\n\t\t\tif (this.editor.matches(Wysie.selectors.formControl)) {\n\t\t\t\treturn _.getValue(this.editor, undefined, this.datatype);\n\t\t\t}\n\n\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\tvar output = $(Wysie.selectors.output + \", \" + Wysie.selectors.formControl, this.editor);\n\n\t\t\tif (output) {\n\t\t\t\treturn _.all.has(output)? _.all.get(output).value : _.getValue(output);\n\t\t\t}\n\t\t}\n\t},\n\n\tset editorValue(value) {\n\t\tif (this.editor) {\n\t\t\tif (this.editor.matches(Wysie.selectors.formControl)) {\n\t\t\t\t_.setValue(this.editor, value);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\tvar output = $(Wysie.selectors.output + \", \" + Wysie.selectors.formControl, this.editor);\n\n\t\t\t\tif (output) {\n\t\t\t\t\tif (_.all.has(output)) {\n\t\t\t\t\t\t_.all.get(output).value = value;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t_.setValue(output, value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\tget exposed() {\n\t\treturn this.editor === this.element;\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar ret = this.super.getData.call(this, o);\n\n\t\tif (ret !== undefined) {\n\t\t\treturn ret;\n\t\t}\n\n\t\tvar ret = !o.dirty && !this.exposed? this.savedValue : this.value;\n\n\t\tif (!o.dirty && ret === \"\") {\n\t\t\treturn null;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tupdate: function () {\n\t\tvar value = _.getValue(this.element, this.attribute, this.datatype);\n\t\tvalue = value || value === 0? value : \"\";\n\n\t\tif (value == this.oldValue) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.value = value;\n\n\t\tthis.empty = value === \"\";\n\n\t\tif (this.humanReadable && this.attribute) {\n\t\t\tthis.element.textContent = this.humanReadable(value);\n\t\t}\n\n\t\tif (this.initialized) {\n\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\tproperty: this.property,\n\t\t\t\tvalue: value,\n\t\t\t\twysie: this.wysie,\n\t\t\t\tnode: this,\n\t\t\t\tdirty: this.editing,\n\t\t\t\taction: \"propertychange\"\n\t\t\t});\n\t\t}\n\t},\n\n\tsave: function() {\n\t\tif (this.placeholder) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.savedValue = this.value;\n\t\tthis.everSaved = true;\n\t\tthis.unsavedChanges = false;\n\t},\n\n\tdone: function () {\n\t\tthis.unobserve();\n\n\t\tif (this.popup) {\n\t\t\tthis.hidePopup();\n\t\t}\n\t\telse if (!this.attribute && !this.exposed && this.editing) {\n\t\t\t$.remove(this.editor);\n\t\t\tthis.element.textContent = this.editorValue;\n\t\t}\n\n\t\tif (!this.exposed) {\n\t\t\tthis.editing = false;\n\t\t}\n\n\t\t// Revert tabIndex\n\t\tif (this.element._.data.prevTabindex !== null) {\n\t\t\tthis.element.tabIndex = this.element._.data.prevTabindex;\n\t\t}\n\t\telse {\n\t\t\tthis.element.removeAttribute(\"tabindex\");\n\t\t}\n\n\t\tthis.element._.unbind(\".wysie:edit .wysie:preedit .wysie:showpopup\");\n\n\t\tthis.observe();\n\t},\n\n\trevert: function() {\n\t\tif (this.unsavedChanges && this.savedValue !== undefined) {\n\t\t\t// FIXME if we have a collection of properties (not scopes), this will cause\n\t\t\t// cancel to not remove new unsaved items\n\t\t\t// This should be fixed by handling this on the collection level.\n\t\t\tthis.value = this.savedValue;\n\t\t\tthis.unsavedChanges = false;\n\t\t}\n\t},\n\n\t// Prepare to be edited\n\t// Called when root edit button is pressed\n\tpreEdit: function () {\n\t\tif (this.computed) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Empty properties should become editable immediately\n\t\t// otherwise they could be invisible!\n\t\tif (this.empty && !this.attribute) {\n\t\t\tthis.edit();\n\t\t\treturn;\n\t\t}\n\n\t\tvar timer;\n\n\t\tthis.element._.events({\n\t\t\t// click is needed too because it works with the keyboard as well\n\t\t\t\"click.wysie:preedit\": e => this.edit(),\n\t\t\t\"focus.wysie:preedit\": e => {\n\t\t\t\tthis.edit();\n\n\t\t\t\tif (!this.popup) {\n\t\t\t\t\tthis.editor.focus();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"click.wysie:edit\": evt => {\n\t\t\t\t// Prevent default actions while editing\n\t\t\t\t// e.g. following links etc\n\t\t\t\tif (!this.exposed) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!this.attribute) {\n\t\t\tthis.element._.events({\n\t\t\t\t\"mouseenter.wysie:preedit\": e => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\ttimer = setTimeout(() => this.edit(), 150);\n\t\t\t\t},\n\t\t\t\t\"mouseleave.wysie:preedit\": e => {\n\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\t// Make element focusable, so it can actually receive focus\n\t\tthis.element._.data.prevTabindex = this.element.getAttribute(\"tabindex\");\n\t\tthis.element.tabIndex = 0;\n\t},\n\n\t// Called only the first time this primitive is edited\n\tinitEdit: function () {\n\t\t// Linked widgets\n\t\tif (this.element.hasAttribute(\"data-input\")) {\n\t\t\tvar selector = this.element.getAttribute(\"data-input\");\n\n\t\t\tif (selector) {\n\t\t\t\tthis.editor = $.clone($(selector));\n\n\t\t\t\tif (!Wysie.is(\"formControl\", this.editor)) {\n\t\t\t\t\tif ($(Wysie.selectors.output, this.editor)) { // has output element?\n\t\t\t\t\t\t// Process it as a wysie instance, so people can use references\n\t\t\t\t\t\tthis.editor.setAttribute(\"data-store\", \"none\");\n\t\t\t\t\t\tnew Wysie(this.editor);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.editor = null; // Cannot use this, sorry bro\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!this.editor) {\n\t\t\t// No editor provided, use default for element type\n\t\t\t// Find default editor for datatype\n\t\t\tvar editor = _.getMatch(this.element, _.editors);\n\n\t\t\tif (editor.create) {\n\t\t\t\t$.extend(this, editor, property => property != \"create\");\n\t\t\t}\n\n\t\t\tvar create = editor.create || editor;\n\t\t\tthis.editor = $.create($.type(create) === \"function\"? create.call(this) : create);\n\t\t\tthis.editorValue = this.value;\n\t\t}\n\n\t\tthis.editor._.events({\n\t\t\t\"input change\": evt => {\n\t\t\t\tvar unsavedChanges = this.wysie.unsavedChanges;\n\n\t\t\t\tthis.value = this.editorValue;\n\n\t\t\t\t// Editing exposed elements outside edit mode is instantly saved\n\t\t\t\tif (\n\t\t\t\t\tthis.exposed &&\n\t\t\t\t\t!this.wysie.editing && // must not be in edit mode\n\t\t\t\t    this.wysie.permissions.save && // must be able to save\n\t\t\t\t    this.scope.everSaved // must not cause unsaved items to be saved\n\t\t\t\t) {\n\t\t\t\t\t// TODO what if change event never fires? What if user\n\t\t\t\t\tthis.unsavedChanges = false;\n\t\t\t\t\tthis.wysie.unsavedChanges = unsavedChanges;\n\n\t\t\t\t\t// Must not save too many times (e.g. not while dragging a slider)\n\t\t\t\t\tif (evt.type == \"change\") {\n\t\t\t\t\t\tthis.save(); // Save current element\n\n\t\t\t\t\t\t// Dont call this.wysie.save() as it will save other fields too\n\t\t\t\t\t\t// We only want to save exposed controls, so save current status\n\t\t\t\t\t\tthis.wysie.storage.save();\n\n\t\t\t\t\t\t// Are there any unsaved changes from other properties?\n\t\t\t\t\t\tthis.wysie.unsavedChanges = this.wysie.calculateUnsavedChanges();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"focus\": evt => {\n\t\t\t\tthis.editor.select && this.editor.select();\n\t\t\t},\n\t\t\t\"keyup\": evt => {\n\t\t\t\tif (this.popup && evt.keyCode == 13 || evt.keyCode == 27) {\n\t\t\t\t\tif (this.popup.contains(document.activeElement)) {\n\t\t\t\t\t\tthis.element.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tthis.hidePopup();\n\t\t\t\t}\n\t\t\t},\n\t\t\t\"wysie:datachange\": evt => {\n\t\t\t\tif (evt.property === \"output\") {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t$.fire(this.editor, \"input\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (\"placeholder\" in this.editor) {\n\t\t\tthis.editor.placeholder = \"(\" + this.label + \")\";\n\t\t}\n\n\t\tif (!this.exposed) {\n\t\t\t// Copy any data-input-* attributes from the element to the editor\n\t\t\tvar dataInput = /^data-input-/i;\n\t\t\t$$(this.element.attributes).forEach(function (attribute) {\n\t\t\t\tif (dataInput.test(attribute.name)) {\n\t\t\t\t\tthis.editor.setAttribute(attribute.name.replace(dataInput, \"\"), attribute.value);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tif (this.attribute) {\n\t\t\t\t// Set up popup\n\t\t\t\tthis.element.classList.add(\"using-popup\");\n\n\t\t\t\tthis.popup = this.popup || $.create(\"div\", {\n\t\t\t\t\tclassName: \"wysie-popup\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcontents: [\n\t\t\t\t\t\tthis.label + \":\",\n\t\t\t\t\t\tthis.editor\n\t\t\t\t\t]\n\t\t\t\t});\n\n\t\t\t\t// No point in having a dropdown in a popup\n\t\t\t\tif (this.editor.matches(\"select\")) {\n\t\t\t\t\tthis.editor.size = Math.min(10, this.editor.children.length);\n\t\t\t\t}\n\n\t\t\t\t// Toggle popup events & methods\n\t\t\t\tvar hideCallback = evt => {\n\t\t\t\t\tif (!this.popup.contains(evt.target) && !this.element.contains(evt.target)) {\n\t\t\t\t\t\tthis.hidePopup();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tthis.showPopup = function() {\n\t\t\t\t\t$.unbind([this.element, this.popup], \".wysie:showpopup\");\n\t\t\t\t\tthis.popup._.after(this.element);\n\n\t\t\t\t\tvar x = this.element.offsetLeft;\n\t\t\t\t\tvar y = this.element.offsetTop + this.element.offsetHeight;\n\n\t\t\t\t\t // TODO what if it doesnt fit?\n\t\t\t\t\tthis.popup._.style({ top:  `${y}px`, left: `${x}px` });\n\n\t\t\t\t\tthis.popup._.removeAttribute(\"hidden\"); // trigger transition\n\n\t\t\t\t\t$.events(document, \"focus click\", hideCallback, true);\n\t\t\t\t};\n\n\t\t\t\tthis.hidePopup = function() {\n\t\t\t\t\t$.unbind(document, \"focus click\", hideCallback, true);\n\n\t\t\t\t\tthis.popup.setAttribute(\"hidden\", \"\"); // trigger transition\n\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t$.remove(this.popup);\n\t\t\t\t\t}, 400); // TODO transition-duration could override this\n\n\t\t\t\t\t$.events(this.element, \"focus.wysie:showpopup click.wysie:showpopup\", evt => {\n\t\t\t\t\t\tthis.showPopup();\n\t\t\t\t\t}, true);\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (!this.popup) {\n\t\t\tthis.editor.classList.add(\"wysie-editor\");\n\t\t}\n\n\t\tthis.initEdit = null;\n\t},\n\n\tedit: function () {\n\t\tif (this.computed || this.editing) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.element._.unbind(\".wysie:preedit\");\n\n\t\tif (this.initEdit) {\n\t\t\tthis.initEdit();\n\t\t}\n\n\t\tif (this.popup) {\n\t\t\tthis.showPopup();\n\t\t}\n\n\t\tif (!this.attribute) {\n\t\t\tif (this.editor.parentNode != this.element && !this.exposed) {\n\t\t\t\tthis.editorValue = this.value;\n\t\t\t\tthis.element.textContent = \"\";\n\n\t\t\t\tif (!this.exposed) {\n\t\t\t\t\tthis.element.appendChild(this.editor);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.editing = true;\n\t}, // edit\n\n\tclear: function() {\n\t\tthis.value = this.emptyValue;\n\t},\n\n\timport: function() {\n\t\tif (!this.computed) {\n\t\t\tthis.value = this.templateValue;\n\t\t}\n\t},\n\n\trender: function(data) {\n\t\tif (Array.isArray(data)) {\n\t\t\tdata = data[0]; // TODO what is gonna happen to the rest? Lost?\n\t\t}\n\n\t\tif (typeof data === \"object\") {\n\t\t\tdata = data[this.property];\n\t\t}\n\n\t\tthis.value = data === undefined? this.default : data;\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tif (this.property == property) {\n\t\t\treturn this;\n\t\t}\n\t},\n\n\tobserve: function() {\n\t\tWysie.observe(this.element, this.attribute, this.observer);\n\t},\n\n\tunobserve: function () {\n\t\tthis.observer.disconnect();\n\t},\n\n\tgetValue: function() {\n\t\treturn _.getValue(this.element, this.attribute, this.datatype);\n\t},\n\n\tlazy: {\n\t\tlabel: function() {\n\t\t\treturn Wysie.readable(this.property);\n\t\t},\n\n\t\temptyValue: function() {\n\t\t\tswitch (this.datatype) {\n\t\t\t\tcase \"boolean\":\n\t\t\t\t\treturn false;\n\t\t\t\tcase \"number\":\n\t\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\treturn \"\";\n\t\t}\n\t},\n\n\tlive: {\n\t\tvalue: {\n\t\t\tget: function() {\n\t\t\t\t// if (this.editing) {\n\t\t\t\t// \tvar ret = this.editorValue;\n\t\t\t\t//\n\t\t\t\t// \treturn ret === \"\"? null : ret;\n\t\t\t\t// }\n\t\t\t},\n\n\t\t\tset: function (value) {\n\t\t\t\tvalue = value || value === 0? value : \"\";\n\t\t\t\tvalue = _.cast(value, this.datatype);\n\n\t\t\t\tif (value == this._value) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.editor) {\n\t\t\t\t\tthis.editorValue = value;\n\t\t\t\t}\n\n\t\t\t\tif (!this.editing || this.attribute) {\n\t\t\t\t\tif (this.datatype == \"number\" && !this.attribute) {\n\t\t\t\t\t\t_.setValue(this.element, value, \"content\", this.datatype);\n\t\t\t\t\t\t_.setValue(this.element, Wysie.Expression.Text.formatNumber(value), null, this.datatype);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.editor && this.editor.matches(\"select\")) {\n\t\t\t\t\t\tthis.editorValue = value;\n\t\t\t\t\t\t_.setValue(this.element, value, \"content\", this.datatype);\n\t\t\t\t\t\t_.setValue(this.element, this.editor.selectedOptions[0]? this.editor.selectedOptions[0].textContent : value, this.attribute, this.datatype);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t_.setValue(this.element, value, this.attribute, this.datatype);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.empty = value === \"\";\n\n\t\t\t\tif (this.humanReadable && this.attribute) {\n\t\t\t\t\tthis.element.textContent = this.humanReadable(value);\n\t\t\t\t}\n\n\t\t\t\tthis._value = value;\n\n\t\t\t\tif (!this.computed) {\n\t\t\t\t\tthis.unsavedChanges = this.wysie.unsavedChanges = true;\n\t\t\t\t}\n\n\t\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\t\tproperty: this.property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\tnode: this,\n\t\t\t\t\tdirty: this.editing,\n\t\t\t\t\taction: \"propertychange\"\n\t\t\t\t});\n\n\t\t\t\tthis.oldValue = this.value;\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\n\t\tempty: function(value) {\n\t\t\tvar hide = value && !this.exposed && !(this.attribute && $(Wysie.selectors.property, this.element));\n\t\t\tthis.element.classList.toggle(\"empty\", hide);\n\t\t},\n\n\t\tediting: function (value) {\n\t\t\tthis.element.classList.toggle(\"editing\", value);\n\t\t},\n\n\t\tcomputed: function (value) {\n\t\t\tthis.element.classList.toggle(\"computed\", value);\n\t\t},\n\n\t\tdatatype: function (value) {\n\t\t\t// Purge caches if datatype changes\n\t\t\tif (_.getValue.cache) {\n\t\t\t\t_.getValue.cache.delete(this.element);\n\t\t\t}\n\t\t}\n\t},\n\n\tstatic: {\n\t\tall: new WeakMap(),\n\n\t\tgetMatch: function (element, all) {\n\t\t\t// TODO specificity\n\t\t\tvar ret = null;\n\n\t\t\tfor (var selector in all) {\n\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\tret = all[selector];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tgetValueAttribute: function (element) {\n\t\t\tvar ret = element.getAttribute(\"data-attribute\") || _.getMatch(element, _.attributes);\n\n\t\t\t// TODO refactor this\n\t\t\tif (ret && ret.value) {\n\t\t\t\tret = $.extend(new String(ret.value), ret);\n\t\t\t}\n\n\t\t\tif (!ret || ret === \"null\") {\n\t\t\t\tret = null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tgetDatatype: function (element, attribute) {\n\t\t\tvar ret = element.getAttribute(\"datatype\");\n\n\t\t\tif (!ret) {\n\t\t\t\tfor (var selector in _.datatypes) {\n\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\tret = _.datatypes[selector][attribute];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tret = ret || \"string\";\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tcast: function(value, datatype) {\n\t\t\tif (datatype == \"number\") {\n\t\t\t\treturn +value;\n\t\t\t}\n\n\t\t\tif (datatype == \"boolean\") {\n\t\t\t\treturn !!value;\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\tgetValue: function (element, attribute, datatype) {\n\t\t\t\tattribute = attribute || attribute === null? attribute : _.getValueAttribute(element);\n\t\t\t\tdatatype = datatype || _.getDatatype(element, attribute);\n\n\t\t\t\tvar ret;\n\n\t\t\t\tif (attribute in element && _.useProperty(element, attribute)) {\n\t\t\t\t\t// Returning properties (if they exist) instead of attributes\n\t\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\t\tret = element[attribute];\n\t\t\t\t}\n\t\t\t\telse if (attribute) {\n\t\t\t\t\tret = element.getAttribute(attribute);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tret = element.getAttribute(\"content\") || element.textContent || null;\n\t\t\t\t}\n\n\t\t\t\treturn _.cast(ret, datatype);\n\t\t},\n\n\t\tsetValue: function (element, value, attribute) {\n\t\t\tif (attribute !== null) {\n\t\t\t\tattribute = attribute ||  _.getValueAttribute(element);\n\t\t\t}\n\n\t\t\tif (attribute in element && _.useProperty(element, attribute) && element[attribute] != value) {\n\t\t\t\t// Setting properties (if they exist) instead of attributes\n\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\ttry {\n\t\t\t\t\telement[attribute] = value;\n\t\t\t\t}\n\t\t\t\tcatch (e) {}\n\t\t\t}\n\n\t\t\t// Set attribute anyway, even if we set a property because when\n\t\t\t// they're not in sync it gets really fucking confusing.\n\t\t\tif (attribute) {\n\t\t\t\tif (element.getAttribute(attribute) != value) { // intentionally non-strict, e.g. \"3.\" !== 3\n\t\t\t\t\telement.setAttribute(attribute, value);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\telement.textContent = value;\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t *  Set/get a property or an attribute?\n\t\t * @return {Boolean} true to use a property, false to use the attribute\n\t\t */\n\t\tuseProperty: function(element, attribute) {\n\t\t\tif ([\"href\", \"src\"].indexOf(attribute) > -1) {\n\t\t\t\t// URL properties resolve \"\" as location.href, fucking up emptiness checks\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (element.namespaceURI == \"http://www.w3.org/2000/svg\") {\n\t\t\t\t// SVG has a fucked up DOM, do not use these properties\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n\n// Define default attributes\n_.attributes = {\n\t\"img, video, audio\": \"src\",\n\t\"a, link\": \"href\",\n\t\"select, input, textarea, meter, progress\": \"value\",\n\t\"input[type=checkbox]\": \"checked\",\n\t\"time\": {\n\t\tvalue: \"datetime\",\n\t\thumanReadable: function (value) {\n\t\t\tvar date = new Date(value);\n\n\t\t\tif (!value || isNaN(date)) {\n\t\t\t\treturn \"(No \" + this.label + \")\";\n\t\t\t}\n\n\t\t\t// TODO do this properly (account for other datetime datatypes and different formats)\n\t\t\tvar options = {\n\t\t\t\t\"date\": {day: \"numeric\", month: \"short\", year: \"numeric\"},\n\t\t\t\t\"month\": {month: \"long\"},\n\t\t\t\t\"time\": {hour: \"numeric\", minute: \"numeric\"},\n\t\t\t\t\"datetime-local\": {day: \"numeric\", month: \"short\", year: \"numeric\", hour: \"numeric\", minute: \"numeric\"}\n\t\t\t};\n\n\t\t\tvar format = options[this.editor && this.editor.type] || options.date;\n\t\t\tformat.timeZone = \"UTC\";\n\n\t\t\treturn date.toLocaleString(\"en-GB\", format);\n\t\t}\n\t},\n\t\"meta\": \"content\"\n};\n\n// Basic datatypes per attribute\n// Only number, boolean\n_.datatypes = {\n\t\"input[type=checkbox]\": {\n\t\t\"checked\": \"boolean\"\n\t},\n\t\"input[type=range], input[type=number], meter, progress\": {\n\t\t\"value\": \"number\"\n\t}\n};\n\n_.editors = {\n\t\"*\": {\"tag\": \"input\"},\n\n\t\".number\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"number\"\n\t},\n\n\t\".boolean\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"checkbox\"\n\t},\n\n\t\"a, img, video, audio, .url\": {\n\t\t\"tag\": \"input\",\n\t\t\"type\": \"url\",\n\t\t\"placeholder\": \"http://\"\n\t},\n\n\t// Block elements\n\t\"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline\": {\n\t\tcreate: function() {\n\t\t\tvar display = getComputedStyle(this.element).display;\n\t\t\tvar tag = display.indexOf(\"inline\") === 0? \"input\" : \"textarea\";\n\t\t\tvar editor = $.create(tag);\n\n\t\t\tif (tag == \"textarea\") {\n\t\t\t\tvar width = this.element.offsetWidth;\n\n\t\t\t\tif (width) {\n\t\t\t\t\teditor.width = width;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn editor;\n\t\t},\n\n\t\tget editorValue () {\n\t\t\treturn this.editor && _.cast(this.editor.value, this.datatype);\n\t\t},\n\n\t\tset editorValue (value) {\n\t\t\tif (this.editor) {\n\t\t\t\tthis.editor.value = value ? value.replace(/\\r?\\n/g, \"\") : \"\";\n\t\t\t}\n\t\t}\n\t},\n\n\t\"meter, progress\": function() {\n\t\treturn $.create({\n\t\t\ttag: \"input\",\n\t\t\ttype: \"range\",\n\t\t\tmin: this.element.getAttribute(\"min\") || 0,\n\t\t\tmax: this.element.getAttribute(\"max\") || 100\n\t\t});\n\t},\n\n\t\"time, .date\": function() {\n\t\tvar types = {\n\t\t\t\"date\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2}$/i,\n\t\t\t\"month\": /^[Y\\d]{4}-[M\\d]{2}$/i,\n\t\t\t\"time\": /^[H\\d]{2}:[M\\d]{2}/i,\n\t\t\t\"week\": /[Y\\d]{4}-W[W\\d]{2}$/i,\n\t\t\t\"datetime-local\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2} [H\\d]{2}:[M\\d]{2}/i\n\t\t};\n\n\t\tvar datetime = this.element.getAttribute(\"datetime\") || \"YYYY-MM-DD\";\n\n\t\tfor (var type in types) {\n\t\t\tif (types[type].test(datetime)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn $.create(\"input\", {type: type});\n\t}\n};\n\n})(Bliss, Bliss.$);\n\n// Image upload widget via imgur\nWysie.Primitive.editors.img = {\n\tcreate: function() {\n\t\tvar root = $.create(\"div\", {\n\t\t\tclassName: \"image-popup\",\n\t\t\tevents: {\n\t\t\t\t\"dragenter dragover drop\": function(evt) {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t},\n\n\t\t\t\tdrop: function(evt) {\n\t\t\t\t\tvar file = $.value(evt.dataTransfer, \"files\", 0);\n\n\t\t\t\t\t// Do upload stuff\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontents: [\n\t\t\t{\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"url\",\n\t\t\t\tclassName: \"value\"\n\t\t\t}, {\n\t\t\t\ttag: \"label\",\n\t\t\t\tclassName: \"upload\",\n\t\t\t\tcontents: [\"Upload: \", {\n\t\t\t\t\ttag: \"input\",\n\t\t\t\t\ttype: \"file\",\n\t\t\t\t\taccept: \"image/*\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tchange: function (evt) {\n\t\t\t\t\t\t\tvar file = this.files[0];\n\n\t\t\t\t\t\t\tif (!file) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Show image locally\n\t\t\t\t\t\t\t$(\"img\", root).file = file;\n\n\t\t\t\t\t\t\t// Upload\n\n\t\t\t\t\t\t\t// Once uploaded, share and get public URL\n\n\t\t\t\t\t\t\t// Set public URL as the value of the URL input\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"image-preview\",\n\t\t\t\tcontents: [{\n\t\t\t\t\t\ttag: \"progress\",\n\t\t\t\t\t\tvalue: \"0\",\n\t\t\t\t\t\tmax: \"100\"\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"img\"\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}, {\n\t\t\t\tclassName: \"tip\",\n\t\t\t\tinnerHTML: \"<strong>Tip:</strong> You can also drag & drop or paste the image to be uploaded!\"\n\t\t\t}\n\t\t]});\n\n\t\treturn root;\n\t}\n};\n\n(function($, $$) {\n\nvar _ = Wysie.Collection = $.Class({\n\textends: Wysie.Node,\n\tconstructor: function (element, wysie, o) {\n\t\t/*\n\t\t * Create the template, remove it from the DOM and store it\n\t\t */\n\t\tthis.templateElement = element;\n\n\t\tthis.items = [];\n\n\t\t// ALL descendant property names as an array\n\t\tif (this.template) {\n\t\t\tthis.properties = this.template.properties;\n\t\t\tthis.mutable = this.template.mutable;\n\t\t}\n\t\telse {\n\t\t\tthis.properties = $$(Wysie.selectors.property, this.templateElement)._.getAttribute(\"property\");\n\t\t\tthis.mutable = this.templateElement.matches(Wysie.selectors.multiple);\n\t\t}\n\n\t\tWysie.hooks.run(\"collection-init-end\", this);\n\t},\n\n\tget length() {\n\t\treturn this.items.length;\n\t},\n\n\t// Collection still contains its template as data\n\tget containsTemplate() {\n\t\treturn this.items.length && this.items[0].element === this.element;\n\t},\n\n\tgetData: function(o) {\n\t\to = o || {};\n\n\t\tvar data = [];\n\n\t\tthis.items.forEach(item => {\n\t\t\tif (!item.deleted) {\n\t\t\t\tvar itemData = item.getData(o);\n\n\t\t\t\tif (itemData) {\n\t\t\t\t\tdata.push(itemData);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!o.dirty && this.unhandled) {\n\t\t\tdata = this.unhandled.before.concat(data, this.unhandled.after);\n\t\t}\n\n\t\treturn data;\n\t},\n\n\t// Create item but don't insert it anywhere\n\t// Mostly used internally\n\tcreateItem: function (element) {\n\t\tvar element = element || this.templateElement.cloneNode(true);\n\n\t\tvar item = Wysie.Unit.create(element, this.wysie, {\n\t\t\tcollection: this,\n\t\t\ttemplate: this.items[0] || (this.template? this.template.items[0] : null)\n\t\t});\n\n\t\t// Add delete & add buttons\n\t\tif (this.mutable) {\n\t\t\t$.create({\n\t\t\t\tclassName: \"wysie-item-controls wysie-ui\",\n\t\t\t\tcontents: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\tclassName: \"delete\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.delete(item)\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Add new \" + this.name.replace(/s$/i, \"\"),\n\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": evt => this.add(null, this.items.indexOf(item)).edit()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tinside: element\n\t\t\t});\n\t\t}\n\n\t\treturn item;\n\t},\n\n\t/**\n\t * Add a new item to this collection\n\t * @param item {Node|Wysie.Unit} Optional. Element or Wysie object for the new item\n\t * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n\t * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n\t */\n\tadd: function(item, index, o = {}) {\n\t\tif (item instanceof Node) {\n\t\t\titem = Wysie.Unit.get(item) || this.createItem(item);\n\t\t}\n\t\telse {\n\t\t\titem = item || this.createItem();\n\t\t}\n\n\t\tif (index in this.items) {\n\t\t\tif (this.bottomUp) {\n\t\t\t\tindex++;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tindex = this.bottomUp? 0 : this.length;\n\t\t}\n\n\t\tif (!item.element.parentNode) {\n\t\t\t// Add it to the DOM, if not already in\n\t\t\tvar nextItem = this.items[index];\n\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t}\n\n\t\t// Update internal data model\n\t\tthis.items.splice(index, 0, item);\n\n\t\tfor (let i = index - 1; i < this.length; i++) {\n\t\t\tlet item = this.items[i];\n\n\t\t\tif (item) {\n\t\t\t\titem.index = i;\n\n\t\t\t\tif (!o.silent) {\n\t\t\t\t\titem.element._.fire(\"wysie:datachange\", {\n\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\t\taction: \"add\",\n\t\t\t\t\t\titem\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!o.silent) {\n\t\t\titem.unsavedChanges = this.wysie.unsavedChanges = true;\n\t\t}\n\n\t\treturn item;\n\t},\n\n\tpropagate: function() {\n\t\tthis.items.forEach(item => item.call.apply(item, arguments));\n\t},\n\n\tdelete: function(item, hard) {\n\t\tif (hard) {\n\t\t\t// Hard delete\n\t\t\t$.remove(item.element);\n\t\t\tthis.items.splice(this.items.indexOf(item), 1);\n\t\t\treturn;\n\t\t}\n\n\t\treturn $.transition(item.element, {opacity: 0}).then(() => {\n\t\t\titem.deleted = true; // schedule for deletion\n\t\t\titem.element.style.opacity = \"\";\n\n\t\t\titem.element._.fire(\"wysie:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\twysie: this.wysie,\n\t\t\t\taction: \"delete\",\n\t\t\t\titem: item\n\t\t\t});\n\n\t\t\titem.unsavedChanges = this.wysie.unsavedChanges = true;\n\t\t});\n\t},\n\n\tedit: function() {\n\t\tif (this.length === 0 && this.required) {\n\t\t\t// Nested collection with no items, add one\n\t\t\tvar item = this.add(null, null, true);\n\n\t\t\titem.placeholder = true;\n\t\t\titem.walk(obj => obj.unsavedChanges = false);\n\n\t\t\t$.once(item.element, \"wysie:datachange\", evt => {\n\t\t\t\titem.unsavedChanges = true;\n\t\t\t\titem.placeholder = false;\n\t\t\t});\n\t\t}\n\n\t\tthis.propagate(obj => obj[obj.preEdit? \"preEdit\" : \"edit\"]());\n\t},\n\n\t/**\n\t * Delete all items in the collection.\n\t */\n\tclear: function() {\n\t\tif (this.mutable) {\n\t\t\tthis.propagate(item => item.element.remove());\n\n\t\t\tthis.items = [];\n\n\t\t\tthis.marker._.fire(\"wysie:datachange\", {\n\t\t\t\tnode: this,\n\t\t\t\twysie: this.wysie,\n\t\t\t\taction: \"clear\"\n\t\t\t});\n\t\t}\n\t},\n\n\tsave: function() {\n\t\tthis.items.forEach(item => {\n\t\t\tif (item.deleted) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\titem.unsavedChanges = false;\n\t\t\t}\n\t\t});\n\t},\n\n\tdone: function() {\n\t\tthis.items.forEach(item => {\n\t\t\tif (item.placeholder) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t});\n\t},\n\n\tpropagated: [\"save\", \"done\"],\n\n\trevert: function() {\n\t\tthis.items.forEach((item, i) => {\n\t\t\t// Delete added items\n\t\t\tif (!item.everSaved && !item.placeholder) {\n\t\t\t\tthis.delete(item, true);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Bring back deleted items\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\titem.deleted = false;\n\t\t\t\t}\n\n\t\t\t\t// Revert all properties\n\t\t\t\titem.revert();\n\t\t\t}\n\t\t});\n\t},\n\n\timport: function() {\n\t\tif (this.mutable) {\n\t\t\tthis.add(this.element);\n\t\t}\n\n\t\tthis.items.forEach(item => item.import());\n\t},\n\n\trender: function(data) {\n\t\tthis.unhandled = {before: [], after: []};\n\n\t\tif (!data) {\n\t\t\tif (data === null || data === undefined) {\n\t\t\t\tif (!this.closestCollection || this.closestCollection.containsTemplate) {\n\t\t\t\t\t// This is not contained in any other collection, display template data\n\t\t\t\t\tthis.clear();\n\t\t\t\t\tthis.import();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tdata = data && Wysie.toArray(data);\n\n\t\tif (!this.mutable) {\n\t\t\tthis.items.forEach((item, i) => item.render(data && data[i]));\n\n\t\t\tif (data) {\n\t\t\t\tthis.unhandled.after = data.slice(this.items.length);\n\t\t\t}\n\t\t}\n\t\telse if (data && data.length > 0) {\n\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\tdata.forEach((datum, i) => {\n\t\t\t\tvar item = this.createItem();\n\n\t\t\t\titem.render(datum);\n\n\t\t\t\tthis.items.push(item);\n\t\t\t\titem.index = i;\n\n\t\t\t\tfragment.appendChild(item.element);\n\t\t\t});\n\n\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t}\n\n\t\tthis.save();\n\t},\n\n\tfind: function(property) {\n\t\tvar items = this.items.filter(item => !item.deleted);\n\n\t\tif (this.property == property) {\n\t\t\treturn items;\n\t\t}\n\n\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\tvar ret = items.map(item => item.find(property));\n\n\t\t\treturn Wysie.flatten(ret);\n\t\t}\n\t},\n\n\tlive: {\n\t\tmutable: function(value) {\n\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t// (think multiple elements with the same property name, where only one has data-multiple)\n\t\t\t\tthis._mutable = value;\n\n\t\t\t\tthis.wysie.needsEdit = true;\n\n\t\t\t\tthis.required = this.templateElement.matches(Wysie.selectors.required);\n\n\t\t\t\t// Keep position of the template in the DOM, since were gonna remove it\n\t\t\t\tthis.marker = $.create(\"div\", {\n\t\t\t\t\thidden: true,\n\t\t\t\t\tclassName: \"wysie-marker\",\n\t\t\t\t\tafter: this.templateElement\n\t\t\t\t});\n\n\t\t\t\tthis.templateElement.classList.add(\"wysie-item\");\n\n\t\t\t\tthis.templateElement.remove();\n\n\t\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\t\tthis.addButton._.before($.value(this.items[0], \"element\") || this.marker);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\t\tvar containerSelector = Wysie.selectors.container[tag];\n\n\t\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\t\tvar after = this.marker.closest(containerSelector);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.addButton._.after(after && after.parentNode? after : this.marker);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.templateElement = this.element.cloneNode(true);\n\t\t\t}\n\t\t}\n\t},\n\n\tlazy: {\n\t\tbottomUp: function() {\n\t\t\t/*\n\t\t\t * Add new items at the top or bottom?\n\t\t\t */\n\n\t\t\tif (!this.mutable) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tvar order = this.templateElement.getAttribute(\"data-order\");\n\t\t\tif (order !== null) {\n\t\t\t\t// Attribute has the highest priority and overrides any heuristics\n\t\t\t\treturn /^desc\\b/i.test(order);\n\t\t\t}\n\n\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t},\n\n\t\tclosestCollection: function() {\n\t\t\tvar parent = this.marker? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\treturn parent.closest(Wysie.selectors.item);\n\t\t},\n\n\t\taddButton: function() {\n\t\t\t// Find add button if provided, or generate one\n\t\t\tvar selector = `button.add-${this.property}`;\n\t\t\tvar scope = this.closestCollection || this.marker.closest(Wysie.selectors.scope);\n\n\t\t\tif (scope) {\n\t\t\t\tvar button = $$(selector, scope).filter(button => {\n\t\t\t\t\treturn !this.templateElement.contains(button);\n\t\t\t\t})[0];\n\t\t\t}\n\n\t\t\tif (!button) {\n\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tbutton.classList.add(\"wysie-ui\", \"wysie-add\");\n\n\t\t\tif (this.property) {\n\t\t\t\tbutton.classList.add(`add-${this.property}`);\n\t\t\t}\n\n\t\t\tbutton.addEventListener(\"click\", evt => {\n\t\t\t\tevt.preventDefault();\n\n\t\t\t\tthis.add().edit();\n\t\t\t});\n\n\t\t\treturn button;\n\t\t}\n\t}\n});\n\n})(Bliss, Bliss.$);\n\n/*\nCopyright (c) 2009 James Padolsey.  All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n\n   1. Redistributions of source code must retain the above copyright\n\t  notice, this list of conditions and the following disclaimer.\n\n   2. Redistributions in binary form must reproduce the above copyright\n\t  notice, this list of conditions and the following disclaimer in the\n\t  documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY James Padolsey ``AS IS\"\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL James Padolsey OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\nLIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\nOUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGE.\n\nThe views and conclusions contained in the software and documentation are\nthose of the authors and should not be interpreted as representing official\npolicies, either expressed or implied, of James Padolsey.\n\n AUTHOR James Padolsey (http://james.padolsey.com)\n VERSION 1.03.0\n UPDATED 29-10-2011\n CONTRIBUTORS\n\tDavid Waller\n    Benjamin Drucker\n\n*/\n\nvar prettyPrint = (function() {\n\n\t/* These \"util\" functions are not part of the core\n\t   functionality but are  all necessary - mostly DOM helpers */\n\n\tvar util = {\n\n\t\ttxt: function(t) {\n\t\t\t/* Create text node */\n\t\t\tt = t + \"\";\n\t\t\treturn document.createTextNode(t);\n\t\t},\n\n\t\trow: function(cells, type, cellType) {\n\n\t\t\t/* Creates new <tr> */\n\t\t\tcellType = cellType || \"td\";\n\n\t\t\t/* colSpan is calculated by length of null items in array */\n\t\t\tvar colSpan = util.count(cells, null) + 1,\n\t\t\t\ttr = $.create(\"tr\"), td,\n\t\t\t\tattrs = {\n\t\t\t\t\tcolSpan: colSpan\n\t\t\t\t};\n\n\t\t\t$$(cells).forEach(function(cell) {\n\t\t\t\tif (cell === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/* Default cell type is <td> */\n\t\t\t\ttd = $.create(cellType, attrs);\n\n\t\t\t\tif (cell.nodeType) {\n\t\t\t\t\t/* IsDomElement */\n\t\t\t\t\ttd.appendChild(cell);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t/* IsString */\n\t\t\t\t\ttd.innerHTML = util.shorten(cell.toString());\n\t\t\t\t}\n\n\t\t\t\ttr.appendChild(td);\n\t\t\t});\n\n\t\t\treturn tr;\n\t\t},\n\n\t\thRow: function(cells, type) {\n\t\t\t/* Return new <th> */\n\t\t\treturn util.row(cells, type, \"th\");\n\t\t},\n\n\t\ttable: function(headings, type) {\n\n\t\t\theadings = headings || [];\n\n\t\t\t/* Creates new table: */\n\t\t\tvar tbl = $.create(\"table\");\n\t\t\tvar thead = $.create(\"thead\");\n\t\t\tvar tbody = $.create(\"tbody\");\n\n\t\t\ttbl.classList.add(type);\n\n\t\t\tif (headings.length) {\n\t\t\t\ttbl.appendChild(thead);\n\t\t\t\tthead.appendChild( util.hRow(headings, type) );\n\t\t\t}\n\n\t\t\ttbl.appendChild(tbody);\n\n\t\t\treturn {\n\t\t\t\t/* Facade for dealing with table/tbody\n\t\t\t\t   Actual table node is this.node: */\n\t\t\t\tnode: tbl,\n\t\t\t\ttbody: tbody,\n\t\t\t\tthead: thead,\n\t\t\t\tappendChild: function(node) {\n\t\t\t\t\tthis.tbody.appendChild(node);\n\t\t\t\t},\n\t\t\t\taddRow: function(cells, _type, cellType) {\n\t\t\t\t\tthis.appendChild(util.row(cells, (_type || type), cellType));\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tshorten: function(str) {\n\t\t\tvar max = 40;\n\t\t\tstr = str.replace(/^\\s\\s*|\\s\\s*$|\\n/g, \"\");\n\t\t\treturn str.length > max ? (str.substring(0, max-1) + \"...\") : str;\n\t\t},\n\n\t\thtmlentities: function(str) {\n\t\t\treturn str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t\t},\n\n\t\tcount: function(arr, item) {\n\t\t\tvar count = 0;\n\t\t\tfor (var i = 0, l = arr.length; i< l; i++) {\n\t\t\t\tif (arr[i] === item) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn count;\n\t\t},\n\n\t\tthead: function(tbl) {\n\t\t\treturn tbl.getElementsByTagName(\"thead\")[0];\n\t\t},\n\n\t\twithin: function(ref) {\n\t\t\t/* Check existence of a val within an object\n\t\t\t   RETURNS KEY */\n\t\t\treturn {\n\t\t\t\tis: function(o) {\n\t\t\t\t\tfor (var i in ref) {\n\t\t\t\t\t\tif (ref[i] === o) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tcommon: {\n\t\t\tcircRef: function(obj, key, settings) {\n\t\t\t\treturn util.expander(\n\t\t\t\t\t\"[POINTS BACK TO <strong>\" + (key) + \"</strong>]\",\n\t\t\t\t\t\"Click to show this item anyway\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, {maxDepth:1}));\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tdepthReached: function(obj, settings) {\n\t\t\t\treturn util.expander(\n\t\t\t\t\t\"[DEPTH REACHED]\",\n\t\t\t\t\t\"Click to show this item anyway\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.parentNode.appendChild( prettyPrintThis(obj, {maxDepth:1}) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\tthis.parentNode.appendChild(\n\t\t\t\t\t\t\t\tutil.table([\"ERROR OCCURED DURING OBJECT RETRIEVAL\"], \"error\").addRow([e.message]).node\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\n\t\texpander: function(text, title, clickFn) {\n\t\t\treturn $.create(\"a\", {\n\t\t\t\tinnerHTML:  util.shorten(text) + ' <b style=\"visibility:hidden;\">[+]</b>',\n\t\t\t\ttitle: title,\n\t\t\t\tonmouseover: function() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"visible\";\n\t\t\t\t},\n\t\t\t\tonmouseout: function() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"hidden\";\n\t\t\t\t},\n\t\t\t\tonclick: function() {\n\t\t\t\t\tthis.style.display = \"none\";\n\t\t\t\t\tclickFn.call(this);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tcursor: \"pointer\"\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t// Main..\n\tvar prettyPrintThis = function(obj, options) {\n\n\t\t /*\n\t\t *\t  obj :: Object to be printed\n\t\t *  options :: Options (merged with config)\n\t\t */\n\n\t\toptions = options || {};\n\n\t\tvar settings = $.extend( {}, prettyPrintThis.config, options ),\n\t\t\tcontainer = $.create(\"div\"),\n\t\t\tconfig = prettyPrintThis.config,\n\t\t\tcurrentDepth = 0,\n\t\t\tstack = {},\n\t\t\thasRunOnce = false;\n\n\t\t/* Expose per-call settings.\n\t\t   Note: \"config\" is overwritten (where necessary) by options/\"settings\"\n\t\t   So, if you need to access/change *DEFAULT* settings then go via \".config\" */\n\t\tprettyPrintThis.settings = settings;\n\n\t\tvar typeDealer = {\n\t\t\tstring : function(item) {\n\t\t\t\treturn util.txt('\"' + util.shorten(item.replace(/\"/g, '\\\\\"')) + '\"');\n\t\t\t},\n\n\t\t\tobject : function(obj, depth, key) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(obj);\n\n\t\t\t\tif ( stackKey ) {\n\t\t\t\t\treturn util.common.circRef(obj, stackKey, settings);\n\t\t\t\t}\n\n\t\t\t\tstack[key||\"TOP\"] = obj;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(obj, settings);\n\t\t\t\t}\n\n\t\t\t\tvar table = util.table([\"Group\", null], \"object\"),\n\t\t\t\t\tisEmpty = true;\n\n\t\t\t\tfor (var i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty || obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tvar item = obj[i],\n\t\t\t\t\t\t\ttype = $.type(item);\n\t\t\t\t\t\tisEmpty = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttable.addRow([i, typeDealer[ type ](item, depth+1, i)], type);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\t\t/* Security errors are thrown on certain Window/DOM properties */\n\t\t\t\t\t\t\tif (window.console && window.console.log) {\n\t\t\t\t\t\t\t\tconsole.log(e.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar ret = (settings.expanded || hasRunOnce) ? table.node : util.expander(\n\t\t\t\t\tJSON.stringify(obj),\n\t\t\t\t\t\"Click to show more\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\thasRunOnce = true;\n\n\t\t\t\treturn ret;\n\n\t\t\t},\n\n\t\t\tarray : function(arr, depth, key, jquery) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(arr);\n\n\t\t\t\tif ( stackKey ) {\n\t\t\t\t\treturn util.common.circRef(arr, stackKey);\n\t\t\t\t}\n\n\t\t\t\tstack[key||\"TOP\"] = arr;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(arr);\n\t\t\t\t}\n\n\t\t\t\t/* Accepts a table and modifies it */\n\t\t\t\tvar table = util.table([\"List (\" + arr.length + \" items)\", null], \"list\");\n\t\t\t\tvar isEmpty = true;\n                var count = 0;\n\n\t\t\t\t$$(arr).forEach(function (item, i) {\n                    if (settings.maxArray >= 0 && ++count > settings.maxArray) {\n                        table.addRow([\n                            i + \"..\" + (arr.length-1),\n                            typeDealer[ $.type(item) ](\"...\", depth+1, i)\n                        ]);\n                        return false;\n                    }\n\t\t\t\t\tisEmpty = false;\n\t\t\t\t\ttable.addRow([i, typeDealer[ $.type(item) ](item, depth+1, i)]);\n\t\t\t\t});\n\n\t\t\t\treturn settings.expanded ? table.node : util.expander(\n\t\t\t\t\tJSON.stringify(arr),\n\t\t\t\t\t\"Click to show more\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t},\n\n\t\t\t\"date\" : function(date) {\n\n\t\t\t\tvar miniTable = util.table([\"Date\", null], \"date\"),\n\t\t\t\t\tsDate = date.toString().split(/\\s/);\n\n\t\t\t\t/* TODO: Make this work well in IE! */\n\t\t\t\tminiTable\n\t\t\t\t\t.addRow([\"Time\", sDate[4]])\n\t\t\t\t\t.addRow([\"Date\", sDate.slice(0, 4).join(\"-\")]);\n\n\t\t\t\treturn settings.expanded ? miniTable.node : util.expander(\n\t\t\t\t\t\"Date (timestamp): \" + (+date),\n\t\t\t\t\t\"Click to see a little more info about this date\",\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthis.parentNode.appendChild(miniTable.node);\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t}\n\t\t};\n\n\t\ttypeDealer.number =\n\t\ttypeDealer.boolean =\n\t\ttypeDealer.undefined =\n\t\ttypeDealer.null =\n\t\ttypeDealer.default = function(value) {\n\t\t\treturn util.txt(value);\n\t\t},\n\n\t\tcontainer.appendChild(typeDealer[$.type(obj)](obj, currentDepth));\n\n\t\treturn container;\n\n\t};\n\n\t/* Configuration */\n\n\t/* All items can be overwridden by passing an\n\t   \"options\" object when calling prettyPrint */\n\tprettyPrintThis.config = {\n\t\t/* Try setting this to false to save space */\n\t\texpanded: true,\n\n\t\tmaxDepth: 10,\n\t\tmaxArray: -1  // default is unlimited\n\t};\n\n\treturn prettyPrintThis;\n\n})();\n\n(function($, $$) {\n\nvar _ = Wysie.Debug = {\n\tfriendlyError: (e, expr) => {\n\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\tvar message = e.message;\n\n\t\t// Friendlify common errors\n\n\t\t// Non-developers don't know wtf a token is.\n\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\tmessage = \"Missing a )\";\n\t\t}\n\t\telse if (message === \"Unexpected )\") {\n\t\t\tmessage = \"Missing a (\";\n\t\t}\n\t\telse if (message === \"Invalid left-hand side in assignment\") {\n\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t}\n\t\telse if (message == \"Unexpected ILLEGAL\") {\n\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t}\n\n\t\treturn `<span class=\"type\">Oh noes, a ${type} error!</span> ${message}`;\n\t},\n\n\telementLabel: function(element, attribute) {\n\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\tif (element.hasAttribute(\"property\")) {\n\t\t\tret += `[property=${element.getAttribute(\"property\")}]`;\n\t\t}\n\t\telse if (element.id) {\n\t\t\tret += `#${element.id}`;\n\t\t}\n\t\telse if (element.classList.length) {\n\t\t\tret += $$(element.classList).map(c => `.${c}`).join(\"\");\n\t\t}\n\n\t\tif (attribute) {\n\t\t\tret += `@${attribute}`;\n\t\t}\n\n\t\treturn ret;\n\t},\n\n\tprintValue: function(obj) {\n\t\tvar ret;\n\n\t\tif (typeof obj !== \"object\" || obj === null) {\n\t\t\treturn typeof obj == \"string\"? `\"${obj}\"` : obj + \"\";\n\t\t}\n\n\t\tif (Array.isArray(obj)) {\n\t\t\tif (obj.length > 0) {\n\t\t\t\tif (typeof obj[0] === \"object\") {\n\t\t\t\t\treturn `List: ${obj.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn \"List: (Empty)\";\n\t\t\t}\n\t\t}\n\n\t\tif (obj.constructor === Object) {\n\t\t\treturn `Group with ${Object.keys(obj).length} properties`;\n\t\t}\n\n\t\tif (obj instanceof Wysie.Primitive) {\n\t\t\treturn _.printValue(obj.value);\n\t\t}\n\t\telse if (obj instanceof Wysie.Collection) {\n\t\t\tif (obj.items.length > 0) {\n\t\t\t\tif (obj.items[0] instanceof Wysie.Scope) {\n\t\t\t\t\treturn `List: ${obj.items.length} group(s)`;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn \"List: \" + obj.items.map(_.printValue).join(\", \");\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn _.printValue([]);\n\t\t\t}\n\t\t}\n\t\telse if (obj instanceof Wysie.Scope) {\n\t\t\t// Group\n\t\t\treturn `Group with ${obj.propertyNames.length} properties`;\n\t\t}\n\t},\n\n\ttimed: function(id, callback) {\n\t\treturn function() {\n\t\t\tconsole.time(id);\n\t\t\tcallback.apply(this, arguments);\n\t\t\tconsole.timeEnd(id);\n\t\t};\n\t},\n\n\ttime: function callee(objName, name) {\n\t\tvar obj = eval(objName);\n\t\tvar callback = obj[name];\n\n\t\tobj[name] = function callee() {\n\t\t\tvar before = performance.now();\n\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\tobj[name].calls++;\n\t\t\treturn ret;\n\t\t};\n\n\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\tcallee.all = callee.all || [];\n\t\tcallee.all.push({obj, objName, name});\n\n\t\treturn obj[name];\n\t},\n\n\ttimes: function() {\n\t\tif (!_.time.all) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.table(_.time.all.map(o => {\n\t\t\treturn {\n\t\t\t\t\"Function\": `${o.objName}.${o.name}`,\n\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t};\n\t\t}));\n\t},\n\n\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n};\n\nWysie.prototype.render = _.timed(\"render\", Wysie.prototype.render);\n\nWysie.selectors.debug = \".debug\";\n\nvar selector = \", .wysie-debuginfo\";\nWysie.Expressions.escape += selector;\nStretchy.selectors.filter += selector;\n\n// Add element to show saved data\nWysie.hooks.add(\"init-tree-after\", function() {\n\tif (this.root.debug) {\n\t\tthis.wrapper.classList.add(\"debug-saving\");\n\t}\n\n\tif (this.store && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\tvar element;\n\n\t\tvar details = $.create(\"details\", {\n\t\t\tclassName: \"wysie-debug-storage\",\n\t\t\tcontents: [\n\t\t\t\t{tag: \"Summary\", textContent: \"Saved data\"},\n\t\t\t\telement = $.create(\"pre\", {id: this.id + \"-debug-storage\"})\n\t\t\t],\n\t\t\tafter: this.wrapper\n\t\t});\n\n\t\t// Intercept textContent\n\n\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, \"textContent\");\n\n\t\tObject.defineProperty(element, \"textContent\", {\n\t\t\tget: function() {\n\t\t\t\treturn descriptor.get.call(this);\n\t\t\t},\n\n\t\t\tset: function(value) {\n\t\t\t\tthis.innerHTML = \"\";\n\n\t\t\t\tif (value) {\n\t\t\t\t\tthis.appendChild(prettyPrint(JSON.parse(value)));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.store += \" #\" + element.id;\n\t}\n});\n\nWysie.hooks.add(\"render-start\", function({data}) {\n\tif (this.storage && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\tvar element = $(`#${this.id}-debug-storage`);\n\n\t\tif (element) {\n\t\t\telement.textContent = data? this.toJSON(data) : \"\";\n\t\t}\n\t}\n});\n\nWysie.hooks.add(\"scope-init-start\", function() {\n\tthis.debug = this.debug || this.walkUp(scope => {\n\t\tif (scope.debug) {\n\t\t\treturn true;\n\t\t}\n\t}) || /[?&]debug\\b/i.test(location.search);\n\n\tif (!this.debug && this.element.closest(Wysie.selectors.debug)) {\n\t\tthis.debug = true;\n\t}\n\n\tif (this.debug) {\n\t\tthis.debug = $.create(\"tbody\", {\n\t\t\tinside: $.create(\"table\", {\n\t\t\t\tinnerHTML: `<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>`,\n\t\t\t\tstyle: {\n\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t},\n\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\tclassName: \"wysie-ui wysie-debuginfo\",\n\t\t\t\t\tinside: this.element,\n\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t})\n\t\t});\n\t}\n}, true);\n\nWysie.hooks.add(\"unit-init-end\", function() {\n\tif (this.collection) {\n\t\tthis.debug = this.collection.debug;\n\t}\n});\n\nWysie.hooks.add(\"expressions-init-start\", function() {\n\tthis.debug = this.scope.debug;\n});\n\nWysie.hooks.add(\"expression-eval-beforeeval\", function() {\n\tif (this.debug) {\n\t\tthis.debug.classList.remove(\"error\");\n\t}\n});\n\nWysie.hooks.add(\"expression-eval-error\", function(env) {\n\tif (this.debug) {\n\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\tthis.debug.classList.add(\"error\");\n\t}\n});\n\nWysie.Scope.prototype.debugRow = function({element, attribute = null, tds = []}) {\n\tif (!this.debug) {\n\t\treturn;\n\t}\n\n\tthis.debug.parentNode.style.display = \"\";\n\n\tvar type = tds[0];\n\n\ttds[0] = $.create(\"td\", {\n\t\ttitle: type\n\t});\n\n\tif (!tds[3]) {\n\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\ttds[3] = $.create(\"td\", {\n\t\t\ttextContent: elementLabel,\n\t\t\ttitle: elementLabel,\n\t\t\tevents: {\n\t\t\t\t\"mouseenter mouseleave\": evt => {\n\t\t\t\t\telement.classList.toggle(\"wysie-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t},\n\t\t\t\t\"click\": evt => {\n\t\t\t\t\telement.scrollIntoView({behavior: \"smooth\"});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\ttds = tds.map(td => {\n\t\tif (!(td instanceof Node)) {\n\t\t\treturn $.create(\"td\", typeof td == \"object\"? td : { textContent: td });\n\t\t}\n\n\t\treturn td;\n\t});\n\n\tif (type == \"Warning\") {\n\t\ttds[1].setAttribute(\"colspan\", 2);\n\t}\n\n\tvar tr = $.create(\"tr\", {\n\t\tclassName: \"debug-\" + type.toLowerCase(),\n\t\tcontents: tds,\n\t\tinside: this.debug\n\t});\n};\n\nWysie.hooks.add(\"expressiontext-init-end\", function() {\n\tif (this.scope.debug) {\n\t\tthis.debug = {};\n\n\t\tthis.template.forEach(expr => {\n\t\t\tif (expr instanceof Wysie.Expression) {\n\t\t\t\tthis.scope.debugRow({\n\t\t\t\t\telement: this.element,\n\t\t\t\t\tattribute: this.attribute,\n\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: evt => {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\tthis.update(this.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: evt => Stretchy.resize(evt.target)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\texpr.debug = $.create(\"td\")\n\t\t\t\t\t]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n\nWysie.hooks.add(\"scope-init-end\", function() {\n\t// TODO make properties update, collapse duplicate expressions\n\tif (this.debug instanceof Node) {\n\t\t// We have a debug table, add stuff to it\n\n\t\tvar selector = Wysie.selectors.andNot(Wysie.selectors.multiple, Wysie.selectors.property);\n\t\t$$(selector, this.element).forEach(element => {\n\t\t\tthis.debugRow({\n\t\t\t\telement,\n\t\t\t\ttds: [\"Warning\", \"data-multiple without a property attribute\"]\n\t\t\t});\n\t\t});\n\n\t\tthis.propagate(obj => {\n\t\t\tvar value = _.printValue(obj);\n\n\t\t\tthis.debugRow({\n\t\t\t\telement: obj.element,\n\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t});\n\n\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", `You cant use \"${obj.property}\" as a property name, its a reserved word.`]\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\tthis.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\ttextContent: `You cant use \"${obj.property}\" as a property name.`,\n\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t}]\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\tthis.scope.element.addEventListener(\"wysie:datachange\", evt => {\n\t\t\t$$(\"tr.debug-property\", this.debug).forEach(tr => {\n\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\tvar value = _.printValue(this.properties[property]);\n\n\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n\nWysie.hooks.add(\"expressiontext-update-beforeeval\", function(env) {\n\tif (this.debug) {\n\t\tenv.td = env.expr.debug;\n\n\t\tif (env.td) {\n\t\t\tenv.td.classList.remove(\"error\");\n\t\t}\n\t}\n});\n\nWysie.hooks.add(\"expressiontext-update-aftereval\", function(env) {\n\tif (env.td && !env.td.classList.contains(\"error\")) {\n\t\tvar value = _.printValue(env.value);\n\t\tenv.td.textContent = env.td.title = value;\n\t}\n});\n\n// Wysie.Debug.time(\"Wysie.Expressions.prototype\", \"update\");\n\n})(Bliss, Bliss.$);\n\n(function($) {\n\nif (!self.Wysie) {\n\treturn;\n}\n\nvar dropboxURL = \"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js\";\n\nWysie.Storage.Backend.add(\"Dropbox\", $.Class({ extends: Wysie.Storage.Backend,\n\tconstructor: function() {\n\t\t// Transform the dropbox shared URL into something raw and CORS-enabled\n\t\tif (this.url.protocol != \"dropbox:\") {\n\t\t\tthis.url.hostname = \"dl.dropboxusercontent.com\";\n\t\t\tthis.url.search = this.url.search.replace(/\\bdl=0|^$/, \"raw=1\");\n\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\t\t}\n\n\t\tthis.permissions.on(\"login\");\n\n\t\tthis.ready = $.include(self.Dropbox, dropboxURL).then((() => {\n\t\t\tvar referrer = new URL(document.referrer, location);\n\n\t\t\tif (referrer.hostname === \"www.dropbox.com\" && location.hash.indexOf(\"#access_token=\") === 0) {\n\t\t\t\t// Were in an OAuth response popup, do what you need then close this\n\t\t\t\tDropbox.AuthDriver.Popup.oauthReceiver();\n\t\t\t\t$.fire(window, \"load\"); // hack because dropbox.js didn't foresee use cases like ours :/\n\t\t\t\tclose();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Internal filename (to be used for saving)\n\t\t\tthis.filename = (this.storage.param(\"path\") || \"\") + (new URL(this.url)).pathname.match(/[^/]*$/)[0];\n\n\t\t\tthis.key = this.storage.param(\"key\") || \"fle6gsc61w5v79j\";\n\n\t\t\tthis.client = new Dropbox.Client({ key: this.key });\n\t\t})).then(() => {\n\t\t\tthis.login(true);\n\t\t});\n\t},\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {Object} file - An object with name & data keys\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(file) {\n\t\tfile.data = Wysie.toJSON(file.data);\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tthis.client.writeFile(file.name, file.data, function(error, stat) {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn reject(Error(error));\n\t\t\t\t}\n\n\t\t\t\tconsole.log(\"File saved as revision \" + stat.versionTag);\n\t\t\t\tresolve(stat);\n\t\t\t});\n\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\treturn this.client.isAuthenticated()? Promise.resolve() : new Promise((resolve, reject) => {\n\t\t\t\tthis.client.authDriver(new Dropbox.AuthDriver.Popup({\n\t\t\t\t    receiverUrl: new URL(location) + \"\"\n\t\t\t\t}));\n\n\t\t\t\tthis.client.authenticate({interactive: !passive}, (error, client) => {\n\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treject(Error(error));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.client.isAuthenticated()) {\n\t\t\t\t\t\t// TODO check if can actually edit the file\n\t\t\t\t\t\tthis.permissions.on([\"logout\", \"edit\"]);\n\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.permissions.off([\"logout\", \"edit\", \"add\", \"delete\"]);\n\n\t\t\t\t\t\treject();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}).then(() => {\n\t\t\t// Not returning a promise here, since processes depending on login don't need to wait for this\n\t\t\tthis.client.getAccountInfo((error, accountInfo) => {\n\t\t\t\tif (!error) {\n\t\t\t\t\tthis.wysie.wrapper._.fire(\"wysie:login\", $.extend({backend: this}, accountInfo));\n\t\t\t\t}\n\t\t\t});\n\t\t}).catch(() => {});\n\t},\n\n\tlogout: function() {\n\t\treturn !this.client.isAuthenticated()? Promise.resolve() : new Promise((resolve, reject) => {\n\t\t\tthis.client.signOut(null, () => {\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\t\tthis.wysie.wrapper._.fire(\"wysie:logout\", {backend: this});\n\t\t\t\tresolve();\n\t\t\t});\n\t\t});\n\n\t},\n\n\tstatic: {\n\t\ttest: function(url) {\n\t\t\treturn /dropbox.com/.test(url.host) || url.protocol === \"dropbox:\";\n\t\t}\n\t}\n}), true);\n\n})(Bliss);\n\n(function($) {\n\nif (!self.Wysie) {\n\treturn;\n}\n\nvar _;\n\nWysie.Storage.Backend.add(\"Github\", _ = $.Class({ extends: Wysie.Storage.Backend,\n\tconstructor: function() {\n\t\tthis.permissions.on(\"login\");\n\n\t\tthis.key = this.storage.param(\"key\") || \"7e08e016048000bc594e\";\n\n\t\t// Extract info for username, repo, branch, filename, filepath from URL\n\t\t$.extend(this, _.parseURL(this.url));\n\t\tthis.repo = this.repo || \"wysie-data\";\n\t\tthis.branch = this.branch || \"master\";\n\t\tthis.path = this.path || `${this.wysie.id}.json`;\n\t\tthis.filename = this.filename || this.path.match(/[^/]*$/)[0];\n\n\t\t// Transform the Github URL into something raw and CORS-enabled\n\t\tthis.url = new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch}/${this.path}?ts=${Date.now()}`);\n\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\n\t\tthis.login(true);\n\t},\n\n\tget authenticated () {\n\t\treturn !!this.accessToken;\n\t},\n\n\treq: function(call, data, method = \"GET\", o = {method: method}) {\n\t\tif (data) {\n\t\t\to.data =  JSON.stringify(data);\n\t\t}\n\n\t\treturn $.fetch(\"https://api.github.com/\" + call, $.extend(o, {\n\t\t\tresponseType: \"json\",\n\t\t\theaders: {\n\t\t\t\t\"Authorization\": `token ${this.accessToken}`\n\t\t\t}\n\t\t}))\n\t\t.catch(err => {\n\t\t\tif (err && err.xhr) {\n\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconsole.error(err);\n\t\t\t\tconsole.log(err.stack);\n\t\t\t}\n\t\t})\n\t\t.then(xhr => Promise.resolve(xhr.response));\n\t},\n\n\tget: Wysie.Storage.Backend.Remote.prototype.get,\n\n\t/**\n\t * Saves a file to the backend.\n\t * @param {Object} file - An object with name & data keys\n\t * @return {Promise} A promise that resolves when the file is saved.\n\t */\n\tput: function(file) {\n\t\tfile.data = Wysie.toJSON(file.data);\n\t\tfile.path = file.path || \"\";\n\n\t\tvar fileCall = `repos/${this.username}/${this.repo}/contents/${file.path}`;\n\n\t\treturn Promise.resolve(this.repoInfo || this.req(\"user/repos\", {\n\t\t\tname: this.repo\n\t\t}, \"POST\"))\n\t\t.then(repoInfo => {\n\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\treturn this.req(fileCall, {\n\t\t\t\tref: this.branch\n\t\t\t});\n\t\t})\n\t\t.then(fileInfo => {\n\t\t\treturn this.req(fileCall, {\n\t\t\t\tmessage: `Updated ${file.name || \"file\"}`,\n\t\t\t\tcontent: _.btoa(file.data),\n\t\t\t\tbranch: this.branch,\n\t\t\t\tsha: fileInfo.sha\n\t\t\t}, \"PUT\");\n\t\t}, xhr => {\n\t\t\tif (xhr.status == 404) {\n\t\t\t\t// File does not exist, create it\n\t\t\t\treturn this.req(fileCall, {\n\t\t\t\t\tmessage: \"Created file\",\n\t\t\t\t\tcontent: _.btoa(file.data),\n\t\t\t\t\tbranch: this.branch\n\t\t\t\t}, \"PUT\");\n\t\t\t}\n\t\t}).then(data => {\n\t\t\tconsole.log(\"success\");\n\t\t});\n\t},\n\n\tlogin: function(passive) {\n\t\treturn this.ready.then(() => {\n\t\t\tif (this.authenticated) {\n\t\t\t\treturn Promise.resolve();\n\t\t\t}\n\n\t\t\treturn (new Promise((resolve, reject) => {\n\t\t\t\tif (passive) {\n\t\t\t\t\tthis.accessToken = localStorage[\"wysie:githubtoken\"];\n\n\t\t\t\t\tif (this.accessToken) {\n\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Show window\n\t\t\t\t\tthis.authPopup = open(`https://github.com/login/oauth/authorize?client_id=${this.key}&scope=repo,gist&state=${location.href}`,\n\t\t\t\t\t\t\"popup\", \"width=900,height=500\");\n\n\t\t\t\t\taddEventListener(\"message\", evt => {\n\t\t\t\t\t\tif (evt.source === this.authPopup) {\n\t\t\t\t\t\t\tthis.accessToken = localStorage[\"wysie:githubtoken\"] = evt.data;\n\n\t\t\t\t\t\t\tif (!this.accessToken) {\n\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(this.accessToken);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}))\n\t\t\t.then(() => this.getUser())\n\t\t\t.then(u => {\n\t\t\t\tthis.permissions.on(\"logout\");\n\n\t\t\t\treturn this.req(`repos/${this.username}/${this.repo}`);\n\t\t\t})\n\t\t\t.then(repoInfo => {\n\t\t\t\tthis.repoInfo = repoInfo;\n\n\t\t\t\tif (repoInfo.permissions.push) {\n\t\t\t\t\tthis.permissions.on(\"edit\");\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(xhr => {\n\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t// Repo does not exist so we can't check permissions\n\t\t\t\t\t// Just check if authenticated user is the same as our URL username\n\t\t\t\t\tif (this.user.login == this.username) {\n\t\t\t\t\t\tthis.permissions.on(\"edit\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\tlogout: function() {\n\t\tif (this.authenticated) {\n\t\t\tlocalStorage.removeItem(\"wysie:githubtoken\");\n\t\t\tdelete this.accessToken;\n\n\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\tthis.wysie.wrapper._.fire(\"wysie:logout\", {backend: this});\n\t\t}\n\n\t\treturn Promise.resolve();\n\t},\n\n\tgetUser: function() {\n\t\treturn this.req(\"user\").then(accountInfo => {\n\t\t\tthis.user = accountInfo;\n\n\t\t\tvar name = accountInfo.name || accountInfo.login;\n\t\t\tthis.wysie.wrapper._.fire(\"wysie:login\", {\n\t\t\t\tbackend: this,\n\t\t\t\tname: `<a href=\"https://github.com/${accountInfo.login}\" target=\"_blank\">\n\t\t\t\t\t\t\t<img class=\"avatar\" src=\"${accountInfo.avatar_url}\" /> ${name}\n\t\t\t\t\t\t</a>`\n\t\t\t});\n\t\t});\n\t},\n\n\tstatic: {\n\t\ttest: function(url) {\n\t\t\treturn /\\bgithub.(com|io)|raw.githubusercontent.com/.test(url.host);\n\t\t},\n\n\t\t/**\n\t\t * Parse Github URLs, return username, repo, branch, path\n\t\t */\n\t\tparseURL: function(url) {\n\t\t\tvar ret = {};\n\n\t\t\turl = new URL(url, location);\n\n\t\t\tvar path = url.pathname.slice(1).split(\"/\");\n\n\t\t\tif (/github.io$/.test(url.host)) {\n\t\t\t\tret.username = url.host.match(/([\\w-]+)\\.github\\.io$/)[1];\n\t\t\t\tret.branch = \"gh-pages\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\tret.username = path.shift();\n\t\t\t}\n\n\t\t\tret.repo = path.shift();\n\n\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\t\t\telse if (/github.com$/.test(url.host) && path[0] == \"blob\") {\n\t\t\t\tpath.shift();\n\t\t\t\tret.branch = path.shift();\n\t\t\t}\n\n\t\t\tret.filename = path[path.length - 1];\n\n\t\t\tret.path = path.join(\"/\");\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tbtoa: str => btoa(unescape(encodeURIComponent(str)))\n\t}\n}), true);\n\n})(Bliss);\n\n//# sourceMappingURL=wysie.js.map\n"],"sourceRoot":"/source/"}