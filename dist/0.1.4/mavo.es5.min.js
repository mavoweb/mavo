!function(){"use strict";function t(e,r,i){return r=void 0===r?1:r,i=i||r+1,i-r<=1?function(){if(arguments.length<=r||"string"===n.type(arguments[r]))return e.apply(this,arguments);var t,i=arguments[r];for(var s in i){var o=Array.prototype.slice.call(arguments);o.splice(r,1,s,i[s]),t=e.apply(this,o)}return t}:t(t(e,r+1,i),r,i-1)}function e(t,n,i){var s=r(i);if("string"===s){var o=Object.getOwnPropertyDescriptor(n,i);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?t[i]=n[i]:(delete t[i],Object.defineProperty(t,i,o))}else if("array"===s)i.forEach(function(r){r in n&&e(t,n,r)});else for(var a in n)i&&("regexp"===s&&!i.test(a)||"function"===s&&!i.call(n,a))||e(t,n,a);return t}function r(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var n=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:"string"===n.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(n,{extend:e,overload:t,type:r,property:n.property||"_",sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.prototype.slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?n.set(t,e):(1===arguments.length&&("string"===n.type(t)?e={}:(e=t,t=e.tag,e=n.extend({},e,function(t){return"tag"!==t}))),n.set(document.createElement(t||"div"),e))},each:function(t,e,r){r=r||{};for(var n in t)r[n]=e.call(t,n,t[n]);return r},ready:function(t){return t=t||document,new Promise(function(e,r){"loading"!==t.readyState?e():t.addEventListener("DOMContentLoaded",function(){e()})})},Class:function(t){var e,r=["constructor","extends","abstract","static"].concat(Object.keys(n.classProps)),i=t.hasOwnProperty("constructor")?t.constructor:n.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error("Abstract classes cannot be directly instantiated.");e["super"]&&e["super"].apply(this,arguments),i.apply(this,arguments)},e["super"]=t["extends"]||null,e.prototype=n.extend(Object.create(e["super"]?e["super"].prototype:Object),{constructor:e}),e.prototype["super"]=e["super"]?e["super"].prototype:null,e.__abstract=!!t["abstract"]);var s=function(t){return this.hasOwnProperty(t)&&r.indexOf(t)===-1};if(t["static"]){n.extend(e,t["static"],s);for(var o in n.classProps)o in t["static"]&&n.classProps[o](e,t["static"][o])}n.extend(e.prototype,t,s);for(var o in n.classProps)o in t&&n.classProps[o](e.prototype,t[o]);return e},classProps:{lazy:t(function(t,e,r){return Object.defineProperty(t,e,{get:function(){var t=r.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,r){return"function"===n.type(r)&&(r={set:r}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],n=r.get&&r.get.call(this,t);return void 0!==n?n:t},set:function(t){var n=this["_"+e],i=r.set&&r.set.call(this,t,n);this["_"+e]=void 0!==i?i:t},configurable:r.configurable,enumerable:r.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],r=document.createElement("script");return e?Promise.resolve():new Promise(function(e,i){n.set(r,{async:!0,onload:function(){e(),n.remove(r)},onerror:function(){i()},src:t,inside:document.head})})},fetch:function(t,r){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var i=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},r);i.method=i.method.toUpperCase(),n.hooks.run("fetch-args",i),"GET"===i.method&&i.data&&(i.url.search+=i.data),document.body.setAttribute("data-loading",i.url),i.xhr.open(i.method,i.url.href,i.async!==!1,i.user,i.password);for(var s in r)if(s in i.xhr)try{i.xhr[s]=r[s]}catch(o){self.console&&console.error(o)}"GET"===i.method||i.headers["Content-type"]||i.headers["Content-Type"]||i.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var a in i.headers)i.xhr.setRequestHeader(a,i.headers[a]);var c=new Promise(function(t,e){i.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===i.xhr.status||i.xhr.status>=200&&i.xhr.status<300||304===i.xhr.status?t(i.xhr):e(n.extend(Error(i.xhr.statusText),{xhr:i.xhr,get status(){return this.xhr.status}}))},i.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(n.extend(Error("Network Error"),{xhr:i.xhr}))},i.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(n.extend(Error("Network Timeout"),{xhr:i.xhr}))},i.xhr.send("GET"===i.method?null:i.data)});return c.xhr=i.xhr,c},value:function(t){var e="string"!==n.type(t);return n.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),n.Hooks=new n.Class({add:function(t,e,r){if("string"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],e&&this[t][r?"unshift":"push"](e)},this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),n.hooks=new n.Hooks;var i=n.property;n.Element=function(t){this.subject=t,this.data={},this.bliss={}},n.Element.prototype={set:t(function(t,e){t in n.setProps?n.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(r,i){if("transition"in this.style){var s=n.extend({},this.style,/^transition(Duration|Property)$/);n.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),n.once(this,"transitionend",function(){clearTimeout(o),n.style(this,s),r(this)});var o=setTimeout(r,e+50,this);n.style(this,t)}else n.style(this,t),r(this)}.bind(this))},fire:function(t,e){var r=document.createEvent("HTMLEvents");return r.initEvent(t,!0,!0),this.dispatchEvent(n.extend(r,e))},unbind:t(function(t,e){(t||"").split(/\s+/).forEach(function(t){if(i in this&&(t.indexOf(".")>-1||!e)){t=(t||"").split(".");var r=t[1];t=t[0];var n=this[i].bliss.listeners=this[i].bliss.listeners||{};for(var s in n)if(!t||s===t)for(var o,a=0;o=n[s][a];a++)r&&r!==o.className||e&&e!==o.callback||(this.removeEventListener(s,o.callback,o.capture),a--)}else this.removeEventListener(t,e)},this)},0)},n.setProps={style:function(t){for(var e in t)e in this.style?this.style[e]=t[e]:this.style.setProperty(e,t[e])},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){n.extend(this,t)},events:function(t){if(t&&t.addEventListener){var e=this;if(t[i]&&t[i].bliss){var r=t[i].bliss.listeners;for(var s in r)r[s].forEach(function(t){e.addEventListener(s,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])}else if(arguments.length>1&&"string"===n.type(t)){var a=arguments[1],c=arguments[2];t.split(/\s+/).forEach(function(t){this.addEventListener(t,a,c)},this)}else for(var u in t)n.events(this,u,t[u])},once:t(function(t,e){t=t.split(/\s+/);var r=this,n=function(){return t.forEach(function(t){r.removeEventListener(t,n)}),e.apply(r,arguments)};t.forEach(function(t){r.addEventListener(t,n)})},0),delegate:t(function(t,e,r){this.addEventListener(t,function(t){t.target.closest(e)&&r.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=n.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=n.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t.appendChild(this)},before:function(t){t.parentNode.insertBefore(this,t)},after:function(t){t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t.insertBefore(this,t.firstChild)},around:function(t){t.parentNode&&n.before(this,t),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(t)}},n.Array=function(t){this.subject=t},n.Array.prototype={all:function(t){var e=$$(arguments).slice(1);return this[t].apply(this,e)}},n.add=t(function(t,e,r,i){r=n.extend({$:!0,element:!0,array:!0},r),"function"==n.type(e)&&(!r.element||t in n.Element.prototype&&i||(n.Element.prototype[t]=function(){return this.subject&&n.defined(e.apply(this.subject,arguments),this.subject)}),!r.array||t in n.Array.prototype&&i||(n.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(r){return r&&n.defined(e.apply(r,t),r)})}),r.$&&(n.sources[t]=n[t]=e,(r.array||r.element)&&(n[t]=function(){var e=[].slice.apply(arguments),i=e.shift(),s=r.array&&Array.isArray(i)?"Array":"Element";return n[s].prototype[t].apply({subject:i},e)})))},0),n.add(n.Array.prototype,{element:!1}),n.add(n.Element.prototype),n.add(n.setProps),n.add(n.classProps,{element:!1,array:!1});var s=document.createElement("_");n.add(n.extend({},HTMLElement.prototype,function(t){return"function"===n.type(s[t])}),null,!0)}(),function(t){"use strict";if(Bliss&&!Bliss.shy){var e=Bliss.property;if(t.add({clone:function(){var e=this.cloneNode(!0),r=t.$("*",e).concat(e);return t.$("*",this).concat(this).forEach(function(e,n,i){t.events(r[n],e),r[n]._.data=t.extend({},e._.data)}),e}},{array:!1}),Object.defineProperty(Node.prototype,e,{get:function o(){return Object.defineProperty(Node.prototype,e,{get:void 0}),Object.defineProperty(this,e,{value:new t.Element(this)}),Object.defineProperty(Node.prototype,e,{get:o}),this[e]},configurable:!0}),Object.defineProperty(Array.prototype,e,{get:function(){return Object.defineProperty(this,e,{value:new t.Array(this)}),this[e]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var r=EventTarget.prototype.addEventListener,n=EventTarget.prototype.removeEventListener,i=function(t,e,r){return r.callback===t&&r.capture==e},s=function(){return!i.apply(this,arguments)};EventTarget.prototype.addEventListener=function(t,n,s){if(this&&this[e]&&this[e].bliss&&n){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};if(t.indexOf(".")>-1){t=t.split(".");var a=t[1];t=t[0]}o[t]=o[t]||[],0===o[t].filter(i.bind(null,n,s)).length&&o[t].push({callback:n,capture:s,className:a})}return r.call(this,t,n,s)},EventTarget.prototype.removeEventListener=function(t,r,i){if(this&&this[e]&&this[e].bliss&&r){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};o[t]&&(o[t]=o[t].filter(s.bind(null,r,i)))}return n.call(this,t,r,i)}}self.$=self.$||t,self.$$=self.$$||t.$}}(Bliss);
/* jsep v0.3.2 (http://jsep.from.so/) */
!function(e){"use strict";var r=function(e,r){var t=new Error(e+" at character "+r);throw t.index=r,t.description=e,t},t={"-":!0,"!":!0,"~":!0,"+":!0},n={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(e){var r,t=0;for(var n in e)(r=n.length)>t&&e.hasOwnProperty(n)&&(t=r);return t},i=o(t),a=o(n),u={true:!0,false:!1,null:null},s=function(e){return n[e]||0},p=function(e,r,t){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:r,right:t}},f=function(e){return e>=48&&e<=57},c=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!n[String.fromCharCode(e)]},l=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!n[String.fromCharCode(e)]},d=function(e){for(var o,d,h=0,v=e.charAt,x=e.charCodeAt,y=function(r){return v.call(e,r)},m=function(r){return x.call(e,r)},b=e.length,E=function(){for(var e=m(h);32===e||9===e||10===e||13===e;)e=m(++h)},g=function(){var e,t,n=w();return E(),63!==m(h)?n:(h++,(e=g())||r("Expected expression",h),E(),58===m(h)?(h++,(t=g())||r("Expected expression",h),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void r("Expected :",h))},C=function(){E();for(var r=e.substr(h,a),t=r.length;t>0;){if(n.hasOwnProperty(r))return h+=t,r;r=r.substr(0,--t)}return!1},w=function(){var e,t,n,o,i,a,u,f;if(a=O(),!(t=C()))return a;for(i={value:t,prec:s(t)},(u=O())||r("Expected expression after "+t,h),o=[a,i,u];(t=C())&&0!==(n=s(t));){for(i={value:t,prec:n};o.length>2&&n<=o[o.length-2].prec;)u=o.pop(),t=o.pop().value,a=o.pop(),e=p(t,a,u),o.push(e);(e=O())||r("Expected expression after "+t,h),o.push(i,e)}for(e=o[f=o.length-1];f>1;)e=p(o[f-1].value,o[f-2],e),f-=2;return e},O=function(){var r,n,o;if(E(),r=m(h),f(r)||46===r)return U();if(39===r||34===r)return k();if(91===r)return S();for(o=(n=e.substr(h,i)).length;o>0;){if(t.hasOwnProperty(n))return h+=o,{type:"UnaryExpression",operator:n,argument:O(),prefix:!0};n=n.substr(0,--o)}return!(!c(r)&&40!==r)&&A()},U=function(){for(var e,t,n="";f(m(h));)n+=y(h++);if(46===m(h))for(n+=y(h++);f(m(h));)n+=y(h++);if("e"===(e=y(h))||"E"===e){for(n+=y(h++),"+"!==(e=y(h))&&"-"!==e||(n+=y(h++));f(m(h));)n+=y(h++);f(m(h-1))||r("Expected exponent ("+n+y(h)+")",h)}return t=m(h),c(t)?r("Variable names cannot start with a number ("+n+y(h)+")",h):46===t&&r("Unexpected period",h),{type:"Literal",value:parseFloat(n),raw:n}},k=function(){for(var e,t="",n=y(h++),o=!1;h<b;){if((e=y(h++))===n){o=!0;break}if("\\"===e)switch(e=y(h++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return o||r('Unclosed quote after "'+t+'"',h),{type:"Literal",value:t,raw:n+t+n}},L=function(){var t,n=m(h),o=h;for(c(n)?h++:r("Unexpected "+y(h),h);h<b&&(n=m(h),l(n));)h++;return t=e.slice(o,h),u.hasOwnProperty(t)?{type:"Literal",value:u[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},j=function(e){for(var t,n,o=[],i=!1;h<b;){if(E(),(t=m(h))===e){i=!0,h++;break}44===t?h++:((n=g())&&"Compound"!==n.type||r("Expected comma",h),o.push(n))}return i||r("Expected "+String.fromCharCode(e),h),o},A=function(){var e,t;for(t=40===(e=m(h))?P():L(),E(),e=m(h);46===e||91===e||40===e;)h++,46===e?(E(),t={type:"MemberExpression",computed:!1,object:t,property:L()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:g()},E(),93!==(e=m(h))&&r("Unclosed [",h),h++):40===e&&(t={type:"CallExpression",arguments:j(41),callee:t}),E(),e=m(h);return t},P=function(){h++;var e=g();if(E(),41===m(h))return h++,e;r("Unclosed (",h)},S=function(){return h++,{type:"ArrayExpression",elements:j(93)}},B=[];h<b;)59===(o=m(h))||44===o?h++:(d=g())?B.push(d):h<b&&r('Unexpected "'+y(h)+'"',h);return 1===B.length?B[0]:{type:"Compound",body:B}};if(d.version="0.3.2",d.toString=function(){return"JavaScript Expression Parser (JSEP) v"+d.version},d.addUnaryOp=function(e){return i=Math.max(e.length,i),t[e]=!0,this},d.addBinaryOp=function(e,r){return a=Math.max(e.length,a),n[e]=r,this},d.addLiteral=function(e,r){return u[e]=r,this},d.removeUnaryOp=function(e){return delete t[e],e.length===i&&(i=o(t)),this},d.removeAllUnaryOps=function(){return t={},i=0,this},d.removeBinaryOp=function(e){return delete n[e],e.length===a&&(a=o(n)),this},d.removeAllBinaryOps=function(){return n={},a=0,this},d.removeLiteral=function(e){return delete u[e],this},d.removeAllLiterals=function(){return u={},this},"undefined"==typeof exports){var h=e.jsep;e.jsep=d,d.noConflict=function(){return e.jsep===d&&(e.jsep=h),d}}else"undefined"!=typeof module&&module.exports?exports=module.exports=d:exports.parse=d}(this);
//# sourceMappingURL=jsep.min.js.map
!function(){function e(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var t=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text number url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||e("script").pop(),resize:function(e){if(t.resizes(e)){var i,n=getComputedStyle(e),o=0;!e.value&&e.placeholder&&(i=!0,e.value=e.placeholder);var l=e.nodeName.toLowerCase();if("textarea"==l)e.style.height="0","border-box"==n.boxSizing?o=e.offsetHeight:"content-box"==n.boxSizing&&(o=-e.clientHeight+parseFloat(n.minHeight)),
e.style.height=e.scrollHeight+o+"px";else if("input"==l)if(e.style.width="1000px",e.offsetWidth){e.style.width="0","border-box"==n.boxSizing?o=e.offsetWidth:"padding-box"==n.boxSizing?o=e.clientWidth:"content-box"==n.boxSizing&&(o=parseFloat(n.minWidth));var r=Math.max(o,e.scrollWidth-e.clientWidth);e.style.width=r+"px";for(var s=0;s<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);s++)r+=e.scrollLeft,e.style.width=r+"px"}else e.style.width=e.value.length+1+"ch";else if("select"==l){var c=e.selectedIndex>0?e.selectedIndex:0,a=document.createElement("_");a.textContent=e.options[c].textContent,e.parentNode.insertBefore(a,e.nextSibling);var d;for(var h in n){var p=n[h];/^(width|webkitLogicalWidth|length)$/.test(h)||"string"!=typeof p||(a.style[h]=p,/appearance$/i.test(h)&&(d=h))}a.style.width="",a.offsetWidth>0&&(e.style.width=a.offsetWidth+"px",n[d]&&"none"===n[d]||(e.style.width="calc("+e.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}i&&(e.value="")}},resizeAll:function(i){
e(i||t.selectors.base).forEach(function(e){t.resize(e)})},active:!0,resizes:function(e){return e&&e.parentNode&&e.matches&&e.matches(t.selectors.base)&&e.matches(t.selectors.filter)},init:function(){t.selectors.filter=t.script.getAttribute("data-filter")||(e("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",t.resizeAll()},$$:e};"loading"!==document.readyState?t.init():document.addEventListener("DOMContentLoaded",t.init);var i=function(e){t.active&&t.resize(e.target)};document.documentElement.addEventListener("input",i),document.documentElement.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(e){t.active&&e.forEach(function(e){"childList"==e.type&&Stretchy.resizeAll(e.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}();
//# sourceMappingURL=stretchy.min.js.map

"use strict";function _toConsumableArray(b){if(Array.isArray(b)){for(var c=0,d=Array(b.length);c<b.length;c++)d[c]=b[c];return d}return Array.from(b)}(function(b,c){var d=self.Mavo=b.Class({constructor:function(m){var n=this;this.treeBuilt=Mavo.defer(),this.element=m,this.inProgress=!1,this.index=Object.keys(d.all).length+1,Object.defineProperty(d.all,this.index-1,{value:this});var p=d.attributes.map(function(J){return"[data-"+J+"]"}).join(", ");if([this.element].concat(_toConsumableArray(c(p,this.element))).forEach(function(J){var M,K=!0,L=!1;try{for(var O,N=d.attributes[Symbol.iterator]();!(K=(O=N.next()).done);K=!0){var P=O.value,Q=J.getAttribute("data-"+P);null!==Q&&J.setAttribute(P,Q)}}catch(R){L=!0,M=R}finally{try{!K&&N.return&&N.return()}finally{if(L)throw M}}}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index,this.id in d.all){for(var q=2;this.id+q in d.all;q++);this.id+=q}d.all[this.id]=this,this.element.setAttribute("mv-app",this.id);var r=b.value(this.element.closest("[lang]"),"lang")||Mavo.locale;this.locale=Mavo.Locale.get(r),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||3),this.element.setAttribute("typeof",""),Mavo.hooks.run("init-start",this);var w,u=!0,v=!1;try{for(var y,x=c(d.selectors.primitive+","+d.selectors.multiple,this.element)[Symbol.iterator]();!(u=(y=x.next()).done);u=!0){var m=y.value,z=b(d.selectors.not(d.selectors.formControl)+", "+d.selectors.property,m);if(z){var A=Mavo.Primitive.getConfig(m),B=Mavo.is("multiple",m);!B&&(A.attribute||A.hasChildren)||m.setAttribute("typeof","")}}}catch(J){v=!0,w=J}finally{try{!u&&x.return&&x.return()}finally{if(v)throw w}}this.expressions=new Mavo.Expressions(this),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var F,C=["source","storage","init"],D=!0,E=!1;try{for(var H,I,G=C[Symbol.iterator]();!(D=(H=G.next()).done);D=!0)I=H.value,this.updateBackend(I)}catch(J){E=!0,F=J}finally{try{!D&&G.return&&G.return()}finally{if(E)throw F}}this.backendObserver=new Mavo.Observer(this.element,C.map(function(J){return"mv-"+J}),function(J){var K={},L=J.map(function(M){var N=M.attributeName.replace(/^mv-/,"");return K[N]=n.updateBackend(N),N});K.source?n.load():!n.source&&(K.storage||K.init&&!n.root.data)&&n.load()}),this.permissions.can("login",function(){("login"in Mavo.Functions.$url&&1==n.index||n.id+"-login"in Mavo.Functions.$url)&&n.primaryBackend.login()}),this.element.addEventListener("mavo:login.mavo",function(J){J.backend!=(n.source||n.storage)||n.root.data||n.unsavedChanges||n.load()}),this.bar=new Mavo.UI.Bar(this),b("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(J){J.target!=document.activeElement&&J.preventDefault()}),this.needsEdit=this.calculateNeedsEdit(),this.setUnsavedChanges(!1),this.permissions.onchange(function(J){var K=J.action,L=J.value,M=n.element.getAttribute("mv-permissions")||"";M=M.trim().split(/\s+/).filter(function(N){return N!=K}),L&&M.push(K),n.element.setAttribute("mv-permissions",M.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],function(){n.modeObserver=new Mavo.Observer(n.element,"mv-mode",function(J){var M,K=!0,L=!1;try{for(var O,N=J[Symbol.iterator]();!(K=(O=N.next()).done);K=!0){var P=O.value,Q=P.target,R=!0,S=!1,T=void 0;try{nodeloop:for(var V,U=d.Node.children(Q)[Symbol.iterator]();!(R=(V=U.next()).done);R=!0){var W=V.value,X=W.mode,Y=void 0;if(W.element==Q)Y=W.element.getAttribute("mv-mode"),W.modes=Y;else{if(W.modes)continue nodeloop;Y=d.getStyle(W.element.parentNode,"--mv-mode")}W.mode=Y,X!=W.mode&&W["edit"==W.mode?"edit":"done"]()}}catch(Z){S=!0,T=Z}finally{try{!R&&U.return&&U.return()}finally{if(S)throw T}}}}catch(Z){L=!0,M=Z}finally{try{!K&&N.return&&N.return()}finally{if(L)throw M}}},{subtree:!0}),n.autoEdit&&n.edit()},function(){n.modeObserver&&n.modeObserver.destroy()}),this.storage||this.source?this.permissions.can("read",function(){return n.load()}):requestAnimationFrame(function(){b.fire(n.element,"mavo:load")}),location.hash&&this.element.addEventListener("mavo:load.mavo",function(){var K=function(){var O=document.getElementById(location.hash.slice(1));return(O||!location.hash)&&(n.element.contains(O)&&requestAnimationFrame(function(){Mavo.scrollIntoViewIfNeeded(O)}),L&&(L.destroy(),L=null)),O};if(!K())var L=new Mavo.Observer(n.element,"id",K,{subtree:!0})}),this.permissions.can("save",function(){n.autoSave&&n.element.addEventListener("mavo:load.mavo:autosave",function(){var K=d.debounce(function(){n.save()},n.autoSaveDelay),L=function(N){N.node.saved&&K()};requestAnimationFrame(function(){n.permissions.can("save",function(){n.element.addEventListener("mavo:datachange.mavo:autosave",L)},function(){n.element.removeEventListener("mavo:datachange.mavo:autosave",L)})})})},function(){b.unbind(n.element,".mavo:save .mavo:autosave")}),this.element.addEventListener("keydown",function(J){if(n.permissions.save&&83==J.keyCode&&J[d.superKey]&&!J.altKey)J.preventDefault(),n.save();else if(38==J.keyCode||40==J.keyCode){var K=J.target;if(K.matches("textarea, input[type=range], input[type=number]"))return;if(K.matches(".mv-editor")){K=K.parentNode}var M=Mavo.Node.get(K);if(M&&M.closestCollection){var N=M.getCousin(38==J.keyCode?-1:1,{wrap:!0});N&&(N.editing?N.edit({immediately:!0}).then(function(){return N.editor.focus()}):N.element.focus(),J.preventDefault())}}}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(m){return this.root.getData(m)},toJSON:function(){return d.toJSON(this.getData())},message:function(m,n){return new d.UI.Message(this,m,n)},error:function(m){this.message(m,{type:"error",dismiss:["button","timeout"]});for(var n=arguments.length,p=Array(1<n?n-1:0),q=1;q<n;q++)p[q-1]=arguments[q];if(0<p.length){var r;(r=console).log.apply(r,["%c"+this.id+": "+m,"color: red; font-weight: bold"].concat(p))}},render:function(m){var n=this;this.expressions.active=!1;var p={context:this,data:m};d.hooks.run("render-start",p),p.data&&this.root.render(p.data),this.unsavedChanges=!1,this.expressions.active=!0,requestAnimationFrame(function(){return n.expressions.update()}),d.hooks.run("render-end",p)},edit:function(){this.root.edit(),b.events(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(m){if(m.target.matches(d.selectors.multiple)){m.target.classList.remove("mv-has-hovered-item");var n=m.target.parentNode.closest(d.selectors.multiple);n&&n.classList.toggle("mv-has-hovered-item","mouseenter"==m.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(m){var n=!!m;return m||this.walk(function(p){if(p.unsavedChanges)return n=!0,!1===m&&(p.unsavedChanges=!1),!1}),this.unsavedChanges=n},done:function(){this.root.done(),b.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},updateBackend:function(m){var p,n=this[m];1==this.index&&(p=d.Functions.$url[m]),p||(p=d.Functions.$url[this.id+"-"+m]||this.element.getAttribute("mv-"+m)||null),p&&(p=p.trim(),"none"==p&&(p=null)),!p||n&&n.equals(p)?!p&&(this[m]=null):this[m]=p=d.Backend.create(p,{mavo:this,format:this.element.getAttribute("mv-"+m+"-format")||this.element.getAttribute("mv-format")},this.element.getAttribute("mv-"+m+"-type"));var q=p?!p.equals(n):!!n;if(q){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);var r=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});r.parent=this.source&&this.source.permissions,this.permissions.parent=r,this.primaryBackend=this.storage||this.source}return q},load:function(){var m=this,n=this.source||this.storage;return n?(this.inProgress="Loading",n.ready.then(function(){return n.load()}).catch(function(p){return m.init&&m.init!=n?(n=m.init,m.init.ready.then(function(){return m.init.load()})):Promise.reject(p)}).catch(function(p){if(p){var q=p instanceof XMLHttpRequest?p:p.xhr;if(q&&404==q.status)m.render(null);else{var r="Problem loading data";q&&(r+=q.status?": HTTP error "+p.status+": "+p.statusText:": Can\u2019t connect to the Internet"),m.error(r,p)}}return null}).then(function(p){return m.render(p)}).then(function(){m.inProgress=!1,requestAnimationFrame(function(){b.fire(m.element,"mavo:load")})})):Promise.resolve()},store:function(){var m=this;return this.storage?(this.inProgress="Saving",this.storage.store(this.getData()).catch(function(n){if(n){var p=m._("problem-saving");n instanceof XMLHttpRequest&&(p+=": "+(n.status?m._("http-error",n):m._("cant-connect"))),m.error(p,n)}return null}).then(function(n){return m.inProgress=!1,n})):Promise.resolve()},upload:function(m){var n=this,p=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"images/"+m.name;return this.uploadBackend?(this.inProgress=this._("uploading"),this.uploadBackend.upload(m,p).then(function(q){return n.inProgress=!1,q}).catch(function(q){return n.error(n._("error-uploading"),q),n.inProgress=!1,null})):Promise.reject()},save:function(){var m=this;return this.store().then(function(n){n&&(b.fire(m.element,"mavo:save",n),m.lastSaved=Date.now(),m.root.save(),m.unsavedChanges=!1)})},walk:function(m){return this.root.walk(m)},calculateNeedsEdit:function(){var n=!1;return this.walk(function(p){return!n&&(n=!p.modes&&"Group"!=p.nodeType,!p.modes||void 0)},void 0,{descentReturn:!0}),n},live:{inProgress:function(m){b.toggleAttribute(this.element,"mv-progress",m,m),b.toggleAttribute(this.element,"aria-busy",!!m,!!m),this.element.style.setProperty("--mv-progress-text",m?"\""+this._(m)+"\"":"")},unsavedChanges:function(m){this.element.classList.toggle("mv-unsaved-changes",m)},needsEdit:function(m){this.bar.toggle("edit",m&&this.permissions.edit)},storage:function(m){if(m!==this._storage&&!m){var n=new Mavo.Permissions({edit:!0,save:!1});n.parent=this.permissions.parent,this.permissions.parent=n}},primaryBackend:function(m){if(m=m||null,m!=this._primaryBackend)return m},uploadBackend:{get:function(){if(this.storage&&this.storage.upload)return this.storage}}},static:{all:{},get:function(m){if(m instanceof Element){for(var n in d.all)if(d.all[n].element==m)return d.all[n];return null}var n="number"==typeof m?Object.keys(d.all)[m]:m;return d.all[n]||null},toNode:Symbol("toNode"),superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",base:"about:"==location.protocol?document.currentScript?document.currentScript.src:"http://mavo.io":location,dependencies:[],init:function(){var m=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document,n=Array.isArray(arguments[0])?arguments[0]:c(d.selectors.init,m);return n.filter(function(p){return!d.get(p)}).map(function(p){return new d(p)})},UI:{},hooks:new b.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-multiple-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions","mv-rel"],lazy:{locale:function(){return document.documentElement.lang||"en-GB"}}}});Object.defineProperty(d.all,"length",{get:function(){return Object.keys(this).length}});{var e=d.selectors={init:".mv-app, [mv-app], [data-mv-app]",property:"[property], [itemprop]",specificProperty:function(m){return"[property="+m+"], [itemprop="+m+"]"},group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",textInput:["text","email","url","tel","search"].map(function(l){return"input[type="+l+"]"}).join(", ")+", input:not([type]), textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},f=e.arr=function(l){return l.split(/\s*,\s*/g)},g=e.not=function(l){return f(l).map(function(m){return":not("+m+")"}).join("")},h=e.or=function(l,m){return l+", "+m},j=e.and=function(l,m){var n=[],p=f(m);return f(l).forEach(function(q){return n.push.apply(n,_toConsumableArray(p.map(function(r){return q+r})))}),n.join(", ")},k=e.andNot=function(l,m){return j(l,g(m))};b.extend(d.selectors,{primitive:k(e.property,e.group),rootGroup:k(e.group,e.property),item:h(e.multiple,e.group),output:h(e.specificProperty("output"),".mv-output")})}requestAnimationFrame(function(){var l=[];b.each({blissfuljs:Array.from&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype,"Intl.~locale.en":self.Intl,IntersectionObserver:self.IntersectionObserver,Symbol:self.Symbol},function(n,p){p||l.push(n)});var m="https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features="+l.map(function(n){return n+"|gated"}).join(",");d.dependencies.push(b.ready(),d.Plugins.load(),b.include(!l.length,m)),d.inited=b.ready().then(function(){return b.attributes(c(d.selectors.init),{"mv-progress":"Loading"}),d.ready}).catch(console.error).then(function(){return Mavo.init()}),d.ready=d.thenAll(d.dependencies)}),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize"})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};function _toConsumableArray(b){if(Array.isArray(b)){for(var d=0,e=Array(b.length);d<b.length;d++)e[d]=b[d];return e}return Array.from(b)}function _defineProperty(b,d,e){return d in b?Object.defineProperty(b,d,{value:e,enumerable:!0,configurable:!0,writable:!0}):b[d]=e,b}(function(b,d){function e(h,k){for(h="mv-"+h+"-within",d("."+h).forEach(function(l){return l.classList.remove(h)});k&&k.classList;)k.classList.add(h),k=k.parentNode}var g=b.extend(Mavo,{load:function(k){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.currentScript?document.currentScript.src:location;if(g.loaded=g.loaded||new Set,!g.loaded.has(k+""))return k=new URL(k,l),/\.css$/.test(k.pathname)?(b.create("link",{href:k,rel:"stylesheet",inside:document.head}),Promise.resolve()):b.include(k)},readFile:function(k){var l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"DataURL",m=new FileReader;return new Promise(function(n,q){m.onload=function(){return n(m.result)},m.onerror=m.onabort=q,m["readAs"+l](k)})},toJSON:function(k){return null===k?"":"string"==typeof k?k:JSON.stringify(k,null,"\t")},safeToJSON:function(k){var l=new WeakSet;return JSON.stringify(k,function(m,n){if("object"===("undefined"==typeof n?"undefined":_typeof(n))&&null!==n){if(l.has(n))return;l.add(n)}return n})},objectify:function(k,l){var m=Mavo.value(k);if("object"!==("undefined"==typeof k?"undefined":_typeof(k))||null===k){if(null===k){var n;k=(n={},_defineProperty(n,Symbol.toStringTag,"Null"),_defineProperty(n,"toJSON",function(){return null}),n)}else{var q=k.constructor;k=new q(m),k[Symbol.toStringTag]=q.name}k.valueOf=k[Symbol.toPrimitive]=function(){return m}}return b.extend(k,l)},value:function(k){return k&&k.valueOf?k.valueOf():k},toArray:function(k){return k===void 0?[]:Array.isArray(k)?k:[k]},delete:function(k,l,m){do{var n=k&&k.indexOf(l);-1<n&&k.splice(n,1)}while(-1<n&&m)},flatten:function(k){return Array.isArray(k)?k.reduce(function(l,m){return g.toArray(l).concat(g.flatten(m))},[]):[k]},pushUnique:function(k,l){-1===k.indexOf(l)&&k.push(l)},union:function(k,l){return new Set([].concat(_toConsumableArray(k||[]),_toConsumableArray(l||[])))},is:function(k){for(var l=arguments.length,m=Array(1<l?l-1:0),n=1;n<l;n++)m[n-1]=arguments[n];var q=!0,t=!1,u;try{for(var w,x,v=m[Symbol.iterator]();!(q=(w=v.next()).done);q=!0)if(x=w.value,x&&x.matches&&x.matches(g.selectors[k]))return!0}catch(y){t=!0,u=y}finally{try{!q&&v.return&&v.return()}finally{if(t)throw u}}return!1},getStyle:function(k,l){if(k){var m=getComputedStyle(k).getPropertyValue(l);if(m)return m.trim()}},data:function(k,l,m){return 2==arguments.length?b.value(k,"_","data","mavo",l):(k._.data.mavo=k._.data.mavo||{},void 0===m)?void delete k._.data.mavo[l]:k._.data.mavo[l]=m},elementPath:function(k,l){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:[1,3],n=1===m.length&&1==m[0];if(Array.isArray(l)){var q=l;return q.reduce(function(w,x){if(n)var y=w.children;else var y=d(w.childNodes).filter(function(z){return-1<m.indexOf(z.nodeType)});return y[x]},k)}for(var q=[],t=l;t&&t!=k;t=t.parentNode){for(var u=0,v=t;v=v["previous"+(n?"Element":"")+"Sibling"];)-1<m.indexOf(v.nodeType)&&u++;q.unshift(u)}return t?q:null},revocably:{add:function(k,l){var m=g.revocably.isRemoved(k);return m&&m.parentNode?m.parentNode.replaceChild(k,m):k&&l&&!k.parentNode&&l.appendChild(k),m},remove:function(k,l){if(k){var m=g.data(k,"commentstub");return m||(l=l||k.id||k.className||k.nodeName,m=g.data(k,"commentstub",document.createComment(l))),k.parentNode&&k.parentNode.replaceChild(m,k),m}},isRemoved:function(k){if(!k||k.parentNode)return!1;var l=g.data(k,"commentstub");return l&&l.parentNode&&l},setAttribute:function(k,l,m){var n=g.data(k,"attribute-"+l);n===void 0&&g.data(k,"attribute-"+l,k.getAttribute(l)),k.setAttribute(l,m)},restoreAttribute:function(k,l){var m=g.data(k,"attribute-"+l);m!==void 0&&(b.toggleAttribute(k,l,m),g.data(k,"attribute-"+l,void 0))}},inView:{is:function(k){var l=k.getBoundingClientRect();return(0<=l.bottom&&l.bottom<=innerHeight||0<=l.top&&l.top<=innerHeight)&&(0<=l.right&&l.right<=innerWidth||0<=l.left&&l.left<=innerWidth)},when:function(k){var l=g.inView.observer=g.inView.observer||new IntersectionObserver(function(m){var n=!0,q=!1,t;try{for(var v,w,u=m[Symbol.iterator]();!(n=(v=u.next()).done);n=!0)w=v.value,this.unobserve(w.target),b.fire(w.target,"mavo:inview",{entry:w})}catch(x){q=!0,t=x}finally{try{!n&&u.return&&u.return()}finally{if(q)throw t}}});return new Promise(function(m){g.is(k)&&m(),l.observe(k);k.addEventListener("mavo:inview",function q(t){k.removeEventListener("mavo:inview",q),t.stopPropagation(),m()})})}},scrollIntoViewIfNeeded:function(k){k&&!Mavo.inView.is(k)&&k.scrollIntoView({behavior:"smooth"})},setAttributeShy:function(k,l,m){k.hasAttribute(l)||k.setAttribute(l,m)},getAttribute:function(k){for(var l=arguments.length,m=Array(1<l?l-1:0),n=1;n<l;n++)m[n-1]=arguments[n];for(var t,u,q=0;t=m[q];q++)if(u=k.getAttribute(t),u)return u;return null},getTarget:function(){var k=location.hash.substr(1);return document.getElementById(k)},in:function(k,l){if(k)return"object"===("undefined"==typeof k?"undefined":_typeof(k))&&l in k||void 0!==k[l]},getCanonicalProperty:function(k,l){if(k&&(l||0===l)){if(g.in(k,l))return l;if(l.toLowerCase){var m=l.toLowerCase();if(g.in(k,m))return m;var n=Object.keys(k),q=n.map(function(t){return t.toLowerCase()}).indexOf(m);if(-1<q)return n[q]}}},subset:function(k,l,m){if(3==arguments.length){if(l.length){var n=l[l.length-1],q=b.value.apply(b,[k].concat(_toConsumableArray(l.slice(0,-1))));return Array.isArray(q)&&Array.isArray(m)?q.splice.apply(q,[n,1].concat(_toConsumableArray(m))):q[l[l.length-1]]=m,k}return m}return"object"==("undefined"==typeof k?"undefined":_typeof(k))&&l&&l.length?l.reduce(function(t,u,v){if(t&&u in t)return t[u];if(Array.isArray(t)&&isNaN(u)){for(var w=0;w<t.length;w++)if(t[w]&&t[w].id==u)return l[v]=w,t[w];return l[v]=t.length,{id:u}}return t},k):k},clone:function(k){return JSON.parse(g.safeToJSON(k))},debounce:function(k,l){if(!l)return k;var n,m=null;return function(){var q=this,t=arguments;n=function(){k.apply(q,t),removeEventListener("beforeunload",n)},clearTimeout(m),m=setTimeout(n,l),addEventListener("beforeunload",n)}},timeout:function(k){return new Promise(function(l){return setTimeout(l,k)})},escapeRegExp:function(k){return k.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},matches:function(k,l){var m=(k+"").match(l);return m?m:[]},match:function(k,l){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return g.matches(k,l)[m]||""},observeResize:function(k,l){if(self.ResizeObserver){var m=null,n=l instanceof ResizeObserver?l:new ResizeObserver(function(q){var t=q[q.length-1].contentRect;m&&m.width==t.width&&m.height==t.height||(l(q),m=t)});return n.observe(k),n}},Observer:b.Class({constructor:function(k,l,m){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};m instanceof MutationObserver&&(this.observer=m),this.observer=this.observer||new MutationObserver(m),this.element=k,this.callback=m,this.attribute=l,this.options=b.extend({},n),l&&b.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!n.oldValue}),this.attribute&&"all"!=this.attribute||b.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!n.oldValue}),this.run()},stop:function(){return this.observer&&this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(k){if(this.running){this.stop();var l=k();this.run()}else var l=k();return l},destroy:function(){this.stop(),this.observer=this.element=null},static:{sneak:function(k,l){return k?k.sneak(l):l()}}}),defer:function(k){var l,m,n=new Promise(function(q,t){k&&k(q,t),l=q,m=t});return n.resolve=function(q){return l(q),n},n.reject=function(q){return m(q),n},n},thenAll:function(k){var l=!0,m=!1,n;try{for(var t,u,q=k[Symbol.iterator]();!(l=(t=q.next()).done);l=!0)u=t.value,"promise"==b.type(u)&&(u=u.catch(function(v){return v}))}catch(v){m=!0,n=v}finally{try{!l&&q.return&&q.return()}finally{if(m)throw n}}return Promise.all(k).then(function(v){return k.length==v.length?v:g.thenAll(k)})},rr:function(k){return k(),k},wrap:function(k,l){return 0>k?l-1:k>=l?0:k}});b.add("toggleAttribute",function(h,k){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null!==k;l?this.setAttribute(h,k):this.removeAttribute(h)}),b.proxy=b.classProps.proxy=b.overload(function(h,k,l){return Object.defineProperty(h,k,{get:function(){return this[l][k]},set:function(n){this[l][k]=n},configurable:!0,enumerable:!0}),h}),b.classProps.propagated=function(h,k){Mavo.toArray(k).forEach(function(l){var m=h[l];h[l]=function(){var n=m&&m.apply(this,arguments);this.propagate&&!1!==n&&this.propagate(l)}})};document.addEventListener("focus",function(h){e("focus",h.target)},!0),document.addEventListener("blur",function(){e("focus",null)},!0),addEventListener("hashchange",function(){e("target",g.getTarget())}),document.documentElement.addEventListener("mavo:datachange",function(){e("target",g.getTarget())}),e("focus",document.activeElement===document.body?null:document.activeElement)})(Bliss,Bliss.$);
"use strict";(function(a){var b=Mavo.Locale=a.Class({constructor:function(d,e){this.lang=d,this.phrases={},this.extend(e)},get fallback(){return b.all[this.baseLang]?b.all[this.baseLang]:this===b.default?void 0:b.default},extend:function(d){a.extend(this.phrases,d)},phrase:function(d,e){var f=d.toLowerCase(),c=this.phrases[f];if(void 0===c&&this.fallback&&(c=this.fallback.phrase(f)),void 0===c)c=Mavo.Functions.readable(f);else if(e){var g=Mavo.matches(c,/\{\w+(?=\})/g).map(function(n){return n.slice(1)});g=Mavo.Functions.unique(g);var j,h=!0,i=!1;try{for(var l,m,k=g[Symbol.iterator]();!(h=(l=k.next()).done);h=!0)m=l.value,m in e&&(c=c.replace(RegExp("{"+m+"}","gi"),e[m]))}catch(n){i=!0,j=n}finally{try{!h&&k.return&&k.return()}finally{if(i)throw j}}}return c},live:{lang:function(d){this.baseLang=b.getBaseLang(d),d==this.baseLang&&(this.baseLang=null)}},static:{all:{},register:function(d,e){b.all[d]?b.all[d].extend(e):b.all[d]=new b(d,e)},match:function(){var d=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";return b.all[d]||b.all[b.getBaseLang(d)]},get:function(d){return b.match(d)||b.default},getBaseLang:function(d){return d.split("-")[0]},lazy:{default:function(){return b.match(Mavo.locale)||b.all.en}}}});Mavo.prototype._=function(c,d){return this.locale&&c?this.locale.phrase(c,d):c},a.ready().then(function(){var c=!0,d=!1,e;try{for(var g,f=$$("datalist.mv-phrases[lang]")[Symbol.iterator]();!(c=(g=f.next()).done);c=!0){var h=g.value,i=$$("option",h).reduce(function(j,k){return j[k.value]=k.textContent.trim(),j},{});Mavo.Locale.register(h.lang,i)}}catch(j){d=!0,e=j}finally{try{!c&&f.return&&f.return()}finally{if(d)throw e}}})})(Bliss);
"use strict";Mavo.Locale.register("en",{edit:"Edit",save:"Save",logout:"Logout",login:"Login",loading:"Loading",uploading:"Uploading",saving:"Saving","logged-in-as":"Logged in to {id} as ","login-to":"Login to {id}","error-uploading":"Error uploading file","problem-saving":"Problem saving data","http-error":"HTTP error {status}: {statusText}","cant-connect":"Can\u2019t connect to the Internet","add-item":"Add {name}","add-item-before":"Add new {name} before","add-item-after":"Add new {name} after","drag-to-reorder":"Drag to reorder {name}","delete-item":"Delete this {name}","gh-updated-file":"Updated {name}","gh-edit-suggestion-saved-in-profile":"Your edits are saved to <a href=\"{previewURL}\" target=\"_blank\">your own profile</a>, because you are not allowed to edit this page.","gh-edit-suggestion-instructions":"Write a short description of your edits below to suggest them to the page admins:","gh-edit-suggestion-notreviewed":"You have selected to suggest your edits to the page admins. Your suggestions have not been reviewed yet.","gh-edit-suggestion-send":"Send edit suggestion","gh-edit-suggestion-revoke":"Revoke edit suggestion","gh-edit-suggestion-reason-placeholder":"I added / corrected / deleted ...","gh-edit-suggestion-cancelled":"Edit suggestion cancelled successfully!","gh-edit-suggestion-title":"Suggested edits to data","gh-edit-suggestion-body":"Hello there! I used Mavo to suggest the following edits:\n{description}\nPreview my changes here: {previewURL}","gh-edit-suggestion-sent":"Edit suggestion sent successfully!"});
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a){Mavo.attributes.push("mv-plugins");var b=Mavo.Plugins={loaded:{},load:function(){b.plugins=new Set;var d=!0,e=!1,f;try{for(var h,g=$$("[mv-plugins]")[Symbol.iterator]();!(d=(h=g.next()).done);d=!0){var j=h.value,k=j.getAttribute("mv-plugins").trim().split(/\s+/),l=!0,m=!1,n=void 0;try{for(var q,r,p=k[Symbol.iterator]();!(l=(q=p.next()).done);l=!0)r=q.value,b.plugins.add(r)}catch(s){m=!0,n=s}finally{try{!l&&p.return&&p.return()}finally{if(m)throw n}}}}catch(s){e=!0,f=s}finally{try{!d&&g.return&&g.return()}finally{if(e)throw f}}return b.plugins.size?a.fetch(b.url+"/plugins.json",{responseType:"json"}).then(function(s){return Mavo.thenAll(s.response.plugin.filter(function(t){return b.plugins.has(t.id)}).map(function(t){if(t.repo)var u="https://raw.githubusercontent.com/"+t.repo+"/";else var u=b.url+"/"+t.id+"/";var v=u+"mavo-"+t.id+".js";return a.include(b.loaded[t.id],v)}))}):Promise.resolve()},register:function(d){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!b.loaded[d]){for(var f in Mavo.hooks.add(e.hooks),e.extend){var g="Mavo"==f?Mavo:Mavo[f];"function"===a.type(g)?a.Class(g,e.extend[f]):a.extend(g,e.extend[f])}var h=[];if(e.ready&&h.push(e.ready),e.dependencies){var j=document.currentScript?document.currentScript.src:location,k=e.dependencies.map(function(m){return Mavo.load(m,j)});h.push.apply(h,_toConsumableArray(k))}if(h.length){var l;(l=Mavo.dependencies).push.apply(l,h)}b.loaded[d]=e,e.init&&Promise.all(h).then(function(){return e.init()})}},url:"https://plugins.mavo.io/"}})(Bliss);
"use strict";(function(a,b){Mavo.attributes.push("mv-bar");var c=Mavo.UI.Bar=a.Class({constructor:function(e){var f=this;if(this.mavo=e,this.element=a(".mv-bar",this.mavo.element),this.template=this.mavo.element.getAttribute("mv-bar"),this.element){this.custom=!0,this.template=this.element.getAttribute("mv-bar")||this.template||"";var g=Object.keys(c.controls).map(function(t){return".mv-"+t}).join(", ");for(var h in this.customControls=b(g,this.element),c.controls)this[h]=a(".mv-"+h,this.element),this[h]&&(this.template+=" yes-"+h)}else this.element=a.create({className:"mv-bar mv-ui",start:this.mavo.element,innerHTML:"<button>&nbsp;</button>"});this.element.classList.contains("mv-compact")&&(this.noResize=!0),this.controls=c.getControls(this.mavo.element.getAttribute("mv-bar")||this.element.getAttribute("mv-bar")),this.controls.length&&(this.targetHeight=this.element.offsetHeight),this.custom||(this.element.innerHTML="");var l,i=function(u){var v=c.controls[u];for(q in f[u]?f[u].remove():v.create?f[u]=v.create.call(f.mavo):f[u]=a.create("button",{className:"mv-"+u,textContent:f.mavo._(u)}),f.add(u),v.permission?f.permissions.can(v.permission,function(){f.toggle(u,!v.condition||v.condition.call(f.mavo))},function(){f.remove(u)}):v.condition&&!v.condition.call(f.mavo)&&f.remove(u),v.events)a.events(f[u],q,v.events[q].bind(f.mavo))},j=!0,k=!1;try{for(var n,m=this.controls[Symbol.iterator]();!(j=(n=m.next()).done);j=!0){var q,p=n.value;i(p)}}catch(t){k=!0,l=t}finally{try{!j&&m.return&&m.return()}finally{if(k)throw l}}var r=function(u){var v=c.controls[u];v.action&&a.delegate(f.mavo.element,"click",".mv-"+u,function(w){(!v.permission||f.permissions.is(v.permission))&&(v.action.call(f.mavo),w.preventDefault())})};for(var s in c.controls)r(s);this.controls.length&&!this.noResize&&(this.resize(),self.ResizeObserver&&(this.resizeObserver=Mavo.observeResize(this.element,function(){f.resize()})))},resize:function(){return this.targetHeight?void(this.resizeObserver&&this.resizeObserver.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),this.element.offsetHeight>1.5*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight&&this.element.classList.add("mv-tiny")),this.resizeObserver&&this.resizeObserver.observe(this.element)):void(this.targetHeight=this.element.offsetHeight)},add:function(e){var f=this,g=c.controls[e];g.prepare&&g.prepare.call(this.mavo),Mavo.revocably.add(this[e],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return f.resize()})},remove:function(e){var f=this,g=c.controls[e];Mavo.revocably.remove(this[e],"mv-"+e),g.cleanup&&g.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return f.resize()})},toggle:function(e,f){return this[f?"add":"remove"](e)},proxy:{permissions:"mavo"},static:{getControls:function(e){var f=Object.keys(c.controls).filter(function(u){return!c.controls[u].optional});if(e){var g="none"==e?[]:e.trim().split(/\s+/),h=!0,i={},j=!0,k=!1,l;try{for(var n,m=g[Symbol.iterator]();!(j=(n=m.next()).done);j=!0){var p=n.value,q=Mavo.match(p,/([a-z]+)\s*$/i,1);q in c.controls&&(i[q]=Mavo.match(p,/^(no|yes)\-/i,1))}}catch(u){k=!0,l=u}finally{try{!j&&m.return&&m.return()}finally{if(k)throw l}}for(var r in i)if(!i[r]){h=!1;break}var s=h?f:[];for(var r in i){var t=i[r];"no"!=t&&t||Mavo.delete(s,r),-1===s.indexOf(r)&&"no"!=t&&s.push(r)}return s}return f},controls:{status:{create:function(){var e=a.create({className:"mv-status"});return e},prepare:function(){var e=this.primaryBackend;if(e&&e.user){var f=e.user,g=f.name||"";f.avatar&&(g="<img class=\"mv-avatar\" src=\""+f.avatar+"\" /> "+g),f.url&&(g="<a href=\""+f.url+"\" target=\"_blank\">"+g+"</a>"),this.bar.status.innerHTML="<span>"+this._("logged-in-as",e)+"</span> "+g}},permission:"logout"},edit:{action:function(){this.editing?this.done():this.edit()},permission:["edit","add","delete"],cleanup:function(){this.editing&&this.done()}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}})})(Bliss,Bliss.$);
"use strict";(function(a){Mavo.UI.Message=a.Class({constructor:function(f,g,h){var i=this;if(this.mavo=f,this.message=g,this.closed=Mavo.defer(),this.element=a.create({className:"mv-ui mv-message"+(h.type?" mv-"+h.type:""),innerHTML:this.message,events:{click:function(){return Mavo.scrollIntoViewIfNeeded(i.mavo.element)}},after:this.mavo.bar.element}),h.classes&&this.element.classList.add(h.classes),"error"==h.type?this.element.setAttribute("role","alert"):this.element.setAttribute("aria-live","polite"),h.dismiss=h.dismiss||{},"string"==typeof h.dismiss||Array.isArray(h.dismiss)){var m,j={},k=!0,l=!1;try{for(var p,q,n=Mavo.toArray(h.dismiss)[Symbol.iterator]();!(k=(p=n.next()).done);k=!0)q=p.value,j[q]=!0}catch(t){l=!0,m=t}finally{try{!k&&n.return&&n.return()}finally{if(l)throw m}}h.dismiss=j}if(h.dismiss.button&&a.create("button",{className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){return i.close()}},start:this.element}),h.dismiss.timeout){var s,r="number"==typeof h.dismiss.timeout?h.dismiss.timeout:5e3;a.events(this.element,{mouseenter:function(){return clearTimeout(s)},mouseleave:Mavo.rr(function(){return s=setTimeout(function(){return i.close()},r)})})}h.dismiss.submit&&this.element.addEventListener("submit",function(t){t.preventDefault(),i.close(t.target)})},close:function(f){var g=this;a.transition(this.element,{opacity:0}).then(function(){a.remove(g.element),g.closed.resolve(f)})}})})(Bliss,Bliss.$);
"use strict";(function(a){var b=Mavo.Permissions=a.Class({constructor:function(d){this.triggers=[],this.hooks=new a.Hooks,this.parentChanged=b.prototype.parentChanged.bind(this),this.set(d)},set:function(d){for(var e in d)this[e]=d[e]},on:function(d){var e=this;return Mavo.toArray(d).forEach(function(f){return e[f]=!0}),this},off:function(d){var e=this;return d=Array.isArray(d)?d:[d],d.forEach(function(f){return e[f]=!1}),this},can:function(d,e,f){this.observe(d,!0,e),f&&this.cannot(d,f)},cannot:function(d,e){this.observe(d,!1,e)},observe:function(d,e,f){d=Mavo.toArray(d),this.is(d,e)&&f(),this.triggers.push({actions:d,value:e,callback:f,active:!0})},is:function(d){var e=this,f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,g=Mavo.toArray(d).map(function(h){return!!e[h]}).reduce(function(h,i){return h||i});return f?g:!g},onchange:function(d){this.hooks.add("change",d);var e=!0,f=!1,g;try{for(var i,j,h=b.actions[Symbol.iterator]();!(e=(i=h.next()).done);e=!0)j=i.value,d.call(this,{action:j,value:this[j]})}catch(k){f=!0,g=k}finally{try{!e&&h.return&&h.return()}finally{if(f)throw g}}},parentChanged:function(){var d=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=this["_"+d.action];void 0!==e||d.from==d.value||(this.fireTriggers(d.action),this.hooks.run("change",a.extend({context:this},d)))},changed:function(d,e,f){f=!!f,e=!!e;e==f||(this["_"+d]=e,this.fireTriggers(d),this.hooks.run("change",{action:d,value:e,from:f,context:this}))},fireTriggers:function(d){var e=!0,f=!1,g;try{for(var i,h=this.triggers[Symbol.iterator]();!(e=(i=h.next()).done);e=!0){var j=i.value,k=this.is(j.actions,j.value);j.active&&-1<j.actions.indexOf(d)&&k?(j.active=!1,j.callback()):!k&&(j.active=!0)}}catch(l){f=!0,g=l}finally{try{!e&&h.return&&h.return()}finally{if(f)throw g}}},or:function(d){var e=!0,f=!1,g;try{for(var i,j,h=b.actions[Symbol.iterator]();!(e=(i=h.next()).done);e=!0)j=i.value,this[j]=this[j]||d[j]}catch(k){f=!0,g=k}finally{try{!e&&h.return&&h.return()}finally{if(f)throw g}}return this},live:{parent:function(d){var e=this._parent;if(e!=d){this._parent=d,e&&Mavo.delete(e.hooks.change,this.parentChanged);var h,f=!0,g=!1;try{for(var j,k,i=b.actions[Symbol.iterator]();!(f=(j=i.next()).done);f=!0)k=j.value,this.parentChanged({action:k,value:d?d[k]:void 0,from:e?e[k]:void 0})}catch(l){g=!0,h=l}finally{try{!f&&i.return&&i.return()}finally{if(g)throw h}}d&&d.onchange(this.parentChanged)}}},static:{actions:[],register:function(d,e){return Array.isArray(d)?void d.forEach(function(f){return b.register(f,e)}):void(a.live(b.prototype,d,{get:function(){var g=this["_"+d];return void 0===g&&this.parent?this.parent[d]:g},set:function(g,h){e&&e.call(this,g,h),this.changed(d,g,h)}}),b.actions.push(d))}}});b.register(["read","save"]),b.register("login",function(c){c&&this.logout&&(this.logout=!1)}),b.register("logout",function(c){c&&this.login&&(this.login=!1)}),b.register("edit",function(c){c&&(this.add=this.delete=!0)}),b.register(["add","delete"],function(c){c||(this.edit=!1)})})(Bliss);
"use strict";(function(a){var b=Mavo.Backend=a.Class({constructor:function(d){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};this.source=d,this.url=new URL(this.source,Mavo.base),this.mavo=e.mavo,this.format=Mavo.Formats.create(e.format,this),this.permissions=new Mavo.Permissions},get:function(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new URL(this.url);return d.searchParams.set("timestamp",Date.now()),a.fetch(d.href).then(function(e){return Promise.resolve(e.responseText)},function(){return Promise.resolve(null)})},load:function(){var d=this;return this.ready.then(function(){return d.get()}).then(function(e){return"string"==typeof e?(e=e.replace(/^\ufeff/,""),d.format.parse(e)):e})},store:function(d){var e=this,f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},g=f.path,h=f.format,i=h===void 0?this.format:h;return this.ready.then(function(){var j="string"==typeof d?Promise.resolve(d):i.stringify(d);return j.then(function(k){return e.put(k,g).then(function(){return{data:d,serialized:k}})})})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},put:function(){return Promise.reject()},isAuthenticated:function(){return!!this.accessToken},oAuthParams:function(){return""},toString:function(){return this.id+" ("+this.url+")"},equals:function(d){return d===this||d&&this.id==d.id&&this.source==d.source},request:function(d,e){var f=this,g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",h=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return h.method=h.method||g,h.responseType=h.responseType||"json",h.headers=a.extend({"Content-Type":"application/json; charset=utf-8"},h.headers||{}),h.data=e,this.isAuthenticated()&&(h.headers.Authorization=h.headers.Authorization||"Bearer "+this.accessToken),"object"===a.type(h.data)&&("GET"==h.method?h.data=Object.keys(h.data).map(function(i){return i+"="+encodeURIComponent(h.data[i])}).join("&"):h.data=JSON.stringify(h.data)),d=new URL(d,this.constructor.apiDomain),"GET"==h.method&&d.searchParams.set("timestamp",Date.now()),a.fetch(d,h).catch(function(i){return i&&i.xhr?Promise.reject(i.xhr):void f.mavo.error("Something went wrong while connecting to "+f.id,i)}).then(function(i){return"HEAD"==h.method?i:i.response})},oAuthenticate:function(d){var e=this;return this.ready.then(function(){return e.isAuthenticated()?Promise.resolve():new Promise(function(f,g){var h=e.id.toLowerCase();if(d)e.accessToken=localStorage["mavo:"+h+"token"],e.accessToken&&f(e.accessToken);else{var i={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)};i.top=(screen.height-i.height)/2,i.left=(screen.width-i.width)/2;var j={url:location.href,backend:e.id};if(e.authPopup=open(e.constructor.oAuth+"?client_id="+e.key+"&state="+encodeURIComponent(JSON.stringify(j))+e.oAuthParams(),"popup","width="+i.width+",height="+i.height+",left="+i.left+",top="+i.top),!e.authPopup){var k="Login popup was blocked! Please check your popup blocker settings.";e.mavo.error(k),g(Error(k))}addEventListener("message",function(l){if(l.source===e.authPopup)for(var m in l.data.backend==e.id&&(e.accessToken=localStorage["mavo:"+h+"token"]=l.data.token),e.accessToken||g(Error("Authentication error")),f(e.accessToken),Mavo.all){var n=Mavo.all[m].primaryBackend;n&&n.id===e.id&&n!==e&&!n.isAuthenticated()&&n.login(!0)}})}})})},oAuthLogout:function(){if(this.isAuthenticated()){var d=this.id.toLowerCase();localStorage.removeItem("mavo:"+d+"token"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.element._.fire("mavo:logout",{backend:this})}return Promise.resolve()},static:{create:function(d,e,f){var g;return f&&(g=Mavo.Functions.get(b,f)),d&&!g&&(g=b.types.filter(function(h){return h.test(d)})[0]||b.Remote),g?new g(d,e):null},types:[],register:function(d){return b[d.prototype.id]=d,b.types.push(d),d}}});b.register(a.Class({id:"Element",extends:b,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=a(this.source)||a.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(d){return Promise.resolve(this.element.textContent=d)},static:{test:function(d){return 0===d.indexOf("#")}}})),b.register(a.Class({id:"Remote",extends:b,constructor:function(){this.permissions.on("read")},static:{test:function(){return!1}}})),b.register(a.Class({extends:b,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(d){return d?localStorage[this.key]=d:delete localStorage[this.key],Promise.resolve(d)},static:{test:function(d){return"local"==d}}}))})(Bliss);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a){var c=Mavo.Formats={},e=c.Base=a.Class({abstract:!0,constructor:function(j){this.backend=j},proxy:{mavo:"backend"},parse:function(j){return this.constructor.parse(j,this)},stringify:function(j){return this.constructor.stringify(j,this)},static:{parse:function(j){return Promise.resolve(j)},stringify:function(j){return Promise.resolve(j)},extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(function(j){return a.include(j.test(),j.url)}))}}}),f=c.JSON=a.Class({extends:c.Base,static:{parse:function(j){return Promise.resolve(j?JSON.parse(j):null)},stringify:function(j){return Promise.resolve(Mavo.toJSON(j))},extensions:[".json",".jsonld"]}}),g=c.Text=a.Class({extends:c.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:function(j,k){return Promise.resolve(_defineProperty({},k?k.property:"content",j))},stringify:function(j,k){return Promise.resolve(j[k?k.property:"content"])}}}),h=c.CSV=a.Class({extends:c.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=a.extend({},c.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:function(){return self.Papa},url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:e.ready,parse:function(j,k){return h.ready().then(function(){var l=Papa.parse(j,h.defaultOptions),m=k?k.property:"content";if(k&&(k.options.delimiter=l.meta.delimiter,k.options.linebreak=l.meta.linebreak),l.meta.aborted)throw l.meta.errors.pop();return _defineProperty({},m,l.data)})},stringify:function(j,k){return h.ready().then(function(){var l=k?k.property:"content",m=k?k.options:h.defaultOptions;return Papa.unparse(j[l],m)})}}});Object.defineProperty(c,"create",{value:function(j,k){if(j&&"object"===("undefined"==typeof j?"undefined":_typeof(j)))return j;if("string"==typeof j)for(var l in j=j.toLowerCase(),c){var m=c[l];if(l.toLowerCase()==j)return new m(k)}if(!j){var n=k.url?k.url.pathname:k.source,o=Mavo.match(n,/\.\w+$/)||".json",m=c.JSON;for(var l in c)-1<c[l].extensions.indexOf(o)&&(m=c[l]);return new m(k)}}})})(Bliss,Bliss.$);
"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Node=a.Class({abstract:!0,constructor:function(f,g){var h=this,j=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(!f||!g)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var k={context:this,options:j};this.uid=++c.maxId,this.nodeType=this.nodeType,this.property=null,this.element=f,a.extend(this,k.options),c.all.set(f,[].concat(_toConsumableArray(c.all.get(this.element)||[]),[this])),this.mavo=g,this.group=this.parentGroup=k.options.group,this.template=k.options.template,this.alias=this.element.getAttribute("mv-alias"),this.template?this.template.copies.push(this):this.copies=[],this.fromTemplate("property","type")||(this.property=c.getProperty(f),this.type=Mavo.Group.normalize(f),this.storage=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",k),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=k.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup);var l=this.template;l&&l.expressions&&(this.expressions=l.expressions.map(function(m){return new Mavo.DOMExpression({template:m,item:h,mavo:h.mavo})})),Mavo.hooks.run("node-init-end",k)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.storage},get parent(){return this.collection||this.parentGroup},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){if(this.template&&Mavo.delete(this.template.copies,this),this.expressions){var h,f=!0,g=!1;try{for(var k,l,j=this.expressions[Symbol.iterator]();!(f=(k=j.next()).done);f=!0)l=k.value,l.destroy()}catch(m){g=!0,h=m}finally{try{!f&&j.return&&j.return()}finally{if(g)throw h}}}},getData:function(){var f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(this.isDataNull(f))return f.forceObjects?Mavo.objectify(null):null},isDataNull:function(f){var g={context:this,options:f,result:this.deleted||!this.saved&&!f.live};return Mavo.hooks.run("unit-isdatanull",g),g.result},walk:function(f){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return function k(l,m){var n=f(l,m);if(!1!==n)for(var q in l.children){var r=l.children[q];if(r instanceof Mavo.Node){var n=k.call(r,r,[].concat(_toConsumableArray(m),[q]));if(!1===n&&!h.descentReturn)return!1}}return!1!==n}(this,g)},walkUp:function(f){for(var h,g=this;g=g.parentGroup;)if(h=f(g),void 0!==h)return h},edit:function(){return this.mode="edit","edit"==this.mode&&void Mavo.hooks.run("node-edit-end",this)},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(a.unbind(this.element,".mavo:edit"),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(f){for(var g in this.children){var h=this.children[g];h instanceof Mavo.Node&&("function"==typeof f?f.call(h,h):f in h&&h[f]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var f=arguments.length,g=Array(f),h=0;h<f;h++)g[h]=arguments[h];var j=!0,k=!1,l;try{for(var n,q,m=g[Symbol.iterator]();!(j=(n=m.next()).done);j=!0)q=n.value,this[q]=this.template[q]}catch(r){k=!0,l=r}finally{try{!j&&m.return&&m.return()}finally{if(k)throw l}}}return!!this.template},render:function(f){this.oldData=this.data,this.data=f,f=Mavo.subset(f,this.inPath);var g={context:this,data:f};if(Mavo.hooks.run("node-render-start",g),"Collection"!=this.nodeType&&Array.isArray(f)){var h;this.isRoot&&1===(h=Object.keys(this.children)).length&&"Collection"===this.children[h[0]].nodeType?g.data=_defineProperty({},h[0],g.data):(this.inPath.push("0"),g.data=g.data[0])}this.editing?(this.done(),this.dataRender(g.data),this.edit()):this.dataRender(g.data),this.save(),Mavo.hooks.run("node-render-end",g)},dataChanged:function(f){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};a.fire(g.element||this.element,"mavo:datachange",a.extend({property:this.property,action:f,mavo:this.mavo,node:this},g))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},getClosestCollection:function(){var f=this.closestItem;return f?f.collection:null},getClosestItem:function(){return this.collection&&this.collection.mutable?this:this.parentGroup?this.parentGroup.closestItem:null},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},resolve:function(f){var g=this.find(f);return void 0===g&&(g=this.walkUp(function(h){return h.property==f?h:f in h.children?h.children[f]:void 0})),void 0===g&&(g=this.mavo.root.find(f)),g},relativizeData:self.Proxy?function(d){var f=this,g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{live:!0},h={};return new Proxy(d,{get:function(k,l,m){return l in k?k[l]:l in m&&l in h?h[l]:void 0},has:function(k,l){if(l in k||l in h)return!0;switch(l){case"$index":return h[l]=f.index||0,!0;case"$next":case"$previous":return f.closestCollection?(h[l]=f.closestCollection.getData(g)[f.index+("$next"==l?1:-1)],!0):(h[l]=null,!1);}var m=f.resolve(l);return void 0===m?l in Mavo.all&&Mavo.all[l].root&&(h[l]=Mavo.all[l].root.getData(g)):(Array.isArray(m)?m=m.map(function(n){return n.getData(g)}).filter(function(n){return null!==n}):m instanceof Mavo.Node&&(m=m.getData(g)),h[l]=m,!0)},set:function(){var l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",m=arguments[2];return console.warn("You cannot set data via expressions. Attempt to set "+l.toString()+" to "+m+" ignored."),m}})}:function(d){return d},pathFrom:function(f){for(var g=this.path,h=f.path,j=0;j<g.length&&h[j]==g[j];j++);return g.slice(j)},getDescendant:function(f){return f.reduce(function(g,h){return g.children[h]},this)},getCousin:function(f){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!this.closestCollection)return null;var h=this.closestCollection,j=Math.abs(f),k=0>f?-1:1;if(h.length<j+1)return null;var l=this.closestItem.index+f;g.wrap&&(l=Mavo.wrap(l,h.length));for(var n,m=0;m<h.length;m++){n=l+m*k,n=g.wrap?Mavo.wrap(n,h.length):n;var q=h.children[n];if(!q||!q.isDeleted())break}if(!q||q.isDeleted()||q==this.closestItem)return null;if(this.collection)return q;var r=this.pathFrom(this.closestItem);return q.getDescendant(r)},lazy:{closestCollection:function(){return this.getClosestCollection()},closestItem:function(){return this.getClosestItem()},inPath:function(){var f="Collection"==this.nodeType?"mv-multiple-path":"mv-path";return(this.element.getAttribute(f)||"").split("/").filter(function(g){return g.length})},properties:function(){if(this.template)return this.template.properties;var f=new Set(this.property&&[this.property]);if("Group"==this.nodeType)for(var g in this.children)f=Mavo.union(f,this.children[g].properties);else"Collection"==this.nodeType&&(f=Mavo.union(f,this.itemTemplate.properties));return f}},live:{store:function(f){a.toggleAttribute(this.element,"mv-storage",f)},unsavedChanges:function(f){return!f||this.saved&&this.editing||(f=!1),this.element.classList.toggle("mv-unsaved-changes",f),f},mode:function(f){var g=this;if(this._mode!=f){if(this.modes&&f!=this.modes&&(f=this.modes),this._mode=f,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var h=this.modes||"edit"==f;Mavo.Observer.sneak(this.mavo.modeObserver,function(){a.toggleAttribute(g.element,"mv-mode",f,h)})}return f}},modes:function(f){return f&&"read"!=f&&"edit"!=f?null:void(this._modes=f,f&&this.mode!=f&&(this.mode=f))},deleted:function(f){var g=this;this.element.classList.toggle("mv-deleted",f),f?(this.elementContents=document.createDocumentFragment(),b(this.element.childNodes).forEach(function(h){g.elementContents.appendChild(h)}),a.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){a.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(){return g.deleted=!1}}}]),this.element.classList.remove("mv-highlight"),this.itembar.remove()):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"),this.itembar.add())},path:{get:function(){var f=this.parent?this.parent.path:[];return this.property?[].concat(_toConsumableArray(f),[this.property]):f}}},static:{maxId:0,all:new WeakMap,create:function(f,g){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return Mavo.is("multiple",f)&&!h.collection?new Mavo.Collection(f,g,h):new Mavo[Mavo.is("group",f)?"Group":"Primitive"](f,g,h)},getProperty:function(f){var g=f.getAttribute("property")||f.getAttribute("itemprop");return g||(f.hasAttribute("property")?g=f.name||f.id||f.classList[0]:f.matches(Mavo.selectors.multiple)&&(g=f.getAttribute("mv-multiple")||"collection")),g&&f.setAttribute("property",g),g},get:function(f,g){var h=(c.all.get(f)||[]).filter(function(j){return!(j instanceof Mavo.Collection)});return 2>h.length||!g?h[0]:h[0]instanceof Mavo.Group?node[1]:void 0},children:function(f){var g=Mavo.Node.get(f);return g?[g]:(g=b(Mavo.selectors.property,f).map(function(h){return Mavo.Node.get(h)}).filter(function(h){return!f.contains(h.parentGroup.element)}).map(function(h){return h.collection||h}),Mavo.Functions.unique(g))}}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Group=a.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){var h=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});var k=b(Mavo.selectors.property+", "+Mavo.selectors.multiple,this.element).filter(function(n){return h.element===n.parentNode.closest(Mavo.selectors.group)}),l=k.map(function(n){return Mavo.Node.getProperty(n)});k.forEach(function(n,q){var r=l[q],s=h.template?h.template.children[r]:null,t={template:s,group:h};if(h.children[r]){var u=h.children[r];u.add(n),u.mutable=u.mutable||Mavo.is("multiple",n)}else h.children[r]=l.indexOf(r)==l.lastIndexOf(r)?Mavo.Node.create(n,h.mavo,t):new Mavo.Collection(n,h.mavo,t)});var m=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=m.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(){var e=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"Node";return Object.keys(this.children).filter(function(g){return e.children[g]instanceof Mavo[f]})},getData:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f={context:this,options:e,data:this.super.getData.call(this,e)};if(void 0!==f.data)return f.data;f.data=this.data?Mavo.clone(Mavo.subset(this.data,this.inPath)):{};var g=Object.keys(this.children);if(1==g.length&&g[0]==this.property){var h=a.extend(a.extend({},f.options),{forceObjects:!0});f.data=this.children[this.property].getData(h)}else for(var j in this.children){var k=this.children[j];if(k.saved||f.options.live){var l=k.getData(f.options);null!==l||f.options.live?f.data[k.property]=l:delete f.data[k.property]}}return f.options.live?f.data&&(f.data[Mavo.toNode]=this,f.data=this.relativizeData(f.data)):(f.data=Mavo.subset(this.data,this.inPath,f.data),g.length||this.isRoot?f.data&&"object"===_typeof(f.data)&&(this.type&&this.type!=c.DEFAULT_TYPE&&(f.data["@type"]=this.type),this.vocab&&(f.data["@context"]=this.vocab)):f.data=null),Mavo.hooks.run("node-getdata-end",f),f.data},find:function(e){var f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(this.property==e)return this;if(e in this.children)return this.children[e].find(e,f);if(this.properties.has(e)){var h,j,g=[];for(var k in this.children)j=this.children[k].find(e,f),void 0!=j&&(Array.isArray(j)?(g.push.apply(g,_toConsumableArray(j)),h=!0):g.push(j));return h||1<g.length?g:g[0]}},edit:function(){var e=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return!1!==this.super.edit.call(this)&&Promise.all(Object.keys(this.children).map(function(g){return e.children[g].edit(f)}))},save:function(){this.unsavedChanges=!1},propagated:["save","import"],dataRender:function(e){var f=this;if(e){if("object"!==("undefined"==typeof e?"undefined":_typeof(e))){if(this.property in this.children)var h=this.property;else var j=a.type(e),k=function(q){return(f.children[q]instanceof Mavo.Primitive)+(f.children[q].datatype==j)},h=Object.keys(this.children).filter(function(n){return!f.children[n].expressionText}).sort(function(n,q){return k(n)-k(q)}).reverse()[0];e=_defineProperty({},h,e),this.data=Mavo.subset(this.data,this.inPath,e)}this.propagate(function(n){var q=e[n.property],r=void 0===q&&n.alias?e[n.alias]:q;n.render(r)});var h}},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(e){if(Mavo.is("group",e)){var f=Mavo.getAttribute(e,"typeof","itemtype")||c.DEFAULT_TYPE;return e.setAttribute("typeof",f),f}return null}}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){var c=Mavo.Primitive=a.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(f){var j=this;this.fromTemplate("config","attribute","templateValue","originalEditor")||(this.config=c.getConfig(f),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&(this.expressionText.primitive=this,this.storage=this.storage||"none",this.modes="read",this.element.setAttribute("aria-live","polite")),!this.editor&&this.element.hasAttribute("mv-edit")&&(!this.originalEditor&&(this.originalEditor=a(this.element.getAttribute("mv-edit"))),this.originalEditor&&!this.template&&(this.originalEditorObserver=new Mavo.Observer(this.originalEditor,"all",function(){var n=j.copies.concat(j),p=!0,q=!1,r;try{for(var t,u,s=n[Symbol.iterator]();!(p=(t=s.next()).done);p=!0)u=t.value,u.editor&&(u.editor=j.originalEditor.cloneNode(!0)),u.setValue(u.value,{force:!0,silent:!0})}catch(v){q=!0,r=v}finally{try{!p&&s.return&&s.return()}finally{if(q)throw r}}}))),this.editor||this.originalEditor||this.attribute||(this.editor=b(this.element.children).filter(function(m){return m.matches(Mavo.selectors.formControl)&&!m.matches(Mavo.selectors.property)})[0],this.editor&&a.remove(this.editor));var k=this.editorValue;this.datatype||"number"!=typeof k&&"boolean"!=typeof k||(this.datatype="undefined"==typeof k?"undefined":_typeof(k)),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&a.events(this.element,this.config.changeEvents,function(m){m.target===j.element&&(j.value=j.getValue())}),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this._default=this.modes?this.templateValue:k:""===this.default?this._default=this.templateValue:this.defaultObserver=new Mavo.Observer(this.element,"mv-default",function(){j.default=j.element.getAttribute("mv-default")});var l=!this.template||this.template.templateValue!=this.templateValue||"edit"==this.modes;this.initialValue=void 0===this.default&&l?this.templateValue:this.default,this.initialValue===void 0&&(this.initialValue=this.emptyValue),this.setValue(this.initialValue,{silent:!0}),Mavo.setAttributeShy(this.element,"aria-label",this.label),this.attribute||Mavo.setAttributeShy(this.element,"mv-attribute","none"),this.observer=new Mavo.Observer(this.element,this.attribute,function(){(j.attribute||!j.editing)&&(j.value=j.getValue())}),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){var d=this.editor||this.originalEditor;if(d){if(d.matches(Mavo.selectors.formControl))return c.getValue(d,{datatype:this.datatype});var f=a(Mavo.selectors.output+", "+Mavo.selectors.formControl,d);if(f)return c.getValue(f)}},set editorValue(d){if(this.config.setEditorValue&&"boolean"!==this.datatype)return this.config.setEditorValue.call(this,d);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))c.setValue(this.editor,d,{config:this.editorDefaults});else{var f=a(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);f&&c.setValue(f,d)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(){var f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},g={context:this,options:f,data:this.super.getData.call(this,f)};return void 0===g.data&&(g.data=this.value,""===g.data&&(g.data=null)),g.options.live?(this.collection||f.forceObjects)&&(g.data=Mavo.objectify(g.data,_defineProperty({},Mavo.toNode,this)),this.collection&&(g.data[this.property]=g.data,g.data=this.relativizeData(g.data))):this.inPath.length&&(g.data=Mavo.subset(this.data,this.inPath,g.data)),Mavo.hooks.run("node-getdata-end",g),g.data},sneak:function(f){return Mavo.Observer.sneak(this.observer,f)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){var f=this;if(!this.editor&&this.originalEditor&&(this.editor=this.originalEditor.cloneNode(!0)),!this.editor){var g=this.config.editor;g&&"boolean"!=this.datatype||(g=Mavo.Elements.defaultConfig[this.datatype||"string"].editor),this.editor=a.create("function"===a.type(g)?g.call(this):g),this.editorValue=this.value}if(a.events(this.editor,{"input change":function(){f.value=f.editorValue},focus:function(){f.editor.select&&f.editor.select()},"mavo:datachange":function(l){"output"===l.property&&(l.stopPropagation(),a.fire(f.editor,"input"))}}),!this.popup&&this.closestCollection&&this.editor.matches(Mavo.selectors.textInput)){var h=this.editor.matches("textarea");this.editor.addEventListener("keydown",function(k){if(13==k.keyCode&&f.closestCollection.editing&&(k.shiftKey||!h)){var l=f.getCousin(1);if(!l){if(f.bottomUp)return;var m=f.closestCollection.add();f.closestCollection.editItem(m,{immediately:!0})}l=f.getCousin(1),l.edit({immediately:!0}).then(function(){return l.editor.focus()}),h&&k.preventDefault()}})}"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var j=/^mv-edit-/i;b(this.element.attributes).forEach(function(k){j.test(k.name)&&this.editor.setAttribute(k.name.replace(j,""),k.value)},this),(this.attribute||this.config.popup)&&(this.popup=new Mavo.UI.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var f=this,g=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!1!==this.super.edit.call(this)&&(-1===this.element.tabIndex&&Mavo.revocably.setAttribute(this.element,"tabindex","0"),this.modes||this.element.addEventListener("click.mavo:edit",function(h){return h.preventDefault()}),this.preEdit=Mavo.defer(function(h){if(g.immediately)return h();var k="click focus dragover dragenter".split(" ").map(function(l){return l+".mavo:preedit"}).join(" ");a.events(f.element,k,h)}).then(function(){return a.unbind(f.element,".mavo:preedit")}),this.config.edit?void this.config.edit.call(this):this.preEdit.then(function(){f.initEdit&&f.initEdit(),f.popup&&(f.popup.prepare(),f.popup.show()),f.attribute||f.popup||(f.editor.parentNode!=f.element&&(f.editorValue=f.value,f.element.textContent="",f.element.appendChild(f.editor)),!f.collection&&(document.activeElement===f.element&&f.editor.focus(),Mavo.revocably.restoreAttribute(f.element,"tabindex")))}))},done:function(){var f=this;return!1!==this.super.done.call(this)&&void("preEdit"in this&&a.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return f.config.done?void f.config.done.call(f):void(f.popup?f.popup.close():!f.attribute&&f.editor&&(a.remove(f.editor),c.setValue(f.element,f.editorValue,{config:f.config,attribute:f.attribute,datatype:f.datatype,map:f.originalEditor||f.editor})))}),!this.collection&&Mavo.revocably.restoreAttribute(this.element,"tabindex"))},dataRender:function(f){if(f&&"object"===("undefined"==typeof f?"undefined":_typeof(f)))if(Symbol.toPrimitive in f)f=f[Symbol.toPrimitive]();else for(var j,g=[this.property,"value"].concat(_toConsumableArray(Object.keys(f))),h=0;h<g.length;h++)if(j=g[h],j in f){f=f[j],this.inPath.push(j);break}f===void 0?!this.modes&&(this.value=this.closestCollection?this.default:this.templateValue):this.value=f},find:function(f){if(this.property==f)return this},getValue:function(){return c.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&c.getConfig(this.editor)}},setValue:function(f){var g=this,h=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.sneak(function(){f=f||0===f||!1===f?f:"";var j=g.datatype;return g.datatype||"number"!=typeof f&&"boolean"!=typeof f||(g.datatype="undefined"==typeof f?"undefined":_typeof(f)),f=c.safeCast(f,g.datatype),h.force||f!=g._value||j!=g.datatype?void(g.editor&&document.activeElement!=g.editor&&(g.editorValue=f),(!g.editing||g.popup||!g.editor)&&(g.config.setValue?g.config.setValue.call(g,g.element,f):!h.dataOnly&&c.setValue(g.element,f,{config:g.config,attribute:g.attribute,datatype:g.datatype,map:g.originalEditor||g.editor})),g.empty=!f&&0!==f,g._value=f,!h.silent&&(g.saved&&(g.unsavedChanges=g.mavo.unsavedChanges=!0),g.dataChanged("propertychange",{value:f}))):f}),f},dataChanged:function(){var f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"propertychange",g=arguments[1];return this.super.dataChanged.call(this,f,g)},live:{default:function(f){this.value==this._default&&(this.value=f)},value:function(f){return this.setValue(f)},datatype:function(f){f!==this._datatype&&("boolean"==f&&!this.attribute&&(this.attribute=Mavo.Elements.defaultConfig.boolean.attribute),a.toggleAttribute(this.element,"datatype",f,f&&"string"!==f))},empty:function(f){var g=f&&!this.modes&&!(this.attribute&&a(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!g)}},static:{all:new WeakMap,getValueAttribute:function(f){var g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mavo.Elements.search(f),h=f.getAttribute("mv-attribute")||g.attribute;return h&&"null"!==h&&"none"!==h||(h=null),h},safeCast:function(f,g){var h="undefined"==typeof f?"undefined":_typeof(f),j=c.cast(f,g);return null===f||void 0===f?f:"boolean"==g?"false"===f||0===f||""===f?!1:"true"===f||0<f||f:"number"==g?/^[-+]?[0-9.e]+$/i.test(f+"")?j:f:j},cast:function(f,g){return"number"===g?+f:"boolean"===g?!!f:"string"===g?f+"":f},getValue:function(f){var g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},h=g.config,j=g.attribute,k=g.datatype;if(h||(h=c.getConfig(f,j)),j=h.attribute,k=h.datatype,h.getValue&&j==h.attribute)return h.getValue(f);var l;return l=j in f&&c.useProperty(f,j)?f[j]:j?f.getAttribute(j):f.getAttribute("content")||f.textContent||null,c.safeCast(l,k)},getConfig:function(f,g,h){void 0===g&&(g=f.getAttribute("mv-attribute")||void 0),("null"==g||"none"==g)&&(g=null),h||(h=f.getAttribute("datatype")||void 0);var j=Mavo.Elements.search(f,g,h);return void 0===j.attribute&&(j.attribute=g||null),void 0===j.datatype&&(j.datatype=h),j},setValue:function(f,g){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(1===f.nodeType&&(h.config||(h.config=c.getConfig(f,h.attribute)),h.attribute=void 0===h.attribute?h.config.attribute:h.attribute,h.datatype=void 0===h.datatype?h.config.datatype:h.datatype,h.config.setValue&&h.attribute==h.config.attribute))return h.config.setValue(f,g);if(h.attribute){if(h.attribute in f&&c.useProperty(f,h.attribute)&&f[h.attribute]!==g)try{f[h.attribute]=g}catch(k){}"boolean"==h.datatype?g!=f.hasAttribute(h.attribute)&&a.toggleAttribute(f,h.attribute,g,g):f.getAttribute(h.attribute)!=g&&f.setAttribute(h.attribute,g)}else{var j=c.format(g,h);j===g?f.textContent=g:(f.textContent=j,f.setAttribute&&f.setAttribute("content",g))}},useProperty:function(f,g){return!(-1<["href","src"].indexOf(g))&&"http://www.w3.org/2000/svg"!=f.namespaceURI},format:function(f){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(g.map&&/^select$/i.test(g.map.nodeName))for(var j,h=0;j=g.map.options[h];h++)if(j.value==f)return j.textContent;if("number"===a.type(f)||"number"==g.datatype){var k=g.attribute||g.element&&g.element.matches("style, pre");if(!k)return c.formatNumber(f)}return Array.isArray(f)?f.map(c.format).join(", "):"object"===a.type(f)?Mavo.toJSON(f):f},lazy:{formatNumber:function(){var f=new Intl.NumberFormat(Mavo.locale,{maximumFractionDigits:2});return function(g){return g===Infinity||g===-Infinity?0>g?"-\u221E":"\u221E":f.format(g)}}}}})})(Bliss,Bliss.$);
"use strict";(function(a){Mavo.UI.Popup=a.Class({constructor:function(f){var g=this;this.primitive=f,this.position=function(){var i=g.primitive.element.getBoundingClientRect(),j=i.left,k=i.bottom;if(g.element.offsetHeight){var l=g.element.getBoundingClientRect();l.height+k>innerHeight&&(k=innerHeight-l.height-20)}a.style(g.element,{top:k+"px",left:j+"px"})},this.element=a.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:function(i){(13==i.keyCode||27==i.keyCode)&&(g.element.contains(document.activeElement)&&g.primitive.element.focus(),i.stopPropagation(),g.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var f=this;a.unbind([this.primitive.element,this.element],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(g){f.element.contains(g.target)||f.primitive.element.contains(g.target)||f.hide()},this.position(),document.body.appendChild(this.element),requestAnimationFrame(function(){return f.element.removeAttribute("hidden")}),a.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var f=this;a.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.element.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){a.remove(f.element)},1e3*parseFloat(getComputedStyle(this.element).transitionDuration)||400)},prepare:function(){var f=this;a.events(this.primitive.element,{"click.mavo:edit":function(){f.show()},"keyup.mavo:edit":function(h){-1<[13,113].indexOf(h.keyCode)&&(f.show(),f.editor.focus())}})},close:function(){this.hide(),a.unbind(this.primitive.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive"}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};(function(a){var c=Mavo.Elements={};Object.defineProperties(c,{register:{value:function(f,g){if("object"===_typeof(arguments[0])){for(var h in arguments[0])c.register(h,arguments[0][h]);return}if(g.extend){var i=c[g.extend];g=a.extend(a.extend({},i,function(u){return"selector"!=u}),g)}if(-1<f.indexOf("@")){var j=f.split("@");g.selector=g.selector||j[0]||"*",void 0===g.attribute&&(g.attribute=j[1])}if(g.selector=g.selector||f,g.id=f,Array.isArray(g.attribute)){var m,k=!0,l=!1;try{for(var q,n=g.attribute[Symbol.iterator]();!(k=(q=n.next()).done);k=!0){var r=q.value,t=a.extend({},g);t.attribute=r,c[f+"@"+r]=t}}catch(u){l=!0,m=u}finally{try{!k&&n.return&&n.return()}finally{if(l)throw m}}}else c[f]=g;return c}},search:{value:function(f,g,h){var i=c.matches(f,g,h),j=i[i.length-1];if(j)return j;var k=a.extend({},c.defaultConfig[h||"string"]);return k.attribute=void 0===g?k.attribute:g,k}},matches:{value:function(f,g,h){var i=[];selectorloop:for(var j in c){var k=c[j],l=g===void 0&&k.default||g===k.attribute;if(l&&(void 0===h||"string"===h||h===k.datatype)){var m=k.selector||j;f.matches(m)&&(!k.test||k.test(f,g,h))&&i.push(k)}}return i}},isSVG:{value:function(f){return"http://www.w3.org/2000/svg"==f.namespaceURI}},defaultConfig:{value:{string:{editor:{tag:"input"}},number:{editor:{tag:"input",type:"number"}},boolean:{attribute:"content",editor:{tag:"input",type:"checkbox"}}}}}),c.register({"@hidden":{datatype:"boolean"},"@y":{test:c.isSVG,datatype:"number"},"@x":{default:!0,test:c.isSVG,datatype:"number"},media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var f=this,g=this.mavo.storage&&this.mavo.storage.upload?this.mavo.storage:this.uploadBackend,h=a.create("input",{type:"url",placeholder:"http://example.com/image.png",className:"mv-output","aria-label":"URL to image"});if(g&&self.FileReader){var i,j=this.element.nodeName.toLowerCase();j="img"==j?"image":j;var k=this.element.getAttribute("mv-uploads")||j+"s",l=function(q){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:q.name;q&&0===q.type.indexOf(j+"/")&&f.mavo.upload(q,k+"/"+r).then(function(t){h.value=t;var u=0,v=Mavo.rr(function(){return a.fetch(t+"?"+Date.now()).then(function(){f.mavo.inProgress=!1,a.fire(h,"input")}).catch(function(w){if(400<w.status&&10>u)return f.mavo.inProgress="Loading Image",u++,Mavo.timeout(2e3).then(v)})})})},m={paste:function(q){var r=q.clipboardData.items[0];if("file"==r.kind&&0===r.type.indexOf(j+"/")){var t="pasted-"+j+"-"+Date.now()+"."+r.type.slice(6);l(r.getAsFile(),t),q.preventDefault()}},"drag dragstart dragend dragover dragenter dragleave drop":function(q){q.preventDefault(),q.stopPropagation()},"dragover dragenter":function(){i.classList.add("mv-dragover"),f.element.classList.add("mv-dragover")},"dragleave dragend drop":function(){i.classList.remove("mv-dragover"),f.element.classList.remove("mv-dragover")},drop:function(q){l(q.dataTransfer.files[0])}};return a.events(this.element,m),i=a.create({className:"mv-upload-popup",contents:[h,{tag:"input",type:"file","aria-label":"Upload image",accept:j+"/*",events:{change:function(q){var r=q.target.files[0];r&&l(r)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:m})}return h}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},details:{attribute:"open",datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},formControl:{selector:"select, input",default:!0,attribute:"value",modes:"edit",changeEvents:"input change",edit:function(){},done:function(){},init:function(){this.editor=this.element}},textarea:{extend:"formControl",attribute:null,getValue:function(f){return f.value},setValue:function(f,g){return f.value=g}},formNumber:{extend:"formControl",selector:"input[type=range], input[type=number]",datatype:"number"},checkbox:{extend:"formControl",selector:"input[type=checkbox]",attribute:"checked",datatype:"boolean",changeEvents:"click"},"input[type=radio]":{extend:"formControl",attribute:"checked",modes:"edit",getValue:function(f){if(f.form)return f.form[f.name].value;var g=a("input[type=radio][name=\""+f.name+"\"]:checked");return g&&g.value},setValue:function(f,g){if(f.form)return void(f.form[f.name].value=g);var h=a("input[type=radio][name=\""+f.name+"\"][value=\""+g+"\"]");a.properties(h,{checked:!0})},init:function(f){var g=this;this.mavo.element.addEventListener("change",function(h){h.target.name==f.name&&(g.value=g.getValue())})}},counter:{extend:"formControl",selector:"button, .counter",attribute:"mv-clicked",datatype:"number",init:function(f){var g=this;"mv-clicked"===this.attribute&&(f.setAttribute("mv-clicked","0"),f.addEventListener("click",function(){var i=+f.getAttribute("mv-clicked")||0;g.value=++i}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var f=this,g=+this.element.getAttribute("min")||0,h=+this.element.getAttribute("max")||1,i=h-g,j=+this.element.getAttribute("mv-edit-step")||(1<i?1:i/100);this.element.addEventListener("mousemove.mavo:edit",function(k){var l=f.element.getBoundingClientRect().left,m=Math.max(0,(k.clientX-l)/f.element.offsetWidth),n=g+i*m,q=n%j;n+=q>j/2?j-q:-q,n=Math.max(g,Math.min(n,h)),f.sneak(function(){return f.element.setAttribute("value",n)})}),this.element.addEventListener("mouseleave.mavo:edit",function(){f.sneak(function(){return f.element.setAttribute("value",f.value)})}),this.element.addEventListener("click.mavo:edit",function(){f.value=f.getValue()}),this.element.addEventListener("keydown.mavo:edit",function(k){if(k.target==f.element&&(37==k.keyCode||39==k.keyCode)){var l=j*(39==k.keyCode?1:-1)*(k.shiftKey?10:1),m=f.value+l;m=Math.max(g,Math.min(m,h)),f.element.setAttribute("value",m),k.preventDefault()}})},done:function(){a.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address",editor:function(){var f=getComputedStyle(this.element).display,g=0===f.indexOf("inline")?"input":"textarea",d=a.create(g);if("textarea"==g){var h=this.element.offsetWidth;h&&(d.width=h)}return d},setEditorValue:function(f){this.datatype&&"string"!=this.datatype&&(f+="");var g=getComputedStyle(this.element);return f=f||"",-1<["normal","nowrap"].indexOf(g.whiteSpace)&&(f=f.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(g.whiteSpace)&&(f=f.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=f,!0}},time:{attribute:"datetime",default:!0,init:function(){if(!this.fromTemplate("dateType")){var f=Mavo.DOMExpression.search(this.element,null),g=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var h in this.config.dateTypes)if(this.config.dateTypes[h].test(g))break;this.dateType=h,f||(this.element.textContent=this.config.defaultFormats[this.dateType](this.property),this.mavo.expressions.extract(this.element,null))}},dateTypes:{date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},defaultFormats:{date:function(f){return"[day("+f+")] [month("+f+").shortname] [year("+f+")]"},month:function(f){return"[month("+f+").name] [year("+f+")]"},time:function(f){return"[hour("+f+").twodigit]:[minute("+f+").twodigit]"},"datetime-local":function(f){return"[day("+f+")] [month("+f+").shortname] [year("+f+")]"}},editor:function(){return{tag:"input",type:this.dateType}}},"circle@r":{default:!0,datatype:"number"},circle:{attribute:["cx","cy"],datatype:"number"},text:{default:!0,popup:!0},".mv-toggle":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){var f=this;Mavo.revocably.setAttribute(this.element,"role","checkbox"),a.events(this.element,"click.mavo:edit keyup.mavo:edit keydown.mavo:edit",function(g){("click"==g.type||" "==g.key||"Enter"==g.key)&&("keydown"!=g.type&&(f.value=!f.value),g.preventDefault(),g.stopPropagation())})},done:function(){Mavo.revocably.restoreAttribute(this.element,"role"),a.unbind(this.element,".mavo:edit")}}})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(d){if(Array.isArray(d)){for(var e=0,f=Array(d.length);e<d.length;e++)f[e]=d[e];return f}return Array.from(d)}(function(d,e){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var f=Mavo.Collection=d.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){this.templateElement=this.element,this.children=[],this.fromTemplate("mutable","templateElement","accepts")||(this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0));var m=this.createItem(this.element);this.add(m,void 0,{silent:!0}),this.itemTemplate=m.template||m,this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var n,h=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},k={context:this,options:h,data:[]},l=!0,m=!1;try{for(var q,r,p=this.children[Symbol.iterator]();!(l=(q=p.next()).done);l=!0)if(r=q.value,!r.deleted||k.options.live){var s=r.getData(k.options);(k.options.live||null!==Mavo.value(s))&&k.data.push(s)}}catch(u){m=!0,n=u}finally{try{!l&&p.return&&p.return()}finally{if(m)throw n}}if(!this.mutable)if(k.data=k.data.filter(function(u){return null!==Mavo.value(u)}),k.options.live&&1===k.data.length)k.data=k.data[0];else if(this.data&&!k.options.live){var t=Mavo.subset(this.data,this.inPath);k.data=k.data.concat(t.slice(k.data.length))}return k.options.live&&Array.isArray(k.data)&&(k.data[Mavo.toNode]=this,k.data=this.relativizeData(k.data)),k.options.live||(k.data=Mavo.subset(this.data,this.inPath,k.data)),Mavo.hooks.run("node-getdata-end",k),k.data},createItem:function(h){h||(h=this.templateElement.cloneNode(!0));var k=Mavo.Node.create(h,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return k},add:function(h,k){var l=this,m=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(h=h instanceof Node?Mavo.Node.get(h)||this.createItem(h):h||this.createItem(),h.collection!=this&&this.adopt(h),this.mutable){var n=this.children[k]?this.children[k].element:this.marker;d[this.bottomUp?"after":"before"](h.element,n),void 0===k&&(k=this.bottomUp?0:this.length)}else k=this.length;var p={context:this,item:h};return p.previousIndex=h.index,p.changed=this.splice({remove:p.item},{index:k,add:p.item}),p.item.itembar&&p.item.itembar.reposition(),this.mavo.expressions.active&&!m.silent&&requestAnimationFrame(function(){p.changed.forEach(function(q){q.dataChanged(q==p.item&&void 0===p.previousIndex?"add":"move"),q.unsavedChanges=!0}),l.unsavedChanges=l.mavo.unsavedChanges=!0,l.mavo.expressions.update(p.item)}),Mavo.hooks.run("collection-add-end",p),p.item},splice:function(){for(var h=arguments.length,k=Array(h),l=0;l<h;l++)k[l]=arguments[l];var m=!0,n=!1,p;try{for(var r,s,q=k[Symbol.iterator]();!(m=(r=q.next()).done);m=!0)s=r.value,void 0===s.index&&s.remove&&isNaN(s.remove)&&(s.index=this.children.indexOf(s.remove),s.remove=1)}catch(D){n=!0,p=D}finally{try{!m&&q.return&&q.return()}finally{if(n)throw p}}k.sort(function(D,E){return E.index-D.index});var t=!0,u=!1,v;try{for(var x,y,w=k[Symbol.iterator]();!(t=(x=w.next()).done);t=!0)if(y=x.value,-1<y.index&&(y.remove||y.add)){var z;y.remove=y.remove||0,y.add=Mavo.toArray(y.add),(z=this.children).splice.apply(z,[y.index,+y.remove].concat(_toConsumableArray(y.add)))}}catch(D){u=!0,v=D}finally{try{!t&&w.return&&w.return()}finally{if(u)throw v}}for(var C,A=[],B=0;B<this.length;B++)C=this.children[B],C&&C.index!==B&&(C.index=B,A.push(C));return A},adopt:function(h){var k=this;h.collection&&(h.collection.splice({remove:h}),h.collection.dataChanged("delete")),this.walk(function(l){l.closestCollection===h.collection&&(l.closestCollection=k),h.mavo!=k.mavo&&(h.mavo=k.mavo)}),h.collection=this,h.template&&(Mavo.delete(h.template.copies,h),h.template=this.itemTemplate)},delete:function(h,k){var l=this;return k?(d.remove(h.element),this.splice({remove:h}),void h.destroy()):d.transition(h.element,{opacity:0}).then(function(){h.deleted=!0,h.element.style.opacity="",h.dataChanged("delete"),l.unsavedChanges=h.unsavedChanges=l.mavo.unsavedChanges=!0})},move:function(h,k){var l=h.index+k+(0<k);l=Mavo.wrap(l,this.children.length+1),this.add(h,l),h instanceof Mavo.Primitive&&h.itembar&&h.itembar.reposition()},editItem:function(h){var k=this,l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},m=l.immediately?Promise.resolve():Mavo.inView.when(h.element);return m.then(function(){return k.mutable&&(!h.itembar&&(h.itembar=new Mavo.UI.Itembar(h)),h.itembar.add()),h.edit(l)})},edit:function(){var h=this,k=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var l=this.element.tagName.toLowerCase(),m=Mavo.selectors.container[l],n=m?this.marker.parentNode.closest(m):this.marker;d[this.bottomUp?"before":"after"](this.addButton,n)}f.dragula.then(function(){h.getDragula()})}return Promise.all(this.children.map(function(p){return h.editItem(p,k)}))},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(function(h){h.itembar&&h.itembar.remove()})))},dataChanged:function(h){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return k.element=k.element||this.marker,this.super.dataChanged.call(this,h,k)},save:function(){var h=!0,k=!1,l;try{for(var n,p,m=this.children[Symbol.iterator]();!(h=(n=m.next()).done);h=!0)p=n.value,p.deleted?this.delete(p,!0):p.unsavedChanges=!1}catch(q){k=!0,l=q}finally{try{!h&&m.return&&m.return()}finally{if(k)throw l}}},propagated:["save"],dataRender:function(h){var k=this;if(void 0!==h)if(h=null===h?[]:Mavo.toArray(h).filter(function(r){return null!==r}),!this.mutable)this.children.forEach(function(r,s){return r.render(h&&h[s])});else{for(var m,l=0;l<this.children.length;l++)m=this.children[l],l<h.length?m.render(h[l]):(m.dataChanged("delete"),this.delete(m,!0));if(h.length>l){for(var m,n=document.createDocumentFragment(),p=l;p<h.length;p++){m=this.createItem(),m.render(h[p]),this.children.push(m),m.index=p,n.appendChild(m.element);var q={context:this,item:m};Mavo.hooks.run("collection-add-end",q)}this.bottomUp?d.after(n,0<l?this.children[l-1].element:this.marker):d.before(n,this.marker);for(var p=l;p<this.children.length;p++)this.children[p].dataChanged("add"),this.mavo.expressions.active&&requestAnimationFrame(function(){return k.mavo.expressions.update(k.children[p])})}}},find:function(h){var k=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},l=this.children.filter(function(n){return!n.deleted});if(this.property==h)return k.collections?this:l;if(this.properties.has(h)){var m=l.map(function(n){return n.find(h,k)});return Mavo.flatten(m)}},isCompatible:function(h){return h&&this.itemTemplate.nodeType==h.itemTemplate.nodeType&&(h===this||h.template==this||this.template==h||this.template&&this.template==h.template||-1<this.accepts.indexOf(h.property))},live:{mutable:function(h){if(h&&h!==this.mutable){this._mutable=h,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this);var k=this.templateElement.parentNode?this.templateElement:this.children[this.length-1].element;d.after(this.marker,k)}}},getDragula:function(){var h=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(m){return!!h.accepts.length&&-1<Mavo.flatten(h.accepts.map(function(n){return h.mavo.root.find(n,{collections:!0})})).filter(function(n){return n&&n instanceof f}).map(function(n){return n.marker.parentNode}).indexOf(m)},moves:function(m,n,p){return p.classList.contains("mv-drag-handle")&&p.closest(Mavo.selectors.multiple)==m},accepts:function(m,n,p,q){if(m.contains(n))return!1;var r=q?q.previousElementSibling:n.lastElementChild,s=f.get(r)||f.get(q);if(!s)return!1;var t=Mavo.Node.get(m);return t&&t.collection.isCompatible(s)}}),this.dragula.on("drop",function(l){var p=Mavo.Node.get(l),q=p&&p.index,r=l.nextElementSibling,s=l.previousElementSibling,t=f.get(s)||f.get(r),u=Mavo.Node.get(s)||Mavo.Node.get(r);if(u&&u.collection!=t&&(u=null),p.collection.isCompatible(t)){var v=u?u.index+(u.element===s):t.length;t.add(p,v)}else return h.dragula.cancel(!0)}),f.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var h=this.templateElement.getAttribute("mv-order");return null===h?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(h)},closestCollection:function(){var h=this.marker?this.marker.parentNode:this.templateElement.parentNode;return h.closest(Mavo.selectors.multiple)},addButton:function(){var h=this,k="button.mv-add-"+this.property,l=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(l)var m=e(k,l).filter(function(n){return!h.templateElement.contains(n)})[0];return m||(m=d.create("button",{className:"mv-add",textContent:this.mavo._("add-item",this)})),m.classList.add("mv-ui","mv-add"),Mavo.data(m,"collection",this),this.property&&m.classList.add("mv-add-"+this.property),m.addEventListener("click",function(n){n.preventDefault(),h.editItem(h.add())}),m}},static:{dragulas:[],get:function(h){var k=Mavo.data(h,"collection");if(k)return k;var l=Mavo.Node.get(h);return l&&l.collection||null},lazy:{dragula:function(){return d.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}})})(Bliss,Bliss.$);
"use strict";(function(a,b){Mavo.UI.Itembar=a.Class({constructor:function(e){var f=this;if(this.item=e,this.element=b(".mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel=\""+this.item.property+"\"]",this.item.element).filter(function(i){return i.closest(Mavo.selectors.multiple)==f.item.element&&!Mavo.data(i,"item")})[0],!this.element&&this.item.template&&this.item.template.itembar)this.element=this.item.template.itembar.element.cloneNode(!0),this.dragHandle=a(".mv-drag-handle",this.element)||this.item.element;else{this.element=this.element||a.create({className:"mv-item-bar mv-ui"});var g=[{tag:"button",title:this.mavo._("delete-item",this.item),className:"mv-delete"},{tag:"button",title:this.mavo._("add-item-"+(this.collection.bottomUp?"after":"before"),this.item),className:"mv-add"}];this.item instanceof Mavo.Group?(this.dragHandle=a.create({tag:"button",title:this.mavo._("drag-to-reorder",this.item),className:"mv-drag-handle"}),g.push(this.dragHandle)):this.dragHandle=this.item.element,a.set(this.element,{"mv-rel":this.item.property,contents:g})}a.events(this.element,{mouseenter:function(){f.item.element.classList.add("mv-highlight")},mouseleave:function(){f.item.element.classList.remove("mv-highlight")}}),this.dragHandle.addEventListener("keydown",function(i){i.target===f.dragHandle&&f.item.editing&&37<=i.keyCode&&40>=i.keyCode&&(f.collection.move(f.item,38>=i.keyCode?-1:1),i.stopPropagation(),i.preventDefault(),i.target.focus())});var h={add:this.buttonSelector("add"),delete:this.buttonSelector("delete"),drag:this.buttonSelector("drag")};this.element.addEventListener("click",function(i){if(f.item.collection.editing){if(i.target.matches(h.add)){var j=f.collection.add(null,f.item.index);return i[Mavo.superKey]&&j.render(f.item.getData()),Mavo.scrollIntoViewIfNeeded(j.element),f.collection.editItem(j)}i.target.matches(h.delete)?f.item.collection.delete(e):i.target.matches(h["drag-handle"])&&function(k){return k.target.focus()}}}),Mavo.data(this.element,"item",this.item)},add:function(){this.element.parentNode||Mavo.revocably.add(this.element)||(this.item instanceof Mavo.Primitive&&!this.item.attribute?(this.element.classList.add("mv-adjacent"),a.after(this.element,this.item.element)):this.item.element.appendChild(this.element)),this.dragHandle==this.item.element&&this.item.element.classList.add("mv-drag-handle")},remove:function(){Mavo.revocably.remove(this.element),this.dragHandle==this.item.element&&this.item.element.classList.remove("mv-drag-handle")},reposition:function(){this.item instanceof Mavo.Primitive&&(this.element.remove(),this.add())},buttonSelector:function(e){return".mv-"+e+"[mv-rel=\""+this.item.property+"\"], [mv-rel=\""+this.item.property+"\"] > .mv-"+e},proxy:{collection:"item",mavo:"item"}})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a){Mavo.attributes.push("mv-expressions");var b=Mavo.Expression=a.Class({constructor:function(d){this.expression=d},eval:function(d){Mavo.hooks.run("expression-eval-beforeeval",this);try{return this.function||(this.function=Mavo.Script.compile(this.expression)),this.function(d)}catch(e){return console.info("%cExpression error!","color: red; font-weight: bold",e.message+" in expression "+this.expression,"\nNot an expression? Use mv-expressions=\"none\" to disable expressions on an element and its descendants."),Mavo.hooks.run("expression-eval-error",{context:this,exception:e}),e}},toString:function(){return this.expression},changedBy:function(d){return b.changedBy(this.identifiers,d)},live:{expression:function(d){this.function=null,this.identifiers=d.match(/[$a-z][$\w]*/ig)||[]}},static:{changedBy:function(d,e){if(!e)return!0;if(!d)return!1;if(-1<d.indexOf(e.property))return!0;if(Mavo.Functions.intersects(e.properties,d))return!0;if("propertychange"!=e.action){if(Mavo.Functions.intersects(["$index","$previous","$next"],d))return!0;var f=e.node.collection||e.node;if(Mavo.Functions.intersects(f.properties,d))return!0}return!1}}});b.Syntax=a.Class({constructor:function(d,e){this.start=d,this.end=e,this.regex=RegExp(Mavo.escapeRegExp(d)+"([\\S\\s]+?)"+Mavo.escapeRegExp(e),"gi")},test:function(d){return this.regex.lastIndex=0,this.regex.test(d)},tokenize:function(d){var e,f=[],g=0;for(this.regex.lastIndex=0;null!==(e=this.regex.exec(d));)e.index>g&&f.push(d.substring(g,e.index)),g=this.regex.lastIndex,f.push(new Mavo.Expression(e[1]));return g<d.length&&f.push(d.substring(g)),f},static:{create:function(d){if(d){var e=d.getAttribute("mv-expressions");if(e)return e=e.trim(),/\s/.test(e)?new(Function.prototype.bind.apply(b.Syntax,[null].concat(_toConsumableArray(e.split(/\s+/))))):b.Syntax.ESCAPE}},ESCAPE:-1}}),b.Syntax.default=new b.Syntax("[","]")})(Bliss);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a){var b=Mavo.DOMExpression=a.Class({constructor:function(){var d=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.mavo=e.mavo,this.template=e.template&&e.template.template||e.template;for(var h,f=["item","path","syntax","fallback","attribute","originalAttribute","expression","parsed"],g=0;g<f.length;g++)h=f[g],this[h]=void 0===e[h]&&this.template?this.template[h]:e[h];if(this.node=e.node,this.node||(this.node=Mavo.elementPath(this.item.element,this.path)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),3===this.node.nodeType&&this.element===this.node&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),!this.expression){if(this.attribute)this.expression=this.node.getAttribute(this.attribute).trim();else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var j=this.node.firstChild.textContent.match(/^\s*|\s*$/g);j[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-j[1].length),a.after(this.node.lastChild,this.node)),j[0]&&(this.node.firstChild.splitText(j[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=e.template?e.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(k){return k instanceof Mavo.Expression?k.expression:k}),this.item=Mavo.Node.get(this.element.closest(Mavo.selectors.item)),this.mavo.treeBuilt.then(function(){d.template||d.item||(d.item=Mavo.Node.get(d.element.closest(Mavo.selectors.item))),Mavo.hooks.run("domexpression-init-treebuilt",d)}),Mavo.hooks.run("domexpression-init-end",this),b.elements.set(this.element,[].concat(_toConsumableArray(b.elements.get(this.element)||[]),[this]))},destroy:function(){b.special.delete(this)},changedBy:function(d){return this.identifiers||(this.identifiers=Mavo.flatten(this.parsed.map(function(e){return e.identifiers||[]})),b.special.add(this)),Mavo.Expression.changedBy(this.identifiers,d)},update:function(){var d=this,e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data,f=arguments[1],g={context:this,event:f},h=g;this.data=e,Mavo.hooks.run("domexpression-update-start",g),this.oldValue=this.value;var j=!1;g.value=this.value=this.parsed.map(function(k,l){if(k instanceof Mavo.Expression){if(k.changedBy(h.event)){var m={context:d,expr:k,parentEnv:h};return Mavo.hooks.run("domexpression-update-beforeeval",m),m.value=Mavo.value(m.expr.eval(e)),Mavo.hooks.run("domexpression-update-aftereval",m),j=!0,m.value instanceof Error?void 0===d.fallback?d.syntax.start+m.expr.expression+d.syntax.end:d.fallback:void 0===m.value||null===m.value?"":m.value}return d.oldValue[l]}return k});j&&(g.value=1===g.value.length?g.value[0]:g.value.map(function(k){return Mavo.Primitive.format(k,{attribute:d.attribute,element:d.element})}).join(""),this.output(g.value),Mavo.hooks.run("domexpression-update-end",g))},output:function(d){this.primitive?this.primitive.value=d:Mavo.Primitive.setValue(this.node,d,{attribute:this.attribute})},live:{item:function(d){d&&this._item!=d&&(this._item&&Mavo.delete(this._item.expressions,this),d.expressions=d.expressions||[],d.expressions.push(this))}},static:{elements:new WeakMap,search:function(d,e){if(null===d)return d;var f=b.elements.get(d)||[];return 1<arguments.length?f.length?f.filter(function(g){return g.attribute===e})[0]||null:null:f},special:{add:function(d,e){if(e){var f=this.vars[e];f&&-1<d.identifiers.indexOf(e)&&(f.all=f.all||new Set,f.all.add(d),1===f.all.size?f.observe():!f.all.size&&f.unobserve())}else for(var e in this.vars)this.add(d,e)},delete:function(d,e){if(e){var f=this.vars[e];f.all=f.all||new Set,f.all.delete(d),f.all.size||f.unobserve()}else for(var e in this.vars)this.delete(d,e)},update:function(){this.update&&this.update.apply(this,arguments);var d=!0,e=!1,f;try{for(var h,j,g=this.all[Symbol.iterator]();!(d=(h=g.next()).done);d=!0)j=h.value,j.update()}catch(k){e=!0,f=k}finally{try{!d&&g.return&&g.return()}finally{if(e)throw f}}},event:function(d){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},f=e.type,g=e.update,h=e.target,j=h===void 0?document:h;this.vars[d]={observe:function(){this.callback=this.callback||b.special.update.bind(this),j.addEventListener(f,this.callback)},unobserve:function(){j.removeEventListener(f,this.callback)}},g&&(this.vars[d].update=function(k){Mavo.Functions[d]=g(k)})},vars:{$now:{observe:function(){this.timer=setInterval(b.special.update.bind(this),100)},unobserve:function(){clearInterval(this.timer)}}}}}});b.special.event("$mouse",{type:"mousemove",update:function(d){return{x:d.clientX,y:d.clientY}}}),b.special.event("$hash",{type:"hashchange",target:window})})(Bliss);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Expressions=a.Class({constructor:function(e){var f=this;this.mavo=e,this.active=!0,this.expressions=[];var g=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,g),this.scheduled={},this.mavo.treeBuilt.then(function(){f.expressions=[],document.documentElement.addEventListener("mavo:datachange",function(h){if(f.active){var j=f.scheduled[h.action]=f.scheduled[h.action]||new Set;h.node.template?!j.has(h.node.template)&&(setTimeout(function(){j.delete(h.node.template),f.update(h)},c.THROTTLE),j.add(h.node.template)):requestAnimationFrame(function(){return f.update(h)})}}),f.update()})},update:function(e){if(this.active){var f,g;e instanceof Mavo.Node?(g=e,e=null):e instanceof Element?(f=e.closest(Mavo.selectors.item),g=Mavo.Node.get(f),e=null):g=this.mavo.root;var h=g.getData({live:!0});g.walk(function(j,k){if(j.expressions&&j.expressions.length&&!j.isDeleted()){var p,l=a.value.apply(a,[h].concat(_toConsumableArray(k))),m=!0,n=!1;try{for(var r,s,q=j.expressions[Symbol.iterator]();!(m=(r=q.next()).done);m=!0)s=r.value,s.changedBy(e)&&s.update(l,e)}catch(t){n=!0,p=t}finally{try{!m&&q.return&&q.return()}finally{if(n)throw p}}}})}},extract:function(e,f,g){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Mavo.Expression.Syntax.default;f&&"mv-expressions"==f.name||(g=void 0===g?Mavo.elementPath(e.closest(Mavo.selectors.item),e):g&&"string"==typeof g?g.slice(1).split("/").map(function(j){return+j}):[],(f&&-1<c.directives.indexOf(f.name)||h.test(f?f.value:e.textContent))&&this.expressions.push(new Mavo.DOMExpression({node:e,syntax:h,path:g,attribute:f&&f.name,mavo:this.mavo})))},traverse:function(e){var f=this,g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",h=arguments[2];if(8!==e.nodeType)if(3===e.nodeType)this.extract(e,null,g,h);else{if(e.normalize(),h=Mavo.Expression.Syntax.create(e)||h,h===Mavo.Expression.Syntax.ESCAPE)return;Mavo.is("item",e)&&(g=""),b(e.attributes).forEach(function(k){return f.extract(e,k,g,h)});var j=0;b(e.childNodes).forEach(function(k){(1==k.nodeType||3==k.nodeType)&&(f.traverse(k,g+"/"+j,h),j++)})}},static:{directives:[],THROTTLE:50,directive:function(e,f){c.directives.push(e),Mavo.attributes.push(e),Mavo.Plugins.register(e,f)}}})})(Bliss,Bliss.$);
"use strict";(function(a,b){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(d){this._hidden!==d&&(this._hidden=d,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var d=this,e=b(Mavo.selectors.property,this.element).filter(function(f){return f.closest("[mv-if]")==d.element}).map(function(f){return Mavo.Node.get(f)});return this.element.addEventListener("mavo:datachange",function(f){requestAnimationFrame(function(){d.element.parentNode||d.item.element.dispatchEvent(f)})}),e}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){var d=this;if("mv-if"==this.attribute){var e=this.value[0],f=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(d.parentIf){var g=d.parentIf.value[0];d.value[0]=e=e&&g}if(e!==f){if(!1!==g&&(e?Mavo.revocably.add(d.element):d.element.parentNode&&Mavo.revocably.remove(d.element,"mv-if")),d.childProperties){var j,h=!0,i=!1;try{for(var l,m,k=d.childProperties[Symbol.iterator]();!(h=(l=k.next()).done);h=!0)m=l.value,m.hidden=!e}catch(t){i=!0,j=t}finally{try{!h&&k.return&&k.return()}finally{if(i)throw j}}}if(d.childIfs){var p,n=!0,o=!1;try{for(var r,s,q=d.childIfs[Symbol.iterator]();!(n=(r=q.next()).done);n=!0)s=r.value,s.update()}catch(t){o=!0,p=t}finally{try{!n&&q.return&&q.return()}finally{if(o)throw p}}}}})}},"unit-isdatanull":function(d){d.result=d.result||this.hidden&&d.options.live}}})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Mavo.Expressions.directive("mv-value",{hooks:{"node-init-start":function(){if(this instanceof Mavo.Group||this.collection){var b=Mavo.DOMExpression.search(this.element).filter(function(c){return"mv-value"==c.originalAttribute})[0];b&&(b.mavoNode=this,this.expressionText=b,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[].concat(_toConsumableArray(this.collection.expressions||[]),[b]),b.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}},"domexpression-init-start":function(){if("mv-value"==this.attribute){this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),this.expression=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end;var b=Mavo.Expression.prototype.changedBy;this.parsed[0].changedBy=function(c){var d=b.call(this,c);return!d&&c&&"propertychange"==c.action&&(d=Mavo.Functions.intersects(this.identifiers,c.node.path)),d}}},"domexpression-init-treebuilt":function(){var b=this;"mv-value"==this.originalAttribute&&this.mavoNode&&(this.mavoNode==this.item||this.mavoNode==this.item.collection)&&(this.mavoNode==this.item.collection&&Mavo.delete(this.item.expressions,this),this.output=function(c){c=c.value||c,this.mavoNode.render(c)},this.changedBy=function(c){return!(c&&(c.node===b.mavoNode||c.node.collection===b.mavoNode))})}}});
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};function _defineProperty(b,f,g){return f in b?Object.defineProperty(b,f,{value:g,enumerable:!0,configurable:!0,writable:!0}):b[f]=g,b}function _toConsumableArray(b){if(Array.isArray(b)){for(var f=0,g=Array(b.length);f<b.length;f++)g[f]=b[f];return g}return Array.from(b)}(function(b,f){function g(){var r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return r=f(r),r||0===r?r+"":""}function h(r){return r=Mavo.value(r),null===r||!1===r||""===r}function j(r){return!f(r)}function k(r,s){var t=r.toLocaleString(Mavo.locale,s);return t=t.replace(/\u200e/g,""),t}function l(r){return function(s){if(s=o.date(s),!s)return"";var t=q[r](s);return t=new self["year"==r?"String":"Number"](t),("month"==r||"weekday"==r)&&(t.name=k(s,_defineProperty({},r,"long")),t.shortname=k(s,_defineProperty({},r,"short"))),"weekday"!=r&&(t.twodigit=(10>t%100?"0":"")+t%100),t}}var m=Mavo.Functions={operators:{"=":"eq"},get:function(s,t){t=f(t);var u=Mavo.getCanonicalProperty(s,t);if(u!==void 0){var w=s[u];return"function"==typeof w&&0!==w.name.indexOf("bound")?w.bind(s):w}if(Array.isArray(s)&&isNaN(t)){var z,x=!0,y=!1;try{for(var B,C,A=s[Symbol.iterator]();!(x=(B=A.next()).done)&&(C=B.value,!(C&&"object"===("undefined"==typeof C?"undefined":_typeof(C))));x=!0);}catch(E){y=!0,z=E}finally{try{!x&&A.return&&A.return()}finally{if(y)throw z}}if(C){if("id"in C)for(var D=0;D<s.length;D++)if(s[D]&&s[D].id==t)return s[D];return s.map(function(E){return m.get(E,t)})}}return null},url:function(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:location;if(s===void 0)return location.href;if(s){s=g(s).replace(/[^\w-:]/g);var u=t.search.match(RegExp("[?&]"+s+"(?:=(.+?))?(?=$|&)"))||t.pathname.match(RegExp("(?:^|\\/)"+s+"\\/([^\\/]*)"))}return null!==u&&s?u[1]||"":null},first:function(s){return s&&s[0]||""},last:function(s){return s&&s[s.length-1]||""},unique:function(s){return Array.isArray(s)?[].concat(_toConsumableArray(new Set(s.map(f)))):s},intersects:function(s,t){if(s&&t){var u=new Set(t.map?t.map(f):t);return s=s.map?s.map(f):[].concat(_toConsumableArray(s)),!s.every(function(w){return!u.has(w)})}},sum:function(s){return o.numbers(s,arguments).reduce(function(t,u){return+t+(+u||0)},0)},average:function(s){return s=o.numbers(s,arguments),s.length&&m.sum(s)/s.length},min:function(s){return Math.min.apply(Math,_toConsumableArray(o.numbers(s,arguments)))},max:function(s){return Math.max.apply(Math,_toConsumableArray(o.numbers(s,arguments)))},count:function(s){return Mavo.toArray(s).filter(function(t){return!h(t)}).length},round:function(s,t){return j(s)||j(t)||!isFinite(s)?Math.round(s):+s.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t})},th:function(s){if(h(s))return"";if(10>t||20<t)var t=["th","st","nd","th"][s%10];return t=t||"th",s+t},iff:function(s){var t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:s,u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"";return Array.isArray(s)?s.map(function(w,x){var y=f(w)?t:u;return Array.isArray(y)?y[Math.min(x,y.length-1)]:y}):f(s)?t:u},replace:function(s,t){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:"",w=3<arguments.length&&arguments[3]!==void 0?arguments[3]:1;if(Array.isArray(s))return s.map(function(B){return m.replace(B,t,u)});for(var z,x=RegExp(Mavo.escapeRegExp(t),"g"),y=s,A=0;y!=z&&A++<w;)z=y,y=y.replace(x,u);return y},len:function(s){return g(s).length},search:function(s,t){return s&&t?g(s).toLowerCase().indexOf((t+"").toLowerCase()):-1},starts:function(s,t){return 0===m.search(g(s),g(t))},ends:function(s,t){var u=[g(s),g(t)];s=u[0],t=u[1];var w=m.search(s,t);return-1<w&&w===s.length-t.length},join:function(s,t){return Mavo.toArray(s).join(g(t))},idify:function(s){return g(s).replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()},readable:function(s){return g(s).replace(/([a-z])([A-Z])(?=[a-z])/g,function(t,u,w){return u+" "+w.toLowerCase()}).replace(/([a-z0-9])[_\/-](?=[a-z0-9])/g,"$1 ").replace(/^[a-z]/,function(t){return t.toUpperCase()})},uppercase:function(s){return g(s).toUpperCase()},lowercase:function(s){return g(s).toLowerCase()},from:function(s,t){return m.between(s,t)},from_last:function(s,t){return m.between(s,t,"",!0)},to:function(s,t){return m.between(s,"",t)},tofirst:function(s,t){return m.between(s,"",t,!0)},between:function(s,t,u,w){var x=[g(s),g(t),g(u)];s=x[0],t=x[1],u=x[2];var y=t?s[w?"lastIndexOf":"indexOf"](t):-1,z=s[w?"indexOf":"lastIndexOf"](u);return s.slice(y+1,-1!==z&&u?z:s.length)},filename:function(s){return Mavo.match(new URL(g(s),Mavo.base).pathname,/[^/]+?$/)},json:function(s){return Mavo.safeToJSON(s)},get $now(){return new Date},get $today(){return m.date(new Date)},year:l("year"),month:l("month"),day:l("day"),weekday:l("weekday"),hour:l("hour"),minute:l("minute"),second:l("second"),ms:l("ms"),date:function(s){return m.year(s)+"-"+m.month(s).twodigit+"-"+m.day(s).twodigit},time:function(s){return m.hour(s).twodigit+":"+m.minute(s).twodigit+":"+m.second(s).twodigit},minutes:function(s){return Math.floor(Math.abs(s)/60)},hours:function(s){return Math.floor(Math.abs(s)/3600)},days:function(s){return Math.floor(Math.abs(s)/86400)},weeks:function(s){return Math.floor(Math.abs(s)/604800)},months:function(s){return Math.floor(Math.abs(s)/(86400*30.4368))},years:function(s){return Math.floor(Math.abs(s)/(12*(86400*30.4368)))},localTimezone:-new Date().getTimezoneOffset(),log:function(){var s;return(s=console).log.apply(s,arguments),0>=arguments.length?void 0:arguments[0]},$mouse:{x:0,y:0},get $hash(){return location.hash.slice(1)},util:{numbers:function(s,t){return s=Array.isArray(s)?s:t?$$(t):[s],s.filter(function(u){return!isNaN(u)&&""!==f(u)}).map(function(u){return+u})},date:function(s){if(s=f(s),!s)return null;if("string"===b.type(s)){s=s.trim(),/^\d{4}-\d{2}-\d{2}/.test(s)||(s=m.$today+" "+s),-1===s.indexOf(":")?s+="T00:00:00":s=s.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"),s=s.replace(/\s+/g,"");var t=Mavo.match(s,/[+-]\d{2}:?\d{2}|Z$/);if(t)s=new Date(s);else{var u=s.match(/\d+/g);s=new Date(u[0],(u[1]||1)-1,u[2]||1,u[3]||0,u[4]||0,u[5]||0,u[6]||0)}}else s=new Date(s);return isNaN(s)?null:s}}},o=m.util;b.lazy(m,"$url",function(){var w,r={},s=new URL(location),t=!0,u=!1;try{for(var y,z,x=s.searchParams[Symbol.iterator]();!(t=(y=x.next()).done);t=!0)z=y.value,r[z[0]]=z[1]}catch(A){u=!0,w=A}finally{try{!t&&x.return&&x.return()}finally{if(u)throw w}}return Object.defineProperties(r,{path:{value:s.pathname.split("/").filter(function(A){return!!A})},toString:{value:function(){return new URL(location)}}}),r}),m._Trap=self.Proxy?new Proxy(m,{get:function(s,t){var u,w=Mavo.getCanonicalProperty(s,t)||Mavo.getCanonicalProperty(Math,t);return w&&(u=s[w],void 0==u&&(u=Math[w])),void 0==u?t in self?self[t]:t:("function"==typeof u&&(u.toString=function(){return t}),u)},has:function(s,t){return"data"!=t}}):m;var p=new Intl.NumberFormat("en",{minimumIntegerDigits:"2"});p=p.format.bind(p);var q={year:function(s){return s.getFullYear()},month:function(s){return s.getMonth()+1},day:function(s){return s.getDate()},weekday:function(s){return s.getDay()||7},hour:function(s){return s.getHours()},minute:function(s){return s.getMinutes()},second:function(s){return s.getSeconds()},ms:function(s){return s.getMilliseconds()}}})(Bliss,Mavo.value);
"use strict";var _slicedToArray=function(){function c(d,f){var g=[],h=!0,j=!1,k;try{for(var m,l=d[Symbol.iterator]();!(h=(m=l.next()).done)&&(g.push(m.value),!(f&&g.length===f));h=!0);}catch(q){j=!0,k=q}finally{try{!h&&l["return"]&&l["return"]()}finally{if(j)throw k}}return g}return function(d,f){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return c(d,f);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(c){if(Array.isArray(c)){for(var d=0,f=Array(c.length);d<c.length;d++)f[d]=c[d];return f}return Array.from(c)}(function(c,d,f){var g=Mavo.Script={addUnaryOperator:function(s,t){if(t.symbol){var w,u=!0,v=!1;try{for(var y,z,x=Mavo.toArray(t.symbol)[Symbol.iterator]();!(u=(y=x.next()).done);u=!0)z=y.value,Mavo.Script.unarySymbols[z]=s,jsep.addUnaryOp(z)}catch(A){v=!0,w=A}finally{try{!u&&x.return&&x.return()}finally{if(v)throw w}}}return Mavo.Functions[s]=function(A){return Array.isArray(A)?A.map(d).map(t.scalar):t.scalar(d(A))}},addBinaryOperator:function(s,t){if(t.symbol){var w,u=!0,v=!1;try{for(var y,z,x=Mavo.toArray(t.symbol)[Symbol.iterator]();!(u=(y=x.next()).done);u=!0)z=y.value,Mavo.Script.symbols[z]=s,t.precedence&&jsep.addBinaryOp(z,t.precedence)}catch(A){v=!0,w=A}finally{try{!u&&x.return&&x.return()}finally{if(v)throw w}}}return t.identity=void 0===t.identity?0:t.identity,Mavo.Functions[s]=t.code||function(){for(var A=arguments.length,B=Array(A),C=0;C<A;C++)B[C]=arguments[C];1===B.length&&Array.isArray(B[0])&&(B=[].concat(_toConsumableArray(B[0]))),t.raw||(B=B.map(d));for(var E,D=t.logical?t.identity:B[0],F=function(I){var J=t.logical?B[I-1]:D,K=B[I];Array.isArray(K)?("number"==typeof t.identity&&(K=f.numbers(K)),E=Array.isArray(J)?[].concat(_toConsumableArray(K.map(function(L,M){return t.scalar(void 0===J[M]?t.identity:J[M],L)})),_toConsumableArray(J.slice(K.length))):K.map(function(L){return t.scalar(J,L)})):Array.isArray(J)?E=J.map(function(L){return t.scalar(L,K)}):E=t.scalar(J,K),D=t.reduce?t.reduce(D,E,J,K):t.logical?D&&E:E},G=1;G<B.length;G++)F(G);return D}},symbols:{},unarySymbols:{},getOperatorName:function(s,t){return Mavo.Script[t?"unarySymbols":"symbols"][s]||s},operators:{not:{symbol:"!",scalar:function(s){return!s}},multiply:{scalar:function(s,t){return s*t},identity:1,symbol:"*"},divide:{scalar:function(s,t){return s/t},identity:1,symbol:"/"},add:{scalar:function(s,t){return+s+ +t},symbol:"+"},plus:{scalar:function(s){return+s},symbol:"+"},subtract:{scalar:function(s,t){if(isNaN(s)||isNaN(t)){var u=f.date(s),v=f.date(t);if(u&&v)return(u-v)/1e3}return s-t},symbol:"-"},minus:{scalar:function(s){return-s},symbol:"-"},mod:{scalar:function(s,t){var u=s%t;return u+=0>u?t:0,u},symbol:"mod",precedence:6},lte:{logical:!0,scalar:function(s,t){var u=Mavo.Script.getNumericalOperands(s,t),v=_slicedToArray(u,2);return s=v[0],t=v[1],s<=t},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(s,t){var u=Mavo.Script.getNumericalOperands(s,t),v=_slicedToArray(u,2);return s=v[0],t=v[1],s<t},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(s,t){var u=Mavo.Script.getNumericalOperands(s,t),v=_slicedToArray(u,2);return s=v[0],t=v[1],s>=t},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(s,t){var u=Mavo.Script.getNumericalOperands(s,t),v=_slicedToArray(u,2);return s=v[0],t=v[1],s>t},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(s,t){return s==t},symbol:["=","=="],identity:!0,precedence:6},neq:{logical:!0,scalar:function(s,t){return s!=t},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(s,t){return!!s&&!!t},identity:!0,symbol:["&&","and"],precedence:2},or:{logical:!0,scalar:function(s,t){return s||t},reduce:function(s,t){return s||t},identity:!1,symbol:["||","or"],precedence:2},concatenate:{symbol:"&",identity:"",scalar:function(s,t){return""+(s||"")+(t||"")},precedence:10},filter:{scalar:function(s,t){return d(t)?s:null},raw:!0}},getNumericalOperands:function(s,t){if(isNaN(s)||isNaN(t)){var u=f.date(s),v=f.date(t);if(u&&v)return[u,v]}return[s,t]},serializers:{BinaryExpression:function(s){return g.serialize(s.left)+" "+s.operator+" "+g.serialize(s.right)},UnaryExpression:function(s){return""+s.operator+g.serialize(s.argument)},CallExpression:function(s){return g.serialize(s.callee)+"("+s.arguments.map(g.serialize).join(", ")+")"},ConditionalExpression:function(s){return g.serialize(s.test)+"? "+g.serialize(s.consequent)+" : "+g.serialize(s.alternate)},MemberExpression:function(s){var t=s.computed?g.serialize(s.property):"\""+s.property.name+"\"";return"get("+g.serialize(s.object)+", "+t+")"},ArrayExpression:function(s){return"["+s.elements.map(g.serialize).join(", ")+"]"},Literal:function(s){return s.raw},Identifier:function(s){return s.name},ThisExpression:function(){return"this"},Compound:function(s){return s.body.map(g.serialize).join(" ")}},transformations:{BinaryExpression:function(s){var t=Mavo.Script.getOperatorName(s.operator),u=s,v=[];do v.unshift(u.right),u=u.left;while(Mavo.Script.getOperatorName(u.operator)===t);if(v.unshift(u),1<v.length)return t+"("+v.map(g.serialize).join(", ")+")"},UnaryExpression:function(s){var t=Mavo.Script.getOperatorName(s.operator,!0);if(t)return t+"("+g.serialize(s.argument)+")"},CallExpression:function(s){"Identifier"==s.callee.type&&("if"==s.callee.name&&(s.callee.name="iff"),s.callee.name="Mavo.Functions._Trap."+s.callee.name)}},serialize:function(s){var t=g.transformations[s.type]&&g.transformations[s.type](s);return void 0===t?g.serializers[s.type](s):t},rewrite:function(s){try{return g.serialize(g.parse(s))}catch(t){return s}},compile:function(s){return s=g.rewrite(s),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\twith (data || {}) {\n\t\t\t\t\treturn "+s+";\n\t\t\t\t}")},parse:self.jsep};for(var h in g.serializers.LogicalExpression=g.serializers.BinaryExpression,g.transformations.LogicalExpression=g.transformations.BinaryExpression,Mavo.Script.operators){var j=Mavo.Script.operators[h];2>j.scalar.length?Mavo.Script.addUnaryOperator(h,j):Mavo.Script.addBinaryOperator(h,j)}var k={average:"avg",iff:"iff IF",multiply:"mult product",divide:"div",lt:"smaller",gt:"larger bigger",eq:"equal equality",th:"ordinal"},l=function(s){k[s].split(/\s+/g).forEach(function(t){return Mavo.Functions[t]=Mavo.Functions[s]})};for(var m in k)l(m)})(Bliss,Mavo.value,Mavo.Functions.util);
"use strict";(function(a){var b=Mavo.Backend.register(a.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-dropbox-key")||"2mx6061p054bpbp",this.url=b.fixShareURL(this.url),this.login(!0)},upload:function(d,e){var f=this;return e=this.path.replace(/[^/]+$/,"")+e,this.put(d,e).then(function(){return f.getURL(e)})},getURL:function(d){return this.request("sharing/create_shared_link_with_settings",{path:d},"POST").then(function(e){return b.fixShareURL(e.url)})},put:function(d){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path,f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return this.request("https://content.dropboxapi.com/2/files/upload",d,"POST",{headers:{"Dropbox-API-Arg":JSON.stringify({path:e,mode:"overwrite"}),"Content-Type":"application/octet-stream"}})},oAuthParams:function(){return"&redirect_uri="+encodeURIComponent("https://auth.mavo.io")+"&response_type=code"},getUser:function(){var d=this;return this.user?Promise.resolve(this.user):this.request("users/get_current_account","null","POST").then(function(e){d.user={username:e.email,name:e.name.display_name,avatar:e.profile_photo_url,info:e}})},login:function(d){var e=this;return this.oAuthenticate(d).then(function(){return e.getUser()}).then(function(){e.user&&(e.permissions.logout=!0,e.request("sharing/get_shared_link_metadata",{url:e.source},"POST").then(function(g){e.path=g.path_lower,e.permissions.on(["edit","save"])}))})},logout:function(){return this.oAuthLogout()},static:{apiDomain:"https://api.dropboxapi.com/2/",oAuth:"https://www.dropbox.com/oauth2/authorize",test:function(d){return d=new URL(d,Mavo.base),/dropbox.com/.test(d.host)},fixShareURL:function(d){return d=new URL(d,Mavo.base),d.hostname="dl.dropboxusercontent.com",d.search=d.search.replace(/\bdl=0|^$/,"raw=1"),d}}}))})(Bliss);
"use strict";(function(a){var b=Mavo.Backend.register(a.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var d=b.parseURL(this.url);if(d.username){if(a.extend(this,d),this.repo=this.repo||"mv-data",this.path=this.path||"",!/\.\w+$/.test(this.path)){var e=this.format.constructor.extensions[0]||".json";this.path+="/"+this.mavo.id+e}this.path=this.path.replace(/\/\/|^\/|\/$/g,""),this.apiCall="repos/"+this.username+"/"+this.repo+"/contents/"+this.path}else this.apiCall=this.url.pathname.slice(1);this.login(!0)},get:function(){var d=this;if(this.isAuthenticated()||!this.path)return this.request(this.apiCall).then(function(f){return Promise.resolve(d.repo?b.atob(f.content):f)});var e=new URL("https://raw.githubusercontent.com/"+this.username+"/"+this.repo+"/"+(this.branch||"master")+"/"+this.path);return this.super.get.call(this,e)},upload:function(d){var e=this,f=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path;return Mavo.readFile(d).then(function(g){var h=g.slice(5),i=h.match(/^\w+\/[\w+]+/)[0];return h=h.replace(RegExp("^"+i+"(;base64)?,"),""),f=e.path.replace(/[^/]+$/,"")+f,e.put(h,f,{isEncoded:!0})}).then(function(g){return e.getURL(f,g.commit.sha)})},put:function(d){var e=this,f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.path,g=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(f){var h="repos/"+this.username+"/"+this.repo,i=h+"/contents/"+f,j=this.mavo.element.getAttribute("mv-github-commit-prefix")||"",k=this.repoInfo||this.request("user/repos",{name:this.repo},"POST").then(function(l){return e.repoInfo=l});return d=g.isEncoded?d:b.btoa(d),Promise.resolve(k).then(function(l){return e.canPush()?l:e.request(h+"/forks",{name:e.repo},"POST").then(function(m){return i="repos/"+m.full_name+"/contents/"+f,e.forkInfo=m}).then(function(m){var n;return new Promise(function q(r){clearTimeout(n),e.request("repos/"+m.full_name+"/commits",{until:"1970-01-01T00:00:00Z"},"HEAD").then(function(){r(m)}).catch(function(){n=setTimeout(q,1e3)})})})}).then(function(){return e.request(i,{ref:e.branch}).then(function(m){return e.request(i,{message:j+e.mavo._("gh-updated-file",{name:m.name||"file"}),content:d,branch:e.branch,sha:m.sha},"PUT")},function(m){return 404==m.status?e.request(i,{message:j+"Created file",content:d,branch:e.branch},"PUT"):m})}).then(function(l){return e.forkInfo&&e.request("repos/"+e.username+"/"+e.repo+"/pulls",{head:e.user.username+":"+e.branch,base:e.branch}).then(function(m){e.pullRequest(m[0])}),l})}},pullRequest:function(d){var e=this,f=new URL(location);f.searchParams.set(this.mavo.id+"-storage","https://github.com/"+this.forkInfo.full_name+"/"+this.path);var g=this.mavo._("gh-edit-suggestion-saved-in-profile",{previewURL:f});this.notice&&this.notice.close(),d?(this.notice=this.mavo.message(g+"\n\t\t\t\t"+this.mavo._("gh-edit-suggestion-notreviewed")+"\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<button class=\"mv-danger\">"+this.mavo._("gh-edit-suggestion-revoke")+"</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(h){h&&e.request("repos/"+e.username+"/"+e.repo+"/pulls/"+d.number,{state:"closed"},"POST").then(function(i){new Mavo.UI.Message(e.mavo,"<a href=\""+i.html_url+"\">"+e.mavo._("gh-edit-suggestion-cancelled")+"</a>",{dismiss:["button","timeout"]}),e.pullRequest()})})):(this.notice=this.mavo.message(g+"\n\t\t\t\t"+this.mavo._("gh-edit-suggestion-instructions")+"\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<textarea name=\"edits\" class=\"mv-autosize\" placeholder=\""+this.mavo._("gh-edit-suggestion-reason-placeholder")+"\"></textarea>\n\t\t\t\t\t<button>"+this.mavo._("gh-edit-suggestion-send")+"</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(h){h&&e.request("repos/"+e.username+"/"+e.repo+"/pulls",{title:e.mavo._("gh-edit-suggestion-title"),body:e.mavo._("gh-edit-suggestion-body",{description:h.elements.edits.value,previewURL:f}),head:e.user.username+":"+e.branch,base:e.branch},"POST").then(function(i){new Mavo.UI.Message(e.mavo,"<a href=\""+i.html_url+"\">"+e.mavo._("gh-edit-suggestion-sent")+"</a>",{dismiss:["button","timeout"]}),e.pullRequest(i)})}))},login:function(d){var e=this;return this.oAuthenticate(d).then(function(){return e.getUser()}).catch(function(f){401==f.status&&e.logout()}).then(function(){if(e.user&&(e.permissions.on(["edit","save","logout"]),e.repo))return e.request("repos/"+e.username+"/"+e.repo).then(function(g){return void 0===e.branch&&(e.branch=g.default_branch),e.repoInfo=g})})},canPush:function(){return this.repoInfo?this.repoInfo.permissions.push:this.user&&this.user.username.toLowerCase()==this.username.toLowerCase()},oAuthParams:function(){return"&scope=repo,gist"},logout:function(){var d=this;return this.oAuthLogout().then(function(){d.user=null})},getUser:function(){var d=this;return this.user?Promise.resolve(this.user):this.request("user").then(function(e){d.user={username:e.login,name:e.name||e.login,avatar:e.avatar_url,url:"https://github.com/"+e.login,info:e},a.fire(d.mavo.element,"mavo:login",{backend:d})})},getURL:function(){var d=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.path,f=arguments[1],g=this.forkInfo||this.repoInfo,h=g.full_name;return e=e.replace(/ /g,"%20"),g.pagesInfo=g.pagesInfo||this.request("repos/"+h+"/pages",{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}),g.pagesInfo.then(function(i){return i.html_url+e}).catch(function(){return f?"https://cdn.rawgit.com/"+h+"/"+f+"/"+e:"https://rawgit.com/"+h+"/"+d.branch+"/"+e})},static:{apiDomain:"https://api.github.com/",oAuth:"https://github.com/login/oauth/authorize",test:function(d){return d=new URL(d,Mavo.base),/\bgithub.com|raw.githubusercontent.com/.test(d.host)},parseURL:function(d){var e={};d=new URL(d,Mavo.base);var f=d.pathname.slice(1).split("/");if(e.username=f.shift(),e.repo=f.shift(),/raw.githubusercontent.com$/.test(d.host))e.branch=f.shift();else{if(/api.github.com$/.test(d.host))return{};"blob"==f[0]&&(f.shift(),e.branch=f.shift())}return e.path=f.join("/"),e},btoa:function(c){function d(){return c.apply(this,arguments)}return d.toString=function(){return c.toString()},d}(function(c){return btoa(unescape(encodeURIComponent(c)))}),atob:function(d){return decodeURIComponent(escape(window.atob(d)))}}}))})(Bliss);
//# sourceMappingURL=maps/mavo.es5.min.js.map
