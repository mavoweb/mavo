!function(){"use strict";function t(e,n,s){return n=void 0===n?1:n,s=s||n+1,1>=s-n?function(){if(arguments.length<=n||"string"===r.type(arguments[n]))return e.apply(this,arguments);var t,s=arguments[n];for(var i in s){var o=Array.from(arguments);o.splice(n,1,i,s[i]),t=e.apply(this,o)}return t}:t(t(e,n+1,s),n,s-1)}function e(t,r,s){var i=n(s);if("string"===i){var o=Object.getOwnPropertyDescriptor(r,s);!o||o.writable&&o.configurable&&o.enumerable&&!o.get&&!o.set?t[s]=r[s]:(delete t[s],Object.defineProperty(t,s,o))}else if("array"===i)s.forEach(function(n){n in r&&e(t,r,n)});else for(var a in r)s&&("regexp"===i&&!s.test(a)||"function"===i&&!s.call(r,a))||e(t,r,a);return t}function n(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var r=self.Bliss=e(function(t,e){return 2!=arguments.length||e?"string"===r.type(t)?(e||document).querySelector(t):t||null:null},self.Bliss);e(r,{extend:e,overload:t,type:n,property:r.property||"_",sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.from("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?r.set(t,e):(1===arguments.length&&("string"===r.type(t)?e={}:(e=t,t=e.tag,e=r.extend({},e,function(t){return"tag"!==t}))),r.set(document.createElement(t||"div"),e))},each:function(t,e,n){n=n||{};for(var r in t)n[r]=e.call(t,r,t[r]);return n},ready:function(t){return t=t||document,new Promise(function(e,n){"loading"!==t.readyState?e():t.addEventListener("DOMContentLoaded",function(){e()})})},Class:function(t){var e=["constructor","extends","abstract","static"].concat(Object.keys(r.classProps)),n=t.hasOwnProperty("constructor")?t.constructor:r.noop,s=function(){if(this.constructor.__abstract&&this.constructor===s)throw new Error("Abstract classes cannot be directly instantiated.");s["super"]&&s["super"].apply(this,arguments),n.apply(this,arguments)};s["super"]=t["extends"]||null,s.prototype=r.extend(Object.create(s["super"]?s["super"].prototype:Object),{constructor:s});var i=function(t){return this.hasOwnProperty(t)&&-1===e.indexOf(t)};if(t["static"]){r.extend(s,t["static"],i);for(var o in r.classProps)o in t["static"]&&r.classProps[o](s,t["static"][o])}r.extend(s.prototype,t,i);for(var o in r.classProps)o in t&&r.classProps[o](s.prototype,t[o]);return s.prototype["super"]=s["super"]?s["super"].prototype:null,s.__abstract=!!t["abstract"],s},classProps:{lazy:t(function(t,e,n){return Object.defineProperty(t,e,{get:function(){var t=n.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return"function"===r.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],r=n.get&&n.get.call(this,t);return void 0!==r?r:t},set:function(t){var r=this["_"+e],s=n.set&&n.set.call(this,t,r);this["_"+e]=void 0!==s?s:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length?arguments[0]:!1,n=document.createElement("script");return e?Promise.resolve():new Promise(function(e,s){r.set(n,{async:!0,onload:function(){e(),r.remove(n)},onerror:function(){s()},src:t,inside:document.head})})},fetch:function(t,n){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var s=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);s.method=s.method.toUpperCase(),r.hooks.run("fetch-args",s),"GET"===s.method&&s.data&&(s.url.search+=s.data),document.body.setAttribute("data-loading",s.url),s.xhr.open(s.method,s.url.href,s.async!==!1,s.user,s.password);for(var i in n)if(i in s.xhr)try{s.xhr[i]=n[i]}catch(o){self.console&&console.error(o)}"GET"===s.method||s.headers["Content-type"]||s.headers["Content-Type"]||s.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var a in s.headers)s.xhr.setRequestHeader(a,s.headers[a]);return new Promise(function(t,e){s.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===s.xhr.status||s.xhr.status>=200&&s.xhr.status<300||304===s.xhr.status?t(s.xhr):e(r.extend(Error(s.xhr.statusText),{xhr:s.xhr,get status(){return this.xhr.status}}))},s.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Error"),{xhr:s.xhr}))},s.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Timeout"),{xhr:s.xhr}))},s.xhr.send("GET"===s.method?null:s.data)})},value:function(t){var e="string"!==r.type(t);return r.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),r.Hooks=new r.Class({add:function(t,e,n){(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],this[t][n?"unshift":"push"](e)},this)},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),r.hooks=new r.Hooks;var s=r.property;r.Element=function(t){this.subject=t,this.data={},this.bliss={}},r.Element.prototype={set:t(function(t,e){t in r.setProps?r.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(n,s){if("transition"in this.style){var i=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),r.once(this,"transitionend",function(){clearTimeout(o),r.style(this,i),n(this)});var o=setTimeout(n,e+50,this);r.style(this,t)}else r.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),this.dispatchEvent(r.extend(n,e))},unbind:t(function(t,e){(t||"").split(/\s+/).forEach(function(t){if(s in this&&(t.indexOf(".")>-1||!e)){t=(t||"").split(".");var n=t[1];t=t[0];var r=this[s].bliss.listeners=this[s].bliss.listeners||{};for(var i in r)if(!t||i===t)for(var o,a=0;o=r[i][a];a++)n&&n!==o.className||e&&e!==o.callback||(this.removeEventListener(i,o.callback,o.capture),a--)}else this.removeEventListener(t,e)},this)},0)},r.setProps={style:function(t){r.extend(this.style,t)},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){r.extend(this,t)},events:function(t){if(t&&t.addEventListener){var e=this;if(t[s]&&t[s].bliss){var n=t[s].bliss.listeners;for(var i in n)n[i].forEach(function(t){e.addEventListener(i,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])}else if(arguments.length>1&&"string"===r.type(t)){var a=arguments[1],u=arguments[2];t.split(/\s+/).forEach(function(t){this.addEventListener(t,a,u)},this)}else for(var c in t)r.events(this,c,t[c])},once:t(function(t,e){t=t.split(/\s+/);var n=this,r=function(){return t.forEach(function(t){n.removeEventListener(t,r)}),e.apply(n,arguments)};t.forEach(function(t){n.addEventListener(t,r)})},0),delegate:t(function(t,e,n){this.addEventListener(t,function(t){t.target.closest(e)&&n.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=r.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=r.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t.appendChild(this)},before:function(t){t.parentNode.insertBefore(this,t)},after:function(t){t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t.insertBefore(this,t.firstChild)},around:function(t){t.parentNode&&r.before(this,t),(/^template$/i.test(this.nodeName)?this.content||this:this).appendChild(t)}},r.Array=function(t){this.subject=t},r.Array.prototype={all:function(t){var e=$$(arguments).slice(1);return this[t].apply(this,e)}},r.add=t(function(t,e,n,s){n=r.extend({$:!0,element:!0,array:!0},n),"function"==r.type(e)&&(!n.element||t in r.Element.prototype&&s||(r.Element.prototype[t]=function(){return this.subject&&r.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in r.Array.prototype&&s||(r.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&r.defined(e.apply(n,t),n)})}),n.$&&(r.sources[t]=r[t]=e,(n.array||n.element)&&(r[t]=function(){var e=[].slice.apply(arguments),s=e.shift(),i=n.array&&Array.isArray(s)?"Array":"Element";return r[i].prototype[t].apply({subject:s},e)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement("_");r.add(r.extend({},HTMLElement.prototype,function(t){return"function"===r.type(i[t])}),null,!0)}(),function(t){"use strict";if(Bliss&&!Bliss.shy){var e=Bliss.property;if(t.add({clone:function(){var e=this.cloneNode(!0),n=t.$("*",e).concat(e);return t.$("*",this).concat(this).forEach(function(e,r,s){t.events(n[r],e),n[r]._.data=t.extend({},e._.data)}),e}},{array:!1}),Object.defineProperty(Node.prototype,e,{get:function o(){return Object.defineProperty(Node.prototype,e,{get:void 0}),Object.defineProperty(this,e,{value:new t.Element(this)}),Object.defineProperty(Node.prototype,e,{get:o}),this[e]},configurable:!0}),Object.defineProperty(Array.prototype,e,{get:function(){return Object.defineProperty(this,e,{value:new t.Array(this)}),this[e]},configurable:!0}),self.EventTarget&&"addEventListener"in EventTarget.prototype){var n=EventTarget.prototype.addEventListener,r=EventTarget.prototype.removeEventListener,s=function(t,e,n){return n.callback===t&&n.capture==e},i=function(){return!s.apply(this,arguments)};EventTarget.prototype.addEventListener=function(t,r,i){if(this&&this[e]&&this[e].bliss&&r){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};if(t.indexOf(".")>-1){t=t.split(".");var a=t[1];t=t[0]}o[t]=o[t]||[],0===o[t].filter(s.bind(null,r,i)).length&&o[t].push({callback:r,capture:i,className:a})}return n.call(this,t,r,i)},EventTarget.prototype.removeEventListener=function(t,n,s){if(this&&this[e]&&this[e].bliss&&n){var o=this[e].bliss.listeners=this[e].bliss.listeners||{};o[t]&&(o[t]=o[t].filter(i.bind(null,n,s)))}return r.call(this,t,n,s)}}self.$=self.$||t,self.$$=self.$$||t.$}}(Bliss);
/*
 * Stretchy: Form element autosizing, the way it should be.
 * by Lea Verou http://lea.verou.me
 * MIT license
 */
(function() {

if (!self.Element) {
	return; // super old browser
}

if (!Element.prototype.matches) {
	Element.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;
}

if (!Element.prototype.matches) {
	return;
}

function $$(expr, con) {
	return expr instanceof Node || expr instanceof Window? [expr] :
	       [].slice.call(typeof expr == "string"? (con || document).querySelectorAll(expr) : expr || []);
}

var _ = self.Stretchy = {
	selectors: {
		base: 'textarea, select:not([size]), input:not([type]), input[type="' + "text url email tel".split(" ").join('"], input[type="') + '"]',
		filter: "*"
	},

	// Script element this was included with, if any
	script: document.currentScript || $$("script").pop(),

	// Autosize one element. The core of Stretchy.
	resize: function(element) {
		if (!_.resizes(element)) {
			return;
		}

		var cs = getComputedStyle(element);
		var offset = 0;

		if (!element.value && element.placeholder) {
			var empty = true;
			element.value = element.placeholder;
		}

		var type = element.nodeName.toLowerCase();

		if (type == "textarea") {
			element.style.height = "0";

			if (cs.boxSizing == "border-box") {
				offset = element.offsetHeight;
			}
			else if (cs.boxSizing == "content-box") {
				offset = -element.clientHeight;
			}

			element.style.height = element.scrollHeight + offset + "px";
		}
		else if(type == "input") {
			element.style.width = "0";

			if (cs.boxSizing == "border-box") {
				offset = element.offsetWidth;
			}
			else if (cs.boxSizing == "padding-box") {
				offset = element.clientWidth;
			}

			// Safari misreports scrollWidth, so we will instead set scrollLeft to a
			// huge number, and read that back to see what it was clipped to
			element.scrollLeft = 1e+10;

			var width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);

			element.style.width = width + "px";
		}
		else if (type == "select") {
			var selectedIndex = element.selectedIndex > 0? element.selectedIndex : 0;

			// Need to use dummy element to measure :(
			var option = document.createElement("_");
			option.textContent = element.options[selectedIndex].textContent;
			element.parentNode.insertBefore(option, element.nextSibling);

			// The name of the appearance property, as it might be prefixed
			var appearance;

			for (var property in cs) {
				var value = cs[property];
				if (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == "string") {
					//console.log(property, option.offsetWidth, cs[property]);
					option.style[property] = value;

					if (/appearance$/i.test(property)) {
						appearance = property;
					}
				}
			}

			option.style.width = "";

			if (option.offsetWidth > 0) {
				element.style.width = option.offsetWidth + "px";

				if (!cs[appearance] || cs[appearance] !== "none") {
					// Account for arrow
					element.style.width = "calc(" + element.style.width + " + 2em)";
				}
			}

			option.parentNode.removeChild(option);
			option = null;
		}

		if (empty) {
			element.value = "";
		}
	},

	// Autosize multiple elements
	resizeAll: function(elements) {
		$$(elements || _.selectors.base).forEach(function (element) {
			_.resize(element);
		});
	},

	active: true,

	// Will stretchy do anything for this element?
	resizes: function(element) {
		return element &&
		       element.parentNode &&
		       element.matches &&
		       element.matches(_.selectors.base) &&
		       element.matches(_.selectors.filter);
	},

	init: function(){
		_.selectors.filter = _.script.getAttribute("data-filter") ||
		                     ($$("[data-stretchy-filter]").pop() || document.body).getAttribute("data-stretchy-filter") || Stretchy.selectors.filter || "*";

		_.resizeAll();
	},

	$$: $$
};

// Autosize all elements once the DOM is loaded

// DOM already loaded?
if (document.readyState !== "loading") {
	_.init();
}
else {
	// Wait for it
	document.addEventListener("DOMContentLoaded", _.init);
}

// Listen for changes
var listener = function(evt) {
	if (_.active) {
		_.resize(evt.target);
	}
};

document.documentElement.addEventListener("input", listener);

// Firefox fires a change event instead of an input event
document.documentElement.addEventListener("change", listener);

// Listen for new elements
if (self.MutationObserver) {
	(new MutationObserver(function(mutations) {
		if (_.active) {
			mutations.forEach(function(mutation) {
				if (mutation.type == "childList") {
					Stretchy.resizeAll(mutation.addedNodes);
				}
			});
		}
	})).observe(document.documentElement, {
		childList: true,
		subtree: true
	});
}

})();

/* jsep v0.3.1 (http://jsep.from.so/) */
!function(a){"use strict";var b="Compound",c="Identifier",d="MemberExpression",e="Literal",f="ThisExpression",g="CallExpression",h="UnaryExpression",i="BinaryExpression",j="LogicalExpression",k="ConditionalExpression",l="ArrayExpression",m=46,n=44,o=39,p=34,q=40,r=41,s=91,t=93,u=63,v=59,w=58,x=function(a,b){var c=new Error(a+" at character "+b);throw c.index=b,c.description=a,c},y=!0,z={"-":y,"!":y,"~":y,"+":y},A={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},B=function(a){var b,c=0;for(var d in a)(b=d.length)>c&&a.hasOwnProperty(d)&&(c=b);return c},C=B(z),D=B(A),E={"true":!0,"false":!1,"null":null},F="this",G=function(a){return A[a]||0},H=function(a,b,c){var d="||"===a||"&&"===a?j:i;return{type:d,operator:a,left:b,right:c}},I=function(a){return a>=48&&a<=57},J=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=128&&!A[String.fromCharCode(a)]},K=function(a){return 36===a||95===a||a>=65&&a<=90||a>=97&&a<=122||a>=48&&a<=57||a>=128&&!A[String.fromCharCode(a)]},L=function(a){for(var i,j,y=0,B=a.charAt,L=a.charCodeAt,M=function(b){return B.call(a,b)},N=function(b){return L.call(a,b)},O=a.length,P=function(){for(var a=N(y);32===a||9===a;)a=N(++y)},Q=function(){var a,b,c=S();return P(),N(y)!==u?c:(y++,a=Q(),a||x("Expected expression",y),P(),N(y)===w?(y++,b=Q(),b||x("Expected expression",y),{type:k,test:c,consequent:a,alternate:b}):void x("Expected :",y))},R=function(){P();for(var b=a.substr(y,D),c=b.length;c>0;){if(A.hasOwnProperty(b))return y+=c,b;b=b.substr(0,--c)}return!1},S=function(){var a,b,c,d,e,f,g,h;if(f=T(),b=R(),!b)return f;for(e={value:b,prec:G(b)},g=T(),g||x("Expected expression after "+b,y),d=[f,e,g];(b=R())&&(c=G(b),0!==c);){for(e={value:b,prec:c};d.length>2&&c<=d[d.length-2].prec;)g=d.pop(),b=d.pop().value,f=d.pop(),a=H(b,f,g),d.push(a);a=T(),a||x("Expected expression after "+b,y),d.push(e,a)}for(h=d.length-1,a=d[h];h>1;)a=H(d[h-1].value,d[h-2],a),h-=2;return a},T=function(){var b,c,d;if(P(),b=N(y),I(b)||b===m)return U();if(b===o||b===p)return V();if(J(b)||b===q)return Y();if(b===s)return $();for(c=a.substr(y,C),d=c.length;d>0;){if(z.hasOwnProperty(c))return y+=d,{type:h,operator:c,argument:T(),prefix:!0};c=c.substr(0,--d)}return!1},U=function(){for(var a,b,c="";I(N(y));)c+=M(y++);if(N(y)===m)for(c+=M(y++);I(N(y));)c+=M(y++);if(a=M(y),"e"===a||"E"===a){for(c+=M(y++),a=M(y),"+"!==a&&"-"!==a||(c+=M(y++));I(N(y));)c+=M(y++);I(N(y-1))||x("Expected exponent ("+c+M(y)+")",y)}return b=N(y),J(b)?x("Variable names cannot start with a number ("+c+M(y)+")",y):b===m&&x("Unexpected period",y),{type:e,value:parseFloat(c),raw:c}},V=function(){for(var a,b="",c=M(y++),d=!1;y<O;){if(a=M(y++),a===c){d=!0;break}if("\\"===a)switch(a=M(y++)){case"n":b+="\n";break;case"r":b+="\r";break;case"t":b+="\t";break;case"b":b+="\b";break;case"f":b+="\f";break;case"v":b+="\x0B";break;default:b+="\\"+a}else b+=a}return d||x('Unclosed quote after "'+b+'"',y),{type:e,value:b,raw:c+b+c}},W=function(){var b,d=N(y),g=y;for(J(d)?y++:x("Unexpected "+M(y),y);y<O&&(d=N(y),K(d));)y++;return b=a.slice(g,y),E.hasOwnProperty(b)?{type:e,value:E[b],raw:b}:b===F?{type:f}:{type:c,name:b}},X=function(a){for(var c,d,e=[],f=!1;y<O;){if(P(),c=N(y),c===a){f=!0,y++;break}c===n?y++:(d=Q(),d&&d.type!==b||x("Expected comma",y),e.push(d))}return f||x("Expected "+String.fromCharCode(a),y),e},Y=function(){var a,b;for(a=N(y),b=a===q?Z():W(),P(),a=N(y);a===m||a===s||a===q;)y++,a===m?(P(),b={type:d,computed:!1,object:b,property:W()}):a===s?(b={type:d,computed:!0,object:b,property:Q()},P(),a=N(y),a!==t&&x("Unclosed [",y),y++):a===q&&(b={type:g,arguments:X(r),callee:b}),P(),a=N(y);return b},Z=function(){y++;var a=Q();return P(),N(y)===r?(y++,a):void x("Unclosed (",y)},$=function(){return y++,{type:l,elements:X(t)}},_=[];y<O;)i=N(y),i===v||i===n?y++:(j=Q())?_.push(j):y<O&&x('Unexpected "'+M(y)+'"',y);return 1===_.length?_[0]:{type:b,body:_}};if(L.version="0.3.1",L.toString=function(){return"JavaScript Expression Parser (JSEP) v"+L.version},L.addUnaryOp=function(a){return C=Math.max(a.length,C),z[a]=y,this},L.addBinaryOp=function(a,b){return D=Math.max(a.length,D),A[a]=b,this},L.addLiteral=function(a,b){return E[a]=b,this},L.removeUnaryOp=function(a){return delete z[a],a.length===C&&(C=B(z)),this},L.removeBinaryOp=function(a){return delete A[a],a.length===D&&(D=B(A)),this},L.removeLiteral=function(a){return delete E[a],this},"undefined"==typeof exports){var M=a.jsep;a.jsep=L,L.noConflict=function(){return a.jsep===L&&(a.jsep=M),L}}else"undefined"!=typeof module&&module.exports?exports=module.exports=L:exports.parse=L}(this);
//# sourceMappingURL=jsep.min.js.map
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}!function(t,e){var i=self.Mavo=t.Class({constructor:function(r){var s=this;if(this.index=i.all.push(this),this.id=r.getAttribute("data-mavo")||Mavo.Node.getProperty(r)||r.id||"mavo"+this.index,this.unhandled=r.classList.contains("mv-keep-unhandled"),1==this.index&&(this.store=i.urlParam("store"),this.source=i.urlParam("source")),this.store=this.store||i.urlParam(this.id+"_store")||r.getAttribute("data-store")||null,this.source=this.source||i.urlParam(this.id+"_source")||r.getAttribute("data-source")||null,this.autoEdit=i.has("autoedit",r),this.element=i.is("scope",r)?r:t(i.selectors.rootScope,r),this.element||(r.setAttribute("typeof",r.getAttribute("property")||""),r.removeAttribute("property"),this.element=r),this.element.classList.add("mv-root"),e(i.selectors.property+", "+i.selectors.scope,r).concat([this.element]).forEach(function(t){i.is("autoMultiple",t)&&!t.hasAttribute("data-multiple")&&t.setAttribute("data-multiple","");
}),this.wrapper=r.closest(".mv-wrapper")||r,this.wrapper.addEventListener("keydown",function(t){83==t.keyCode&&t[i.superKey]&&(t.preventDefault(),s.save())}),e(i.selectors.primitive,r).forEach(function(e){var r=t(i.selectors.not(i.selectors.formControl)+", "+i.selectors.property,e)&&(Mavo.is("multiple",e)||null===Mavo.Primitive.getValueAttribute(e))||e.matches("template");r&&e.setAttribute("typeof","")}),this.wrapper===this.element&&i.is("multiple",r)){var n=this.element;this.element.matches("li, option")?n=n.parentNode:this.element.matches("td, tr, tbody, thead, tfoot")&&(n=n.closest("table")),this.wrapper=t.create({around:n})}this.wrapper.classList.add("mv-wrapper"),this.ui={bar:t(".mv-bar",this.wrapper)||t.create({className:"mv-bar mv-ui",start:this.wrapper})},this.ui.status=t(".status",this.ui.bar)||t.create("span",{className:"status",inside:this.ui.bar}),this.needsEdit=!1,this.permissions=new Mavo.Permissions(null,this),Mavo.hooks.run("init-tree-before",this),this.root=Mavo.Node.create(this.element,this),
Mavo.hooks.run("init-tree-after",this),this.setUnsavedChanges(!1),this.permissions.onchange(function(t){var e=t.action,i=t.value;s.wrapper.classList.toggle("can-"+e,i)}),this.permissions.can(["edit","add","delete"],function(){s.ui.edit=t.create("button",{className:"edit",textContent:"Edit",onclick:function(t){return s.editing?s.done():s.edit()},inside:s.ui.bar}),s.autoEdit&&s.wrapper.addEventListener("mavo:load",function(t){return s.ui.edit.click()})},function(){t.remove(s.ui.edit),s.editing&&s.done()}),this.needsEdit&&this.permissions.can("save",function(){s.ui.save=t.create("button",{className:"save",textContent:"Save",events:{click:function(t){return s.save()},"mouseenter focus":function(t){s.wrapper.classList.add("save-hovered"),s.setUnsavedChanges()},"mouseleave blur":function(t){return s.wrapper.classList.remove("save-hovered")}},inside:s.ui.bar}),s.ui.revert=t.create("button",{className:"revert",textContent:"Revert",disabled:!0,events:{click:function(t){return s.revert()},"mouseenter focus":function(t){
s.unsavedChanges||(s.wrapper.classList.add("revert-hovered"),s.setUnsavedChanges())},"mouseleave blur":function(t){return s.wrapper.classList.remove("revert-hovered")}},inside:s.ui.bar})},function(){t.remove([s.ui.save,s.ui.revert]),s.ui.save=s.ui.revert=null}),this.permissions.can("delete",function(){s.ui.clear=t.create("button",{className:"clear",textContent:"Clear",onclick:function(t){return s.clear()}}),s.ui.bar.appendChild(s.ui.clear)}),this.permissions.cannot(["delete","edit"],function(){t.remove(s.ui.clear)}),this.store||this.source?(this.storage=new i.Storage(this),this.permissions.can("read",function(){return s.storage.load()})):(this.permissions.on(["read","edit"]),t.fire(this.wrapper,"mavo:load")),this.needsEdit||this.permissions.off(["edit","add","delete"]),Mavo.hooks.run("init-end",this)},get data(){return this.getData()},getData:function(t){return this.root.getData(t)},toJSON:function(){var t=arguments.length<=0||void 0===arguments[0]?this.data:arguments[0];return i.toJSON(t);
},render:function(t){i.hooks.run("render-start",{context:this,data:t}),t&&(this.editing?(this.done(),this.root.render(t),this.edit()):this.root.render(t)),this.unsavedChanges=!1},clear:function(){confirm("This will delete all your data. Are you sure?")&&(this.storage&&this.storage.clear(),this.root.clear())},edit:function(){this.editing=!0,this.root.edit(),t.events(this.wrapper,"mouseenter.mavo:edit mouseleave.mavo:edit",function(t){if(t.target.matches(".mv-item-controls .delete")){var e=t.target.closest(i.selectors.item);e.classList.toggle("delete-hover","mouseenter"==t.type)}if(t.target.matches(i.selectors.item)){t.target.classList.remove("has-hovered-item");var r=t.target.parentNode.closest(i.selectors.item);r&&r.classList.toggle("has-hovered-item","mouseenter"==t.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(t){var e=!!t;return t||this.walk(function(i){if(i.unsavedChanges)return e=!0,t===!1&&(i.unsavedChanges=!1),!1}),this.unsavedChanges=e},done:function(){this.root.done(),
t.unbind(this.wrapper,".mavo:edit"),this.editing=!1,this.unsavedChanges=!1},save:function(){this.root.save(),this.storage&&this.storage.save(),this.unsavedChanges=!1},revert:function(){this.root.revert()},walk:function(t){this.root.walk(t)},live:{editing:{set:function(t){this.wrapper.classList.toggle("editing",t),t?this.wrapper.setAttribute("data-editing",""):this.wrapper.removeAttribute("data-editing")}},unsavedChanges:function(t){this.wrapper.classList.toggle("unsaved-changes",t),this.ui&&this.ui.save&&(this.ui.save.disabled=!t,this.ui.revert.disabled=!t)},needsEdit:function(t){this.ui.bar[(t?"remove":"set")+"Attribute"]("hidden","")}},"static":{all:[],superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",init:function(t){return e(i.selectors.init,t||document).map(function(t){return new i(t)})},hooks:new t.Hooks}});!function(){var e=i.selectors={init:".mavo, [mavo], [data-mavo], [data-store]",property:"[property], [itemprop]",specificProperty:function(t){return"[property="+t+"], [itemprop="+t+"]";
},scope:"[typeof], [itemscope], [itemtype], .mv-group",multiple:"[multiple], [data-multiple], .multiple",required:"[required], [data-required], .required",formControl:"input, select, option, textarea",computed:".computed",item:".mv-item",ui:".mv-ui",option:function(t){return"["+t+"], [data-"+t+"], [data-mv-options~='"+t+"'], ."+t},container:{li:"ul, ol",tr:"table",option:"select",dt:"dl",dd:"dl"},documentFragment:".document-fragment"},r=e.arr=function(t){return t.split(/\s*,\s*/g)},s=e.not=function(t){return r(t).map(function(t){return":not("+t+")"}).join("")},n=e.or=function(t,e){return t+", "+e},o=e.and=function(t,e){var i=[],s=r(e);return r(t).forEach(function(t){return i.push.apply(i,_toConsumableArray(s.map(function(e){return t+e})))}),i.join(", ")},a=e.andNot=function(t,e){return o(t,s(e))};t.extend(i.selectors,{primitive:a(e.property,e.scope),rootScope:a(e.scope,e.property),output:n(e.specificProperty("output"),".output, .value"),autoMultiple:o("li, tr, option",":only-of-type")});
}(),Promise.all([t.ready(),t.include(Array.from&&window.Intl&&document.documentElement.closest,"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en")])["catch"](function(t){return console.error(t)}).then(function(){return Mavo.init()}),Stretchy.selectors.filter=".mv-editor:not([property])"}(Bliss,Bliss.$);
"use strict";!function(t,r){var e=t.extend(Mavo,{toJSON:function(t){return null===t?"":"string"==typeof t?t:JSON.stringify(t,null,"\t")},readable:function(t){return t&&t.replace(/([a-z])([A-Z])(?=[a-z])/g,function(t,r,e){return r+" "+e.toLowerCase()}).replace(/([a-z])[_\/-](?=[a-z])/g,"$1 ").replace(/^[a-z]/,function(t){return t.toUpperCase()})},queryJSON:function(r,e){return e&&r?t.value.apply(t,[r].concat(e.split("/"))):r},observe:function(r,e,n,a){n instanceof MutationObserver||(n=new MutationObserver(n));var o={};return e&&t.extend(o,{attributes:!0,attributeFilter:"all"==e?void 0:[e],attributeOldValue:!!a}),e&&"all"!=e||t.extend(o,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!a}),n.observe(r,o),n},toArray:function(t){return void 0===t?[]:Array.isArray(t)?t:[t]},flatten:function(t){return Array.isArray(t)?t.reduce(function(t,r){return e.toArray(t).concat(e.flatten(r))},[]):[t]},is:function(t,r){return r.matches&&r.matches(e.selectors[t])},has:function(t,r){return r.matches&&r.matches(e.selectors.option(t));
},urlParam:function(){for(var t=("searchParams"in URL.prototype?new URL(location).searchParams:null),r=null,e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];var o=!0,i=!1,u=void 0;try{for(var c,s=n[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var l=c.value;if(t)r=t.get(l);else{var f=location.search.match(RegExp("[?&]"+l+"(?:=([^&]+))?(?=&|$)","i"));r=f&&(f[1]||"")}if(null!==r)return r}}catch(p){i=!0,u=p}finally{try{!o&&s["return"]&&s["return"]()}finally{if(i)throw u}}return null},escapeRegExp:function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}});t.proxy=t.classProps.proxy=t.overload(function(t,r,e){return Object.defineProperty(t,r,{get:function(){return this[e][r]},set:function(t){this[e][r]=t},configurable:!0,enumerable:!0}),t}),t.classProps.propagated=function(t,r){Mavo.toArray(r).forEach(function(r){var e=t[r];t[r]=function(){var t=e&&e.apply(this,arguments);this.propagate&&t!==!1&&this.propagate(r)}})},document.addEventListener("focus",function(t){r(".focus-within").forEach(function(t){
return t.classList.remove("focus-within")});for(var e=t.target;e=e.parentNode;)e.classList&&e.classList.add("focus-within")},!0)}(Bliss,Bliss.$);
"use strict";!function(t){var i=Mavo.Permissions=t.Class({constructor:function(i){this.triggers=[],this.set(i),this.hooks=new t.Hooks},set:function(t){for(var i in t)this[i]=t[i]},on:function(t){var i=this;return Mavo.toArray(t).forEach(function(t){return i[t]=!0}),this},off:function(t){var i=this;return t=Array.isArray(t)?t:[t],t.forEach(function(t){return i[t]=!1}),this},can:function(t,i,n){this.observe(t,!0,i),n&&this.cannot(t,n)},cannot:function(t,i){this.observe(t,!1,i)},when:function(t){var i=this;return new Promise(function(n,r){i.can(t,n,r)})},observe:function(t,i,n){t=Mavo.toArray(t),this.is(t,i)&&n(),this.triggers.push({actions:t,value:i,callback:n,active:!0})},is:function(t,i){var n=this,r=t.map(function(t){return!!n[t]}).reduce(function(t,i){return t||i});return i?r:!r},onchange:function(t){this.hooks.add("change",t)},changed:function(t,i,n){var r=this;n=!!n,i=!!i,i!=n&&(this["_"+t]=i,this.triggers.forEach(function(i){var n=r.is(i.actions,i.value);i.active&&i.actions.indexOf(t)>-1&&n?(i.active=!1,
i.callback()):n||(i.active=!0)}),this.hooks.run("change",{action:t,value:i,permissions:this}))},or:function(t){var n=this;return i.actions.forEach(function(i){n[i]=n[i]||t[i]}),this},"static":{actions:[],register:function(n,r){return Array.isArray(n)?void n.forEach(function(t){return i.register(t,r)}):(t.live(i.prototype,n,function(t,i){r&&r.call(this,t,i),this.changed(n,t,i)}),void i.actions.push(n))}}});i.register(["read","save"]),i.register("login",function(t){t&&this.logout&&(this.logout=!1)}),i.register("logout",function(t){t&&this.login&&(this.login=!1)}),i.register("edit",function(t){t&&(this.add=this["delete"]=!0)}),i.register(["add","delete"],function(t){t||(this.edit=!1)})}(Bliss);
"use strict";!function(t){var e=Mavo.Storage=t.Class({constructor:function(n){var o=this;this.mavo=n,this.backend=e.Backend.create(this.mavo.store,this),this.sourceBackend=e.Backend.create(this.mavo.source,this),this.backend?this.backend.permissions=this.permissions.or(this.backend.permissions):this.permissions.on("read"),this.loaded=new Promise(function(t,e){o.mavo.wrapper.addEventListener("mavo:load",t)}),this.authControls={},this.permissions.can("login",function(){o.loginHash="#login"+(Mavo.all[0]===o.mavo?"":"-"+o.mavo.id),o.authControls.login=t.create({tag:"a",href:o.loginHash,textContent:"Login",className:"login button",events:{click:function(t){t.preventDefault(),o.login()}},after:t(".status",o.mavo.ui.bar)});var e;(e=function(){location.hash===o.loginHash&&(history.replaceState(null,document.title,new URL("",location)+""),o.login())})(),window.addEventListener("hashchange.mavo",e)},function(){t.remove(o.authControls.login),o.mavo.wrapper._.unbind("hashchange.mavo")}),this.mavo.wrapper.addEventListener("mavo:login.mavo",function(e){
if(e.backend==o.backend){var n=t(".status",o.mavo.ui.bar);n.innerHTML="",n._.contents(["Logged in to "+e.backend.id+" as ",{tag:"strong",innerHTML:e.name},{tag:"button",textContent:"Logout",className:"logout",events:{click:function(t){return e.backend.logout()}}}])}}),this.mavo.wrapper.addEventListener("mavo:logout.mavo",function(e){t(".status",o.mavo.ui.bar).textContent=""})},proxy:{permissions:"mavo"},load:function(){var e=this;this.inProgress="Loading";var n=this.backend||this.sourceBackend;return n.ready.then(function(){return n.get()})["catch"](function(t){return e.sourceBackend&&n!==e.sourceBackend?e.sourceBackend.ready.then(function(){return e.sourceBackend.get()}):Promise.reject(t)}).then(function(n){n&&"string"==t.type(n)&&(n=JSON.parse(n)),e.mavo.render(n)})["catch"](function(t){t&&(t.xhr&&404==t.xhr.status?e.mavo.render(""):(console.error(t),console.log(t.stack)))}).then(function(){e.inProgress=!1,t.fire(e.mavo.wrapper,"mavo:load")})},save:function(){var e=this;this.inProgress="Saving",
this.backend.login().then(function(){return e.backend.put()}).then(function(n){t.fire(e.mavo.wrapper,"mavo:save",{data:n.data,dataString:n.dataString})})["catch"](function(t){t&&(console.error(t),console.log(t.stack))}).then(function(){e.inProgress=!1})},login:function(){return this.backend.login()},logout:function(){return this.backend.logout()},clear:function(){this.save(null)},param:function(t){if(this.params=this.params||{},!(t in this.params)){var e="data-store-"+t;this.params[t]=this.mavo.wrapper.getAttribute(e)||this.mavo.element.getAttribute(e),this.mavo.wrapper.removeAttribute(e),this.mavo.element.removeAttribute(e)}return this.params[t]},live:{inProgress:function(t){this.mavo.wrapper[(t?"set":"remove")+"Attribute"]("data-mv-progress",t)}},"static":{isHash:function(t){return t.origin===location.origin&&t.pathname===location.pathname&&!!t.hash}}});e.Backend=t.Class({constructor:function(t,e){this.url=t,this.storage=e,this.permissions=new Mavo.Permissions},get:function(){return t.fetch(this.url.href,{
responseType:"json"}).then(function(t){return Promise.resolve(t.response)},function(){return Promise.resolve(null)})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},getFile:function(){var t=this.mavo.data;return{data:t,dataString:Mavo.toJSON(t),path:this.path||""}},toString:function(){return this.id+" ("+this.url+")"},proxy:{mavo:"storage"},"static":{create:function(t,n){if(t){var o=e.Backend.types.filter(function(e){return e.test(t)})[0]||e.Backend.Remote;return new o(t,n)}return null},types:[],register:function(t){return e.Backend[t.prototype.id]=t,e.Backend.types.push(t),t}}}),e.Backend.register(t.Class({id:"Element","extends":e.Backend,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=t(this.url)||t.create("script",{type:"application/json",id:this.url.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(){var t=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];
return this.element.textContent=t.dataString,Promise.resolve(t)},"static":{test:function(t){return 0===t.indexOf("#")}}})),e.Backend.register(t.Class({id:"Remote","extends":e.Backend,constructor:function(){this.permissions.on("read"),this.url=new URL(this.url,location)},"static":{test:function(t){return!1}}})),e.Backend.register(t.Class({"extends":e.Backend,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(){var t=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];return null===t.data?delete localStorage[this.key]:localStorage[this.key]=t.dataString,Promise.resolve(t)},"static":{test:function(t){return"local"==t}}}))}(Bliss);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}!function(t,e){var r=Mavo.Node=t.Class({"abstract":!0,constructor:function(t,e){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!t||!e)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");this.element=t,this.template=o.template,this.template?this.template.copies.push(this):this.copies=[],this.mavo=e,this.fromTemplate("property","type")||(this.property=r.getProperty(t),this.type=Mavo.Scope.normalize(t)),this.scope=this.parentScope=o.scope,Mavo.hooks.run("node-init-end",this)},get isRoot(){return!this.property},get name(){return Mavo.readable(this.property||this.type).toLowerCase()},get data(){return this.getData()},walk:function(t){var e=function r(e){var o=t(e);o!==!1&&e.propagate&&e.propagate(r)};e(this)},walkUp:function(t){for(var e=this;e=e.parentScope;){var r=t(e);if(void 0!==r)return r;
}},call:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return r=r||[],"string"==typeof t?this[t].apply(this,_toConsumableArray(r)):t.apply(this,[this].concat(_toConsumableArray(r)))},edit:function(){this.propagate(function(t){return t[t.preEdit?"preEdit":"edit"]()})},propagated:["save","revert","done","import"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){if(this.template){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var o=!0,a=!1,i=void 0;try{for(var n,p=e[Symbol.iterator]();!(o=(n=p.next()).done);o=!0){var s=n.value;this[s]=this.template[s]}}catch(c){a=!0,i=c}finally{try{!o&&p["return"]&&p["return"]()}finally{if(a)throw i}}}return!!this.template},"static":{create:function(t,e){var r,o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return Mavo.is("multiple",t)&&!o.collection?new Mavo.Collection(t,e,o):(r=Mavo.Unit).create.apply(r,arguments)},getProperty:function(t){var e=t.getAttribute("property")||t.getAttribute("itemprop");
return!e&&t.hasAttribute("property")&&(e=t.name||t.id||t.classList[0]),e&&t.setAttribute("property",e),e}}})}(Bliss,Bliss.$);
"use strict";!function(e,t){Mavo.Unit=e.Class({"abstract":!0,"extends":Mavo.Node,constructor:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];this.constructor.all.set(this.element,this),this.collection=n.collection,this.dirty=n.dirty,this.collection&&(this.scope=this.parentScope=this.collection.parentScope),this.fromTemplate("computed","required")||(this.computed=Mavo.is("computed",this.element),this.required=Mavo.is("required",this.element)),Mavo.hooks.run("unit-init-end",this)},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentScope&&this.parentScope.isDeleted()},getData:function(e){e=e||{};var t=function(t){return t.dirty&&!e.dirty||t.deleted&&e.dirty||t.computed&&!e.computed||t.placeholder};return t(this)?null:void this.walkUp(function(e){if(t(e))return null})},lazy:{closestCollection:function(){return this.collection||this.scope.collection||(this.parentScope?this.parentScope.closestCollection:null)}},live:{deleted:function(n){var i=this;
this.element.classList.toggle("deleted",n),n?(this.elementContents=document.createDocumentFragment(),t(this.element.childNodes).forEach(function(e){i.elementContents.appendChild(e)}),e.contents(this.element,[{tag:"button","class":"close",textContent:"×",events:{click:function(t){e.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",textContent:"Undo",events:{click:function(e){return i.deleted=!1}}}]),this.element.classList.remove("delete-hover")):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,e.fire(this.element,"mavo:datachange",{unit:this.collection,mavo:this.mavo,action:"undelete",item:this}))},unsavedChanges:function(e){return e&&(this.placeholder||this.computed||!this.editing)&&(e=!1),this.element.classList.toggle("unsaved-changes",e),e},placeholder:function(e){this.element.classList.toggle("placeholder",e)}},"static":{get:function(e,t){var n=Mavo.Scope.all.get(e);return t||!n?Mavo.Primitive.all.get(e):n},create:function(e,t){
var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(!e||!t)throw new TypeError("Mavo.Unit.create() requires an element argument and a mavo object");return new(Mavo[Mavo.is("scope",e)?"Scope":"Primitive"])(e,t,n)}}})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e){var i=Mavo.Expression=t.Class({constructor:function(t){this.expression=t},eval:function(t){this.oldValue=this.value,Mavo.hooks.run("expression-eval-beforeeval",this);try{this["function"]||(this["function"]=i.compile(this.expression)),this.value=this["function"](t)}catch(e){Mavo.hooks.run("expression-eval-error",{context:this,exception:e}),this.value=i.ERROR}return this.value},toString:function(){return this.expression},live:{expression:function(t){t=t.trim();this["function"]=null}},"static":{ERROR:"N/A",serializers:{BinaryExpression:function(t){return i.serialize(t.left)+" "+t.operator+" "+i.serialize(t.right)},UnaryExpression:function(t){
return""+t.operator+i.serialize(t.argument)},CallExpression:function(t){return i.serialize(t.callee)+"("+t.arguments.map(i.serialize).join(", ")+")"},ConditionalExpression:function(t){return i.serialize(t.test)+"? "+i.serialize(t.consequent)+" : "+i.serialize(t.alternate)},MemberExpression:function(t){return i.serialize(t.object)+"["+i.serialize(t.property)+"]"},ArrayExpression:function(t){return"["+t.elements.map(i.serialize).join(", ")+"]"},Literal:function(t){return t.raw},Identifier:function(t){return t.name},ThisExpression:function(t){return"this"},Compound:function(t){return t.body.map(i.serialize).join(" ")}},transformations:{BinaryExpression:function(t){var e=Mavo.Script.getOperatorName(t.operator),n=(Mavo.Script.operators[e],t),r=[];do r.unshift(n.right),n=n.left;while(Mavo.Script.getOperatorName(n.operator)===e);if(r.unshift(n),r.length>1)return e+"("+r.map(i.serialize).join(", ")+")"},CallExpression:function(t){"Identifier"==t.callee.type&&"if"==t.callee.name&&(t.callee.name="iff");
}},serialize:function(t){if(i.transformations[t.type]){var e=i.transformations[t.type](t);if(void 0!==e)return e}return i.serializers[t.type](t)},rewrite:function(t){try{return i.serialize(i.parse(t))}catch(e){return t}},compile:function(t){return t=i.rewrite(t),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\t\twith(data) {\n\t\t\t\t\t\treturn "+t+";\n\t\t\t\t\t}")},parse:self.jsep}});self.jsep&&(jsep.addBinaryOp("and",2),jsep.addBinaryOp("or",2),jsep.addBinaryOp("=",6),jsep.removeBinaryOp("===")),i.serializers.LogicalExpression=i.serializers.BinaryExpression,i.transformations.LogicalExpression=i.transformations.BinaryExpression,function(){var e=Mavo.Expression.Syntax=t.Class({constructor:function(t,e){this.start=t,this.end=e,this.regex=RegExp(Mavo.escapeRegExp(t)+"([\\S\\s]+?)"+Mavo.escapeRegExp(e),"gi")},test:function(t){return this.regex.lastIndex=0,this.regex.test(t)},tokenize:function(t){var e,i=[],n=0;for(this.regex.lastIndex=0;null!==(e=this.regex.exec(t));)e.index>n&&i.push(t.substring(n,e.index)),
n=this.regex.lastIndex,i.push(new Mavo.Expression(e[1]));return n<t.length&&i.push(t.substring(n)),i},"static":{create:function(t){if(t){var i=t.getAttribute("data-expressions");if(i)return i=i.trim(),/\s/.test(i)?new(Function.prototype.bind.apply(e,[null].concat(_toConsumableArray(i.split(/\s+/))))):e.ESCAPE}},ESCAPE:-1}});e["default"]=new e("[","]")}(),function(){var e=Mavo.Expression.Text=t.Class({constructor:function(t){this.all=t.all,this.node=t.node,this.path=t.path,this.syntax=t.syntax,this.node||(this.node=this.path.reduce(function(t,e){return t.childNodes[e]},this.all.scope.element)),this.element=this.node,this.attribute=t.attribute||null,"data-content"==this.attribute?(this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.expression=Mavo.Primitive.getValue(this.element,"data-content",null,{raw:!0}),this.syntax.test(this.expression)||(this.expression=this.syntax.start+this.expression+this.syntax.end)):(3===this.node.nodeType&&(this.element=this.node.parentNode,this.node.parentNode.children.length&&!this.attribute||(this.node=this.element,
this.element.normalize())),this.expression=(this.attribute?this.node.getAttribute(this.attribute):this.node.textContent).trim()),this.template=t.template?t.template.template:this.syntax.tokenize(this.expression),Mavo.hooks.run("expressiontext-init-end",this),e.elements.set(this.element,[].concat(_toConsumableArray(e.elements.get(this.element)||[]),[this]))},update:function(t){var e=this;this.data=t;var i={};i.value=this.value=this.template.map(function(i){if(i instanceof Mavo.Expression){var n={context:e,expr:i};return Mavo.hooks.run("expressiontext-update-beforeeval",n),n.value=n.expr.eval(t),Mavo.hooks.run("expressiontext-update-aftereval",n),void 0===n.value||null===n.value?"":n.value}return i}),this.attribute||(i.presentational=this.value.map(function(t){return Array.isArray(t)?t.join(", "):"number"==typeof t?Mavo.Primitive.formatNumber(t):t}),i.presentational=1===i.presentational.length?i.presentational[0]:i.presentational.join("")),i.value=1===i.value.length?i.value[0]:i.value.join(""),
this.primitive&&1===this.template.length&&("number"==typeof i.value?this.primitive.datatype="number":"boolean"==typeof i.value&&(this.primitive.datatype="boolean")),i.presentational===i.value&&(i=i.value),this.primitive?this.primitive.value=i:Mavo.Primitive.setValue(this.node,i,this.attribute,{presentational:i.presentational})},proxy:{scope:"all"},"static":{elements:new WeakMap,search:function(t,i){var n=e.elements.get(t)||[];return arguments.length>1?n.length?n.filter(function(t){return t.attribute===i})[0]||null:null:n}}})}(),function(){Mavo.Expressions=t.Class({constructor:function(t){var e=this;if(t&&(this.scope=t,this.scope.expressions=this),this.all=[],Mavo.hooks.run("expressions-init-start",this),this.scope){var i=this.scope.template;if(i&&i.expressions){var n=!0,r=!1,s=void 0;try{for(var a,o=i.expressions.all[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value;this.all.push(new Mavo.Expression.Text({path:u.path,syntax:u.syntax,attribute:u.attribute,all:this,template:u}));
}}catch(l){r=!0,s=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(r)throw s}}}else{var p=Mavo.Expression.Syntax.create(this.scope.element.closest("[data-expressions]"))||Mavo.Expression.Syntax["default"];this.traverse(this.scope.element,void 0,p)}}this.dependents=new Set,this.active=!0,this.scope.element.addEventListener("mavo:datachange",function(t){return e.update()}),this.update()},update:function(){if(this.active&&!this.scope.isDeleted()&&this.all.length+this.dependents.size!==0){var t={context:this,data:this.scope.getRelativeData()};Mavo.hooks.run("expressions-update-start",t);var e=!0,i=!1,n=void 0;try{for(var r,s=this.all[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){var a=r.value;a.update(t.data)}}catch(o){i=!0,n=o}finally{try{!e&&s["return"]&&s["return"]()}finally{if(i)throw n}}var u=!0,l=!1,p=void 0;try{for(var h,c=this.dependents[Symbol.iterator]();!(u=(h=c.next()).done);u=!0){var f=h.value;f.update()}}catch(o){l=!0,p=o}finally{try{!u&&c["return"]&&c["return"]()}finally{
if(l)throw p}}}},extract:function(t,e,i,n){(e&&"data-content"==e.name||n.test(e?e.value:t.textContent))&&this.all.push(new Mavo.Expression.Text({node:t,syntax:n,path:(i||"").slice(1).split("/").map(function(t){return+t}),attribute:e&&e.name,all:this}))},traverse:function(t){var i=this,n=arguments.length<=1||void 0===arguments[1]?"":arguments[1],r=arguments[2];if(3===t.nodeType||8===t.nodeType)this.extract(t,null,n,r);else if(t==this.scope.element||!Mavo.is("scope",t)){if(r=Mavo.Expression.Syntax.create(t)||r,r===Mavo.Expression.Syntax.ESCAPE)return;e(t.attributes).forEach(function(e){return i.extract(t,e,n,r)}),e(t.childNodes).forEach(function(t,e){return i.traverse(t,n+"/"+e,r)})}},"static":{}})}(),Mavo.Node.prototype.getRelativeData=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?{dirty:!0,computed:!0,"null":!0}:arguments[0];e.unhandled=this.mavo.unhandled;var i=this.getData(e);return self.Proxy&&i&&"object"===("undefined"==typeof i?"undefined":_typeof(i))&&(i=new Proxy(i,{
get:function(i,n){if(n in i)return i[n];if("$index"==n)return t.index+1;var r=t.walkUp(function(i){if(n in i.properties)return i.expressions.dependents.add(t.expressions),i.properties[n].getRelativeData(e)});return void 0!==r?r:void 0},has:function(i,n){if(n in i)return!0;if("$index"==n)return!0;var r=t.walkUp(function(t){if(n in t.properties)return!0});return void 0!==r?r:(r=t.find(n),void 0!==r?(r=Array.isArray(r)?r.map(function(t){return t.getData(e)}).filter(function(t){return null!==t}):r.getData(e),i[n]=r,!0):void 0)},set:function(t,e,i){throw Error("You can’t set data via expressions.")}})),i},Mavo.hooks.add("scope-init-start",function(){new Mavo.Expressions(this)}),Mavo.hooks.add("primitive-init-start",function(){this.expressionText=Mavo.Expression.Text.search(this.element,this.attribute),this.computed=!!this.expressionText,this.expressionText&&(this.expressionText.primitive=this)}),Mavo.hooks.add("scope-init-end",function(){this.expressions.update()}),Mavo.hooks.add("scope-render-start",function(){
this.expressions.active=!1}),Mavo.hooks.add("scope-render-end",function(){var t=this;requestAnimationFrame(function(){t.expressions.active=!0,t.expressions.update()})})}(Bliss,Bliss.$);
"use strict";function _toConsumableArray(r){if(Array.isArray(r)){for(var t=0,n=Array(r.length);t<r.length;t++)n[t]=r[t];return n}return Array.from(r)}var _slicedToArray=function(){function r(r,t){var n=[],a=!0,e=!1,i=void 0;try{for(var o,u=r[Symbol.iterator]();!(a=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(l){e=!0,i=l}finally{try{!a&&u["return"]&&u["return"]()}finally{if(e)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return r(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){function r(r,t){return r=Array.isArray(r)?r:t?$$(t):[r],r.filter(function(r){return!isNaN(r)}).map(function(r){return+r})}var t=Mavo.Functions={operators:{"=":"eq"},get now(){return new Date},sum:function(t){return r(t,arguments).reduce(function(r,t){return+r+(+t||0)},0)},average:function(n){return n=r(n,arguments),n.length&&t.sum(n)/n.length},min:function(t){return Math.min.apply(Math,_toConsumableArray(r(t,arguments)));
},max:function(t){return Math.max.apply(Math,_toConsumableArray(r(t,arguments)))},count:function(r){return Mavo.toArray(r).filter(function(r){return null!==r&&r!==!1}).length},round:function(r,t){return r&&t&&isFinite(r)?+r.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t}):Math.round(r)},iff:function(r,t){var n=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return Array.isArray(r)?r.map(function(r,a){var e=r?t:n;return Array.isArray(e)?e[Math.min(a,e.length-1)]:e}):r?t:n},idify:function(r){return((text||"")+"").replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase()}};Mavo.Script={addUnaryOperator:function(r,t){return function(r){return Array.isArray(r)?r.map(t.scalar):t.scalar(r)}},addBinaryOperator:function(n,a){if(a.symbol){var e=!0,i=!1,o=void 0;try{for(var u,l=Mavo.toArray(a.symbol)[Symbol.iterator]();!(e=(u=l.next()).done);e=!0){var c=u.value;Mavo.Script.symbols[c]=n}}catch(s){i=!0,o=s}finally{try{!e&&l["return"]&&l["return"]()}finally{if(i)throw o}}}return a.identity=a.identity||0,
t[n]=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];1===n.length&&Array.isArray(n[0])&&(n=[].concat(_toConsumableArray(n[0])));for(var i,o=!!a.logical||n[0],u=function(t){var e=a.logical?n[t-1]:o,u=n[t];Array.isArray(u)?("number"==typeof a.identity&&(u=r(u)),i=Array.isArray(e)?[].concat(_toConsumableArray(u.map(function(r,t){return a.scalar(void 0===e[t]?a.identity:e[t],r)})),_toConsumableArray(e.slice(u.length))):u.map(function(r){return a.scalar(e,r)})):("number"==typeof a.identity&&(u=+u),i=Array.isArray(e)?e.map(function(r){return a.scalar(r,u)}):a.scalar(e,u)),o=a.logical?o&&i:i},l=1;l<n.length;l++)u(l);return o}},symbols:{},getOperatorName:function(r){return Mavo.Script.symbols[r]||r},operators:{not:{scalar:function(r){return function(r){return!r}}},multiply:{scalar:function(r,t){return r*t},identity:1,symbol:"*"},divide:{scalar:function(r,t){return r/t},identity:1,symbol:"/"},add:{scalar:function(r,t){return+r+ +t},symbol:"+"},subtract:{scalar:function(r,t){
return r-t},symbol:"-"},lte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<=t},symbol:"<="},lt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r<t},symbol:"<"},gte:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r>=t},symbol:">="},gt:{logical:!0,scalar:function(r,t){var n=Mavo.Script.getNumericalOperands(r,t),a=_slicedToArray(n,2);return r=a[0],t=a[1],r>t},symbol:">"},eq:{logical:!0,scalar:function(r,t){return r==t},symbol:["=","=="]},and:{logical:!0,scalar:function(r,t){return!!r&&!!t},identity:!0,symbol:"&&"},or:{logical:!0,scalar:function(r,t){return!!r||!!t},identity:!1,symbol:"||"}},getNumericalOperands:function(r,t){if(isNaN(r)||isNaN(t)){var n=new Date(r),a=new Date(t);if(!isNaN(n)&&!isNaN(a))return[n,a]}return[r,t]}};for(var n in Mavo.Script.operators){var a=Mavo.Script.operators[n];
a.scalar.length<2?Mavo.Script.addUnaryOperator(n,a):Mavo.Script.addBinaryOperator(n,a)}var e={average:"avg",iff:"iff IF",subtract:"minus",multiply:"mult product",divide:"div",lt:"lessThan smaller",gt:"moreThan greater greaterThan bigger",eq:"equal equality"},i=function(r){e[r].split(/\s+/g).forEach(function(n){return t[n]=t[r]})};for(var o in e)i(o);Mavo.Functions._Trap=self.Proxy?new Proxy(t,{get:function(r,t){if(t in r)return r[t];var n=t.toLowerCase&&t.toLowerCase();return n&&r.hasOwnProperty(n)?r[n]:t in Math||n in Math?Math[t]||Math[n]:t in self?self[t]:t},has:function(r,t){return"data"!=t}}):Mavo.Functions}();
"use strict";!function(e,t){Mavo.Scope=e.Class({"extends":Mavo.Unit,constructor:function(e,i,r){var o=this;if(this.properties={},this.scope=this,Mavo.hooks.run("scope-init-start",this),Mavo.Primitive.getValueAttribute(this.element)){this.properties[this.property]=new Mavo.Primitive(this.element,this.mavo,{scope:this})}t(Mavo.selectors.property,this.element).forEach(function(e){var t=Mavo.Node.getProperty(e);if(o.contains(e)){var i=o.properties[t],r=o.template?o.template.properties[t]:null,n={template:r,scope:o};if(i){var s=i;i instanceof Mavo.Collection||(s=new Mavo.Collection(i.element,o.mavo,n),o.properties[t]=i.collection=s,s.add(i)),!s.mutable&&Mavo.is("multiple",e)&&(s.mutable=!0),s.add(e)}else{var a=Mavo.Node.create(e,o.mavo,n);o.properties[t]=a}}}),Mavo.hooks.run("scope-init-end",this)},getData:function(t){t=t||{};var i=this["super"].getData.call(this,t);return void 0!==i?i:(i={},this.propagate(function(e){if((!e.computed||t.computed)&&!(e.property in i)){var r=e.getData(t);(null!==r||t["null"])&&(i[e.property]=r);
}}),t.dirty&&!t.unhandled||e.extend(i,this.unhandled),i)},find:function(e){if(this.property==e)return this;if(e in this.properties)return this.properties[e].find(e);for(var t in this.properties){var i=this.properties[t].find(e);if(void 0!==i)return i}},propagate:function(t){var i=arguments;e.each(this.properties,function(e,t){t.call.apply(t,i)})},save:function(){return!this.placeholder&&void(this.unsavedChanges=!1)},done:function(){e.unbind(this.element,".mavo:edit")},propagated:["save","done","import","clear"],render:function(t){var i=this;t&&(Mavo.hooks.run("scope-render-start",this),t=Array.isArray(t)?t[0]:t,this.unhandled=e.extend({},t,function(e){return!(e in i.properties)}),this.propagate(function(e){e.render(t[e.property])}),this.save(),Mavo.hooks.run("scope-render-end",this))},contains:function(e){return e instanceof Mavo.Unit?e.parentScope===this:e.parentNode&&this.element===e.parentNode.closest(Mavo.selectors.scope)},"static":{all:new WeakMap,normalize:function(e){if(Mavo.is("scope",e)){
var t=e.getAttribute("typeof")||e.getAttribute("itemtype")||"Item";return e.setAttribute("typeof",t),t}return null}}})}(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};!function(t,e){var i=Mavo.Primitive=t.Class({"extends":Mavo.Unit,constructor:function(n,a,r){var o=this;if(this.fromTemplate("attribute","datatype","humanReadable","templateValue")||(this.attribute=i.getValueAttribute(this.element),this.attribute&&(this.humanReadable=this.attribute.humanReadable),this.datatype=i.getDatatype(this.element,this.attribute)),this.view="read",this.computed=!1,Mavo.hooks.run("primitive-init-start",this),Mavo.is("formControl",this.element)?(this.editor=this.element,this.editorType="exposed",this.edit()):this.computed||(this.mavo.needsEdit=!0),this.editor||this.attribute||(this.editor=e(this.element.children).filter(function(t){return t.matches(Mavo.selectors.formControl)&&!t.matches(Mavo.selectors.property)})[0],this.editor&&(this.editorType="nested",this.element.textContent=this.editorValue,
t.remove(this.editor))),!this.editor&&this.element.hasAttribute("data-edit")){this.editorType="linked";var s=t(this.element.getAttribute("data-edit"));s&&Mavo.is("formControl",s)&&(this.editor=s.cloneNode(!0),this.template||Mavo.observe(s,"all",function(t){var e=!0,i=!1,n=void 0;try{for(var a,r=o.copies[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){var u=a.value;u.editor=s.cloneNode(!0),u.setValue(u.value,{force:!0,silent:!0})}}catch(h){i=!0,n=h}finally{try{!e&&r["return"]&&r["return"]()}finally{if(i)throw n}}}))}if(this.templateValue=this.getValue(),this["default"]=this.element.getAttribute("data-default"),this.computed||""===this["default"]?this["default"]=this.templateValue:null===this["default"]?this["default"]=this.editor?this.editorValue:this.emptyValue:Mavo.observe(this.element,"data-default",function(t){o["default"]=o.element.getAttribute("data-default")}),this.collection){var u=function(e){o.unobserve();var i=t.remove(t(Mavo.selectors.ui,o.element)),n=e();return t.inside(i,o.element),
o.observe(),n};["textContent","innerHTML"].forEach(function(t){var e=Object.getOwnPropertyDescriptor(Node.prototype,t);Object.defineProperty(o.element,t,{get:function(){var t=this;return u(function(){return e.get.call(t)})},set:function(t){var i=this;u(function(){return e.set.call(i,t)})}})})}this.computed||this.setValue(this.templateValue,{silent:!0}),this.setValue(this.template?this["default"]:this.templateValue,{silent:!0}),this.observe()},get editing(){return"edit"==this.view},get editorValue(){if(this.getEditorValue){var e=this.getEditorValue();if(void 0!==e)return e}if(this.editor){if(this.editor.matches(Mavo.selectors.formControl))return i.getValue(this.editor,void 0,this.datatype);var n=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);if(n)return i.all.has(n)?i.all.get(n).value:i.getValue(n)}},set editorValue(e){if((!this.setEditorValue||void 0===this.setEditorValue(e))&&this.editor)if(this.editor.matches(Mavo.selectors.formControl))i.setValue(this.editor,e);else{
var n=t(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);n&&(i.all.has(n)?i.all.get(n).value=e:i.setValue(n,e))}},get exposed(){return this.editor===this.element},getData:function(t){t=t||{};var e=this["super"].getData.call(this,t);if(void 0!==e)return e;var e=t.dirty||this.exposed?this.value:this.savedValue;return t.dirty||""!==e?e:null},save:function(){return!this.placeholder&&(this.savedValue=this.value,void(this.unsavedChanges=!1))},done:function(){this.unobserve(),this.popup?this.popup.close():this.attribute||this.exposed||!this.editing||(t.remove(this.editor),this.element.textContent=this.editorValue),this.exposed||(this.view="read"),null!==this.element._.data.prevTabindex?this.element.tabIndex=this.element._.data.prevTabindex:this.element.removeAttribute("tabindex"),this.observe()},revert:function(){this.unsavedChanges&&void 0!==this.savedValue&&(this.value=this.savedValue,this.unsavedChanges=!1)},preEdit:function(){var t=this;if(!this.computed){if(this.empty&&!this.attribute)return void this.edit();
if("preEdit"!=this.view){this.view="preEdit";var e;this.element._.events({"click.mavo:preedit":function(e){return t.edit()},"focus.mavo:preedit":function(e){t.edit(),t.popup||t.editor.focus()},"click.mavo:edit":function(e){t.exposed||e.preventDefault()}}),this.attribute||this.element._.events({"mouseenter.mavo:preedit":function(i){clearTimeout(e),e=setTimeout(function(){return t.edit()},150)},"mouseleave.mavo:preedit":function(t){clearTimeout(e)}}),this.element._.data.prevTabindex=this.element.getAttribute("tabindex"),this.element.tabIndex=0}}},initEdit:function(){var n=this;if(!this.editor){var a=i.getMatch(this.element,i.editors);a.create&&t.extend(this,a,function(t){return"create"!=t});var r=a.create||a;this.editor=t.create("function"===t.type(r)?r.call(this):r),this.editorValue=this.value,this.editorType="created"}if(this.editor._.events({"input change":function(t){var e=n.mavo.unsavedChanges;n.value=n.editorValue,n.exposed&&!n.mavo.editing&&n.mavo.permissions.save&&(n.unsavedChanges=!1,
n.mavo.unsavedChanges=e,"change"==t.type&&(n.save(),n.mavo.storage.save(),n.mavo.setUnsavedChanges()))},focus:function(t){n.editor.select&&n.editor.select()},"mavo:datachange":function(e){"output"===e.property&&(e.stopPropagation(),t.fire(n.editor,"input"))}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")"),!this.exposed){var o=/^data-input-/i;e(this.element.attributes).forEach(function(t){o.test(t.name)&&this.editor.setAttribute(t.name.replace(o,""),t.value)},this),this.attribute&&(this.popup=new i.Popup(this))}this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){this.computed||this.editing||(this.element._.unbind(".mavo:preedit"),this.initEdit&&this.initEdit(),this.popup&&this.popup.show(),this.attribute||this.editor.parentNode==this.element||this.exposed||(this.editorValue=this.value,this.element.textContent="",this.exposed||this.element.appendChild(this.editor)),this.view="edit")},clear:function(){this.value=this.emptyValue;
},render:function(t){Array.isArray(t)&&(t=t[0]),"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(t=t[this.property]),void 0===t?this.value=this.closestCollection?this["default"]:this.templateValue:this.value=t,this.save()},find:function(t){if(this.property==t)return this},observe:function(){var t=this;this.computed||(this.observer=Mavo.observe(this.element,this.attribute,this.observer||function(e){!t.attribute&&t.mavo.editing||(t.value=t.getValue())}))},unobserve:function(){this.observer&&this.observer.disconnect()},getValue:function(t){return i.getValue(this.element,this.attribute,this.datatype,t)},lazy:{label:function(){return Mavo.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0}return""}},setValue:function(e){var n=this,a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];if(this.unobserve(),"object"==t.type(e)&&"value"in e){var r=e.presentational;e=e.value}return e=e||0===e?e:"",e=i.safeCast(e,this.datatype),
e!=this._value||a.force?(this.editor&&document.activeElement!=this.editor&&(this.editorValue=e),this.humanReadable&&this.attribute&&(r=this.humanReadable(e)),this.editing&&!this.attribute||(this.editor&&this.editor.matches("select")&&!this.exposed&&this.editor.selectedOptions[0]&&(r=this.editor.selectedOptions[0].textContent),i.setValue(this.element,{value:e,presentational:r},this.attribute,this.datatype)),this.empty=""===e,this._value=e,a.silent||(this.computed||(this.unsavedChanges=this.mavo.unsavedChanges=!0),requestAnimationFrame(function(){t.fire(n.element,"mavo:datachange",{property:n.property,value:e,mavo:n.mavo,node:n,dirty:n.editing,action:"propertychange"})})),"preEdit"==this.view&&this.preEdit(),this.observe(),e):e},live:{value:function(t){return this.setValue(t)},empty:function(e){var i=e&&!this.exposed&&!(this.attribute&&t(Mavo.selectors.property,this.element));this.element.classList.toggle("empty",i)},view:function(t){this.element.classList.toggle("editing","edit"==t)},computed:function(t){
this.element.classList.toggle("computed",t)}},"static":{all:new WeakMap,getMatch:function(t,e){var i=null;for(var n in e)t.matches(n)&&(i=e[n]);return i},getValueAttribute:function(e){var n=e.getAttribute("data-attribute")||i.getMatch(e,i.attributes);return n&&n.value&&(n=t.extend(new String(n.value),n)),n&&"null"!==n||(n=null),n},getDatatype:function(t,e){var n=t.getAttribute("datatype");if(!n)for(var a in i.datatypes)t.matches(a)&&(n=i.datatypes[a][e]);return n=n||"string"},safeCast:function(t,e){var n=("undefined"==typeof t?"undefined":_typeof(t),i.cast(t,e));return null===t||void 0===t?t:"boolean"==e?"false"!==t&&0!==t&&""!==t&&("true"===t||t>0||t):"number"==e?/^[-+]?[0-9.e]+$/i.test(t+"")?n:t:n},cast:function(t,e){switch(e){case"number":return+t;case"boolean":return!!t;case"string":return t+""}return t},getValue:function(t,e,n){arguments.length<=3||void 0===arguments[3]?{}:arguments[3];e=e||null===e?e:i.getValueAttribute(t),n=n||i.getDatatype(t,e);var a;return a=e in t&&i.useProperty(t,e)?t[e]:e?t.getAttribute(e):t.getAttribute("content")||t.textContent||null,
i.safeCast(a,n)},setValue:function(e,n,a,r){if("object"==t.type(n)&&"value"in n){var o=n.presentational;n=n.value}if(null!==a&&(a=a||i.getValueAttribute(e)),a in e&&i.useProperty(e,a)&&e[a]!=n)try{e[a]=n}catch(s){}a?e.getAttribute(a)!=n&&(e.setAttribute(a,n),o&&(e.textContent=o)):("number"!==r||o||(o=i.formatNumber(n)),e.textContent=o||n,o&&e.setAttribute&&e.setAttribute("content",n))},useProperty:function(t,e){return!(["href","src"].indexOf(e)>-1)&&"http://www.w3.org/2000/svg"!=t.namespaceURI},register:function(t){var e=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];e.attribute&&(Mavo.Primitive.attributes[t]=e.attribute),e.datatype&&(Mavo.Primitive.datatypes[t]=e.datatype),e.editor&&(Mavo.Primitive.editors[t]=e.editor),e.init&&Mavo.hooks.add("primitive-init-start",function(){this.element.matches(t)&&e.init.call(this,this.element)});var i=!0,n=!1,a=void 0;try{for(var r,o=Mavo.toArray(e.is)[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=r.value;Mavo.selectors[s]+=", "+t;
}}catch(u){n=!0,a=u}finally{try{!i&&o["return"]&&o["return"]()}finally{if(n)throw a}}},lazy:{formatNumber:function(){var t=new Intl.NumberFormat("en-US",{maximumFractionDigits:2});return function(e){return e===1/0||e===-(1/0)?e<0?"-∞":"∞":t.format(e)}}}}});i.attributes={"img, video, audio":"src","a, link":"href","select, input, textarea, meter, progress":"value","input[type=checkbox]":"checked",time:{value:"datetime",humanReadable:function(t){var e=new Date(t);if(!t||isNaN(e))return"(No "+this.label+")";var i={date:{day:"numeric",month:"short",year:"numeric"},month:{month:"long"},time:{hour:"numeric",minute:"numeric"},"datetime-local":{day:"numeric",month:"short",year:"numeric",hour:"numeric",minute:"numeric"}},n=i[this.editor&&this.editor.type]||i.date;return n.timeZone="UTC",e.toLocaleString("en-GB",n)}},meta:"content"},i.datatypes={"input[type=checkbox]":{checked:"boolean"},"input[type=range], input[type=number], meter, progress":{value:"number"}},i.editors={"*":{tag:"input"},".number":{
tag:"input",type:"number"},".boolean":{tag:"input",type:"checkbox"},"a, img, video, audio, .url":{tag:"input",type:"url",placeholder:"http://"},"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline":{create:function(){var e=getComputedStyle(this.element).display,i=0===e.indexOf("inline")?"input":"textarea",n=t.create(i);if("textarea"==i){var a=this.element.offsetWidth;a&&(n.width=a)}return n},setEditorValue:function(t){if("string"==this.datatype){var e=getComputedStyle(this.element);return t=t||"",["normal","nowrap"].indexOf(e.whiteSpace)>-1&&(t=t.replace(/\r?\n/g," ")),["normal","nowrap","pre-line"].indexOf(e.whiteSpace)>-1&&(t=t.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=t,!0}}},"meter, progress":function(){return t.create({tag:"input",type:"range",min:this.element.getAttribute("min")||0,max:this.element.getAttribute("max")||100})},"time, .date":function(){var e={date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i,month:/^[Y\d]{4}-[M\d]{2}$/i,
time:/^[H\d]{2}:[M\d]{2}/i,week:/[Y\d]{4}-W[W\d]{2}$/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[M\d]{2}/i},i=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var n in e)if(e[n].test(i))break;return t.create("input",{type:n})}},i.Popup=t.Class({constructor:function(e){var i=this;this.primitive=e,this.popup=t.create("div",{className:"mv-popup",hidden:!0,contents:[this.primitive.label+":",this.editor],events:{keyup:function(t){13!=t.keyCode&&27!=t.keyCode||(i.popup.contains(document.activeElement)&&i.element.focus(),t.stopPropagation(),i.hide())}}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var e=this;t.unbind([this.element,this.popup],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(t){e.popup.contains(t.target)||e.element.contains(t.target)||e.hide()},this.position=function(i){var n=e.element.getBoundingClientRect(),a=n.left,r=n.bottom;t.style(e.popup,{top:r+"px",left:a+"px"})},this.position(),
document.body.appendChild(this.popup),requestAnimationFrame(function(t){return e.popup.removeAttribute("hidden")}),t.events(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position)},hide:function(){var e=this;t.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position),this.popup.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){t.remove(e.popup)},1e3*parseFloat(getComputedStyle(this.popup).transitionDuration)||400),t.events(this.element,{"click.mavo:showpopup":function(t){e.show()},"keyup.mavo:showpopup":function(t){[13,113].indexOf(t.keyCode)>-1&&(e.show(),e.editor.focus())}})},close:function(){this.hide(),t.unbind(this.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive",element:"primitive"}})}(Bliss,Bliss.$),Mavo.Primitive.register("button, .counter",{attribute:"data-clicked",datatype:"number",is:"formControl",init:function(t){"data-clicked"===this.attribute&&(t.setAttribute("data-clicked","0"),
t.addEventListener("click",function(e){var i=+t.getAttribute("data-clicked")||0;t.setAttribute("data-clicked",i+1)}))}});
"use strict";Mavo.Primitive.editors.img={create:function(){var e=$.create("div",{className:"image-popup",events:{"dragenter dragover drop":function(e){e.stopPropagation(),e.preventDefault()},drop:function(e){$.value(e.dataTransfer,"files",0)}},contents:[{tag:"input",type:"url",className:"value"},{tag:"label",className:"upload",contents:["Upload: ",{tag:"input",type:"file",accept:"image/*",events:{change:function(e){var a=this.files[0]}}}]},{className:"tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste the image to be uploaded!"}]});return e}};
"use strict";!function(e,t){Mavo.Collection=e.Class({"extends":Mavo.Node,constructor:function(e,i,n){if(this.templateElement=this.element,this.items=[],!this.fromTemplate("properties","mutable","templateElement")){if(this.templateElement.matches("template")){var a=document.createElement(this.templateElement.getAttribute("data-tag")||"mv-group");a.classList.add("document-fragment"),t(this.templateElement.attributes).forEach(function(e){a.setAttribute(e.name,e.value)}),a.appendChild(document.importNode(this.templateElement.content,!0)),this.templateElement.parentNode.replaceChild(a,this.templateElement),this.element=this.templateElement=a}this.properties=t(Mavo.selectors.property,this.templateElement).map(Mavo.Node.getProperty),this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.templateElement=this.templateElement.cloneNode(!0)}if(this.mutable){var r=this.createItem(this.element);this.add(r),this.itemTemplate=r.template||r}Mavo.hooks.run("collection-init-end",this)},get length(){
return this.items.length},get containsTemplate(){return this.items.length&&this.items[0].element===this.element},getData:function(e){e=e||{};var t=[];return this.items.forEach(function(i){if(!i.deleted){var n=i.getData(e);n&&t.push(n)}}),!e.dirty&&this.unhandled&&(t=this.unhandled.before.concat(t,this.unhandled.after)),t},createItem:function(t){var i=this;t||(t=this.templateElement.cloneNode(!0));var n=Mavo.Unit.create(t,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type,dirty:!0});return Mavo.is("documentFragment",n.element)?n.element=new Mavo.Fragment(n.element):this.mutable&&this.mavo.permissions.can("edit",function(){e.create({className:"mv-item-controls mv-ui",contents:[{tag:"button",title:"Delete this "+i.name,className:"delete",events:{click:function(e){return i["delete"](n)}}},{tag:"button",title:"Add new "+i.name.replace(/s$/i,"")+" "+(i.bottomUp?"after":"before"),className:"add",events:{click:function(e){
return i.add(null,i.items.indexOf(n)).edit()}}}],inside:t})}),n},add:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];if(e=e instanceof Node?Mavo.Unit.get(e)||this.createItem(e):e||this.createItem(),t in this.items?this.bottomUp&&t++:t=this.bottomUp?0:this.length,!e.element.parentNode){var n=this.items[t];e.element._.before(n&&n.element||this.marker)}this.items.splice(t,0,e);for(var a=t-1;a<this.length;a++){var r=this.items[a];r&&(r.index=a,i.silent||r.element._.fire("mavo:datachange",{node:this,mavo:this.mavo,action:"add",item:r}))}return i.silent||(e.unsavedChanges=this.mavo.unsavedChanges=!0),e},propagate:function(){var e=arguments;this.items.forEach(function(t){return t.call.apply(t,e)})},"delete":function(t,i){var n=this;return i?(e.remove(t.element),void this.items.splice(this.items.indexOf(t),1)):e.transition(t.element,{opacity:0}).then(function(){t.deleted=!0,t.element.style.opacity="",t.element._.fire("mavo:datachange",{node:n,mavo:n.mavo,action:"delete",
item:t}),t.unsavedChanges=n.mavo.unsavedChanges=!0})},edit:function(){if(0===this.length&&this.required){var t=this.add(null,null,!0);t.placeholder=!0,t.walk(function(e){return e.unsavedChanges=!1}),e.once(t.element,"mavo:datachange",function(e){t.unsavedChanges=!0,t.placeholder=!1})}this.propagate(function(e){return e[e.preEdit?"preEdit":"edit"]()})},clear:function(){this.mutable&&(this.propagate(function(e){if(e.element.remove)e.element.remove();else{var t=!0,i=!1,n=void 0;try{for(var a,r=e.element.childNodes[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){a.value}}catch(s){i=!0,n=s}finally{try{!t&&r["return"]&&r["return"]()}finally{if(i)throw n}}}}),this.items=[],this.marker._.fire("mavo:datachange",{node:this,mavo:this.mavo,action:"clear"}))},save:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=this.items[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;r.deleted?this["delete"](r,!0):r.unsavedChanges=r.dirty=!1}}catch(s){t=!0,i=s}finally{try{!e&&a["return"]&&a["return"]();
}finally{if(t)throw i}}},done:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=this.items[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;if(r.placeholder)return void this["delete"](r,!0)}}catch(s){t=!0,i=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw i}}},propagated:["save","done"],revert:function(){var e=!0,t=!1,i=void 0;try{for(var n,a=this.items[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var r=n.value;r.unsavedChanges&&!r.placeholder?this["delete"](r,!0):(r.deleted&&(r.deleted=!1),r.revert())}}catch(s){t=!0,i=s}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw i}}},render:function(e){var t=this;if(this.unhandled={before:[],after:[]},e){if(e=Mavo.toArray(e),this.mutable){this.clear();var i=document.createDocumentFragment();e.forEach(function(e,n){var a=t.createItem();a.render(e),t.items.push(a),a.index=n,i.appendChild(a.element)}),this.marker.parentNode.insertBefore(i,this.marker)}else this.items.forEach(function(t,i){return t.render(e&&e[i]);
}),e&&(this.unhandled.after=e.slice(this.items.length));this.save()}},find:function(e){var t=this.items.filter(function(e){return!e.deleted});if(this.property==e)return t;if(this.properties.indexOf(e)>-1){var i=t.map(function(t){return t.find(e)});return Mavo.flatten(i)}},live:{mutable:function(t){if(t&&t!==this.mutable&&(this._mutable=t,this.mavo.needsEdit=!0,this.required=this.templateElement.matches(Mavo.selectors.required),this.marker=e.create("div",{hidden:!0,className:"mv-marker",after:this.templateElement}),this.templateElement.classList.add("mv-item"),!this.addButton.parentNode))if(this.bottomUp)this.addButton._.before(e.value(this.items[0],"element")||this.marker);else{var i=this.element.tagName.toLowerCase(),n=Mavo.selectors.container[i];if(n)var a=this.marker.closest(n);this.addButton._.after(a&&a.parentNode?a:this.marker)}}},lazy:{bottomUp:function(){if(!this.mutable)return!1;var e=this.templateElement.getAttribute("data-order");return null!==e?/^desc\b/i.test(e):!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.templateElement)&Node.DOCUMENT_POSITION_FOLLOWING);
},closestCollection:function(){var e=this.marker?this.marker.parentNode:this.templateElement.parentNode;return e.closest(Mavo.selectors.item)},addButton:function(){var i=this,n="button.add-"+this.property,a=this.closestCollection||this.marker.closest(Mavo.selectors.scope);if(a)var r=t(n,a).filter(function(e){return!i.templateElement.contains(e)})[0];return r||(r=e.create("button",{className:"add",textContent:"Add "+this.name})),r.classList.add("mv-ui","mv-add"),this.property&&r.classList.add("add-"+this.property),r.addEventListener("click",function(e){e.preventDefault(),i.add().edit()}),r}}});Mavo.Fragment=e.Class({constructor:function(e){this.childNodes=[];var t=!0,i=!1,n=void 0;try{for(var a,r=e.childNodes[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;this.appendChild(s)}}catch(o){i=!0,n=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(i)throw n}}},appendChild:function(e){this.childNodes.push(e)},classList:{toggle:function(){},add:function(){},remove:function(){},
contains:function(){}}})}(Bliss,Bliss.$);
"use strict";var prettyPrint=function(){var e={txt:function(e){return e+="",document.createTextNode(e)},row:function(t,n,r){r=r||"td";var i,o=e.count(t,null)+1,a=$.create("tr"),d={colSpan:o};return $$(t).forEach(function(t){null!==t&&(i=$.create(r,d),t.nodeType?i.appendChild(t):i.innerHTML=e.shorten(t.toString()),a.appendChild(i))}),a},hRow:function(t,n){return e.row(t,n,"th")},table:function(t,n){t=t||[];var r=$.create("table"),i=$.create("thead"),o=$.create("tbody");return r.classList.add(n),t.length&&(r.appendChild(i),i.appendChild(e.hRow(t,n))),r.appendChild(o),{node:r,tbody:o,thead:i,appendChild:function(e){this.tbody.appendChild(e)},addRow:function(t,r,i){return this.appendChild(e.row(t,r||n,i)),this}}},shorten:function(e){var t=40;return e=e.replace(/^\s\s*|\s\s*$|\n/g,""),e.length>t?e.substring(0,t-1)+"...":e},htmlentities:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},count:function n(e,t){for(var n=0,r=0,i=e.length;r<i;r++)e[r]===t&&n++;return n;
},thead:function(e){return e.getElementsByTagName("thead")[0]},within:function(e){return{is:function(t){for(var n in e)if(e[n]===t)return n;return""}}},common:{circRef:function(n,r,i){return e.expander("[POINTS BACK TO <strong>"+r+"</strong>]","Click to show this item anyway",function(){this.parentNode.appendChild(t(n,{maxDepth:1}))})},depthReached:function(n,r){return e.expander("[DEPTH REACHED]","Click to show this item anyway",function(){try{this.parentNode.appendChild(t(n,{maxDepth:1}))}catch(r){this.parentNode.appendChild(e.table(["ERROR OCCURED DURING OBJECT RETRIEVAL"],"error").addRow([r.message]).node)}})}},expander:function(t,n,r){return $.create("a",{innerHTML:e.shorten(t)+' <b style="visibility:hidden;">[+]</b>',title:n,onmouseover:function(){this.getElementsByTagName("b")[0].style.visibility="visible"},onmouseout:function(){this.getElementsByTagName("b")[0].style.visibility="hidden"},onclick:function(){return this.style.display="none",r.call(this),!1},style:{cursor:"pointer"
}})}},t=function r(t,n){n=n||{};var i=$.extend({},r.config,n),o=$.create("div"),a=(r.config,0),d={},c=!1;r.settings=i;var l={string:function(t){return e.txt('"'+e.shorten(t.replace(/"/g,'\\"'))+'"')},object:function(t,n,r){var o=e.within(d).is(t);if(o)return e.common.circRef(t,o,i);if(d[r||"TOP"]=t,n===i.maxDepth)return e.common.depthReached(t,i);var a=e.table(["Group",null],"object"),u=!0;for(var s in t)if(!t.hasOwnProperty||t.hasOwnProperty(s)){var h=t[s],p=$.type(h);u=!1;try{a.addRow([s,l[p](h,n+1,s)],p)}catch(f){window.console&&window.console.log&&console.log(f.message)}}var m=i.expanded||c?a.node:e.expander(JSON.stringify(t),"Click to show more",function(){this.parentNode.appendChild(a.node)});return c=!0,m},array:function(t,n,r,o){var a=e.within(d).is(t);if(a)return e.common.circRef(t,a);if(d[r||"TOP"]=t,n===i.maxDepth)return e.common.depthReached(t);var c=e.table(["List ("+t.length+" items)",null],"list"),u=!0,s=0;return $$(t).forEach(function(e,r){return i.maxArray>=0&&++s>i.maxArray?(c.addRow([r+".."+(t.length-1),l[$.type(e)]("...",n+1,r)]),
!1):(u=!1,void c.addRow([r,l[$.type(e)](e,n+1,r)]))}),i.expanded?c.node:e.expander(JSON.stringify(t),"Click to show more",function(){this.parentNode.appendChild(c.node)})},date:function(t){var n=e.table(["Date",null],"date"),r=t.toString().split(/\s/);return n.addRow(["Time",r[4]]).addRow(["Date",r.slice(0,4).join("-")]),i.expanded?n.node:e.expander("Date (timestamp): "+ +t,"Click to see a little more info about this date",function(){this.parentNode.appendChild(n.node)})}};return l.number=l["boolean"]=l.undefined=l["null"]=l["default"]=function(t){return e.txt(t)},o.appendChild(l[$.type(t)](t,a)),o};return t.config={expanded:!0,maxDepth:10,maxArray:-1},t}();
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function($,$$){var _=Mavo.Debug={friendlyError:function(e,t){var n=e.constructor.name.replace(/Error$/,"").toLowerCase(),o=e.message;return o=o.replace(/\s+token\s+/g," "),"Unexpected }"!=o||/[{}]/.test(t)?"Unexpected )"===o?o="Missing a (":"Invalid left-hand side in assignment"===o?o="Invalid assignment. Maybe you typed = instead of == ?":"Unexpected ILLEGAL"==o&&(o="There is an invalid character somewhere."):o="Missing a )",'<span class="type">Oh noes, a '+n+" error!</span> "+o},elementLabel:function(e,t){var n=e.nodeName.toLowerCase();return e.hasAttribute("property")?n+="[property="+e.getAttribute("property")+"]":e.id?n+="#"+e.id:e.classList.length&&(n+=$$(e.classList).map(function(e){return"."+e}).join("")),t&&(n+="@"+t),n},printValue:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))||null===e?"string"==typeof e?'"'+e+'"':e+"":Array.isArray(e)?e.length>0?"object"===_typeof(e[0])?"List: "+e.length+" group(s)":"List: "+e.map(_.printValue).join(", "):"List: (Empty)":e.constructor===Object?"Group with "+Object.keys(e).length+" properties":e instanceof Mavo.Primitive?_.printValue(e.value):e instanceof Mavo.Collection?e.items.length>0?e.items[0]instanceof Mavo.Scope?"List: "+e.items.length+" group(s)":"List: "+e.items.map(_.printValue).join(", "):_.printValue([]):e instanceof Mavo.Scope?"Group with "+Object.keys(e).length+" properties":void 0;
},timed:function(e,t){return function(){console.time(e),t.apply(this,arguments),console.timeEnd(e)}},time:function callee(objName,name){var obj=eval(objName),callback=obj[name];return obj[name]=function e(){var t=performance.now(),n=callback.apply(this,arguments);return e.timeTaken+=performance.now()-t,obj[name].calls++,n},obj[name].timeTaken=obj[name].calls=0,callee.all=callee.all||[],callee.all.push({obj:obj,objName:objName,name:name}),obj[name]},times:function(){_.time.all&&console.table(_.time.all.map(function(e){return{Function:e.objName+"."+e.name,"Time (ms)":e.obj[e.name].timeTaken,Calls:e.obj[e.name].calls}}))},reservedWords:"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield".split("|")};Mavo.prototype.render=_.timed("render",Mavo.prototype.render),
Mavo.selectors.debug=".debug";var selector=", .mv-debuginfo";Stretchy.selectors.filter+=selector,Mavo.hooks.add("init-tree-after",function(){if(this.root.debug&&this.wrapper.classList.add("debug-saving"),this.store&&this.wrapper.classList.contains("debug-saving")){var e;$.create("details",{className:"mv-debug-storage",contents:[{tag:"Summary",textContent:"Saved data"},e=$.create("pre",{id:this.id+"-debug-storage"})],after:this.wrapper});this.wrapper.addEventListener("mavo:save",function(t){e.innerHTML="",e.appendChild(prettyPrint(t.data))})}}),Mavo.hooks.add("render-start",function(e){var t=e.data;if(this.storage&&this.wrapper.classList.contains("debug-saving")){var n=$("#"+this.id+"-debug-storage");n&&(n.innerHTML="",t&&n.appendChild(prettyPrint(t)))}}),Mavo.hooks.add("scope-init-start",function(){this.debug=this.debug||this.walkUp(function(e){if(e.debug)return!0})||null!==Mavo.urlParam("debug"),!this.debug&&this.element.closest(Mavo.selectors.debug)&&(this.debug=!0),this.debug&&(this.debug=$.create("tbody",{
inside:$.create("table",{innerHTML:"<thead><tr>\n\t\t\t\t\t<th></th>\n\t\t\t\t\t<th>Expression</th>\n\t\t\t\t\t<th>Value</th>\n\t\t\t\t\t<th>Element</th>\n\t\t\t\t</tr></thead>",style:{display:"none"},inside:$.create("details",{className:"mv-ui mv-debuginfo",inside:this.element,contents:$.create("summary",{textContent:"Debug"}),"data-expressions":"none"})})}))},!0),Mavo.hooks.add("unit-init-end",function(){this.collection&&(this.debug=this.collection.debug)}),Mavo.hooks.add("expressions-init-start",function(){this.debug=this.scope.debug}),Mavo.hooks.add("expression-eval-beforeeval",function(){this.debug&&this.debug.classList.remove("error")}),Mavo.hooks.add("expression-eval-error",function(e){this.debug&&(this.debug.innerHTML=_.friendlyError(e.exception,e.expression),this.debug.classList.add("error"))}),Mavo.Scope.prototype.debugRow=function(e){var t=e.element,n=e.attribute,o=void 0===n?null:n,a=e.tds,s=void 0===a?[]:a;if(this.debug){this.debug.parentNode.style.display="";var r=s[0];if(s[0]=$.create("td",{
title:r}),!s[3]){var i=_.elementLabel(t,o);s[3]=$.create("td",{textContent:i,title:i,events:{"mouseenter mouseleave":function(e){t.classList.toggle("mv-highlight","mouseenter"===e.type)},click:function(e){t.scrollIntoView({behavior:"smooth"})}}})}s=s.map(function(e){return e instanceof Node?e:$.create("td","object"==("undefined"==typeof e?"undefined":_typeof(e))?e:{textContent:e})}),"Warning"==r&&s[1].setAttribute("colspan",2);$.create("tr",{className:"debug-"+r.toLowerCase(),contents:s,inside:this.debug})}},Mavo.hooks.add("expressiontext-init-end",function(){var e=this;this.scope.debug&&(this.debug={},this.template.forEach(function(t){t instanceof Mavo.Expression&&!e.element.matches(".mv-debuginfo *")&&e.scope.debugRow({element:e.element,attribute:e.attribute,tds:["Expression",{tag:"td",contents:{tag:"textarea",value:t.expression,events:{input:function(n){t.expression=n.target.value,e.update(e.data)}},once:{focus:function(e){return Stretchy.resize(e.target)}}}},t.debug=$.create("td")]});
}))}),Mavo.hooks.add("scope-init-end",function(){var e=this;if(this.debug instanceof Node){var t=Mavo.selectors.andNot(Mavo.selectors.multiple,Mavo.selectors.property);$$(t,this.element).forEach(function(t){e.debugRow({element:t,tds:["Warning","data-multiple without a property attribute"]})}),this.propagate(function(t){_.printValue(t);e.debugRow({element:t.element,tds:["Property",t.property,t.value]}),_.reservedWords.indexOf(t.property)>-1?e.debugRow({element:t.element,tds:["Warning",'You can’t use "'+t.property+'" as a property name, it’s a reserved word.']}):/^\d|[\W$]/.test(t.property)&&e.debugRow({element:t.element,tds:["Warning",{textContent:'You can’t use "'+t.property+'" as a property name.',title:"Property names can only contain letters, numbers and underscores and cannot start with a number."}]})}),this.scope.element.addEventListener("mavo:datachange",function(t){$$("tr.debug-property",e.debug).forEach(function(t){var n=t.cells[1].textContent,o=_.printValue(e.properties[n]);if(t.cells[2]){
var a=t.cells[2];a.textContent=a.title=o}})})}}),Mavo.hooks.add("expressiontext-update-beforeeval",function(e){this.debug&&(e.td=e.expr.debug,e.td&&e.td.classList.remove("error"))}),Mavo.hooks.add("expressiontext-update-aftereval",function(e){if(e.td&&!e.td.classList.contains("error")){var t=_.printValue(e.value);e.td.textContent=e.td.title=t}})}(Bliss,Bliss.$);
"use strict";!function(e){if(self.Mavo){var o="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js";Mavo.Storage.Backend.register(e.Class({"extends":Mavo.Storage.Backend,id:"Dropbox",constructor:function(){var t=this;this.url=new URL(this.url,location),"dropbox:"!=this.url.protocol&&(this.url.hostname="dl.dropboxusercontent.com",this.url.search=this.url.search.replace(/\bdl=0|^$/,"raw=1"),this.permissions.on("read")),this.permissions.on("login"),this.ready=e.include(self.Dropbox,o).then(function(){var o=new URL(document.referrer,location);return"www.dropbox.com"===o.hostname&&0===location.hash.indexOf("#access_token=")?(Dropbox.AuthDriver.Popup.oauthReceiver(),e.fire(window,"load"),void close()):(t.path=(t.storage.param("path")||"")+new URL(t.url).pathname.match(/[^\/]*$/)[0],t.key=t.storage.param("key")||"fle6gsc61w5v79j",void(t.client=new Dropbox.Client({key:t.key})))}).then(function(){t.login(!0)})},put:function(){var e=this,o=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0];
return new Promise(function(t,n){e.client.writeFile(o.name,o.dataString,function(e,i){return e?n(Error(e)):(console.log("File saved as revision "+i.versionTag),void t(o))})})},login:function(o){var t=this;return this.ready.then(function(){return t.client.isAuthenticated()?Promise.resolve():new Promise(function(e,n){t.client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:new URL(location)+""})),t.client.authenticate({interactive:!o},function(o,i){o&&n(Error(o)),t.client.isAuthenticated()?(t.permissions.on(["logout","edit"]),e()):(t.permissions.off(["logout","edit","add","delete"]),n())})})}).then(function(){t.client.getAccountInfo(function(o,n){o||e.fire(t.mavo.wrapper,"mavo:login",e.extend({backend:t},n))})})["catch"](function(){})},logout:function(){var e=this;return this.client.isAuthenticated()?new Promise(function(o,t){e.client.signOut(null,function(){e.permissions.off(["edit","add","delete"]).on("login"),e.mavo.wrapper._.fire("mavo:logout",{backend:e}),o()})}):Promise.resolve();
},"static":{test:function(e){return e=new URL(e,location),/dropbox.com/.test(e.host)||"dropbox:"===e.protocol}}}))}}(Bliss);
"use strict";!function(t){if(self.Mavo)var e=Mavo.Storage.Backend.register(t.Class({"extends":Mavo.Storage.Backend,id:"Github",constructor:function(){this.permissions.on("login"),this.key=this.storage.param("key")||"7e08e016048000bc594e",this.url=new URL(this.url,location),t.extend(this,e.parseURL(this.url)),this.repo=this.repo||"mv-data",this.branch=this.branch||"master",this.path=this.path||this.mavo.id+".json",this.permissions.on("read"),this.login(!0)},get authenticated(){return!!this.accessToken},req:function(e,n){var o=arguments.length<=2||void 0===arguments[2]?"GET":arguments[2],r=arguments.length<=3||void 0===arguments[3]?{method:o}:arguments[3];n&&(r.data=JSON.stringify(n));var s=t.extend(r,{responseType:"json"});return this.authenticated&&(s.headers={Authorization:"token "+this.accessToken}),t.fetch("https://api.github.com/"+e,s)["catch"](function(t){return t&&t.xhr?Promise.reject(t.xhr):(console.error(t),void console.log(t.stack))}).then(function(t){return Promise.resolve(t.response);
})},get:function(){return this.req("repos/"+this.username+"/"+this.repo+"/contents/"+this.path).then(function(t){return Promise.resolve(e.atob(t.content))})},put:function(){var t=this,n=arguments.length<=0||void 0===arguments[0]?this.getFile():arguments[0],o="repos/"+this.username+"/"+this.repo+"/contents/"+n.path;return Promise.resolve(this.repoInfo||this.req("user/repos",{name:this.repo},"POST")).then(function(e){return t.repoInfo=e,t.req(o,{ref:t.branch})}).then(function(r){return t.req(o,{message:"Updated "+(n.name||"file"),content:e.btoa(n.dataString),branch:t.branch,sha:r.sha},"PUT")},function(r){if(404==r.status)return t.req(o,{message:"Created file",content:e.btoa(n.dataString),branch:t.branch},"PUT")}).then(function(t){return console.log("success"),n})},login:function(t){var e=this;return this.ready.then(function(){return e.authenticated?Promise.resolve():new Promise(function(n,o){if(t)e.accessToken=localStorage["mavo:githubtoken"],e.accessToken&&n(e.accessToken);else{var r={width:Math.min(1e3,innerWidth-100),
height:Math.min(800,innerHeight-100)};r.top=(innerHeight-r.height)/2+(screen.top||screenTop),r.left=(innerWidth-r.width)/2+(screen.left||screenLeft),e.authPopup=open("https://github.com/login/oauth/authorize?client_id="+e.key+"&scope=repo,gist&state="+location.href,"popup","width="+r.width+",height="+r.height+",left="+r.left+",top="+r.top),addEventListener("message",function(t){t.source===e.authPopup&&(e.accessToken=localStorage["mavo:githubtoken"]=t.data,e.accessToken||o(Error("Authentication error")),n(e.accessToken))})}}).then(function(){return e.getUser()})["catch"](function(t){401==t.status&&e.logout()}).then(function(t){if(e.user)return e.permissions.on("logout"),e.req("repos/"+e.username+"/"+e.repo).then(function(t){e.repoInfo=t,t.permissions.push&&e.permissions.on(["edit","save"])})["catch"](function(t){404==t.status&&e.user.login.toLowerCase()==e.username.toLowerCase()&&e.permissions.on(["edit","save"])})})})},logout:function(){return this.authenticated&&(localStorage.removeItem("mavo:githubtoken"),
delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),this.mavo.wrapper._.fire("mavo:logout",{backend:this})),Promise.resolve()},getUser:function(){var e=this;return this.req("user").then(function(n){e.user=n;var o=n.name||n.login;t.fire(e.mavo.wrapper,"mavo:login",{backend:e,name:'<a href="https://github.com/'+n.login+'" target="_blank">\n\t\t\t\t\t\t\t<img class="avatar" src="'+n.avatar_url+'" /> '+o+"\n\t\t\t\t\t\t</a>"})})},"static":{test:function(t){return t=new URL(t,location),/\bgithub.(com|io)|raw.githubusercontent.com/.test(t.host)},parseURL:function(t){var e={};t=new URL(t,location);var n=t.pathname.slice(1).split("/");if(/github.io$/.test(t.host)){if(e.username=t.host.match(/([\w-]+)\.github\.io$/)[1],1==n.length)return e.repo=t.host,e.path=n[0],e.branch="master",e;e.branch="gh-pages"}else e.username=n.shift();return e.repo=n.shift(),/raw.githubusercontent.com$/.test(t.host)?e.branch=n.shift():/github.com$/.test(t.host)&&"blob"==n[0]&&(n.shift(),
e.branch=n.shift()),e.path=n.join("/"),e},btoa:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return btoa(unescape(encodeURIComponent(t)))}),atob:function(t){return decodeURIComponent(escape(window.atob(t)))}}}))}(Bliss);
//# sourceMappingURL=maps/mavo.min.js.map
