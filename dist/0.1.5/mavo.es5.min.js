!function(){"use strict";function t(e,n,i){return n=void 0===n?1:n,i=i||n+1,i-n<=1?function(){if(arguments.length<=n||"string"===r.type(arguments[n]))return e.apply(this,arguments);var t,i=arguments[n];for(var o in i){var s=Array.prototype.slice.call(arguments);s.splice(n,1,o,i[o]),t=e.apply(this,s)}return t}:t(t(e,n+1,i),n,i-1)}function e(t,r,i){var o=n(i);if("string"===o){var s=Object.getOwnPropertyDescriptor(r,i);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?t[i]=r[i]:(delete t[i],Object.defineProperty(t,i,s))}else if("array"===o)i.forEach(function(n){n in r&&e(t,r,n)});else for(var a in r)i&&("regexp"===o&&!i.test(a)||"function"===o&&!i.call(r,a))||e(t,r,a);return t}function n(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var r=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:"string"===r.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(r,{extend:e,overload:t,type:n,property:r.property||"_",listeners:self.WeakMap?new WeakMap:new Map,original:{addEventListener:(self.EventTarget||Node).prototype.addEventListener,removeEventListener:(self.EventTarget||Node).prototype.removeEventListener},sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.prototype.slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?r.set(t,e):(1===arguments.length&&("string"===r.type(t)?e={}:(e=t,t=e.tag,e=r.extend({},e,function(t){return"tag"!==t}))),r.set(document.createElement(t||"div"),e))},each:function(t,e,n){n=n||{};for(var r in t)n[r]=e.call(t,r,t[r]);return n},ready:function(t,e,n){if("function"!=typeof t||e||(e=t,t=void 0),t=t||document,e&&("loading"!==t.readyState?e():r.once(t,"DOMContentLoaded",function(){e()})),!n)return new Promise(function(e){r.ready(t,e,!0)})},Class:function(t){var e,n=["constructor","extends","abstract","static"].concat(Object.keys(r.classProps)),i=t.hasOwnProperty("constructor")?t.constructor:r.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error("Abstract classes cannot be directly instantiated.");e["super"]&&e["super"].apply(this,arguments),i.apply(this,arguments)},e["super"]=t["extends"]||null,e.prototype=r.extend(Object.create(e["super"]?e["super"].prototype:Object),{constructor:e}),e.prototype["super"]=e["super"]?e["super"].prototype:null,e.__abstract=!!t["abstract"]);var o=function(t){return this.hasOwnProperty(t)&&n.indexOf(t)===-1};if(t["static"]){r.extend(e,t["static"],o);for(var s in r.classProps)s in t["static"]&&r.classProps[s](e,t["static"][s])}r.extend(e.prototype,t,o);for(var s in r.classProps)s in t&&r.classProps[s](e.prototype,t[s]);return e},classProps:{lazy:t(function(t,e,n){return Object.defineProperty(t,e,{get:function(){var t=n.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return"function"===r.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],r=n.get&&n.get.call(this,t);return void 0!==r?r:t},set:function(t){var r=this["_"+e],i=n.set&&n.set.call(this,t,r);this["_"+e]=void 0!==i?i:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],n=document.createElement("script");return e?Promise.resolve():new Promise(function(e,i){r.set(n,{async:!0,onload:function(){e(),n.parentNode&&n.parentNode.removeChild(n)},onerror:function(){i()},src:t,inside:document.head})})},fetch:function(t,n){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var i=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);i.method=i.method.toUpperCase(),r.hooks.run("fetch-args",i),"GET"===i.method&&i.data&&(i.url.search+=i.data),document.body.setAttribute("data-loading",i.url),i.xhr.open(i.method,i.url.href,i.async!==!1,i.user,i.password);for(var o in n)if("upload"===o)i.xhr.upload&&"object"==typeof n[o]&&r.extend(i.xhr.upload,n[o]);else if(o in i.xhr)try{i.xhr[o]=n[o]}catch(s){self.console&&console.error(s)}var a=Object.keys(i.headers).map(function(t){return t.toLowerCase()});"GET"!==i.method&&a.indexOf("content-type")===-1&&i.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var c in i.headers)void 0!==i.headers[c]&&i.xhr.setRequestHeader(c,i.headers[c]);var u=new Promise(function(t,e){i.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===i.xhr.status||i.xhr.status>=200&&i.xhr.status<300||304===i.xhr.status?t(i.xhr):e(r.extend(Error(i.xhr.statusText),{xhr:i.xhr,get status(){return this.xhr.status}}))},i.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Error"),{xhr:i.xhr}))},i.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Timeout"),{xhr:i.xhr}))},i.xhr.send("GET"===i.method?null:i.data)});return u.xhr=i.xhr,u},value:function(t){var e="string"!==r.type(t);return r.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),r.Hooks=new r.Class({add:function(t,e,n){if("string"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],e&&this[t][n?"unshift":"push"](e)},this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),r.hooks=new r.Hooks;r.property;r.Element=function(t){this.subject=t,this.data={},this.bliss={}},r.Element.prototype={set:t(function(t,e){t in r.setProps?r.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(n,i){if("transition"in this.style){var o=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),r.once(this,"transitionend",function(){clearTimeout(s),r.style(this,o),n(this)});var s=setTimeout(n,e+50,this);r.style(this,t)}else r.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),this.dispatchEvent(r.extend(n,e))},bind:t(function(t,e){if(arguments.length>1&&("function"===r.type(e)||e.handleEvent)){var n=e;e="object"===r.type(arguments[2])?arguments[2]:{capture:!!arguments[2]},e.callback=n}var i=r.listeners.get(this)||{};t.trim().split(/\s+/).forEach(function(t){if(t.indexOf(".")>-1){t=t.split(".");var n=t[1];t=t[0]}i[t]=i[t]||[],0===i[t].filter(function(t){return t.callback===e.callback&&t.capture==e.capture}).length&&i[t].push(r.extend({className:n},e)),r.original.addEventListener.call(this,t,e.callback,e)},this),r.listeners.set(this,i)},0),unbind:t(function(t,e){if(e&&("function"===r.type(e)||e.handleEvent)){var n=e;e=arguments[2]}"boolean"==r.type(e)&&(e={capture:e}),e=e||{},e.callback=e.callback||n;var i=r.listeners.get(this);(t||"").trim().split(/\s+/).forEach(function(t){if(t.indexOf(".")>-1){t=t.split(".");var n=t[1];t=t[0]}if(t&&e.callback)return r.original.removeEventListener.call(this,t,e.callback,e.capture);if(i)for(var o in i)if(!t||o===t)for(var s,a=0;s=i[o][a];a++)n&&n!==s.className||e.callback&&e.callback!==s.callback||!!e.capture!=!!s.capture||(i[o].splice(a,1),r.original.removeEventListener.call(this,o,s.callback,s.capture),a--)},this)},0)},r.setProps={style:function(t){for(var e in t)e in this.style?this.style[e]=t[e]:this.style.setProperty(e,t[e])},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){r.extend(this,t)},events:function(t){if(1!=arguments.length||!t||!t.addEventListener)return r.bind.apply(this,[this].concat(r.$(arguments)));var e=this;if(r.listeners){var n=r.listeners.get(t);for(var i in n)n[i].forEach(function(t){r.bind(e,i,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])},once:t(function(t,e){var n=this,i=function(){return r.unbind(n,t,i),e.apply(n,arguments)};r.bind(this,t,i,{once:!0})},0),delegate:t(function(t,e,n){r.bind(this,t,function(t){t.target.closest(e)&&n.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=r.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=r.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t&&t.appendChild(this)},before:function(t){t&&t.parentNode.insertBefore(this,t)},after:function(t){t&&t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t&&t.insertBefore(this,t.firstChild)},around:function(t){t&&t.parentNode&&r.before(this,t),this.appendChild(t)}},r.Array=function(t){this.subject=t},r.Array.prototype={all:function(t){var e=r.$(arguments).slice(1);return this[t].apply(this,e)}},r.add=t(function(t,e,n,i){n=r.extend({$:!0,element:!0,array:!0},n),"function"==r.type(e)&&(!n.element||t in r.Element.prototype&&i||(r.Element.prototype[t]=function(){return this.subject&&r.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in r.Array.prototype&&i||(r.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&r.defined(e.apply(n,t),n)})}),n.$&&(r.sources[t]=r[t]=e,(n.array||n.element)&&(r[t]=function(){var e=[].slice.apply(arguments),i=e.shift(),o=n.array&&Array.isArray(i)?"Array":"Element";return r[o].prototype[t].apply({subject:i},e)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement("_");r.add(r.extend({},HTMLElement.prototype,function(t){return"function"===r.type(i[t])}),null,!0)}();
/* jsep v0.3.2 (http://jsep.from.so/) */
!function(e){"use strict";var r=function(e,r){var t=new Error(e+" at character "+r);throw t.index=r,t.description=e,t},t={"-":!0,"!":!0,"~":!0,"+":!0},n={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(e){var r,t=0;for(var n in e)(r=n.length)>t&&e.hasOwnProperty(n)&&(t=r);return t},i=o(t),a=o(n),u={true:!0,false:!1,null:null},s=function(e){return n[e]||0},p=function(e,r,t){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:r,right:t}},f=function(e){return e>=48&&e<=57},c=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!n[String.fromCharCode(e)]},l=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!n[String.fromCharCode(e)]},d=function(e){for(var o,d,h=0,v=e.charAt,x=e.charCodeAt,y=function(r){return v.call(e,r)},m=function(r){return x.call(e,r)},b=e.length,E=function(){for(var e=m(h);32===e||9===e||10===e||13===e;)e=m(++h)},g=function(){var e,t,n=w();return E(),63!==m(h)?n:(h++,(e=g())||r("Expected expression",h),E(),58===m(h)?(h++,(t=g())||r("Expected expression",h),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void r("Expected :",h))},C=function(){E();for(var r=e.substr(h,a),t=r.length;t>0;){if(n.hasOwnProperty(r))return h+=t,r;r=r.substr(0,--t)}return!1},w=function(){var e,t,n,o,i,a,u,f;if(a=O(),!(t=C()))return a;for(i={value:t,prec:s(t)},(u=O())||r("Expected expression after "+t,h),o=[a,i,u];(t=C())&&0!==(n=s(t));){for(i={value:t,prec:n};o.length>2&&n<=o[o.length-2].prec;)u=o.pop(),t=o.pop().value,a=o.pop(),e=p(t,a,u),o.push(e);(e=O())||r("Expected expression after "+t,h),o.push(i,e)}for(e=o[f=o.length-1];f>1;)e=p(o[f-1].value,o[f-2],e),f-=2;return e},O=function(){var r,n,o;if(E(),r=m(h),f(r)||46===r)return U();if(39===r||34===r)return k();if(91===r)return S();for(o=(n=e.substr(h,i)).length;o>0;){if(t.hasOwnProperty(n))return h+=o,{type:"UnaryExpression",operator:n,argument:O(),prefix:!0};n=n.substr(0,--o)}return!(!c(r)&&40!==r)&&A()},U=function(){for(var e,t,n="";f(m(h));)n+=y(h++);if(46===m(h))for(n+=y(h++);f(m(h));)n+=y(h++);if("e"===(e=y(h))||"E"===e){for(n+=y(h++),"+"!==(e=y(h))&&"-"!==e||(n+=y(h++));f(m(h));)n+=y(h++);f(m(h-1))||r("Expected exponent ("+n+y(h)+")",h)}return t=m(h),c(t)?r("Variable names cannot start with a number ("+n+y(h)+")",h):46===t&&r("Unexpected period",h),{type:"Literal",value:parseFloat(n),raw:n}},k=function(){for(var e,t="",n=y(h++),o=!1;h<b;){if((e=y(h++))===n){o=!0;break}if("\\"===e)switch(e=y(h++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return o||r('Unclosed quote after "'+t+'"',h),{type:"Literal",value:t,raw:n+t+n}},L=function(){var t,n=m(h),o=h;for(c(n)?h++:r("Unexpected "+y(h),h);h<b&&(n=m(h),l(n));)h++;return t=e.slice(o,h),u.hasOwnProperty(t)?{type:"Literal",value:u[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},j=function(e){for(var t,n,o=[],i=!1;h<b;){if(E(),(t=m(h))===e){i=!0,h++;break}44===t?h++:((n=g())&&"Compound"!==n.type||r("Expected comma",h),o.push(n))}return i||r("Expected "+String.fromCharCode(e),h),o},A=function(){var e,t;for(t=40===(e=m(h))?P():L(),E(),e=m(h);46===e||91===e||40===e;)h++,46===e?(E(),t={type:"MemberExpression",computed:!1,object:t,property:L()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:g()},E(),93!==(e=m(h))&&r("Unclosed [",h),h++):40===e&&(t={type:"CallExpression",arguments:j(41),callee:t}),E(),e=m(h);return t},P=function(){h++;var e=g();if(E(),41===m(h))return h++,e;r("Unclosed (",h)},S=function(){return h++,{type:"ArrayExpression",elements:j(93)}},B=[];h<b;)59===(o=m(h))||44===o?h++:(d=g())?B.push(d):h<b&&r('Unexpected "'+y(h)+'"',h);return 1===B.length?B[0]:{type:"Compound",body:B}};if(d.version="0.3.2",d.toString=function(){return"JavaScript Expression Parser (JSEP) v"+d.version},d.addUnaryOp=function(e){return i=Math.max(e.length,i),t[e]=!0,this},d.addBinaryOp=function(e,r){return a=Math.max(e.length,a),n[e]=r,this},d.addLiteral=function(e,r){return u[e]=r,this},d.removeUnaryOp=function(e){return delete t[e],e.length===i&&(i=o(t)),this},d.removeAllUnaryOps=function(){return t={},i=0,this},d.removeBinaryOp=function(e){return delete n[e],e.length===a&&(a=o(n)),this},d.removeAllBinaryOps=function(){return n={},a=0,this},d.removeLiteral=function(e){return delete u[e],this},d.removeAllLiterals=function(){return u={},this},"undefined"==typeof exports){var h=e.jsep;e.jsep=d,d.noConflict=function(){return e.jsep===d&&(e.jsep=h),d}}else"undefined"!=typeof module&&module.exports?exports=module.exports=d:exports.parse=d}(this);
//# sourceMappingURL=jsep.min.js.map
!function(){function e(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var t=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text number url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||e("script").pop(),resize:function(e){if(t.resizes(e)){var i,n=getComputedStyle(e),o=0;!e.value&&e.placeholder&&(i=!0,e.value=e.placeholder);var l=e.nodeName.toLowerCase();if("textarea"==l)e.style.height="0","border-box"==n.boxSizing?o=e.offsetHeight:"content-box"==n.boxSizing&&(o=-e.clientHeight+parseFloat(n.minHeight)),
e.style.height=e.scrollHeight+o+"px";else if("input"==l)if(e.style.width="1000px",e.offsetWidth){e.style.width="0","border-box"==n.boxSizing?o=e.offsetWidth:"padding-box"==n.boxSizing?o=e.clientWidth:"content-box"==n.boxSizing&&(o=parseFloat(n.minWidth));var r=Math.max(o,e.scrollWidth-e.clientWidth);e.style.width=r+"px";for(var s=0;s<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);s++)r+=e.scrollLeft,e.style.width=r+"px"}else e.style.width=e.value.length+1+"ch";else if("select"==l){var c=e.selectedIndex>0?e.selectedIndex:0,a=document.createElement("_");a.textContent=e.options[c].textContent,e.parentNode.insertBefore(a,e.nextSibling);var d;for(var h in n){var p=n[h];/^(width|webkitLogicalWidth|length)$/.test(h)||"string"!=typeof p||(a.style[h]=p,/appearance$/i.test(h)&&(d=h))}a.style.width="",a.offsetWidth>0&&(e.style.width=a.offsetWidth+"px",n[d]&&"none"===n[d]||(e.style.width="calc("+e.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}i&&(e.value="")}},resizeAll:function(i){
e(i||t.selectors.base).forEach(function(e){t.resize(e)})},active:!0,resizes:function(e){return e&&e.parentNode&&e.matches&&e.matches(t.selectors.base)&&e.matches(t.selectors.filter)},init:function(){t.selectors.filter=t.script.getAttribute("data-filter")||(e("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",t.resizeAll()},$$:e};"loading"!==document.readyState?t.init():document.addEventListener("DOMContentLoaded",t.init);var i=function(e){t.active&&t.resize(e.target)};document.documentElement.addEventListener("input",i),document.documentElement.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(e){t.active&&e.forEach(function(e){"childList"==e.type&&Stretchy.resizeAll(e.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}();
//# sourceMappingURL=stretchy.min.js.map

"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=self.Mavo=a.Class({constructor:function(d){var e=this;this.treeBuilt=Mavo.defer(),this.dataLoaded=Mavo.defer(),this.element=d,this.inProgress=!1,this.index=Object.keys(c.all).length+1,Object.defineProperty(c.all,this.index-1,{value:this});var f=c.attributes.map(function(a){return"[data-"+a+"]"}).join(", ");if([this.element].concat(_toConsumableArray(b(f,this.element))).forEach(function(a){c.attributes.forEach(function(b){var c=a.getAttribute("data-"+b);null!==c&&a.setAttribute(b,c)})}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index,this.id in c.all){for(var g=2;this.id+g in c.all;g++);this.id+=g}c.all[this.id]=this,this.element.setAttribute("mv-app",this.id);var h=a.value(this.element.closest("[lang]"),"lang")||Mavo.locale;this.locale=Mavo.Locale.get(h),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||3),this.element.setAttribute("typeof",""),Mavo.hooks.run("init-start",this),b(c.selectors.primitive+","+c.selectors.multiple,this.element).forEach(function(b){var d=a(c.selectors.not(c.selectors.formControl)+", "+c.selectors.property,b);if(d){var e=Mavo.Primitive.getConfig(b),f=Mavo.is("multiple",b);!f&&(e.attribute||e.hasChildren)||b.setAttribute("typeof","")}}),this.expressions=new Mavo.Expressions(this),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var i=["source","storage","init"];i.forEach(function(a){return e.updateBackend(a)}),this.backendObserver=new Mavo.Observer(this.element,i.map(function(a){return"mv-"+a}),function(a){var b={},c=a.map(function(a){var c=a.attributeName.replace(/^mv-/,"");return b[c]=e.updateBackend(c),c});b.source?e.load():!e.source&&(b.storage||b.init&&!e.root.data)&&e.load()}),this.permissions.can("login",function(){(null!==Mavo.Functions.url("login")&&1==e.index||null!==Mavo.Functions.url(e.id+"-login"))&&e.primaryBackend.login()}),a.bind(this.element,"mv-login.mavo",function(a){a.backend!=(e.source||e.storage)||e.root.data||e.unsavedChanges||e.load()}),this.bar=new Mavo.UI.Bar(this),a("summary [property]:not([typeof])")&&this.element.addEventListener("click",function(a){a.target!=document.activeElement&&a.preventDefault()}),this.needsEdit=this.calculateNeedsEdit(),this.setUnsavedChanges(!1),this.permissions.onchange(function(a){var b=a.action,c=a.value,d=e.element.getAttribute("mv-permissions")||"";d=d.trim().split(/\s+/).filter(function(c){return c!=b}),c&&d.push(b),e.element.setAttribute("mv-permissions",d.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],function(){e.modeObserver=new Mavo.Observer(e.element,"mv-mode",function(a){a.forEach(function(a){var b=a.target,d=c.Node.children(b);nodeloop:for(var e=0;e<d.length;e++){var f=d[e],g=f.mode,h=void 0;if(f.element==b)h=f.element.getAttribute("mv-mode"),f.modes=h;else{if(f.modes)continue nodeloop;h=c.getStyle(f.element.parentNode,"--mv-mode")}f.mode=h,g!=f.mode&&f["edit"==f.mode?"edit":"done"]()}})},{subtree:!0}),e.autoEdit&&e.edit()},function(){e.modeObserver&&e.modeObserver.destroy()}),this.storage||this.source?this.permissions.can("read",function(){return e.load()}):requestAnimationFrame(function(){e.dataLoaded.resolve(),a.fire(e.element,"mv-load")}),location.hash&&a.bind(this.element,"mv-load.mavo",function(){var a=function(){var a=document.getElementById(location.hash.slice(1));return(a||!location.hash)&&(e.element.contains(a)&&requestAnimationFrame(function(){Mavo.scrollIntoViewIfNeeded(a)}),b&&(b.destroy(),b=null)),a};if(!a())var b=new Mavo.Observer(e.element,"id",a,{subtree:!0})}),this.autoSave&&this.dataLoaded.then(function(){var b=c.debounce(function(){e.save()},e.autoSaveDelay),d=function(a){a.node.saved&&b()};requestAnimationFrame(function(){e.permissions.can("save",function(){a.bind(e.element,"mv-change.mavo:autosave",d)},function(){a.unbind(e.element,"mv-change.mavo:autosave",d)})})}),this.element.addEventListener("keydown",function(a){if(e.permissions.save&&83==a.keyCode&&a[c.superKey]&&!a.altKey)a.preventDefault(),e.save();else if(38==a.keyCode||40==a.keyCode){var b=a.target;if(b.matches("textarea, input[type=range], input[type=number]"))return;if(b.matches(".mv-editor")){b=b.parentNode}var d=Mavo.Node.get(b);if(d&&d.closestCollection){var f=d.getCousin(38==a.keyCode?-1:1,{wrap:!0});f&&(f.editing?f.edit({immediately:!0}).then(function(){return f.editor.focus()}):f.element.focus(),a.preventDefault())}}}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(a){return this.root.getData(a)},toJSON:function(){return c.toJSON(this.getData())},message:function(a,b){return new c.UI.Message(this,a,b)},error:function(a){this.message(a,{type:"error",dismiss:["button","timeout"]});for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(0<c.length){var e;(e=console).log.apply(e,["%c"+this.id+": "+a,"color: red; font-weight: bold"].concat(c))}},render:function(a){var b=this;this.expressions.active=!1;var d={context:this,data:a};c.hooks.run("render-start",d),d.data&&this.root.render(d.data),this.unsavedChanges=!1,this.expressions.active=!0,requestAnimationFrame(function(){return b.expressions.update()}),c.hooks.run("render-end",d)},edit:function(){this.root.edit(),a.bind(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",function(a){if(a.target.matches(c.selectors.multiple)){a.target.classList.remove("mv-has-hovered-item");var b=a.target.parentNode.closest(c.selectors.multiple);b&&b.classList.toggle("mv-has-hovered-item","mouseenter"==a.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(a){var b=!!a;return a||this.walk(function(c){if(c.unsavedChanges)return b=!0,!1===a&&(c.unsavedChanges=!1),!1}),this.unsavedChanges=b},done:function(){this.root.done(),a.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},updateBackend:function(a){var b,d=this[a];1==this.index&&(b=c.Functions.url(a)),b||(b=c.Functions.url(this.id+"-"+a)||this.element.getAttribute("mv-"+a)||null),b&&(b=b.trim(),"none"==b&&(b=null)),!b||d&&d.equals(b)?!b&&(this[a]=null):this[a]=b=c.Backend.create(b,{mavo:this,format:this.element.getAttribute("mv-"+a+"-format")||this.element.getAttribute("mv-format")},this.element.getAttribute("mv-"+a+"-type"));var e=b?!b.equals(d):!!d;if(e){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);var f=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});f.parent=this.source&&this.source.permissions,this.permissions.parent=f,this.primaryBackend=this.storage||this.source}return e},load:function(){var b=this,c=this.source||this.storage;return c?(this.inProgress="Loading",c.ready.then(function(){return c.load()}).catch(function(a){return b.init&&b.init!=c?(c=b.init,b.init.ready.then(function(){return b.init.load()})):Promise.reject(a)}).catch(function(a){if(a){var c=a instanceof XMLHttpRequest?a:a.xhr;if(c&&404==c.status)b.render(null);else{var d=b._("problem-loading");c&&(d+=c.status?b._("http-error",a):": "+b._("cant-connect")),b.error(d,a)}}return null}).then(function(a){return b.render(a)}).then(function(){b.inProgress=!1,requestAnimationFrame(function(){b.dataLoaded.resolve(),a.fire(b.element,"mv-load")})})):Promise.resolve()},store:function(){var a=this;return this.storage?(this.inProgress="Saving",this.storage.store(this.getData()).catch(function(b){if(b){var c=a._("problem-saving");b instanceof XMLHttpRequest&&(c+=": "+(b.status?a._("http-error",b):a._("cant-connect"))),a.error(c,b)}return null}).then(function(b){return a.inProgress=!1,b})):Promise.resolve()},upload:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"images/"+a.name;return this.uploadBackend?(this.inProgress=this._("uploading"),this.uploadBackend.upload(a,c).then(function(a){return b.inProgress=!1,a}).catch(function(a){return b.error(b._("error-uploading"),a),b.inProgress=!1,null})):Promise.reject()},save:function(){var b=this;return this.store().then(function(c){c&&(a.fire(b.element,"mv-save",c),b.lastSaved=Date.now(),b.root.save(),b.unsavedChanges=!1)})},walk:function(){var a;return(a=this.root).walk.apply(a,arguments)},calculateNeedsEdit:function(){var a=!1;return this.walk(function(b){return!a&&(a=!b.modes&&"Group"!=b.nodeType,!b.modes)},void 0,{descentReturn:!0}),a},live:{inProgress:function(b){a.toggleAttribute(this.element,"mv-progress",b,b),a.toggleAttribute(this.element,"aria-busy",!!b,!!b),this.element.style.setProperty("--mv-progress-text",b?"\""+this._(b)+"\"":"")},unsavedChanges:function(a){this.element.classList.toggle("mv-unsaved-changes",a)},needsEdit:function(a){this.bar.toggle("edit",a&&this.permissions.edit)},storage:function(a){if(a!==this._storage&&!a){var b=new Mavo.Permissions({edit:!0,save:!1});b.parent=this.permissions.parent,this.permissions.parent=b}},primaryBackend:function(a){if(a=a||null,a!=this._primaryBackend)return a},uploadBackend:{get:function(){if(this.storage&&this.storage.upload)return this.storage}}},static:{version:"v0.1.5",all:{},get:function(a){if(a instanceof Element){for(var b in c.all)if(c.all[b].element==a)return c.all[b];return null}var b="number"==typeof a?Object.keys(c.all)[a]:a;return c.all[b]||null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",base:"about:"==location.protocol?document.currentScript?document.currentScript.src:"http://mavo.io":location,dependencies:[],init:function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:document,d=Array.isArray(arguments[0])?arguments[0]:b(c.selectors.init,a);return d.filter(function(a){return!c.get(a)}).map(function(a){return new c(a)})},UI:{},hooks:new a.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-multiple-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions","mv-rel","mv-value"],lazy:{locale:function(){return document.documentElement.lang||"en-GB"},toNode:function(){return Symbol("toNode")}}}});Object.defineProperty(c.all,"length",{get:function(){return Object.keys(this).length}});{var d=c.selectors={init:".mv-app, [mv-app], [data-mv-app]",property:"[property], [itemprop]",specificProperty:function(a){return"[property="+a+"], [itemprop="+a+"]"},group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",textInput:["text","email","url","tel","search"].map(function(a){return"input[type="+a+"]"}).join(", ")+", input:not([type]), textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},e=d.arr=function(a){return a.split(/\s*,\s*/g)},f=d.not=function(a){return e(a).map(function(a){return":not("+a+")"}).join("")},g=d.or=function(a,b){return a+", "+b},h=d.and=function(a,b){var c=[],d=e(b);return e(a).forEach(function(a){return c.push.apply(c,_toConsumableArray(d.map(function(b){return a+b})))}),c.join(", ")},i=d.andNot=function(a,b){return h(a,f(b))};a.extend(c.selectors,{primitive:i(d.property,d.group),rootGroup:i(d.group,d.property),item:g(d.multiple,d.group),output:g(d.specificProperty("output"),".mv-output")})}requestAnimationFrame(function(){var d=[];a.each({blissfuljs:Array.from&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype,"Intl.~locale.en":self.Intl,IntersectionObserver:self.IntersectionObserver,Symbol:self.Symbol,"Element.prototype.remove":Element.prototype.remove},function(a,b){b||d.push(a)});var e="https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features="+d.map(function(b){return b+"|gated"}).join(",");c.dependencies.push(a.ready().then(function(){return c.Plugins.load()}),a.include(!d.length,e)),c.inited=a.ready().then(function(){return a.attributes(b(c.selectors.init),{"mv-progress":"Loading"}),c.ready}).catch(console.error).then(function(){return Mavo.init()}),c.ready=c.thenAll(c.dependencies)}),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize",self.$=self.$||a,self.$$=self.$$||b})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){function c(){var a=d.getTarget(),c="mv-target-within";for(b("."+c).forEach(function(a){return a.classList.remove(c)});a&&a.classList;)a.classList.add(c),a=a.parentNode}var d=a.extend(Mavo,{load:function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.currentScript?document.currentScript.src:location;if(d.loaded=d.loaded||new Set,!d.loaded.has(b+""))return b=new URL(b,c),/\.css$/.test(b.pathname)?(a.create("link",{href:b,rel:"stylesheet",inside:document.head}),Promise.resolve()):a.include(b)},readFile:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"DataURL",c=new FileReader;return new Promise(function(d,e){c.onload=function(){return d(c.result)},c.onerror=c.onabort=e,c["readAs"+b](a)})},toJSON:function(a){return null===a?"":"string"==typeof a?a:JSON.stringify(a,null,"\t")},safeToJSON:function(a){var b=self.WeakSet?new WeakSet:new Set;return JSON.stringify(a,function(a,c){if("object"===("undefined"==typeof c?"undefined":_typeof(c))&&null!==c){if(b.has(c))return;b.add(c)}return c})},objectify:function(b,c){var d=Mavo.value(b);if("object"!==("undefined"==typeof b?"undefined":_typeof(b))||null===b){if(null===b){var e;b=(e={},_defineProperty(e,Symbol.toStringTag,"Null"),_defineProperty(e,"toJSON",function(){return null}),e)}else{var f=b.constructor;b=new f(d),b[Symbol.toStringTag]=f.name}b.valueOf=b[Symbol.toPrimitive]=function(){return d}}return a.extend(b,c)},value:function(a){return a&&a.valueOf?a.valueOf():a},toArray:function(a){return a===void 0?[]:Array.isArray(a)?a:[a]},delete:function(a,b,c){do{var d=a&&a.indexOf(b);-1<d&&a.splice(d,1)}while(-1<d&&c)},flatten:function(a){return Array.isArray(a)?a.reduce(function(a,b){return d.toArray(a).concat(d.flatten(b))},[]):[a]},pushUnique:function(a,b){-1===a.indexOf(b)&&a.push(b)},union:function(a,b){return new Set([].concat(_toConsumableArray(a||[]),_toConsumableArray(b||[])))},is:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];for(var f,g=0;g<c.length;g++)if(f=c[g],f&&f.matches&&f.matches(d.selectors[a]))return!0;return!1},getStyle:function(a,b){if(a){var c=getComputedStyle(a).getPropertyValue(b);if(c)return c.trim()}},data:function(a,b,c){var e,f=d.elementData.get(a)||{};return 2==arguments.length?e=f[b]:void 0===c?delete f[b]:e=f[b]=c,d.elementData.set(a,f),e},elementData:new WeakMap,elementPath:function(a,b){if(Array.isArray(b)){var c=b,d=c.reduce(function(a,b){return a.children[b>>0]||a},a),e=c[c.length-1];if(e!=e>>0){var f=+(e+"").split(".")[1];0>e>>0&&(d=d.firstChild,f--);for(var g=0;g<f;g++)d=d.nextSibling}return d}for(var c=[],h=b;h&&h!=a;h=h.parentNode){for(var i=0,j=h===b&&1!==b.nodeType,f=j?1:0,k=h;k=k["previous"+(j?"":"Element")+"Sibling"];)j?(f++,1==k.nodeType&&(j=!1)):i++;0<f&&(i=i-1+"."+f),c.unshift(i)}return h?c:null},revocably:{add:function(a,b){var c=d.revocably.isRemoved(a);return c&&c.parentNode?c.parentNode.replaceChild(a,c):a&&b&&!a.parentNode&&b.appendChild(a),c},remove:function(a,b){if(a){var c=d.data(a,"commentstub");return c||(b=b||a.id||a.className||a.nodeName,c=d.data(a,"commentstub",document.createComment(b))),a.parentNode&&a.parentNode.replaceChild(c,a),c}},isRemoved:function(a){if(!a||a.parentNode)return!1;var b=d.data(a,"commentstub");return b&&b.parentNode&&b},setAttribute:function(a,b,c){var e=d.data(a,"attribute-"+b);e===void 0&&d.data(a,"attribute-"+b,a.getAttribute(b)),a.setAttribute(b,c)},restoreAttribute:function(b,c){var e=d.data(b,"attribute-"+c);e!==void 0&&(a.toggleAttribute(b,c,e),d.data(b,"attribute-"+c,void 0))}},inView:{is:function(a){var b=a.getBoundingClientRect();return(0<=b.bottom&&b.bottom<=innerHeight||0<=b.top&&b.top<=innerHeight)&&(0<=b.right&&b.right<=innerWidth||0<=b.left&&b.left<=innerWidth)},when:function(b){var c=d.inView.observer=d.inView.observer||new IntersectionObserver(function(b){var c=this;b.forEach(function(b){c.unobserve(b.target),a.fire(b.target,"mv-inview",{entry:b})})});return new Promise(function(a){d.is(b)&&a(),c.observe(b);b.addEventListener("mv-inview",function c(d){b.removeEventListener("mv-inview",c),d.stopPropagation(),a()})})}},scrollIntoViewIfNeeded:function(a){a&&!Mavo.inView.is(a)&&a.scrollIntoView({behavior:"smooth"})},setAttributeShy:function(a,b,c){a.hasAttribute(b)||a.setAttribute(b,c)},getAttribute:function(a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];for(var e,f,g=0;e=c[g];g++)if(f=a.getAttribute(e),f)return f;return null},getTarget:function(){var a=location.hash.substr(1);return document.getElementById(a)},in:function(a,b){if(a)return"object"===("undefined"==typeof a?"undefined":_typeof(a))&&b in a||void 0!==a[b]},getCanonicalProperty:function(a,b){if(a&&(b||0===b)){if(d.in(a,b))return b;if(b.toLowerCase){var c=b.toLowerCase();if(d.in(a,c))return c;var e=Object.keys(a),f=e.map(function(a){return a.toLowerCase()}).indexOf(c);if(-1<f)return e[f]}}},subset:function(b,c,d){if(3==arguments.length){if(c.length){var e=c[c.length-1],f=a.value.apply(a,[b].concat(_toConsumableArray(c.slice(0,-1))));return Array.isArray(f)&&Array.isArray(d)?f.splice.apply(f,[e,1].concat(_toConsumableArray(d))):f[c[c.length-1]]=d,b}return d}return"object"==("undefined"==typeof b?"undefined":_typeof(b))&&c&&c.length?c.reduce(function(a,b,d){var e={},f=Mavo.Functions.get(a,b,e);return c[d]=Array.isArray(e.property)?e.property[0]:e.property,void 0===f&&e.query&&(f=_defineProperty({},e.query.property,e.query.value)),f},b):b},clone:function(a){return JSON.parse(d.safeToJSON(a))},debounce:function(a,b){if(!b)return a;var c,d=null;return function(){var e=this,f=arguments;c=function(){a.apply(e,f),removeEventListener("beforeunload",c)},clearTimeout(d),d=setTimeout(c,b),addEventListener("beforeunload",c)}},timeout:function(a){return new Promise(function(b){return setTimeout(b,a)})},escapeRegExp:function(a){return a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},matches:function(a,b){var c=(a+"").match(b);return c?c:[]},match:function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return d.matches(a,b)[c]||""},observeResize:function(a,b){if(self.ResizeObserver){var c=null,d=b instanceof ResizeObserver?b:new ResizeObserver(function(a){var d=a[a.length-1].contentRect;c&&c.width==d.width&&c.height==d.height||(b(a),c=d)});return d.observe(a),d}},Observer:a.Class({constructor:function(b,c,d){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:{};d instanceof MutationObserver&&(this.observer=d),this.observer=this.observer||new MutationObserver(d),this.element=b,this.callback=d,this.attribute=c,this.options=a.extend({},e),c&&a.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!e.oldValue}),this.attribute&&"all"!=this.attribute||a.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!e.oldValue}),this.run()},stop:function(){return this.observer&&this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(a){if(this.running){this.stop();var b=a();this.run()}else var b=a();return b},destroy:function(){this.stop(),this.observer=this.element=null},static:{sneak:function(a,b){return a?a.sneak(b):b()}}}),defer:function(a){var b,c,d=new Promise(function(d,e){a&&a(d,e),b=d,c=e});return d.resolve=function(c){return b(c),d},d.reject=function(b){return c(b),d},d},thenAll:function(c){return b(c).forEach(function(b){"promise"==a.type(b)&&(b=b.catch(function(a){return a}))}),Promise.all(c).then(function(a){return c.length==a.length?a:d.thenAll(c)})},rr:function(a){return a(),a},wrap:function(a,b){return 0>a?b-1:a>=b?0:a},options:function(a){var b={};return(a.trim().match(/(?:\\[,;]|[^,;])+/g)||[]).forEach(function(a){if(a){a=a.trim().replace(/\\([,;])/g,"$1");var c=a.match(/^\s*((?:\\:|[^:])+?)\s*:\s*(.+)$/);c?b[c[1].replace(/\\:/g,":")]=c[2]:b[a]=!0}}),b}});a.add("toggleAttribute",function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null!==b;c?this.setAttribute(a,b):this.removeAttribute(a)}),a.proxy=a.classProps.proxy=a.overload(function(a,b,c){return Object.defineProperty(a,b,{get:function(){return this[c][b]},set:function(a){this[c][b]=a},configurable:!0,enumerable:!0}),a}),a.classProps.propagated=function(a,b){Mavo.toArray(b).forEach(function(b){var c=a[b];a[b]=function(){var a=c&&c.apply(this,arguments);this.propagate&&!1!==a&&this.propagate(b)}})};addEventListener("hashchange",c);new Mavo.Observer(document.documentElement,"id",c)})(Bliss,Bliss.$);
"use strict";(function(a,b){var c=Mavo.Locale=a.Class({constructor:function(a,b){this.lang=a,this.phrases={},this.extend(b)},get fallback(){return c.all[this.baseLang]?c.all[this.baseLang]:this===c.default?void 0:c.default},extend:function(b){a.extend(this.phrases,b)},phrase:function(a,b){var c=a.toLowerCase(),d=this.phrases[c];if(void 0===d&&this.fallback&&(d=this.fallback.phrase(c)),void 0===d)d=Mavo.Functions.readable(c);else if(b){var e=Mavo.matches(d,/\{\w+(?=\})/g).map(function(a){return a.slice(1)});Mavo.Functions.unique(e).forEach(function(a){a in b&&(d=d.replace(RegExp("{"+a+"}","gi"),b[a]))})}return d},live:{lang:function(a){this.baseLang=c.getBaseLang(a),a==this.baseLang&&(this.baseLang=null)}},static:{all:{},register:function(a,b){c.all[a]?c.all[a].extend(b):c.all[a]=new c(a,b)},match:function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"";return c.all[a]||c.all[c.getBaseLang(a)]},get:function(a){return c.match(a)||c.default},getBaseLang:function(a){return a.split("-")[0]},lazy:{default:function(){return c.match(Mavo.locale)||c.all.en}}}});Mavo.prototype._=function(a,b){return this.locale&&a?this.locale.phrase(a,b):a},a.ready().then(function(){b("datalist.mv-phrases[lang]").forEach(function(a){var c=b("option",a).reduce(function(a,b){return a[b.value]=b.textContent.trim(),a},{});Mavo.Locale.register(a.lang,c)})})})(Bliss,Bliss.$);
"use strict";Mavo.Locale.register("en",{edit:"Edit",save:"Save",import:"Import",export:"Export",logout:"Logout",login:"Login",loading:"Loading",uploading:"Uploading",saving:"Saving","logged-in-as":"Logged in to {id} as ","login-to":"Login to {id}","error-uploading":"Error uploading file","cannot-load-uploaded-file":"Cannot load uploaded file","problem-saving":"Problem saving data","problem-loading":"Problem loading data","cannot-parse":"Can\u2019t understand this file","http-error":"HTTP error {status}: {statusText}","cant-connect":"Can\u2019t connect to the Internet","add-item":"Add {name}","add-item-before":"Add new {name} before","add-item-after":"Add new {name} after","drag-to-reorder":"Drag to reorder {name}","delete-item":"Delete this {name}","gh-updated-file":"Updated {name}","gh-edit-suggestion-saved-in-profile":"Your edits are saved to <a href=\"{previewURL}\" target=\"_blank\">your own profile</a>, because you are not allowed to edit this page.","gh-edit-suggestion-instructions":"Write a short description of your edits below to suggest them to the page admins:","gh-edit-suggestion-notreviewed":"You have selected to suggest your edits to the page admins. Your suggestions have not been reviewed yet.","gh-edit-suggestion-send":"Send edit suggestion","gh-edit-suggestion-revoke":"Revoke edit suggestion","gh-edit-suggestion-reason-placeholder":"I added / corrected / deleted ...","gh-edit-suggestion-cancelled":"Edit suggestion cancelled successfully!","gh-edit-suggestion-title":"Suggested edits to data","gh-edit-suggestion-body":"Hello there! I used Mavo to suggest the following edits:\n{description}\nPreview my changes here: {previewURL}","gh-edit-suggestion-sent":"Edit suggestion sent successfully!"});
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){Mavo.attributes.push("mv-plugins");var c=Mavo.Plugins={loaded:{},load:function(){return c.plugins=new Set,b("[mv-plugins]").forEach(function(a){a.getAttribute("mv-plugins").trim().split(/\s+/).forEach(function(a){return c.plugins.add(a)})}),c.plugins.size?a.fetch(c.url+"/plugins.json",{responseType:"json"}).then(function(b){return Mavo.thenAll(b.response.plugin.filter(function(a){return c.plugins.has(a.id)}).map(function(b){if(b.repo)var d="https://raw.githubusercontent.com/"+b.repo+"/";else var d=c.url+"/"+b.id+"/";var e=d+"mavo-"+b.id+".js";return a.include(c.loaded[b.id],e)}))}):Promise.resolve()},register:function(b){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!c.loaded[b]){for(var e in Mavo.hooks.add(d.hooks),d.extend){var f="Mavo"==e?Mavo:Mavo[e];"function"===a.type(f)?a.Class(f,d.extend[e]):a.extend(f,d.extend[e])}var g=[];if(d.ready&&g.push(d.ready),d.dependencies){var h=document.currentScript?document.currentScript.src:location,i=d.dependencies.map(function(a){return Mavo.load(a,h)});g.push.apply(g,_toConsumableArray(i))}if(g.length){var j;(j=Mavo.dependencies).push.apply(j,g)}c.loaded[b]=d,d.init&&Promise.all(g).then(function(){return d.init()})}},url:"https://plugins.mavo.io"}})(Bliss,Bliss.$);
"use strict";(function(b){Mavo.attributes.push("mv-bar");var a=Mavo.UI.Bar=b.Class({constructor:function(c){var d=this;if(this.mavo=c,this.element=b(".mv-bar",this.mavo.element),this.template=this.mavo.element.getAttribute("mv-bar")||"",this.element)for(var e in this.custom=!0,this.template+=" "+(this.element.getAttribute("mv-bar")||""),this.template=this.template.trim(),a.controls)this[e]=b(".mv-"+e,this.element),this[e]&&(this.template=this.template||"with",this.template+=" "+e);else this.element=b.create({className:"mv-bar mv-ui",start:this.mavo.element,innerHTML:"<button>&nbsp;</button>"});this.element.classList.contains("mv-compact")&&(this.noResize=!0),/\byes-\w+/.test(this.template)&&console.warn(this.mavo.id+": You used mv-bar=\""+this.template+"\". Note that yes-* in mv-bar is deprecated and will be removed in v0.1.6. Please use the new syntax: http://mavo.io/docs/ui/#bar"),this.controls=a.getControls(this.template),this.controls.length&&(this.targetHeight=this.element.offsetHeight),this.custom||(this.element.innerHTML=""),this.controls.forEach(function(c){var e=a.controls[c];for(var f in d[c]&&d[c].remove(),e.create?d[c]=e.create.call(d.mavo,d[c]):!d[c]&&(d[c]=b.create("button",{className:"mv-"+c,textContent:d.mavo._(c)})),d.add(c),e.permission?d.permissions.can(e.permission,function(){d.toggle(c,!e.condition||e.condition.call(d.mavo))},function(){d.remove(c)}):e.condition&&!e.condition.call(d.mavo)&&d.remove(c),e.events)b.bind(d[c],f,e.events[f].bind(d.mavo))});var f=function(c){var e=a.controls[c];e.action&&b.delegate(d.mavo.element,"click",".mv-"+c,function(a){(!e.permission||d.permissions.is(e.permission))&&(e.action.call(d.mavo),a.preventDefault())})};for(var g in a.controls)f(g);this.controls.length&&!this.noResize&&(this.resize(),self.ResizeObserver&&(this.resizeObserver=Mavo.observeResize(this.element,function(){d.resize()})))},resize:function(){return this.targetHeight?void(this.resizeObserver&&this.resizeObserver.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),this.element.offsetHeight>1.6*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight&&this.element.classList.add("mv-tiny")),this.resizeObserver&&this.resizeObserver.observe(this.element)):void(this.targetHeight=this.element.offsetHeight)},add:function(b){var c=this,d=a.controls[b];d.prepare&&d.prepare.call(this.mavo),Mavo.revocably.add(this[b],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return c.resize()})},remove:function(b){var c=this,d=a.controls[b];Mavo.revocably.remove(this[b],"mv-"+b),d.cleanup&&d.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(function(){return c.resize()})},toggle:function(a,b){return this[b?"add":"remove"](a)},proxy:{permissions:"mavo"},static:{getControls:function(b){var c=Object.keys(a.controls);if(b&&(b=b.trim())){if("none"==b)return[];var d=/^with\s|\b(yes|no)-\w+\b/.test(b);b=b.replace(/\byes-|^with\s+/g,"");var e=b.split(/\s+/);return e=Mavo.Functions.unique(e.reverse()).reverse(),d?c.filter(function(b){var c=Math.max,d=e.lastIndexOf(b),f=e.lastIndexOf("no-"+b),g=d>c(-1,f),h=f>c(-1,d);return g||!a.controls[b].optional&&!h}):e}return c.filter(function(b){return!a.controls[b].optional})},controls:{status:{create:function(a){return a||b.create({className:"mv-status"})},prepare:function(){var a=this.primaryBackend;if(a&&a.user){var b=a.user,c=b.name||"";b.avatar&&(c="<img class=\"mv-avatar\" src=\""+b.avatar+"\" /> "+c),b.url&&(c="<a href=\""+b.url+"\" target=\"_blank\">"+c+"</a>"),this.bar.status.innerHTML="<span>"+this._("logged-in-as",a)+"</span> "+c}},permission:"logout"},edit:{action:function(){this.editing?this.done():this.edit()},permission:["edit","add","delete"],cleanup:function(){this.editing&&this.done()},condition:function(){return this.needsEdit}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},export:{create:function(c){var d;return d=c?c.matches("a")?c:b.create("a",{className:"mv-button",around:c}):b.create("a",{className:"mv-export mv-button",textContent:this._("export")}),d.setAttribute("download",this.id+".json"),d},events:{mousedown:function(){this.bar.export.href="data:application/json;charset=UTF-8,"+encodeURIComponent(this.toJSON())}},permission:"edit",optional:!0},import:{create:function(a){var c=this,d=a||b.create("span",{role:"button",tabIndex:"0",className:"mv-import mv-button",textContent:this._("import"),events:{focus:function(){e.focus()}}}),e=b.create("input",{type:"file",inside:d,events:{change:function(a){var d=a.target.files[0];if(d){var e=b.extend(new FileReader,{onload:function(){c.inProgress=!1;try{var a=JSON.parse(e.result);c.render(a)}catch(a){c.error(c._("cannot-parse"))}},onerror:function(){c.error(c._("problem-loading"))}});c.inProgress=c._("uploading"),e.readAsText(d)}}}});return d},optional:!0},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}})})(Bliss,Bliss.$);
"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a){Mavo.UI.Message=a.Class({constructor:function(b,c,d){var e=this;if(this.mavo=b,this.message=c,this.closed=Mavo.defer(),this.element=a.create(_defineProperty({className:"mv-ui mv-message"+(d.type?" mv-"+d.type:""),innerHTML:this.message,events:{click:function(){return Mavo.scrollIntoViewIfNeeded(e.mavo.element)}}},this.mavo.bar?"after":"start",(this.mavo.bar||this.mavo).element)),d.classes&&this.element.classList.add(d.classes),"error"==d.type?this.element.setAttribute("role","alert"):this.element.setAttribute("aria-live","polite"),d.dismiss=d.dismiss||{},"string"==typeof d.dismiss||Array.isArray(d.dismiss)){var f={};Mavo.toArray(d.dismiss).forEach(function(a){f[a]=!0}),d.dismiss=f}if(d.dismiss.button&&a.create("button",{className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){return e.close()}},start:this.element}),d.dismiss.timeout){var g,h="number"==typeof d.dismiss.timeout?d.dismiss.timeout:5e3;a.bind(this.element,{mouseenter:function(){return clearTimeout(g)},mouseleave:Mavo.rr(function(){return g=setTimeout(function(){return e.close()},h)})})}d.dismiss.submit&&this.element.addEventListener("submit",function(a){a.preventDefault(),e.close(a.target)})},close:function(b){var c=this;a.transition(this.element,{opacity:0}).then(function(){a.remove(c.element),c.closed.resolve(b)})}})})(Bliss,Bliss.$);
"use strict";(function(a){var b=Mavo.Permissions=a.Class({constructor:function(c){this.triggers=[],this.hooks=new a.Hooks,this.parentChanged=b.prototype.parentChanged.bind(this),this.set(c)},set:function(a){for(var b in a)this[b]=a[b]},on:function(a){var b=this;return Mavo.toArray(a).forEach(function(a){return b[a]=!0}),this},off:function(a){var b=this;return a=Array.isArray(a)?a:[a],a.forEach(function(a){return b[a]=!1}),this},can:function(a,b,c){this.observe(a,!0,b),c&&this.cannot(a,c)},cannot:function(a,b){this.observe(a,!1,b)},observe:function(a,b,c){a=Mavo.toArray(a),this.is(a,b)&&c(),this.triggers.push({actions:a,value:b,callback:c,active:!0})},is:function(a){var b=this,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,d=Mavo.toArray(a).map(function(a){return!!b[a]}).reduce(function(a,b){return a||b});return c?d:!d},onchange:function(a){var c=this;this.hooks.add("change",a),b.actions.forEach(function(b){a.call(c,{action:b,value:c[b]})})},parentChanged:function(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=this["_"+b.action];void 0!==c||b.from==b.value||(this.fireTriggers(b.action),this.hooks.run("change",a.extend({context:this},b)))},changed:function(a,b,c){c=!!c,b=!!b;b==c||(this["_"+a]=b,this.fireTriggers(a),this.hooks.run("change",{action:a,value:b,from:c,context:this}))},fireTriggers:function(a){var b=this;this.triggers.forEach(function(c){var d=b.is(c.actions,c.value);c.active&&-1<c.actions.indexOf(a)&&d?(c.active=!1,c.callback()):!d&&(c.active=!0)})},or:function(a){var c=this;return b.actions.forEach(function(b){c[b]=c[b]||a[b]}),this},live:{parent:function(a){var c=this,d=this._parent;d==a||(this._parent=a,d&&Mavo.delete(d.hooks.change,this.parentChanged),b.actions.forEach(function(b){c.parentChanged({action:b,value:a?a[b]:void 0,from:d?d[b]:void 0})}),a&&a.onchange(this.parentChanged))}},static:{actions:[],register:function(c,d){return Array.isArray(c)?void c.forEach(function(a){return b.register(a,d)}):void(a.live(b.prototype,c,{get:function(){var a=this["_"+c];return void 0===a&&this.parent?this.parent[c]:a},set:function(a,b){d&&d.call(this,a,b),this.changed(c,a,b)}}),b.actions.push(c))}}});b.register(["read","save"]),b.register("login",function(a){a&&this.logout&&(this.logout=!1)}),b.register("logout",function(a){a&&this.login&&(this.login=!1)}),b.register("edit",function(a){a&&(this.add=this.delete=!0)}),b.register(["add","delete"],function(a){a||(this.edit=!1)})})(Bliss,Bliss.$);
"use strict";(function(a){var b=Mavo.Backend=a.Class({constructor:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};this.source=a,this.url=new URL(this.source,Mavo.base),this.mavo=b.mavo,this.format=Mavo.Formats.create(b.format,this),this.permissions=new Mavo.Permissions},get:function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new URL(this.url);return b.searchParams.set("timestamp",Date.now()),a.fetch(b.href).then(function(a){return Promise.resolve(a.responseText)},function(){return Promise.resolve(null)})},load:function(){var a=this;return this.ready.then(function(){return a.get()}).then(function(b){return"string"==typeof b?(b=b.replace(/^\ufeff/,""),a.format.parse(b)):b})},store:function(a){var b=this,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},d=c.path,e=c.format,f=e===void 0?this.format:e;return this.ready.then(function(){var c="string"==typeof a?Promise.resolve(a):f.stringify(a);return c.then(function(c){return b.put(c,d).then(function(){return{data:a,serialized:c}})})})},ready:Promise.resolve(),login:function(){return Promise.resolve()},logout:function(){return Promise.resolve()},put:function(){return Promise.reject()},isAuthenticated:function(){return!!this.accessToken},oAuthParams:function(){return""},toString:function(){return this.id+" ("+this.url+")"},equals:function(a){return a===this||a&&this.id==a.id&&this.source==a.source},request:function(b,c){var d=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",f=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return f.method=f.method||e,f.responseType=f.responseType||"json",f.headers=a.extend({"Content-Type":"application/json; charset=utf-8"},f.headers||{}),f.data=c,this.isAuthenticated()&&(f.headers.Authorization=f.headers.Authorization||"Bearer "+this.accessToken),"object"===a.type(f.data)&&("GET"==f.method?f.data=Object.keys(f.data).map(function(a){return a+"="+encodeURIComponent(f.data[a])}).join("&"):f.data=JSON.stringify(f.data)),b=new URL(b,this.constructor.apiDomain),"GET"==f.method&&b.searchParams.set("timestamp",Date.now()),a.fetch(b,f).catch(function(a){return a&&a.xhr?Promise.reject(a.xhr):void d.mavo.error("Something went wrong while connecting to "+d.id,a)}).then(function(a){return"HEAD"==f.method?a:a.response})},oAuthenticate:function(a){var b=this;return this.ready.then(function(){return b.isAuthenticated()?Promise.resolve():new Promise(function(c,d){var e=Math.min,f=b.id.toLowerCase();if(a)b.accessToken=localStorage["mavo:"+f+"token"],b.accessToken&&c(b.accessToken);else{var g={width:e(1e3,innerWidth-100),height:e(800,innerHeight-100)};g.top=(screen.height-g.height)/2,g.left=(screen.width-g.width)/2;var h={url:location.href,backend:b.id};if(b.authPopup=open(b.constructor.oAuth+"?client_id="+b.key+"&state="+encodeURIComponent(JSON.stringify(h))+b.oAuthParams(),"popup","width="+g.width+",height="+g.height+",left="+g.left+",top="+g.top),!b.authPopup){var i="Login popup was blocked! Please check your popup blocker settings.";b.mavo.error(i),d(Error(i))}addEventListener("message",function(a){if(a.source===b.authPopup)for(var e in a.data.backend==b.id&&(b.accessToken=localStorage["mavo:"+f+"token"]=a.data.token),b.accessToken||d(Error("Authentication error")),c(b.accessToken),Mavo.all){var g=Mavo.all[e].primaryBackend;g&&g.id===b.id&&g!==b&&!g.isAuthenticated()&&g.login(!0)}})}})})},oAuthLogout:function(){if(this.isAuthenticated()){var b=this.id.toLowerCase();localStorage.removeItem("mavo:"+b+"token"),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),a.fire(this.mavo.element,"mv-logout",{backend:this})}return Promise.resolve()},static:{create:function(a,c,d){var e;return d&&(e=Mavo.Functions.get(b,d)),a&&!e&&(e=b.types.filter(function(b){return b.test(a)})[0]||b.Remote),e?new e(a,c):null},types:[],register:function(a){return b[a.prototype.id]=a,b.types.push(a),a}}});b.register(a.Class({id:"Element",extends:b,constructor:function(){this.permissions.on(["read","edit","save"]),this.element=a(this.source)||a.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(a){return Promise.resolve(this.element.textContent=a)},static:{test:function(a){return 0===a.indexOf("#")}}})),b.register(a.Class({id:"Remote",extends:b,constructor:function(){this.permissions.on("read")},static:{test:function(){return!1}}})),b.register(a.Class({extends:b,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(a){return a?localStorage[this.key]=a:delete localStorage[this.key],Promise.resolve(a)},static:{test:function(a){return"local"==a}}}))})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a){var b=Mavo.Formats={},c=b.Base=a.Class({abstract:!0,constructor:function(a){this.backend=a},proxy:{mavo:"backend"},parse:function(a){return this.constructor.parse(a,this)},stringify:function(a){return this.constructor.stringify(a,this)},static:{parse:function(a){return Promise.resolve(a)},stringify:function(a){return Promise.resolve(a)},extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(function(b){return a.include(b.test(),b.url)}))}}}),d=b.JSON=a.Class({extends:b.Base,static:{parse:function(a){return Promise.resolve(a?JSON.parse(a):null)},stringify:function(a){return Promise.resolve(Mavo.toJSON(a))},extensions:[".json",".jsonld"]}}),e=b.Text=a.Class({extends:b.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:function(a,b){return Promise.resolve(_defineProperty({},b?b.property:"content",a))},stringify:function(a,b){return Promise.resolve(a[b?b.property:"content"])}}}),f=b.CSV=a.Class({extends:b.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=a.extend({},b.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:function(){return self.Papa},url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:c.ready,parse:function(a,b){return f.ready().then(function(){var c=Papa.parse(a,f.defaultOptions),d=b?b.property:"content";if(b&&(b.options.delimiter=c.meta.delimiter,b.options.linebreak=c.meta.linebreak),c.meta.aborted)throw c.meta.errors.pop();return _defineProperty({},d,c.data)})},stringify:function(a,b){return f.ready().then(function(){var c=b?b.property:"content",d=b?b.options:f.defaultOptions;return Papa.unparse(a[c],d)})}}});Object.defineProperty(b,"create",{value:function(a,c){if(a&&"object"===("undefined"==typeof a?"undefined":_typeof(a)))return a;if("string"==typeof a)for(var d in a=a.toLowerCase(),b){var e=b[d];if(d.toLowerCase()==a)return new e(c)}if(!a){var f=c.url?c.url.pathname:c.source,g=Mavo.match(f,/\.\w+$/)||".json",e=b.JSON;for(var d in b)-1<b[d].extensions.indexOf(g)&&(e=b[d]);return new e(c)}}})})(Bliss,Bliss.$);
"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Node=a.Class({abstract:!0,constructor:function(b,d){var e=this,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(!b||!d)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var g={context:this,options:f};this.uid=++c.maxId,this.nodeType=this.nodeType,this.property=null,this.element=b,a.extend(this,g.options),c.all.set(b,[].concat(_toConsumableArray(c.all.get(this.element)||[]),[this])),this.mavo=d,this.group=this.parentGroup=g.options.group,this.template=g.options.template,this.alias=this.element.getAttribute("mv-alias"),this.template?this.template.copies.push(this):this.copies=[],this.fromTemplate("property","type")||(this.property=c.getProperty(b),this.type=Mavo.Group.normalize(b),this.storage=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",g),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=g.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup);var h=this.template;if(h&&h.expressions&&(this.expressions=h.expressions.map(function(a){return new Mavo.DOMExpression({template:a,item:e,mavo:e.mavo})})),this instanceof Mavo.Group||this.collection){var i=Mavo.DOMExpression.search(this.element).filter(function(a){return"mv-value"==a.originalAttribute})[0];i&&(i.mavoNode=this,this.expressionText=i,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[].concat(_toConsumableArray(this.collection.expressions||[]),[i]),i.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}Mavo.hooks.run("node-init-end",g)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.storage},get parent(){return this.collection||this.parentGroup},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){this.template&&Mavo.delete(this.template.copies,this),this.expressions&&this.expressions.forEach(function(a){return a.destroy()}),this.itembar&&this.itembar.destroy()},getData:function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(this.isDataNull(a))return a.forceObjects?Mavo.objectify(null):null},isDataNull:function(a){var b={context:this,options:a,result:this.deleted||!this.saved&&!a.live};return Mavo.hooks.run("unit-isdatanull",b),b.result},walk:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return function b(d,e){var f=a(d,e);if(!1!==f)for(var g in d.children){var h=d.children[g];if(h instanceof Mavo.Node){var f=b.call(h,h,[].concat(_toConsumableArray(e),[g]));if(!1===f&&!c.descentReturn)return!1}}return!1!==f}(this,b)},walkUp:function(a){for(var b=this;b=b.parentGroup;){var c=a(b);if(c!==void 0)return c}},edit:function(){return this.mode="edit","edit"==this.mode&&void(a.fire(this.element,"mv-edit",{mavo:this.mavo,node:this}),Mavo.hooks.run("node-edit-end",this))},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(a.unbind(this.element,".mavo:edit"),a.fire(this.element,"mv-done",{mavo:this.mavo,node:this}),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(a){for(var b in this.children){var c=this.children[b];c instanceof Mavo.Node&&("function"==typeof a?a.call(c,c):a in c&&c[a]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(){var a=this;if(this.template){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];c.forEach(function(b){return a[b]=a.template[b]})}return!!this.template},render:function(a){this.oldData=this.data,this.data=a,a=Mavo.subset(a,this.inPath);var b={context:this,data:a};if(Mavo.hooks.run("node-render-start",b),"Collection"!=this.nodeType&&Array.isArray(a)){var c;this.isRoot&&1===(c=Object.keys(this.children)).length&&"Collection"===this.children[c[0]].nodeType?b.data=_defineProperty({},c[0],b.data):(this.inPath.push("0"),b.data=b.data[0])}this.editing?(this.done(),this.dataRender(b.data),this.edit()):this.dataRender(b.data),this.save(),Mavo.hooks.run("node-render-end",b)},dataChanged:function(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};a.fire(c.element||this.element,"mv-change",a.extend({property:this.property,action:b,mavo:this.mavo,node:this},c))},toString:function(){return"#"+this.uid+": "+this.nodeType+" ("+this.property+")"},getClosestCollection:function(){var a=this.closestItem;return a?a.collection:null},getClosestItem:function(){return this.collection&&this.collection.mutable?this:this.parentGroup?this.parentGroup.closestItem:null},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},resolve:function(a){var b=this.find(a);return void 0===b&&(b=this.walkUp(function(b){return b.property==a?b:a in b.children?b.children[a]:void 0})),void 0===b&&(b=this.mavo.root.find(a)),b},relativizeData:self.Proxy?function(a){var b=this,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{live:!0},d={};return new Proxy(a,{get:function(a,b,c){return b in a?a[b]:b in c&&b in d?d[b]:void 0},has:function(a,e){if(e in a||e in d)return!0;switch(e){case"$index":return d[e]=b.index||0,!0;case"$next":case"$previous":return b.closestCollection?(d[e]=b.closestCollection.getData(c)[b.index+("$next"==e?1:-1)],!0):(d[e]=null,!1);}var f=b.resolve(e);return void 0===f?e in Mavo.all&&Mavo.all[e].root&&(d[e]=Mavo.all[e].root.getData(c)):(Array.isArray(f)?f=f.map(function(a){return a.getData(c)}).filter(function(a){return null!==a}):f instanceof Mavo.Node&&(f=f.getData(c)),d[e]=f,!0)},set:function(){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",b=arguments[2];return console.warn("You cannot set data via expressions. Attempt to set "+a.toString()+" to "+b+" ignored."),b}})}:function(a){return a},pathFrom:function(a){for(var b=this.path,c=a.path,d=0;d<b.length&&c[d]==b[d];d++);return b.slice(d)},getDescendant:function(a){return a.reduce(function(a,b){return a.children[b]},this)},getCousin:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!this.closestCollection)return null;var c=this.closestCollection,d=Math.abs(a),e=0>a?-1:1;if(c.length<d+1)return null;var f=this.closestItem.index+a;b.wrap&&(f=Mavo.wrap(f,c.length));for(var g,h=0;h<c.length;h++){g=f+h*e,g=b.wrap?Mavo.wrap(g,c.length):g;var i=c.children[g];if(!i||!i.isDeleted())break}if(!i||i.isDeleted()||i==this.closestItem)return null;if(this.collection)return i;var j=this.pathFrom(this.closestItem);return i.getDescendant(j)},contains:function(a){do{if(a===this)return!0;a=a.parent}while(a);return!1},lazy:{closestCollection:function(){return this.getClosestCollection()},closestItem:function(){return this.getClosestItem()},inPath:function(){var a="Collection"==this.nodeType?"mv-multiple-path":"mv-path";return(this.element.getAttribute(a)||"").split("/").filter(function(a){return a.length})},properties:function(){if(this.template)return this.template.properties;var a=new Set(this.property&&[this.property]);if("Group"==this.nodeType)for(var b in this.children)a=Mavo.union(a,this.children[b].properties);else"Collection"==this.nodeType&&(a=Mavo.union(a,this.itemTemplate.properties));return a}},live:{store:function(b){a.toggleAttribute(this.element,"mv-storage",b)},unsavedChanges:function(a){return!a||this.saved&&this.editing||(a=!1),this.element.classList.toggle("mv-unsaved-changes",a),a},mode:function(b){var c=this;if(this._mode!=b){if(this.modes&&b!=this.modes&&(b=this.modes),this._mode=b,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var d=this.modes||"edit"==b;Mavo.Observer.sneak(this.mavo.modeObserver,function(){a.toggleAttribute(c.element,"mv-mode",b,d)})}return b}},modes:function(a){return a&&"read"!=a&&"edit"!=a?null:void(this._modes=a,a&&this.mode!=a&&(this.mode=a))},deleted:function(c){var d=this;this.element.classList.toggle("mv-deleted",c),c?(this.elementContents=document.createDocumentFragment(),b(this.element.childNodes).forEach(function(a){d.elementContents.appendChild(a)}),a.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){a.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:function(){return d.deleted=!1}}}]),this.element.classList.remove("mv-highlight"),this.itembar.remove()):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"),this.itembar.add())},path:{get:function(){var a=this.parent?this.parent.path:[];return this.property?[].concat(_toConsumableArray(a),[this.property]):a}}},static:{maxId:0,all:new WeakMap,create:function(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return Mavo.is("multiple",a)&&!c.collection?new Mavo.Collection(a,b,c):new Mavo[Mavo.is("group",a)?"Group":"Primitive"](a,b,c)},getProperty:function(a){var b=a.getAttribute("property")||a.getAttribute("itemprop");return b||(a.hasAttribute("property")?b=a.name||a.id||a.classList[0]:a.matches(Mavo.selectors.multiple)&&(b=a.getAttribute("mv-multiple")||"collection")),b&&a.setAttribute("property",b),b},get:function(a,b){var d=(c.all.get(a)||[]).filter(function(a){return!(a instanceof Mavo.Collection)});return 2>d.length||!b?d[0]:d[0]instanceof Mavo.Group?node[1]:void 0},children:function(a){var c=Mavo.Node.get(a);return c?[c]:(c=b(Mavo.selectors.property,a).map(function(a){return Mavo.Node.get(a)}).filter(function(b){return!a.contains(b.parentGroup.element)}).map(function(a){return a.collection||a}),Mavo.Functions.unique(c))}}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Group=a.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){var a=this;if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});var c=b(Mavo.selectors.property+", "+Mavo.selectors.multiple,this.element).filter(function(b){return a.element===b.parentNode.closest(Mavo.selectors.group)}),d=c.map(function(a){return Mavo.Node.getProperty(a)});c.forEach(function(b,c){var e=d[c],f=a.template?a.template.children[e]:null,g={template:f,group:a};if(a.children[e]){var h=a.children[e];h.add(b),h.mutable=h.mutable||Mavo.is("multiple",b)}else a.children[e]=d.indexOf(e)==d.lastIndexOf(e)?Mavo.Node.create(b,a.mavo,g):new Mavo.Collection(b,a.mavo,g)});var e=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=e.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(){var a=this,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"Node";return Object.keys(this.children).filter(function(c){return a.children[c]instanceof Mavo[b]})},getData:function(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},d={context:this,options:b,data:this.super.getData.call(this,b)};if(void 0!==d.data)return d.data;d.data=(this.data?Mavo.clone(Mavo.subset(this.data,this.inPath)):{})||{};var e=Object.keys(this.children);if(1==e.length&&e[0]==this.property){var f=a.extend(a.extend({},d.options),{forceObjects:!0});d.data=this.children[this.property].getData(f)}else for(var g in this.children){var h=this.children[g];if(h.saved||d.options.live){var i=h.getData(d.options);null!==i||d.options.live?d.data[h.property]=i:delete d.data[h.property]}}return d.options.live?d.data&&(d.data[Mavo.toNode]=this,d.data=this.relativizeData(d.data)):(d.data=Mavo.subset(this.data,this.inPath,d.data),e.length||this.isRoot?d.data&&"object"===_typeof(d.data)&&(this.type&&this.type!=c.DEFAULT_TYPE&&(d.data["@type"]=this.type),this.vocab&&(d.data["@context"]=this.vocab)):d.data=null),Mavo.hooks.run("node-getdata-end",d),d.data},find:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(this.property==a)return this;if(a in this.children)return this.children[a].find(a,b);if(this.properties.has(a)){var c,d,e=[];for(var f in this.children)d=this.children[f].find(a,b),void 0!==d&&(Array.isArray(d)?(e.push.apply(e,_toConsumableArray(d)),c=!0):e.push(d));return c||1<e.length?e:e[0]}},edit:function(){var a=this,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return!1!==this.super.edit.call(this)&&Promise.all(Object.keys(this.children).map(function(c){return a.children[c].edit(b)}))},save:function(){this.unsavedChanges=!1},propagated:["save","import"],dataRender:function(b){var c=this;if(b){if("object"!==("undefined"==typeof b?"undefined":_typeof(b))){if(this.property in this.children)var d=this.property;else var e=a.type(b),f=function(a){return(c.children[a]instanceof Mavo.Primitive)+(c.children[a].datatype==e)},d=Object.keys(this.children).filter(function(a){return!c.children[a].expressionText}).sort(function(a,b){return f(a)-f(b)}).reverse()[0];b=_defineProperty({},d,b),this.data=Mavo.subset(this.data,this.inPath,b)}var g;this.propagate(function(c){var d=b[c.property];c.alias&&void 0!==b[c.alias]&&(g=g||a.extend({},b),d=b[c.alias]),c.render(d)}),g&&this.propagate(function(a){a.alias&&(b[a.property]=g[a.alias],!(a.alias in c.children)&&delete b[a.alias])});var d}},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(a){if(Mavo.is("group",a)){var b=Mavo.getAttribute(a,"typeof","itemtype")||c.DEFAULT_TYPE;return a.setAttribute("typeof",b),b}return null}}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}(function(a,b){var c=Mavo.Primitive=a.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(d){var e=this;this.fromTemplate("config","attribute","templateValue","originalEditor")||(this.config=c.getConfig(d),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=this.expressionText||Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&(this.expressionText.primitive=this,this.storage=this.storage||"none",this.modes="read",this.element.setAttribute("aria-live","polite")),!this.editor&&this.element.hasAttribute("mv-edit")&&(!this.originalEditor&&(this.originalEditor=a(this.element.getAttribute("mv-edit"))),this.originalEditor&&!this.template&&(this.originalEditorObserver=new Mavo.Observer(this.originalEditor,"all",function(){e.copies.concat(e).forEach(function(a){"editor"==a.defaultSource&&(a.default=e.originalEditor.value),a.editor&&(a.editor=e.originalEditor.cloneNode(!0)),a.setValue(a.value,{force:!0,silent:!0})})}))),this.editor||this.originalEditor||this.attribute||(this.editor=b(this.element.children).filter(function(a){return a.matches(Mavo.selectors.formControl)&&!a.matches(Mavo.selectors.property)})[0],this.editor&&a.remove(this.editor));var f=this.editorValue;this.datatype||"number"!=typeof f&&"boolean"!=typeof f||(this.datatype="undefined"==typeof f?"undefined":_typeof(f)),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&a.bind(this.element,this.config.changeEvents,function(a){a.target===e.element&&(e.value=e.getValue())}),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?(this._default=this.modes?this.templateValue:f,this.defaultSource=this.modes?"template":"editor"):""===this.default?(this._default=this.templateValue,this.defaultSource="template"):(this.defaultObserver=new Mavo.Observer(this.element,"mv-default",function(){e.default=e.element.getAttribute("mv-default")}),this.defaultSource="attribute");var g=!this.template||this.template.templateValue!=this.templateValue||"edit"==this.modes;this.initialValue=void 0===this.default&&g?this.templateValue:this.default,this.initialValue===void 0&&(this.initialValue=this.emptyValue),this.setValue(this.initialValue,{silent:!0}),Mavo.setAttributeShy(this.element,"aria-label",this.label),this.attribute||Mavo.setAttributeShy(this.element,"mv-attribute","none"),!1!==this.config.observer&&(this.observer=new Mavo.Observer(this.element,this.attribute,function(){e.observer.running&&(e.attribute||!e.editing||e.config.subtree)&&(e.value=e.getValue())},{subtree:this.config.subtree,childList:this.config.subtree})),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){var b=this.editor||this.originalEditor;if(b){if(b.matches(Mavo.selectors.formControl))return c.getValue(b,{datatype:this.datatype});var d=a(Mavo.selectors.output+", "+Mavo.selectors.formControl,b);if(d)return c.getValue(d)}},set editorValue(b){if(this.config.setEditorValue&&"boolean"!==this.datatype)return this.config.setEditorValue.call(this,b);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))c.setValue(this.editor,b,{config:this.editorDefaults});else{var d=a(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);d&&c.setValue(d,b)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b={context:this,options:a,data:this.super.getData.call(this,a)};return void 0===b.data&&(b.data=this.value,""===b.data&&(b.data=null)),b.options.live?(this.collection||a.forceObjects)&&(b.data=Mavo.objectify(b.data,_defineProperty({},Mavo.toNode,this)),this.collection&&(b.data[this.property]=b.data,b.data=this.relativizeData(b.data))):this.inPath.length&&(b.data=Mavo.subset(this.data,this.inPath,b.data)),Mavo.hooks.run("node-getdata-end",b),b.data},sneak:function(a){return Mavo.Observer.sneak(this.observer,a)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){var c=this;if(!this.editor&&this.originalEditor&&(this.editor=this.originalEditor.cloneNode(!0)),!this.editor){var d=this.config.editor;d&&"boolean"!=this.datatype||(d=Mavo.Elements.defaultConfig[this.datatype||"string"].editor),this.editor=a.create("function"===a.type(d)?d.call(this):d),this.editorValue=this.value}a.bind(this.editor,{"input change":function(){c.value=c.editorValue},"mv-change":function(b){"output"===b.property&&(b.stopPropagation(),a.fire(c.editor,"input"))}});var e=this.editor.matches("textarea");e||this.editor.addEventListener("focus",function(){c.editor.select&&c.editor.select()}),!this.popup&&this.closestCollection&&this.editor.matches(Mavo.selectors.textInput)&&this.editor.addEventListener("keydown",function(a){if(13==a.keyCode&&c.closestCollection.editing&&(a.shiftKey||!e)){var b=c.getCousin(1);if(!b){if(c.bottomUp)return;var d=c.closestCollection.add();c.closestCollection.editItem(d,{immediately:!0})}b=c.getCousin(1),b.edit({immediately:!0}).then(function(){return b.editor.focus()}),e&&a.preventDefault()}else if(8==a.keyCode&&(c.empty&&c.collection||a[Mavo.superKey])){c.closestCollection.delete(c.closestItem);var f=c.getCousin(1)||c.getCousin(-1);f&&f.edit({immediately:!0}).then(function(){return f.editor.focus()})}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var f=/^mv-edit-/i;b(this.element.attributes).forEach(function(a){f.test(a.name)&&this.editor.setAttribute(a.name.replace(f,""),a.value)},this),(this.attribute||this.config.popup)&&(this.popup=new Mavo.UI.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!1!==this.super.edit.call(this)&&(-1===this.element.tabIndex&&Mavo.revocably.setAttribute(this.element,"tabindex","0"),this.modes||a.bind(this.element,"click.mavo:edit",function(a){return a.preventDefault()}),this.preEdit=Mavo.defer(function(d){if(c.immediately)return d();var e=["click","focus","dragover","dragenter"].map(function(a){return a+".mavo:preedit"}).join(" ");a.bind(b.element,e,d)}).then(function(){return a.unbind(b.element,".mavo:preedit")}),this.config.edit?void this.config.edit.call(this):this.preEdit.then(function(){b.sneak(function(){b.initEdit&&b.initEdit(),b.popup&&(b.popup.prepare(),b.popup.show()),b.attribute||b.popup||(b.editor.parentNode!=b.element&&(b.editorValue=b.value,b.element.textContent="",b.element.appendChild(b.editor)),!b.collection&&(document.activeElement===b.element&&b.editor.focus(),Mavo.revocably.restoreAttribute(b.element,"tabindex")))})}))},done:function(){var b=this;return!1!==this.super.done.call(this)&&void("preEdit"in this&&a.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(function(){return b.config.done?void b.config.done.call(b):void(b.popup?b.popup.close():!b.attribute&&b.editor&&(a.remove(b.editor),c.setValue(b.element,b.editorValue,{config:b.config,attribute:b.attribute,datatype:b.datatype,map:b.originalEditor||b.editor})))}),!this.collection&&Mavo.revocably.restoreAttribute(this.element,"tabindex"))},dataRender:function(a){if(a&&"object"===("undefined"==typeof a?"undefined":_typeof(a)))if(Symbol.toPrimitive in a)a=a[Symbol.toPrimitive]();else for(var b,c=[this.property,"value","content"],d=0;d<c.length;d++)if(b=c[d],b in a){a=a[b],this.inPath.push(b);break}a===void 0?!this.modes&&(this.value=this.closestCollection?this.default:this.templateValue):this.value=a},find:function(a){if(this.property==a)return this},getValue:function(){return c.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&c.getConfig(this.editor)}},setValue:function(a){var b=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.sneak(function(){a=a||0===a||!1===a?a:"";var e=b.datatype;return b.datatype||"number"!=typeof a&&"boolean"!=typeof a||(b.datatype="undefined"==typeof a?"undefined":_typeof(a)),a=c.safeCast(a,b.datatype),d.force||a!=b._value||e!=b.datatype?void(b.editor&&document.activeElement!=b.editor&&(b.editorValue=a),(b.popup||!b.editor||b.editor!==document.activeElement)&&(b.config.setValue?b.config.setValue.call(b,b.element,a):!d.dataOnly&&c.setValue(b.element,a,{config:b.config,attribute:b.attribute,datatype:b.datatype,map:b.originalEditor||b.editor})),b.empty=!a&&0!==a,b._value=a,!d.silent&&(b.saved&&(b.unsavedChanges=b.mavo.unsavedChanges=!0),b.dataChanged("propertychange",{value:a}))):a}),a},dataChanged:function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"propertychange",b=arguments[1];return this.super.dataChanged.call(this,a,b)},live:{default:function(a){this.value==this._default&&(this.value=a)},value:function(a){return this.setValue(a)},datatype:function(b){b!==this._datatype&&("boolean"==b&&!this.attribute&&(this.attribute=Mavo.Elements.defaultConfig.boolean.attribute),a.toggleAttribute(this.element,"datatype",b,b&&"string"!==b))},empty:function(b){var c=b&&!this.modes&&!(this.attribute&&a(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!c)}},static:{all:new WeakMap,getValueAttribute:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Mavo.Elements.search(a),c=a.getAttribute("mv-attribute")||b.attribute;return c&&"null"!==c&&"none"!==c||(c=null),c},safeCast:function(a,b){var d="undefined"==typeof a?"undefined":_typeof(a),e=c.cast(a,b);return null===a||void 0===a?a:"boolean"==b?"false"===a||0===a||""===a?!1:"true"===a||0<a||a:"number"==b?/^[-+]?[0-9.e]+$/i.test(a+"")?e:a:e},cast:function(a,b){return"number"===b?+a:"boolean"===b?!!a:"string"===b?a+"":a},getValue:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=b.config,e=b.attribute,f=b.datatype;if(d||(d=c.getConfig(a,e)),e=d.attribute,f=d.datatype,d.getValue&&e==d.attribute)return d.getValue(a);var g;return g=e in a&&c.useProperty(a,e)?a[e]:e?a.getAttribute(e):a.getAttribute("content")||a.textContent||null,c.safeCast(g,f)},getConfig:function(a,b,d){void 0===b&&(b=a.getAttribute("mv-attribute")||void 0),("null"==b||"none"==b)&&(b=null),d||b!=c.getValueAttribute(a)||(d=a.getAttribute("datatype")||void 0);var e=Mavo.Elements.search(a,b,d);return void 0===e.attribute&&(e.attribute=b||null),void 0===e.datatype&&(e.datatype=d),e},setValue:function(b,d){var e=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};if(1===b.nodeType&&(e.config||(e.config=c.getConfig(b,e.attribute)),e.attribute=void 0===e.attribute?e.config.attribute:e.attribute,e.datatype=void 0===e.datatype?e.config.datatype:e.datatype,e.config.setValue&&e.attribute==e.config.attribute))return e.config.setValue(b,d,e.attribute);if(e.attribute){if(e.attribute in b&&c.useProperty(b,e.attribute)&&b[e.attribute]!==d){try{var f=b[e.attribute],g=b[e.attribute]=d}catch(a){}f!=g&&e.config.changeEvents&&e.config.changeEvents.split(/\s+/).forEach(function(c){return a.fire(b,c)})}"boolean"==e.datatype?d!=b.hasAttribute(e.attribute)&&a.toggleAttribute(b,e.attribute,d,d):b.getAttribute(e.attribute)!=d&&b.setAttribute(e.attribute,d)}else{var h=c.format(d,e);h===d?b.textContent=d:(b.textContent=h,b.setAttribute&&b.setAttribute("content",d))}},useProperty:function(a,b){return!(-1<["href","src"].indexOf(b))&&"http://www.w3.org/2000/svg"!=a.namespaceURI},format:function(b){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(d.map&&/^select$/i.test(d.map.nodeName))for(var e,f=0;e=d.map.options[f];f++)if(e.value==b)return e.textContent;if("number"===a.type(b)||"number"==d.datatype){var g=d.attribute||d.element&&d.element.matches("style, pre");if(!g)return c.formatNumber(b)}return Array.isArray(b)?b.map(c.format).join(", "):"object"===a.type(b)?Mavo.toJSON(b):b},lazy:{formatNumber:function(){var a=new Intl.NumberFormat(Mavo.locale,{maximumFractionDigits:2});return function(b){return b===Infinity||b===-Infinity?0>b?"-\u221E":"\u221E":a.format(b)}}}}})})(Bliss,Bliss.$);
"use strict";(function(a){Mavo.UI.Popup=a.Class({constructor:function(b){var c=this;this.primitive=b,this.position=function(){var b=c.primitive.element.getBoundingClientRect(),d=b.left,e=b.bottom,f=!1;if(c.element.offsetHeight&&(c.height=c.element.getBoundingClientRect().height||c.height),c.height+e+20>innerHeight)if(20<b.top-c.height){var f=!0;e=b.top-c.height-20}else e=innerHeight-c.height-20;c.element.classList.toggle("mv-point-down",f),a.style(c.element,{top:e+"px",left:d+"px"})},this.element=a.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:function(a){(13==a.keyCode||27==a.keyCode)&&(c.element.contains(document.activeElement)&&c.primitive.element.focus(),a.stopPropagation(),c.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){var b=this;a.unbind([this.primitive.element,this.element],".mavo:showpopup"),this.shown=!0,this.hideCallback=function(a){b.element.contains(a.target)||b.primitive.element.contains(a.target)||b.hide()},this.element.style.transition="none",this.element.removeAttribute("hidden"),this.position(),this.element.setAttribute("hidden",""),this.element.style.transition="",document.body.appendChild(this.element),setTimeout(function(){b.element.removeAttribute("hidden")},100),a.bind(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position,{passive:!0})},hide:function(){var b=this;a.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position,{passive:!0}),this.element.setAttribute("hidden",""),this.shown=!1,setTimeout(function(){a.remove(b.element)},1e3*parseFloat(getComputedStyle(this.element).transitionDuration)||400)},prepare:function(){var b=this;a.bind(this.primitive.element,{"click.mavo:edit":function(){b.show()},"keyup.mavo:edit":function(a){-1<[13,113].indexOf(a.keyCode)&&(b.show(),b.editor.focus())}})},close:function(){this.hide(),a.unbind(this.primitive.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive"}})})(Bliss,Bliss.$);
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};(function(a){var b=Mavo.Elements={};Object.defineProperties(b,{register:{value:function(c,d){if("object"===_typeof(arguments[0])){for(var e in arguments[0])b.register(e,arguments[0][e]);return}if(d.extend){var f=b[d.extend];d=a.extend(a.extend({},f),d)}if(-1<c.indexOf("@")){var g=c.split("@");d.selector=d.selector||g[0]||"*",void 0===d.attribute&&(d.attribute=g[1])}return d.selector=d.selector||c,d.id=c,Array.isArray(d.attribute)?d.attribute.forEach(function(e){var f=a.extend({},d);f.attribute=e,b[c+"@"+e]=f}):b[c]=d,b}},search:{value:function(c,d,e){var f=b.matches(c,d,e),g=f[f.length-1];if(g)return g;var h=a.extend({},b.defaultConfig[e||"string"]);return h.attribute=void 0===d?h.attribute:d,h}},matches:{value:function(a,c,d){var e=[];selectorloop:for(var f in b){var g=b[f],h=void 0===c&&g.default||c===g.attribute;if(h&&(void 0===d||"string"===d||d===g.datatype)){var i=g.selector||f;a.matches(i)&&(!g.test||g.test(a,c,d))&&e.push(g)}}return e}},isSVG:{value:function(a){return"http://www.w3.org/2000/svg"==a.namespaceURI}},defaultConfig:{value:{string:{editor:{tag:"input"}},number:{editor:{tag:"input",type:"number"}},boolean:{attribute:"content",editor:{tag:"input",type:"checkbox"}}}}}),b.register({"@hidden":{datatype:"boolean"},"@y":{test:b.isSVG,datatype:"number"},"@x":{default:!0,test:b.isSVG,datatype:"number"},media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var b=this,c=a.create("input",{type:"url",placeholder:"http://example.com/image.png",className:"mv-output","aria-label":"URL to image"});if(this.mavo.uploadBackend&&self.FileReader){var d,e=this.element.nodeName.toLowerCase();e="img"==e?"image":e;var f=this.element.getAttribute("mv-uploads")||e+"s",g=function(a){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a.name;if(a&&0===a.type.indexOf(e+"/")){var g=URL.createObjectURL(a);b.sneak(function(){return b.element.src=g}),b.mavo.upload(a,f+"/"+d).then(function(a){var d=0,e=Mavo.rr(function(){return Mavo.timeout(1e3+500*d).then(function(){d++,b.element.src=a})}),f=function(){URL.revokeObjectURL(g),b.element.removeEventListener("load",h),b.element.removeEventListener("error",h)},h=function(){b.element.src!=g&&(b.element.src=a,f())};c.value=a,b.element.addEventListener("load",h),b.element.addEventListener("error",function(){10>=d?(b.sneak(function(){return b.element.src=g}),e()):(b.mavo.error(b.mavo._("cannot-load-uploaded-file")+" "+a),f())})})}},h={paste:function(a){var b=a.clipboardData.items[0];if("file"==b.kind&&0===b.type.indexOf(e+"/")){var c="pasted-"+e+"-"+Date.now()+"."+b.type.slice(6);g(b.getAsFile(),c),a.preventDefault()}},"drag dragstart dragend dragover dragenter dragleave drop":function(a){a.preventDefault(),a.stopPropagation()},"dragover dragenter":function(){d.classList.add("mv-dragover"),b.element.classList.add("mv-dragover")},"dragleave dragend drop":function(){d.classList.remove("mv-dragover"),b.element.classList.remove("mv-dragover")},drop:function(a){g(a.dataTransfer.files[0])}};return a.bind(this.element,h),d=a.create({className:"mv-upload-popup",contents:[c,{tag:"input",type:"file","aria-label":"Upload image",accept:e+"/*",events:{change:function(a){var b=a.target.files[0];b&&g(b)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:h})}return c}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},details:{attribute:"open",datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},formControl:{selector:"input",default:!0,attribute:"value",modes:"edit",changeEvents:"input change",edit:function(){},done:function(){},init:function(){this.editor=this.element}},select:{extend:"formControl",selector:"select",subtree:!0},textarea:{extend:"formControl",selector:"textarea",attribute:null,getValue:function(a){return a.value},setValue:function(a,b){return a.value=b}},formNumber:{extend:"formControl",selector:"input[type=range], input[type=number]",datatype:"number",setValue:function(b,c){b.value=c,b.setAttribute("value",c);var d=c>b.value?"max":"min";if(!isNaN(c)&&b.value!=c&&!Mavo.data(b,"boundObserver")){var e=new Mavo.Observer(b,d,function(){b.value=c});requestAnimationFrame(function(){a.bind(b,"input mv-change",function c(){e.destroy(),Mavo.data(b,"boundObserver",void 0),a.unbind(b,"input mv-change",c)})}),Mavo.data(b,"boundObserver",e)}}},checkbox:{extend:"formControl",selector:"input[type=checkbox]",attribute:"checked",datatype:"boolean",changeEvents:"click"},radio:{extend:"formControl",selector:"input[type=radio]",attribute:"checked",modes:"edit",getValue:function(b){if(b.form)return b.form[b.name].value;var c=a("input[type=radio][name=\""+b.name+"\"]:checked");return c&&c.value},setValue:function(b,c){if(b.form)return void(b.form[b.name].value=c);var d=a("input[type=radio][name=\""+b.name+"\"][value=\""+c+"\"]");a.properties(d,{checked:!0})},init:function(a){var b=this;this.mavo.element.addEventListener("change",function(c){c.target.name==a.name&&(b.value=b.getValue())})}},counter:{extend:"formControl",selector:"button, .counter",attribute:"mv-clicked",datatype:"number",init:function(a){var b=this;"mv-clicked"===this.attribute&&(a.setAttribute("mv-clicked","0"),a.addEventListener("click",function(){var c=+a.getAttribute("mv-clicked")||0;b.value=++c}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var b=Math.min,c=Math.max,d=this,e=+this.element.getAttribute("min")||0,f=+this.element.getAttribute("max")||1,g=f-e,h=+this.element.getAttribute("mv-edit-step")||(1<g?1:g/100);a.bind(this.element,"mousemove.mavo:edit",function(a){var i=d.element.getBoundingClientRect().left,j=c(0,(a.clientX-i)/d.element.offsetWidth),k=e+g*j,l=k%h;k+=l>h/2?h-l:-l,k=c(e,b(k,f)),d.sneak(function(){return d.element.setAttribute("value",k)})}),a.bind(this.element,"mouseleave.mavo:edit",function(){d.sneak(function(){return d.element.setAttribute("value",d.value)})}),a.bind(this.element,"click.mavo:edit",function(){d.value=d.getValue()}),a.bind(this.element,"keydown.mavo:edit",function(a){if(a.target==d.element&&(37==a.keyCode||39==a.keyCode)){var g=h*(39==a.keyCode?1:-1)*(a.shiftKey?10:1),i=d.value+g;i=c(e,b(i,f)),d.element.setAttribute("value",i),a.preventDefault()}})},done:function(){a.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address",editor:function(){var b=getComputedStyle(this.element),c=b.display,d=0===c.indexOf("inline")?"input":"textarea",e=a.create(d);if("textarea"==d){var f=this.element.offsetWidth;f&&(e.width=f),e.style.whiteSpace={normal:"pre-wrap",nowrap:"pre"}[b.whiteSpace]||"inherit"}return e},setEditorValue:function(a){this.datatype&&"string"!=this.datatype&&(a+="");var b=getComputedStyle(this.element);return a=a||"",-1<["normal","nowrap"].indexOf(b.whiteSpace)&&(a=a.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(b.whiteSpace)&&(a=a.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=a,!0}},time:{attribute:"datetime",default:!0,init:function(){if(!this.fromTemplate("dateType")){var a=Mavo.DOMExpression.search(this.element,null),b=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var c in this.config.dateTypes)if(this.config.dateTypes[c].test(b))break;this.dateType=c,a||(this.element.textContent=this.config.defaultFormats[this.dateType](this.property),this.mavo.expressions.extract(this.element,null))}},dateTypes:{month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[Mi\d]{2}/i,date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i},defaultFormats:{date:function(a){return"[day("+a+")] [month("+a+").shortname] [year("+a+")]"},month:function(a){return"[month("+a+").name] [year("+a+")]"},time:function(a){return"[hour("+a+").twodigit]:[minute("+a+").twodigit]"},"datetime-local":function(a){return this.date(a)+" "+this.time(a)}},editor:function(){return{tag:"input",type:this.dateType}}},"circle@r":{default:!0,datatype:"number"},circle:{attribute:["cx","cy"],datatype:"number"},text:{default:!0,popup:!0},".mv-toggle":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){var b=this;Mavo.revocably.setAttribute(this.element,"role","checkbox"),a.bind(this.element,"click.mavo:edit keyup.mavo:edit keydown.mavo:edit",function(a){("click"==a.type||" "==a.key||"Enter"==a.key)&&("keydown"!=a.type&&(b.value=!b.value),a.preventDefault(),a.stopPropagation())})},done:function(){Mavo.revocably.restoreAttribute(this.element,"role"),a.unbind(this.element,".mavo:edit")}}})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var d=Mavo.Collection=a.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){this.templateElement=this.element,this.children=[],this.fromTemplate("mutable","templateElement","accepts")||(this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.templateElement=this.templateElement.cloneNode(!0));var a=this.createItem(this.element);this.add(a,void 0,{silent:!0}),this.itemTemplate=a.template||a,this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b={context:this,options:a,data:[]};if(this.children.forEach(function(a){if(!a.deleted||b.options.live){var c=a.getData(b.options);(b.options.live||null!==Mavo.value(c))&&b.data.push(c)}}),!this.mutable)if(b.data=b.data.filter(function(a){return null!==Mavo.value(a)}),b.options.live&&1===b.data.length)b.data=b.data[0];else if(this.data&&!b.options.live){var c=Mavo.subset(this.data,this.inPath);b.data=b.data.concat(c.slice(b.data.length))}return b.options.live&&Array.isArray(b.data)&&(b.data[Mavo.toNode]=this,b.data=this.relativizeData(b.data)),b.options.live||(b.data=Mavo.subset(this.data,this.inPath,b.data)),Mavo.hooks.run("node-getdata-end",b),b.data},createItem:function(a){a||(a=this.templateElement.cloneNode(!0));var b=Mavo.Node.create(a,this.mavo,{collection:this,template:this.itemTemplate||(this.template?this.template.itemTemplate:null),property:this.property,type:this.type});return b},add:function(b,c){var d=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(b=b instanceof Node?Mavo.Node.get(b)||this.createItem(b):b||this.createItem(),b.collection!=this&&this.adopt(b),this.mutable){var f=this.children[c]?this.children[c].element:this.marker;a[this.bottomUp?"after":"before"](b.element,f),void 0===c&&(c=this.bottomUp?0:this.length)}else c=this.length;var g={context:this,item:b};return g.previousIndex=b.index,g.changed=this.splice({remove:g.item},{index:c,add:g.item}),g.item.itembar&&g.item.itembar.reposition(),this.mavo.expressions.active&&!e.silent&&requestAnimationFrame(function(){g.changed.forEach(function(a){a.dataChanged(a==g.item&&void 0===g.previousIndex?"add":"move"),a.unsavedChanges=!0}),d.unsavedChanges=d.mavo.unsavedChanges=!0,d.mavo.expressions.update(g.item)}),Mavo.hooks.run("collection-add-end",g),g.item},splice:function(){for(var a=this,b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];c.forEach(function(b){b.index===void 0&&b.remove&&isNaN(b.remove)&&(b.index=a.children.indexOf(b.remove),b.remove=1)}),c.sort(function(c,a){return a.index-c.index}),c.forEach(function(b){if(-1<b.index&&(b.remove||b.add)){var c;b.remove=b.remove||0,b.add=Mavo.toArray(b.add),(c=a.children).splice.apply(c,[b.index,+b.remove].concat(_toConsumableArray(b.add)))}});for(var e,f=[],g=0;g<this.length;g++)e=this.children[g],e&&e.index!==g&&(e.index=g,f.push(e));return f},adopt:function(a){var b=this;a.collection&&(a.collection.splice({remove:a}),a.collection.dataChanged("delete")),this.walk(function(c){c.closestCollection===a.collection&&(c.closestCollection=b),a.mavo!=b.mavo&&(a.mavo=b.mavo)}),a.collection=this,a.template&&(Mavo.delete(a.template.copies,a),a.template=this.itemTemplate)},delete:function(b,c){var d=this;return c?(a.remove(b.element),this.splice({remove:b}),void b.destroy()):a.transition(b.element,{opacity:0}).then(function(){b.deleted=!0,b.element.style.opacity="",b.dataChanged("delete"),d.unsavedChanges=b.unsavedChanges=d.mavo.unsavedChanges=!0})},move:function(a,b){var c=a.index+b+(0<b);c=Mavo.wrap(c,this.children.length+1),this.add(a,c),a instanceof Mavo.Primitive&&a.itembar&&a.itembar.reposition()},editItem:function(a){var b=this,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},d=c.immediately?Promise.resolve():Mavo.inView.when(a.element);return d.then(function(){return b.mutable&&(!a.itembar&&(a.itembar=new Mavo.UI.Itembar(a)),a.itembar.add()),a.edit(c)})},edit:function(){var b=this,c=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var e=this.element.tagName.toLowerCase(),f=Mavo.selectors.container[e],g=f?this.marker.parentNode.closest(f):this.marker;a[this.bottomUp?"before":"after"](this.addButton,g)}d.dragula.then(function(){b.getDragula()})}return Promise.all(this.children.map(function(a){return b.editItem(a,c)}))},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(function(a){a.itembar&&a.itembar.remove()})))},dataChanged:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return b.element=b.element||this.marker,this.super.dataChanged.call(this,a,b)},save:function(){var a=this;this.children.forEach(function(b){b.deleted?a.delete(b,!0):b.unsavedChanges=!1})},propagated:["save"],dataRender:function(b){var c=this;if(void 0!==b)if(b=null===b?[]:Mavo.toArray(b).filter(function(a){return null!==a}),!this.mutable)this.children.forEach(function(a,c){return a.render(b&&b[c])});else{for(var d,e=0;e<this.children.length;e++)d=this.children[e],e<b.length?d.render(b[e]):(d.dataChanged("delete"),this.delete(d,!0),e--);if(b.length>e){for(var d,f=document.createDocumentFragment(),g=e;g<b.length;g++){d=this.createItem(),d.render(b[g]),this.children.push(d),d.index=g,f.appendChild(d.element);var h={context:this,item:d};Mavo.hooks.run("collection-add-end",h)}this.bottomUp?a.after(f,0<e?this.children[e-1].element:this.marker):a.before(f,this.marker);for(var g=e;g<this.children.length;g++)this.children[g].dataChanged("add"),this.mavo.expressions.active&&requestAnimationFrame(function(){return c.mavo.expressions.update(c.children[g])})}}},find:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=this.children.filter(function(a){return!a.deleted});if(this.property==a)return b.collections?this:c;if(this.properties.has(a)){var d=c.map(function(c){return c.find(a,b)});return Mavo.flatten(d)}},isCompatible:function(a){return a&&this.itemTemplate.nodeType==a.itemTemplate.nodeType&&(a===this||a.template==this||this.template==a||this.template&&this.template==a.template||-1<this.accepts.indexOf(a.property))},live:{mutable:function(b){if(b&&b!==this.mutable){this._mutable=b,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this);var c=this.templateElement.parentNode?this.templateElement:this.children[this.length-1].element;a.after(this.marker,c)}}},getDragula:function(){var a=this;if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:function(b){return!!a.accepts.length&&-1<Mavo.flatten(a.accepts.map(function(b){return a.mavo.root.find(b,{collections:!0})})).filter(function(a){return a&&a instanceof d}).map(function(a){return a.marker.parentNode}).indexOf(b)},moves:function(a,b,c){return c.classList.contains("mv-drag-handle")&&c.closest(Mavo.selectors.multiple)==a},accepts:function(a,b,c,e){if(a.contains(b))return!1;var f=e?e.previousElementSibling:b.lastElementChild,g=d.get(f)||d.get(e);if(!g)return!1;var h=Mavo.Node.get(a);return h&&h.collection.isCompatible(g)}}),this.dragula.on("drop",function(b){var c=Mavo.Node.get(b),e=c&&c.index,f=b.nextElementSibling,g=b.previousElementSibling,h=d.get(g)||d.get(f),i=Mavo.Node.get(g)||Mavo.Node.get(f);if(i&&i.collection!=h&&(i=null),c.collection.isCompatible(h)){var j=i?i.index+(i.element===g):h.length;h.add(c,j)}else return a.dragula.cancel(!0)}),d.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var a=this.templateElement.getAttribute("mv-order");return null===a?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(a)},closestCollection:function(){var a=this.marker?this.marker.parentNode:this.templateElement.parentNode;return a.closest(Mavo.selectors.multiple)},addButton:function(){var c=this,d="button.mv-add-"+this.property,e=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(e)var f=b(d,e).filter(function(a){return!c.templateElement.contains(a)})[0];return f||(f=a.create("button",{className:"mv-add",textContent:this.mavo._("add-item",this)})),f.classList.add("mv-ui","mv-add"),Mavo.data(f,"collection",this),this.property&&f.classList.add("mv-add-"+this.property),f.addEventListener("click",function(a){a.preventDefault(),c.editItem(c.add())}),f}},static:{dragulas:[],get:function(a){var b=Mavo.data(a,"collection");if(b)return b;var c=Mavo.Node.get(a);return c&&c.collection||null},lazy:{dragula:function(){return a.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}}})})(Bliss,Bliss.$);
"use strict";(function(a,b){var c=Mavo.UI.Itembar=a.Class({constructor:function(c){var d=this;if(this.item=c,this.element=b(".mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel=\""+this.item.property+"\"]",this.item.element).filter(function(a){return a.closest(Mavo.selectors.multiple)==d.item.element&&!Mavo.data(a,"item")})[0],!this.element&&this.item.template&&this.item.template.itembar)this.element=this.item.template.itembar.element.cloneNode(!0),this.dragHandle=a(".mv-drag-handle",this.element)||this.item.element;else{this.element=this.element||a.create({className:"mv-item-bar mv-ui"});var e=[{tag:"button",title:this.mavo._("delete-item",this.item),className:"mv-delete"},{tag:"button",title:this.mavo._("add-item-"+(this.collection.bottomUp?"after":"before"),this.item),className:"mv-add"}];this.item instanceof Mavo.Group?(this.dragHandle=a.create({tag:"button",title:this.mavo._("drag-to-reorder",this.item),className:"mv-drag-handle"}),e.push(this.dragHandle)):this.dragHandle=this.item.element,a.set(this.element,{"mv-rel":this.item.property,contents:e})}this.element.setAttribute("hidden",""),a.bind([this.item.element,this.element],"focusin mouseover",this),a.bind(this.element,{mouseenter:function(){d.item.element.classList.add("mv-highlight")},mouseleave:function(){d.item.element.classList.remove("mv-highlight")}}),this.dragHandle.addEventListener("keydown",function(a){a.target===d.dragHandle&&d.item.editing&&37<=a.keyCode&&40>=a.keyCode&&(d.collection.move(d.item,38>=a.keyCode?-1:1),a.stopPropagation(),a.preventDefault(),a.target.focus())});var f={add:this.buttonSelector("add"),delete:this.buttonSelector("delete"),drag:this.buttonSelector("drag")};this.element.addEventListener("click",function(a){if(d.item.collection.editing){if(a.target.matches(f.add)){var b=d.collection.add(null,d.item.index);return a[Mavo.superKey]&&b.render(d.item.getData()),Mavo.scrollIntoViewIfNeeded(b.element),d.collection.editItem(b)}a.target.matches(f.delete)?d.item.collection.delete(c):a.target.matches(f["drag-handle"])&&function(a){return a.target.focus()}}}),Mavo.data(this.element,"item",this.item)},destroy:function(){this.hide()},show:function(b){var d=this;c.visible.forEach(function(a){a!=d&&(!d.sticky||a.sticky)&&(clearTimeout(a.hideTimeout),a.hide(b,c.DELAY))}),c.visible.add(this),(this.element.hasAttribute("hidden")||b&&!this.sticky)&&(this.element.removeAttribute("hidden"),this.sticky=this.sticky||b,a.bind([this.item.element,this.element],"focusout mouseleave",this),this.adjacent&&a.style(this.element,{"--mv-item-width":this.item.element.offsetWidth+"px","--mv-item-height":this.item.element.offsetHeight+"px","--mv-item-left":this.item.element.offsetLeft+"px","--mv-item-top":this.item.element.offsetTop+"px"}))},hide:function(b){var d=this,e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;(!this.sticky||b)&&(e?this.hideTimeout=setTimeout(function(){return d.hide(b)},e):(this.element.setAttribute("hidden",""),a.unbind([this.item.element,this.element],"focusout mouseleave",this),this.sticky=!1,c.visible.delete(this)))},handleEvent:function(a){var b=-1===a.type.indexOf("mouse");this.isWithinItem(a.target)&&(clearTimeout(this.hideTimeout),-1<["mouseleave","focusout","blur"].indexOf(a.type)?!this.isWithinItem(a.relatedTarget)&&this.hide(b,c.DELAY):(this.show(b),a.stopPropagation()))},isWithinItem:function(a){if(!a)return!1;var b=a.closest(".mv-item-bar");return b?b===this.element:a.closest(Mavo.selectors.item)===this.item.element},add:function(){this.element.parentNode||Mavo.revocably.add(this.element)||(this.item instanceof Mavo.Primitive&&!this.item.attribute?(this.adjacent=!0,a.after(this.element,this.item.element)):this.item.element.appendChild(this.element)),this.dragHandle==this.item.element&&this.item.element.classList.add("mv-drag-handle")},remove:function(){Mavo.revocably.remove(this.element),this.dragHandle==this.item.element&&this.item.element.classList.remove("mv-drag-handle")},reposition:function(){this.item instanceof Mavo.Primitive&&(this.element.remove(),this.add())},buttonSelector:function(a){return".mv-"+a+"[mv-rel=\""+this.item.property+"\"], [mv-rel=\""+this.item.property+"\"] > .mv-"+a},live:{sticky:function(a){this.element.classList.toggle("mv-sticky",a)},adjacent:function(a){this.element.classList.toggle("mv-adjacent",a)}},proxy:{collection:"item",mavo:"item"},static:{DELAY:100,visible:new Set}})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a){Mavo.attributes.push("mv-expressions");var b=Mavo.Expression=a.Class({constructor:function(a){this.expression=a},eval:function(a){Mavo.hooks.run("expression-eval-beforeeval",this);try{return this.function||(this.function=Mavo.Script.compile(this.expression)),this.function(a)}catch(a){return console.info("%cExpression error!","color: red; font-weight: bold",a.message+" in expression "+this.expression,"\nNot an expression? Use mv-expressions=\"none\" to disable expressions on an element and its descendants."),Mavo.hooks.run("expression-eval-error",{context:this,exception:a}),a}},toString:function(){return this.expression},changedBy:function(a){return b.changedBy(this.identifiers,a)},live:{expression:function(a){this.function=null,this.identifiers=a.match(/[$a-z][$\w]*/ig)||[]}},static:{changedBy:function(a,b){if(!b)return!0;if(!a)return!1;if(-1<a.indexOf(b.property))return!0;if(Mavo.Functions.intersects(b.properties,a))return!0;if("propertychange"==b.action)return Mavo.Functions.intersects(a,b.node.path);if(Mavo.Functions.intersects(["$index","$previous","$next"],a))return!0;var c=b.node.collection||b.node;return!!Mavo.Functions.intersects(c.properties,a)}}});b.Syntax=a.Class({constructor:function(a,b){this.start=a,this.end=b,this.regex=RegExp(Mavo.escapeRegExp(a)+"([\\S\\s]+?)"+Mavo.escapeRegExp(b),"gi")},test:function(a){return this.regex.lastIndex=0,this.regex.test(a)},tokenize:function(a){var b,c=[],d=0;for(this.regex.lastIndex=0;null!==(b=this.regex.exec(a));)b.index>d&&c.push(a.substring(d,b.index)),d=this.regex.lastIndex,c.push(new Mavo.Expression(b[1]));return d<a.length&&c.push(a.substring(d)),c},static:{create:function(a){if(a){var c=a.getAttribute("mv-expressions");if(c)return c=c.trim(),/\s/.test(c)?new(Function.prototype.bind.apply(b.Syntax,[null].concat(_toConsumableArray(c.split(/\s+/))))):b.Syntax.ESCAPE}},ESCAPE:-1}}),b.Syntax.default=new b.Syntax("[","]")})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a){var b=Mavo.DOMExpression=a.Class({constructor:function(){var c=this,d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.mavo=d.mavo,this.template=d.template&&d.template.template||d.template;for(var e,f=["item","path","syntax","fallback","attribute","originalAttribute","expression","parsed"],g=0;g<f.length;g++)e=f[g],this[e]=void 0===d[e]&&this.template?this.template[e]:d[e];if(this.node=d.node,this.node||(this.node=Mavo.elementPath(this.item.element,this.path)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),"mv-value"==this.attribute){this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute});var h=this.element.getAttribute("mv-value");this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(h)],this.expression=this.syntax.start+h+this.syntax.end}if(3===this.node.nodeType&&this.element===this.node&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),!this.expression){if(this.attribute){var i=Element.prototype.getAttribute.call(this.node,this.attribute);this.expression=(i||"").trim()}else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var j=this.node.firstChild.textContent.match(/^\s*|\s*$/g);j[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-j[1].length),a.after(this.node.lastChild,this.node)),j[0]&&(this.node.firstChild.splitText(j[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=d.template?d.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(function(a){return a instanceof Mavo.Expression?a.expression:a}),this.item=Mavo.Node.get(this.element.closest(Mavo.selectors.item)),this.mavo.treeBuilt.then(function(){c.template||c.item||(c.item=Mavo.Node.get(c.element.closest(Mavo.selectors.item))),"mv-value"==c.originalAttribute&&c.mavoNode&&c.mavoNode==c.item.collection&&Mavo.delete(c.item.expressions,c),Mavo.hooks.run("domexpression-init-treebuilt",c)}),Mavo.hooks.run("domexpression-init-end",this),b.elements.set(this.element,[].concat(_toConsumableArray(b.elements.get(this.element)||[]),[this]))},destroy:function(){b.special.delete(this)},changedBy:function(a){return"mv-value"==this.originalAttribute&&this.mavoNode&&!(this.mavoNode instanceof Mavo.Primitive)?!a||!this.mavoNode.contains(a.node):(this.identifiers||(this.identifiers=Mavo.flatten(this.parsed.map(function(a){return a.identifiers||[]})),b.special.add(this)),Mavo.Expression.changedBy(this.identifiers,a))},update:function(){var a=this,b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.data,c=arguments[1],d={context:this,event:c},e=d;this.data=b,Mavo.hooks.run("domexpression-update-start",d),this.oldValue=this.value;var f=!1;d.value=this.value=this.parsed.map(function(c,d){if(c instanceof Mavo.Expression){if(c.changedBy(e.event)){var g={context:a,expr:c,parentEnv:e};return Mavo.hooks.run("domexpression-update-beforeeval",g),g.value=Mavo.value(g.expr.eval(b)),Mavo.hooks.run("domexpression-update-aftereval",g),f=!0,g.value instanceof Error?void 0===a.fallback?a.syntax.start+g.expr.expression+a.syntax.end:a.fallback:void 0===g.value||null===g.value?"":g.value}return a.oldValue[d]}return c});f&&(d.value=1===d.value.length?d.value[0]:d.value.map(function(b){return Mavo.Primitive.format(b,{attribute:a.attribute,element:a.element})}).join(""),this.output(d.value),Mavo.hooks.run("domexpression-update-end",d))},output:function(a){this.primitive?this.primitive.value=a:this.mavoNode?this.mavoNode.render(a):Mavo.Primitive.setValue(this.node,a,{attribute:this.attribute})},live:{item:function(a){a&&this._item!=a&&(this._item&&Mavo.delete(this._item.expressions,this),a.expressions=a.expressions||[],a.expressions.push(this))}},static:{elements:new WeakMap,search:function(a,c){if(null===a)return a;var d=b.elements.get(a)||[];return 1<arguments.length?d.length?d.filter(function(a){return a.attribute===c})[0]||null:null:d},special:{add:function(a,b){if(b){var c=this.vars[b];c&&-1<a.identifiers.indexOf(b)&&(c.all=c.all||new Set,c.all.add(a),1===c.all.size?c.observe():!c.all.size&&c.unobserve())}else for(var b in this.vars)this.add(a,b)},delete:function(a,b){if(b){var c=this.vars[b];c.all=c.all||new Set,c.all.delete(a),c.all.size||c.unobserve()}else for(var b in this.vars)this.delete(a,b)},update:function(){this.update&&this.update.apply(this,arguments),this.all.forEach(function(a){return a.update()})},event:function(a){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},d=c.type,e=c.update,f=c.target,g=f===void 0?document:f;this.vars[a]={observe:function(){this.callback=this.callback||b.special.update.bind(this),g.addEventListener(d,this.callback)},unobserve:function(){g.removeEventListener(d,this.callback)}},e&&(this.vars[a].update=function(b){Mavo.Functions[a]=e(b)})},vars:{$now:{observe:function(){var a=this;this.timer=requestAnimationFrame(function c(){b.special.update.call(a),a.timer=requestAnimationFrame(c)})},unobserve:function(){cancelAnimationFrame(this.timer)}}}}}});b.special.event("$mouse",{type:"mousemove",update:function(a){return{x:a.clientX,y:a.clientY}}}),b.special.event("$hash",{type:"hashchange",target:window})})(Bliss,Bliss.$);
"use strict";function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){var c=Mavo.Expressions=a.Class({constructor:function(a){var b=this;this.mavo=a,this.active=!0,this.expressions=[];var d=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,d),this.scheduled={},this.mavo.treeBuilt.then(function(){b.expressions=[],document.documentElement.addEventListener("mv-change",function(a){if(b.active){var d=b.scheduled[a.action]=b.scheduled[a.action]||new Set;a.node.template?!d.has(a.node.template)&&(setTimeout(function(){d.delete(a.node.template),b.update(a)},c.THROTTLE),d.add(a.node.template)):requestAnimationFrame(function(){return b.update(a)})}}),b.update()})},update:function(b){if(this.active){var c,d;b instanceof Mavo.Node?(d=b,b=null):b instanceof Element?(c=b.closest(Mavo.selectors.item),d=Mavo.Node.get(c),b=null):d=this.mavo.root;var e=d.getData({live:!0});d.walk(function(c,d){if(c.expressions&&c.expressions.length&&!c.isDeleted()){var f=a.value.apply(a,[e].concat(_toConsumableArray(d)));c.expressions.forEach(function(a){a.changedBy(b)&&a.update(f,b)})}})}},extract:function(a,b,d){var e=3<arguments.length&&arguments[3]!==void 0?arguments[3]:Mavo.Expression.Syntax.default;b&&"mv-expressions"==b.name||(b&&-1<c.directives.indexOf(b.name)||e!==Mavo.Expression.Syntax.ESCAPE&&e.test(b?b.value:a.textContent))&&(d===void 0&&(d=Mavo.elementPath(a.closest(Mavo.selectors.item),a)),this.expressions.push(new Mavo.DOMExpression({node:a,syntax:e,path:d,attribute:b&&b.name,mavo:this.mavo})))},traverse:function(a){var c=this,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],e=arguments[2];if(8!==a.nodeType)if(3===a.nodeType)this.extract(a,null,d,e);else{a.normalize(),e=Mavo.Expression.Syntax.create(a)||e,Mavo.is("item",a)&&(d=[]),b(a.attributes).forEach(function(b){return c.extract(a,b,d,e)});var f=-1,g=0;a.matches("script:not([mv-expressions])")||b(a.childNodes).forEach(function(a){if(1==a.nodeType?(g=0,f++):g++,1==a.nodeType||3==a.nodeType){var b=0<g?f+"."+g:f;c.traverse(a,[].concat(_toConsumableArray(d||[]),[b]),e)}})}},static:{directives:["mv-value"],THROTTLE:50,directive:function(a,b){c.directives.push(a),Mavo.attributes.push(a),Mavo.Plugins.register(a,b)}}})})(Bliss,Bliss.$);
"use strict";(function(a,b){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(a){this._hidden!==a&&(this._hidden=a,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var a=this,c=b(Mavo.selectors.property,this.element).filter(function(b){return b.closest("[mv-if]")==a.element}).map(function(a){return Mavo.Node.get(a)});return this.element.addEventListener("mv-change",function(b){requestAnimationFrame(function(){a.element.parentNode||a.item.element.dispatchEvent(b)})}),c}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){var a=this;if("mv-if"==this.attribute){var b=this.value[0],c=this.oldValue[0];this.item.mavo.treeBuilt.then(function(){if(a.parentIf){var d=a.parentIf.value[0];a.value[0]=b=b&&d}!1!==d&&(b?Mavo.revocably.add(a.element):a.element.parentNode&&Mavo.revocably.remove(a.element,"mv-if")),b!==c&&(a.childProperties&&a.childProperties.forEach(function(a){return a.hidden=!b}),a.childIfs&&a.childIfs.forEach(function(a){return a.update()}))})}},"unit-isdatanull":function(a){a.result=a.result||this.hidden&&a.options.live}}})})(Bliss,Bliss.$);
"use strict";function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,b){function c(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return a=b(a),a||0===a?a+"":""}function d(a){return a=Mavo.value(a),null===a||!1===a||""===a}function e(a){return!b(a)}function f(a,b){var c=a.toLocaleString(Mavo.locale,b);return c=c.replace(/\u200e/g,""),c}function g(a){return function(b){if(b=l.date(b),!b)return"";var c=m[a](b);return c=new self["year"==a?"String":"Number"](c),("month"==a||"weekday"==a)&&(c.name=f(b,_defineProperty({},a,"long")),c.shortname=f(b,_defineProperty({},a,"short"))),"weekday"!=a&&(c.twodigit=(10>c%100?"0":"")+c%100),c}}var h=Math.floor,i=Math.abs,j=Math.min,k=Mavo.Functions={operators:{"=":"eq"},get:function(a,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};c=d.property=b(c);var e=Mavo.getCanonicalProperty(a,c);if(void 0!==e){d.property=e;var f=a[e];return"function"==typeof f&&0!==f.name.indexOf("bound")?f.bind(a):f}if(Array.isArray(a)&&c&&isNaN(c)){var g=c.indexOf("=");return-1<g?(d.query={property:c.slice(0,g),value:c.slice(g+1)},d.property=[],f=a.filter(function(a,b){var c=k.get(a,d.query.property)==d.query.value;return c&&d.property.push(b),c}),"id"==d.query.property&&(d.property=d.property[0],f=f[0]),void 0===f?d.property=a.length:0===f.length&&(d.property=[a.length]),f):a.map(function(a){return k.get(a,c)})}return null},url:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:location;if(void 0===a)return location.href;if(a){a=c(a).replace(/[^\w-:]/g);var d=b.search.match(RegExp("[?&]"+a+"(?:=(.+?))?(?=$|&)"))||b.pathname.match(RegExp("(?:^|\\/)"+a+"\\/([^\\/]*)"))}return null!==d&&a?decodeURIComponent(d[1])||"":null},first:function(a){return a&&a[0]||""},last:function(a){return a&&a[a.length-1]||""},unique:function(a){return Array.isArray(a)?[].concat(_toConsumableArray(new Set(a.map(b)))):a},intersects:function(a,c){if(a&&c){var d=new Set(c.map?c.map(b):c);return a=a.map?a.map(b):[].concat(_toConsumableArray(a)),!a.every(function(a){return!d.has(a)})}},sum:function(a){return l.numbers(a,arguments).reduce(function(a,b){return+a+(+b||0)},0)},average:function(a){return a=l.numbers(a,arguments),a.length&&k.sum(a)/a.length},min:function(a){return j.apply(Math,_toConsumableArray(l.numbers(a,arguments)))},max:function(a){return Math.max.apply(Math,_toConsumableArray(l.numbers(a,arguments)))},count:function(a){return Mavo.toArray(a).filter(function(b){return!d(b)}).length},reverse:function(a){return Mavo.toArray(a).slice().reverse()},round:function(a,b){return e(a)||e(b)||!isFinite(a)?Math.round(a):+a.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:b})},th:function(a){if(d(a))return"";if(10>b||20<b)var b=["th","st","nd","th"][a%10];return b=b||"th",a+b},iff:function(a){var d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:a,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return Array.isArray(a)?a.map(function(a,c){var f=b(a)?d:e;return Array.isArray(f)?f[j(c,f.length-1)]:f}):b(a)?d:e},replace:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;if(Array.isArray(a))return a.map(function(a){return k.replace(a,b,c)});for(var e,f=RegExp(Mavo.escapeRegExp(b),"g"),g=a,h=0;g!=e&&h++<d;)e=g,g=g.replace(f,c);return g},len:function(a){return c(a).length},search:function(a,b){return a&&b?c(a).toLowerCase().indexOf((b+"").toLowerCase()):-1},starts:function(a,b){return 0===k.search(c(a),c(b))},ends:function(a,b){var d=[c(a),c(b)];a=d[0],b=d[1];var e=k.search(a,b);return-1<e&&e===a.length-b.length},join:function(a,b){return Mavo.toArray(a).join(c(b))},idify:function(a){return c(a).trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").toLowerCase()},readable:function(a){return c(a).replace(/([a-z])([A-Z])(?=[a-z])/g,function(a,b,c){return b+" "+c.toLowerCase()}).replace(/([a-z0-9])[_\/-](?=[a-z0-9])/g,"$1 ").replace(/^[a-z]/,function(a){return a.toUpperCase()})},uppercase:function(a){return c(a).toUpperCase()},lowercase:function(a){return c(a).toLowerCase()},from:function(a,b){return k.between(a,b)},from_last:function(a,b){return k.between(a,b,"",!0)},to:function(a,b){return k.between(a,"",b)},tofirst:function(a,b){return k.between(a,"",b,!0)},between:function(a,b,d,e){var f=[c(a),c(b),c(d)];a=f[0],b=f[1],d=f[2];var g=b?a[e?"lastIndexOf":"indexOf"](b):-1,h=a[e?"indexOf":"lastIndexOf"](d);return a.slice(g+1,-1!==h&&d?h:a.length)},filename:function(a){return Mavo.match(new URL(c(a),Mavo.base).pathname,/[^/]+?$/)},json:function(a){return Mavo.safeToJSON(a)},get $now(){return new Date},$startup:new Date,get $today(){return k.date(new Date)},year:g("year"),month:g("month"),day:g("day"),weekday:g("weekday"),hour:g("hour"),minute:g("minute"),second:g("second"),ms:g("ms"),date:function(a){return a=l.date(a),a?k.year(a)+"-"+k.month(a).twodigit+"-"+k.day(a).twodigit:""},time:function(a){return a=l.date(a),a?k.hour(a).twodigit+":"+k.minute(a).twodigit+":"+k.second(a).twodigit:""},minutes:function(a){return h(i(a)/60)||0},hours:function(a){return h(i(a)/3600)||0},days:function(a){return h(i(a)/86400)||0},weeks:function(a){return h(i(a)/604800)||0},months:function(a){return h(i(a)/(30.4368*86400))||0},years:function(a){return h(i(a)/(12*(30.4368*86400)))||0},localTimezone:-new Date().getTimezoneOffset(),log:function(){for(var a,c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return(a=console).log.apply(a,_toConsumableArray(d.map(b))),d[0]},$mouse:{x:0,y:0},get $hash(){return location.hash.slice(1)},util:{numbers:function(a,c){return a=Array.isArray(a)?a:c?$$(c):[a],a.filter(function(a){return!isNaN(a)&&""!==b(a)}).map(function(a){return+a})},fixDateString:function(a){a=a.trim();var b=/^\d{4}-\d{2}(-\d{2})?/.test(a),c=-1<a.indexOf(":");return b||c?(a=b?a.replace(/^(\d{4}-\d{2})(?!-\d{2})/,"$1-01"):k.$today+" "+a,c?a=a.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"):a+="T00:00:00",a=a.replace(/\s+/g,""),a):null},date:function(c){if(c=b(c),!c)return null;if("string"===a.type(c)){if(c=l.fixDateString(c),null===c)return null;var d=Mavo.match(c,/[+-]\d{2}:?\d{2}|Z$/);if(d)c=new Date(c);else{var e=c.match(/\d+/g);c=new Date(e[0],(e[1]||1)-1,e[2]||1,e[3]||0,e[4]||0,e[5]||0,e[6]||0)}}else c=new Date(c);return isNaN(c)?null:c}}},l=k.util;k._Trap=self.Proxy?new Proxy(k,{get:function(a,b){var c,d=Mavo.getCanonicalProperty(a,b)||Mavo.getCanonicalProperty(Math,b);return d&&(c=a[d],void 0===c&&(c=Math[d])),void 0===c?b in self?self[b]:b:("function"==typeof c&&(c.toString=function(){return b}),c)},has:function(a,b){return"data"!=b}}):k;var m={year:function(a){return a.getFullYear()},month:function(a){return a.getMonth()+1},day:function(a){return a.getDate()},weekday:function(a){return a.getDay()||7},hour:function(a){return a.getHours()},minute:function(a){return a.getMinutes()},second:function(a){return a.getSeconds()},ms:function(a){return a.getMilliseconds()}}})(Bliss,Mavo.value);
"use strict";var _slicedToArray=function(){function a(a,b){var c,d=[],e=!0,f=!1;try{for(var g,h=a[Symbol.iterator]();!(e=(g=h.next()).done)&&(d.push(g.value),!(b&&d.length===b));e=!0);}catch(a){f=!0,c=a}finally{try{!e&&h["return"]&&h["return"]()}finally{if(f)throw c}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}(function(a,c,d){var b=Mavo.Script={addUnaryOperator:function(a,b){return b.symbol&&Mavo.toArray(b.symbol).forEach(function(b){Mavo.Script.unarySymbols[b]=a,jsep.addUnaryOp(b)}),Mavo.Functions[a]=function(a){return Array.isArray(a)?a.map(c).map(b.scalar):b.scalar(c(a))}},addBinaryOperator:function(a,e){return e.symbol&&Mavo.toArray(e.symbol).forEach(function(b){Mavo.Script.symbols[b]=a,e.precedence&&jsep.addBinaryOp(b,e.precedence)}),e.identity=void 0===e.identity?0:e.identity,Mavo.Functions[a]=e.code||function(){for(var a=arguments.length,f=Array(a),b=0;b<a;b++)f[b]=arguments[b];1===f.length&&Array.isArray(f[0])&&(f=[].concat(_toConsumableArray(f[0]))),e.raw||(f=f.map(c));for(var g,h=e.logical?e.identity:f[0],j=function(c){var j=e.logical?f[c-1]:h,a=f[c];Array.isArray(a)?("number"==typeof e.identity&&(a=d.numbers(a)),g=Array.isArray(j)?[].concat(_toConsumableArray(a.map(function(a,b){return e.scalar(void 0===j[b]?e.identity:j[b],a)})),_toConsumableArray(j.slice(a.length))):a.map(function(a){return e.scalar(j,a)})):Array.isArray(j)?g=j.map(function(b){return e.scalar(b,a)}):g=e.scalar(j,a),h=e.reduce?e.reduce(h,g,j,a):e.logical?h&&g:g},k=1;k<f.length;k++)j(k);return h}},symbols:{},unarySymbols:{},getOperatorName:function(a,b){return Mavo.Script[b?"unarySymbols":"symbols"][a]||a},operators:{not:{symbol:"!",scalar:function(b){return!b}},multiply:{scalar:function(c,a){return c*a},identity:1,symbol:"*"},divide:{scalar:function(c,a){return c/a},identity:1,symbol:"/"},add:{scalar:function(c,d){return+c+ +d},symbol:"+"},plus:{scalar:function(b){return+b},symbol:"+"},subtract:{scalar:function(c,a){if(isNaN(c)||isNaN(a)){var b=d.date(c),e=d.date(a);if(b&&e)return(b-e)/1e3}return c-a},symbol:"-"},minus:{scalar:function(b){return-b},symbol:"-"},mod:{scalar:function(c,a){var b=c%a;return b+=0>b?a:0,b},symbol:"mod",precedence:6},lte:{logical:!0,scalar:function(c,a){var b=Mavo.Script.getNumericalOperands(c,a),d=_slicedToArray(b,2);return c=d[0],a=d[1],c<=a},identity:!0,symbol:"<="},lt:{logical:!0,scalar:function(c,a){var b=Mavo.Script.getNumericalOperands(c,a),d=_slicedToArray(b,2);return c=d[0],a=d[1],c<a},identity:!0,symbol:"<"},gte:{logical:!0,scalar:function(c,a){var b=Mavo.Script.getNumericalOperands(c,a),d=_slicedToArray(b,2);return c=d[0],a=d[1],c>=a},identity:!0,symbol:">="},gt:{logical:!0,scalar:function(c,a){var b=Mavo.Script.getNumericalOperands(c,a),d=_slicedToArray(b,2);return c=d[0],a=d[1],c>a},identity:!0,symbol:">"},eq:{logical:!0,scalar:function(c,a){return c==a},symbol:["=","=="],identity:!0,precedence:6},neq:{logical:!0,scalar:function(c,a){return c!=a},symbol:["!="],identity:!0},and:{logical:!0,scalar:function(c,d){return!!c&&!!d},identity:!0,symbol:["&&","and"],precedence:2},or:{logical:!0,scalar:function(c,a){return c||a},reduce:function(a,b){return a||b},identity:!1,symbol:["||","or"],precedence:2},concatenate:{symbol:"&",identity:"",scalar:function(c,a){return""+(c||"")+(a||"")},precedence:10},filter:{scalar:function(d,a){return c(a)?d:null},raw:!0}},getNumericalOperands:function(c,a){if(isNaN(c)||isNaN(a)){var b=d.date(c),e=d.date(a);if(b&&e)return[b,e]}return[c,a]},serializers:{BinaryExpression:function(a){return b.serialize(a.left)+" "+a.operator+" "+b.serialize(a.right)},UnaryExpression:function(a){return""+a.operator+b.serialize(a.argument)},CallExpression:function(a){return b.serialize(a.callee)+"("+a.arguments.map(b.serialize).join(", ")+")"},ConditionalExpression:function(a){return b.serialize(a.test)+"? "+b.serialize(a.consequent)+" : "+b.serialize(a.alternate)},MemberExpression:function(a){var c=a.computed?b.serialize(a.property):"\""+a.property.name+"\"";return"get("+b.serialize(a.object)+", "+c+")"},ArrayExpression:function(a){return"["+a.elements.map(b.serialize).join(", ")+"]"},Literal:function(a){return a.raw},Identifier:function(a){return a.name},ThisExpression:function(){return"this"},Compound:function(a){return a.body.map(b.serialize).join(" ")}},transformations:{BinaryExpression:function(a){var c=Mavo.Script.getOperatorName(a.operator),d=a,e=[];do e.unshift(d.right),d=d.left;while(Mavo.Script.getOperatorName(d.operator)===c);if(e.unshift(d),1<e.length)return c+"("+e.map(b.serialize).join(", ")+")"},UnaryExpression:function(a){var c=Mavo.Script.getOperatorName(a.operator,!0);if(c)return c+"("+b.serialize(a.argument)+")"},CallExpression:function(a){"Identifier"==a.callee.type&&("if"==a.callee.name&&(a.callee.name="iff"),a.callee.name="Mavo.Functions._Trap."+a.callee.name)}},serialize:function(a){var c=b.transformations[a.type]&&b.transformations[a.type](a);return void 0===c?b.serializers[a.type](a):c},rewrite:function(a){try{return b.serialize(b.parse(a))}catch(b){return a}},compile:function(a){return a=b.rewrite(a),new Function("data","with(Mavo.Functions._Trap)\n\t\t\t\twith (data || {}) {\n\t\t\t\t\treturn ("+a+");\n\t\t\t\t}")},parse:self.jsep};for(var e in b.serializers.LogicalExpression=b.serializers.BinaryExpression,b.transformations.LogicalExpression=b.transformations.BinaryExpression,Mavo.Script.operators){var f=Mavo.Script.operators[e];2>f.scalar.length?Mavo.Script.addUnaryOperator(e,f):Mavo.Script.addBinaryOperator(e,f)}var g={average:"avg",iff:"iff IF",multiply:"mult product",divide:"div",lt:"smaller",gt:"larger bigger",eq:"equal equality",th:"ordinal"},h=function(a){g[a].split(/\s+/g).forEach(function(b){return Mavo.Functions[b]=Mavo.Functions[a]})};for(var i in g)h(i)})(Bliss,Mavo.value,Mavo.Functions.util);
"use strict";(function(a){var b=Mavo.Backend.register(a.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-dropbox-key")||"2mx6061p054bpbp",this.url=b.fixShareURL(this.url),this.login(!0)},upload:function(a,b){var c=this;return b=this.path.replace(/[^/]+$/,"")+b,this.put(a,b).then(function(){return c.getURL(b)})},getURL:function(a){return this.request("sharing/create_shared_link_with_settings",{path:a},"POST").then(function(a){return b.fixShareURL(a.url)})},put:function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return this.request("https://content.dropboxapi.com/2/files/upload",a,"POST",{headers:{"Dropbox-API-Arg":JSON.stringify({path:b,mode:"overwrite"}),"Content-Type":"application/octet-stream"}})},oAuthParams:function(){return"&redirect_uri="+encodeURIComponent("https://auth.mavo.io")+"&response_type=code"},getUser:function(){var a=this;return this.user?Promise.resolve(this.user):this.request("users/get_current_account","null","POST").then(function(b){a.user={username:b.email,name:b.name.display_name,avatar:b.profile_photo_url,info:b}})},login:function(a){var b=this;return this.oAuthenticate(a).then(function(){return b.getUser()}).then(function(){b.user&&(b.permissions.logout=!0,b.request("sharing/get_shared_link_metadata",{url:b.source},"POST").then(function(a){b.path=a.path_lower,b.permissions.on(["edit","save"])}))})},logout:function(){return this.oAuthLogout()},static:{apiDomain:"https://api.dropboxapi.com/2/",oAuth:"https://www.dropbox.com/oauth2/authorize",test:function(a){return a=new URL(a,Mavo.base),/dropbox.com/.test(a.host)},fixShareURL:function(a){return a=new URL(a,Mavo.base),a.hostname="dl.dropboxusercontent.com",a.search=a.search.replace(/\bdl=0|^$/,"raw=1"),a}}}))})(Bliss,Bliss.$);
"use strict";(function(a){var b=Mavo.Backend.register(a.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var c=b.parseURL(this.url);if(c.username){if(a.extend(this,c),this.repo=this.repo||"mv-data",this.path=this.path||"",!/\.\w+$/.test(this.path)){var d=this.format.constructor.extensions[0]||".json";this.path+="/"+this.mavo.id+d}this.path=this.path.replace(/\/\/|^\/|\/$/g,""),this.apiCall="repos/"+this.username+"/"+this.repo+"/contents/"+this.path}else this.apiCall=this.url.pathname.slice(1);this.login(!0)},get:function(){var a=this;if(this.isAuthenticated()||!this.path)return this.request(this.apiCall).then(function(c){return Promise.resolve(a.repo?b.atob(c.content):c)});var c=new URL("https://raw.githubusercontent.com/"+this.username+"/"+this.repo+"/"+(this.branch||"master")+"/"+this.path);return this.super.get.call(this,c)},upload:function(a){var b=this,c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.path;return Mavo.readFile(a).then(function(a){var d=a.slice(5),e=d.match(/^\w+\/[\w+]+/)[0];return d=d.replace(RegExp("^"+e+"(;base64)?,"),""),c=b.path.replace(/[^/]+$/,"")+c,b.put(d,c,{isEncoded:!0})}).then(function(a){return b.getURL(c,a.commit.sha)})},put:function(a){var c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.path,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(d){var f="repos/"+this.username+"/"+this.repo,g=f+"/contents/"+d,h=this.mavo.element.getAttribute("mv-github-commit-prefix")||"",i=this.repoInfo||this.request("user/repos",{name:this.repo},"POST").then(function(a){return c.repoInfo=a});return a=e.isEncoded?a:b.btoa(a),Promise.resolve(i).then(function(a){return c.canPush()?a:c.request(f+"/forks",{name:c.repo},"POST").then(function(a){return g="repos/"+a.full_name+"/contents/"+d,c.forkInfo=a}).then(function(a){var b;return new Promise(function d(e){clearTimeout(b),c.request("repos/"+a.full_name+"/commits",{until:"1970-01-01T00:00:00Z"},"HEAD").then(function(){e(a)}).catch(function(){b=setTimeout(d,1e3)})})})}).then(function(){return c.request(g,{ref:c.branch}).then(function(b){return c.request(g,{message:h+c.mavo._("gh-updated-file",{name:b.name||"file"}),content:a,branch:c.branch,sha:b.sha},"PUT")},function(b){return 404==b.status?c.request(g,{message:h+"Created file",content:a,branch:c.branch},"PUT"):b})}).then(function(a){return c.forkInfo&&c.request("repos/"+c.username+"/"+c.repo+"/pulls",{head:c.user.username+":"+c.branch,base:c.branch}).then(function(a){c.pullRequest(a[0])}),a})}},pullRequest:function(a){var b=this,c=new URL(location);c.searchParams.set(this.mavo.id+"-storage","https://github.com/"+this.forkInfo.full_name+"/"+this.path);var d=this.mavo._("gh-edit-suggestion-saved-in-profile",{previewURL:c});this.notice&&this.notice.close(),a?(this.notice=this.mavo.message(d+"\n\t\t\t\t"+this.mavo._("gh-edit-suggestion-notreviewed")+"\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<button class=\"mv-danger\">"+this.mavo._("gh-edit-suggestion-revoke")+"</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(c){c&&b.request("repos/"+b.username+"/"+b.repo+"/pulls/"+a.number,{state:"closed"},"POST").then(function(a){new Mavo.UI.Message(b.mavo,"<a href=\""+a.html_url+"\">"+b.mavo._("gh-edit-suggestion-cancelled")+"</a>",{dismiss:["button","timeout"]}),b.pullRequest()})})):(this.notice=this.mavo.message(d+"\n\t\t\t\t"+this.mavo._("gh-edit-suggestion-instructions")+"\n\t\t\t\t<form onsubmit=\"return false\">\n\t\t\t\t\t<textarea name=\"edits\" class=\"mv-autosize\" placeholder=\""+this.mavo._("gh-edit-suggestion-reason-placeholder")+"\"></textarea>\n\t\t\t\t\t<button>"+this.mavo._("gh-edit-suggestion-send")+"</button>\n\t\t\t\t</form>",{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(function(a){a&&b.request("repos/"+b.username+"/"+b.repo+"/pulls",{title:b.mavo._("gh-edit-suggestion-title"),body:b.mavo._("gh-edit-suggestion-body",{description:a.elements.edits.value,previewURL:c}),head:b.user.username+":"+b.branch,base:b.branch},"POST").then(function(a){new Mavo.UI.Message(b.mavo,"<a href=\""+a.html_url+"\">"+b.mavo._("gh-edit-suggestion-sent")+"</a>",{dismiss:["button","timeout"]}),b.pullRequest(a)})}))},login:function(a){var b=this;return this.oAuthenticate(a).then(function(){return b.getUser()}).catch(function(a){401==a.status&&b.logout()}).then(function(){if(b.user&&(b.permissions.on(["edit","save","logout"]),b.repo))return b.request("repos/"+b.username+"/"+b.repo).then(function(a){return void 0===b.branch&&(b.branch=a.default_branch),b.repoInfo=a})})},canPush:function(){return this.repoInfo?this.repoInfo.permissions.push:this.user&&this.user.username.toLowerCase()==this.username.toLowerCase()},oAuthParams:function(){return"&scope=repo,gist"},logout:function(){var a=this;return this.oAuthLogout().then(function(){a.user=null})},getUser:function(){var b=this;return this.user?Promise.resolve(this.user):this.request("user").then(function(c){b.user={username:c.login,name:c.name||c.login,avatar:c.avatar_url,url:"https://github.com/"+c.login,info:c},a.fire(b.mavo.element,"mv-login",{backend:b})})},getURL:function(){var a=this,b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.path,c=arguments[1],d=this.forkInfo||this.repoInfo,e=d.full_name;return b=b.replace(/ /g,"%20"),d.pagesInfo=d.pagesInfo||this.request("repos/"+e+"/pages",{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}),d.pagesInfo.then(function(a){return a.html_url+b}).catch(function(){return c?"https://cdn.rawgit.com/"+e+"/"+c+"/"+b:"https://rawgit.com/"+e+"/"+a.branch+"/"+b})},static:{apiDomain:"https://api.github.com/",oAuth:"https://github.com/login/oauth/authorize",test:function(a){return a=new URL(a,Mavo.base),/\bgithub.com|raw.githubusercontent.com/.test(a.host)},parseURL:function(a){var b={};a=new URL(a,Mavo.base);var c=a.pathname.slice(1).split("/");if(b.username=c.shift(),b.repo=c.shift(),/raw.githubusercontent.com$/.test(a.host))b.branch=c.shift();else{if(/api.github.com$/.test(a.host))return{};"blob"==c[0]&&(c.shift(),b.branch=c.shift())}return b.path=c.join("/"),b},btoa:function(a){function b(){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){return btoa(unescape(encodeURIComponent(a)))}),atob:function(a){return decodeURIComponent(escape(window.atob(a)))}}}))})(Bliss,Bliss.$);
//# sourceMappingURL=maps/mavo.es5.min.js.map
