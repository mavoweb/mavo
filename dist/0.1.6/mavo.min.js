!function(){"use strict";function t(e,n,i){return n=void 0===n?1:n,i=i||n+1,i-n<=1?function(){if(arguments.length<=n||"string"===r.type(arguments[n]))return e.apply(this,arguments);var t,i=arguments[n];for(var o in i){var s=Array.prototype.slice.call(arguments);s.splice(n,1,o,i[o]),t=e.apply(this,s)}return t}:t(t(e,n+1,i),n,i-1)}function e(t,r,i){var o=n(i);if("string"===o){var s=Object.getOwnPropertyDescriptor(r,i);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?t[i]=r[i]:(delete t[i],Object.defineProperty(t,i,s))}else if("array"===o)i.forEach(function(n){n in r&&e(t,r,n)});else for(var a in r)i&&("regexp"===o&&!i.test(a)||"function"===o&&!i.call(r,a))||e(t,r,a);return t}function n(t){if(null===t)return"null";if(void 0===t)return"undefined";var e=(Object.prototype.toString.call(t).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase();return"number"==e&&isNaN(t)?"nan":e}var r=self.Bliss=e(function(t,e){return 2==arguments.length&&!e||!t?null:"string"===r.type(t)?(e||document).querySelector(t):t||null},self.Bliss);e(r,{extend:e,overload:t,type:n,property:r.property||"_",listeners:self.WeakMap?new WeakMap:new Map,original:{addEventListener:(self.EventTarget||Node).prototype.addEventListener,removeEventListener:(self.EventTarget||Node).prototype.removeEventListener},sources:{},noop:function(){},$:function(t,e){return t instanceof Node||t instanceof Window?[t]:2!=arguments.length||e?Array.prototype.slice.call("string"==typeof t?(e||document).querySelectorAll(t):t||[]):[]},defined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]},create:function(t,e){return t instanceof Node?r.set(t,e):(1===arguments.length&&("string"===r.type(t)?e={}:(e=t,t=e.tag,e=r.extend({},e,function(t){return"tag"!==t}))),r.set(document.createElement(t||"div"),e))},each:function(t,e,n){n=n||{};for(var r in t)n[r]=e.call(t,r,t[r]);return n},ready:function(t,e,n){if("function"!=typeof t||e||(e=t,t=void 0),t=t||document,e&&("loading"!==t.readyState?e():r.once(t,"DOMContentLoaded",function(){e()})),!n)return new Promise(function(e){r.ready(t,e,!0)})},Class:function(t){var e,n=["constructor","extends","abstract","static"].concat(Object.keys(r.classProps)),i=t.hasOwnProperty("constructor")?t.constructor:r.noop;2==arguments.length?(e=arguments[0],t=arguments[1]):(e=function(){if(this.constructor.__abstract&&this.constructor===e)throw new Error("Abstract classes cannot be directly instantiated.");e["super"]&&e["super"].apply(this,arguments),i.apply(this,arguments)},e["super"]=t["extends"]||null,e.prototype=r.extend(Object.create(e["super"]?e["super"].prototype:Object),{constructor:e}),e.prototype["super"]=e["super"]?e["super"].prototype:null,e.__abstract=!!t["abstract"]);var o=function(t){return this.hasOwnProperty(t)&&n.indexOf(t)===-1};if(t["static"]){r.extend(e,t["static"],o);for(var s in r.classProps)s in t["static"]&&r.classProps[s](e,t["static"][s])}r.extend(e.prototype,t,o);for(var s in r.classProps)s in t&&r.classProps[s](e.prototype,t[s]);return e},classProps:{lazy:t(function(t,e,n){return Object.defineProperty(t,e,{get:function(){var t=n.call(this);return Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),t},set:function(t){Object.defineProperty(this,e,{value:t,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),t}),live:t(function(t,e,n){return"function"===r.type(n)&&(n={set:n}),Object.defineProperty(t,e,{get:function(){var t=this["_"+e],r=n.get&&n.get.call(this,t);return void 0!==r?r:t},set:function(t){var r=this["_"+e],i=n.set&&n.set.call(this,t,r);this["_"+e]=void 0!==i?i:t},configurable:n.configurable,enumerable:n.enumerable}),t})},include:function(){var t=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],n=document.createElement("script");return e?Promise.resolve():new Promise(function(e,i){r.set(n,{async:!0,onload:function(){e(),n.parentNode&&n.parentNode.removeChild(n)},onerror:function(){i()},src:t,inside:document.head})})},fetch:function(t,n){if(!t)throw new TypeError("URL parameter is mandatory and cannot be "+t);var i=e({url:new URL(t,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},n);i.method=i.method.toUpperCase(),r.hooks.run("fetch-args",i),"GET"===i.method&&i.data&&(i.url.search+=i.data),document.body.setAttribute("data-loading",i.url),i.xhr.open(i.method,i.url.href,i.async!==!1,i.user,i.password);for(var o in n)if("upload"===o)i.xhr.upload&&"object"==typeof n[o]&&r.extend(i.xhr.upload,n[o]);else if(o in i.xhr)try{i.xhr[o]=n[o]}catch(s){self.console&&console.error(s)}var a=Object.keys(i.headers).map(function(t){return t.toLowerCase()});"GET"!==i.method&&a.indexOf("content-type")===-1&&i.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var c in i.headers)void 0!==i.headers[c]&&i.xhr.setRequestHeader(c,i.headers[c]);var u=new Promise(function(t,e){i.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===i.xhr.status||i.xhr.status>=200&&i.xhr.status<300||304===i.xhr.status?t(i.xhr):e(r.extend(Error(i.xhr.statusText),{xhr:i.xhr,get status(){return this.xhr.status}}))},i.xhr.onerror=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Error"),{xhr:i.xhr}))},i.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),e(r.extend(Error("Network Timeout"),{xhr:i.xhr}))},i.xhr.send("GET"===i.method?null:i.data)});return u.xhr=i.xhr,u},value:function(t){var e="string"!==r.type(t);return r.$(arguments).slice(+e).reduce(function(t,e){return t&&t[e]},e?t:self)}}),r.Hooks=new r.Class({add:function(t,e,n){if("string"==typeof arguments[0])(Array.isArray(t)?t:[t]).forEach(function(t){this[t]=this[t]||[],e&&this[t][n?"unshift":"push"](e)},this);else for(var t in arguments[0])this.add(t,arguments[0][t],arguments[1])},run:function(t,e){this[t]=this[t]||[],this[t].forEach(function(t){t.call(e&&e.context?e.context:e,e)})}}),r.hooks=new r.Hooks;r.property;r.Element=function(t){this.subject=t,this.data={},this.bliss={}},r.Element.prototype={set:t(function(t,e){t in r.setProps?r.setProps[t].call(this,e):t in this?this[t]=e:this.setAttribute(t,e)},0),transition:function(t,e){return e=+e||400,new Promise(function(n,i){if("transition"in this.style){var o=r.extend({},this.style,/^transition(Duration|Property)$/);r.style(this,{transitionDuration:(e||400)+"ms",transitionProperty:Object.keys(t).join(", ")}),r.once(this,"transitionend",function(){clearTimeout(s),r.style(this,o),n(this)});var s=setTimeout(n,e+50,this);r.style(this,t)}else r.style(this,t),n(this)}.bind(this))},fire:function(t,e){var n=document.createEvent("HTMLEvents");return n.initEvent(t,!0,!0),this.dispatchEvent(r.extend(n,e))},bind:t(function(t,e){if(arguments.length>1&&("function"===r.type(e)||e.handleEvent)){var n=e;e="object"===r.type(arguments[2])?arguments[2]:{capture:!!arguments[2]},e.callback=n}var i=r.listeners.get(this)||{};t.trim().split(/\s+/).forEach(function(t){if(t.indexOf(".")>-1){t=t.split(".");var n=t[1];t=t[0]}i[t]=i[t]||[],0===i[t].filter(function(t){return t.callback===e.callback&&t.capture==e.capture}).length&&i[t].push(r.extend({className:n},e)),r.original.addEventListener.call(this,t,e.callback,e)},this),r.listeners.set(this,i)},0),unbind:t(function(t,e){if(e&&("function"===r.type(e)||e.handleEvent)){var n=e;e=arguments[2]}"boolean"==r.type(e)&&(e={capture:e}),e=e||{},e.callback=e.callback||n;var i=r.listeners.get(this);(t||"").trim().split(/\s+/).forEach(function(t){if(t.indexOf(".")>-1){t=t.split(".");var n=t[1];t=t[0]}if(t&&e.callback)return r.original.removeEventListener.call(this,t,e.callback,e.capture);if(i)for(var o in i)if(!t||o===t)for(var s,a=0;s=i[o][a];a++)n&&n!==s.className||e.callback&&e.callback!==s.callback||!!e.capture!=!!s.capture||(i[o].splice(a,1),r.original.removeEventListener.call(this,o,s.callback,s.capture),a--)},this)},0)},r.setProps={style:function(t){for(var e in t)e in this.style?this.style[e]=t[e]:this.style.setProperty(e,t[e])},attributes:function(t){for(var e in t)this.setAttribute(e,t[e])},properties:function(t){r.extend(this,t)},events:function(t){if(1!=arguments.length||!t||!t.addEventListener)return r.bind.apply(this,[this].concat(r.$(arguments)));var e=this;if(r.listeners){var n=r.listeners.get(t);for(var i in n)n[i].forEach(function(t){r.bind(e,i,t.callback,t.capture)})}for(var o in t)0===o.indexOf("on")&&(this[o]=t[o])},once:t(function(t,e){var n=this,i=function(){return r.unbind(n,t,i),e.apply(n,arguments)};r.bind(this,t,i,{once:!0})},0),delegate:t(function(t,e,n){r.bind(this,t,function(t){t.target.closest(e)&&n.call(this,t)})},0,2),contents:function(t){(t||0===t)&&(Array.isArray(t)?t:[t]).forEach(function(t){var e=r.type(t);/^(string|number)$/.test(e)?t=document.createTextNode(t+""):"object"===e&&(t=r.create(t)),t instanceof Node&&this.appendChild(t)},this)},inside:function(t){t&&t.appendChild(this)},before:function(t){t&&t.parentNode.insertBefore(this,t)},after:function(t){t&&t.parentNode.insertBefore(this,t.nextSibling)},start:function(t){t&&t.insertBefore(this,t.firstChild)},around:function(t){t&&t.parentNode&&r.before(this,t),this.appendChild(t)}},r.Array=function(t){this.subject=t},r.Array.prototype={all:function(t){var e=r.$(arguments).slice(1);return this[t].apply(this,e)}},r.add=t(function(t,e,n,i){n=r.extend({$:!0,element:!0,array:!0},n),"function"==r.type(e)&&(!n.element||t in r.Element.prototype&&i||(r.Element.prototype[t]=function(){return this.subject&&r.defined(e.apply(this.subject,arguments),this.subject)}),!n.array||t in r.Array.prototype&&i||(r.Array.prototype[t]=function(){var t=arguments;return this.subject.map(function(n){return n&&r.defined(e.apply(n,t),n)})}),n.$&&(r.sources[t]=r[t]=e,(n.array||n.element)&&(r[t]=function(){var e=[].slice.apply(arguments),i=e.shift(),o=n.array&&Array.isArray(i)?"Array":"Element";return r[o].prototype[t].apply({subject:i},e)})))},0),r.add(r.Array.prototype,{element:!1}),r.add(r.Element.prototype),r.add(r.setProps),r.add(r.classProps,{element:!1,array:!1});var i=document.createElement("_");r.add(r.extend({},HTMLElement.prototype,function(t){return"function"===r.type(i[t])}),null,!0)}();
/* jsep v0.3.2 (http://jsep.from.so/) */
!function(e){"use strict";var r=function(e,r){var t=new Error(e+" at character "+r);throw t.index=r,t.description=e,t},t={"-":!0,"!":!0,"~":!0,"+":!0},n={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(e){var r,t=0;for(var n in e)(r=n.length)>t&&e.hasOwnProperty(n)&&(t=r);return t},i=o(t),a=o(n),u={true:!0,false:!1,null:null},s=function(e){return n[e]||0},p=function(e,r,t){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:r,right:t}},f=function(e){return e>=48&&e<=57},c=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!n[String.fromCharCode(e)]},l=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!n[String.fromCharCode(e)]},d=function(e){for(var o,d,h=0,v=e.charAt,x=e.charCodeAt,y=function(r){return v.call(e,r)},m=function(r){return x.call(e,r)},b=e.length,E=function(){for(var e=m(h);32===e||9===e||10===e||13===e;)e=m(++h)},g=function(){var e,t,n=w();return E(),63!==m(h)?n:(h++,(e=g())||r("Expected expression",h),E(),58===m(h)?(h++,(t=g())||r("Expected expression",h),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void r("Expected :",h))},C=function(){E();for(var r=e.substr(h,a),t=r.length;t>0;){if(n.hasOwnProperty(r))return h+=t,r;r=r.substr(0,--t)}return!1},w=function(){var e,t,n,o,i,a,u,f;if(a=O(),!(t=C()))return a;for(i={value:t,prec:s(t)},(u=O())||r("Expected expression after "+t,h),o=[a,i,u];(t=C())&&0!==(n=s(t));){for(i={value:t,prec:n};o.length>2&&n<=o[o.length-2].prec;)u=o.pop(),t=o.pop().value,a=o.pop(),e=p(t,a,u),o.push(e);(e=O())||r("Expected expression after "+t,h),o.push(i,e)}for(e=o[f=o.length-1];f>1;)e=p(o[f-1].value,o[f-2],e),f-=2;return e},O=function(){var r,n,o;if(E(),r=m(h),f(r)||46===r)return U();if(39===r||34===r)return k();if(91===r)return S();for(o=(n=e.substr(h,i)).length;o>0;){if(t.hasOwnProperty(n))return h+=o,{type:"UnaryExpression",operator:n,argument:O(),prefix:!0};n=n.substr(0,--o)}return!(!c(r)&&40!==r)&&A()},U=function(){for(var e,t,n="";f(m(h));)n+=y(h++);if(46===m(h))for(n+=y(h++);f(m(h));)n+=y(h++);if("e"===(e=y(h))||"E"===e){for(n+=y(h++),"+"!==(e=y(h))&&"-"!==e||(n+=y(h++));f(m(h));)n+=y(h++);f(m(h-1))||r("Expected exponent ("+n+y(h)+")",h)}return t=m(h),c(t)?r("Variable names cannot start with a number ("+n+y(h)+")",h):46===t&&r("Unexpected period",h),{type:"Literal",value:parseFloat(n),raw:n}},k=function(){for(var e,t="",n=y(h++),o=!1;h<b;){if((e=y(h++))===n){o=!0;break}if("\\"===e)switch(e=y(h++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return o||r('Unclosed quote after "'+t+'"',h),{type:"Literal",value:t,raw:n+t+n}},L=function(){var t,n=m(h),o=h;for(c(n)?h++:r("Unexpected "+y(h),h);h<b&&(n=m(h),l(n));)h++;return t=e.slice(o,h),u.hasOwnProperty(t)?{type:"Literal",value:u[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},j=function(e){for(var t,n,o=[],i=!1;h<b;){if(E(),(t=m(h))===e){i=!0,h++;break}44===t?h++:((n=g())&&"Compound"!==n.type||r("Expected comma",h),o.push(n))}return i||r("Expected "+String.fromCharCode(e),h),o},A=function(){var e,t;for(t=40===(e=m(h))?P():L(),E(),e=m(h);46===e||91===e||40===e;)h++,46===e?(E(),t={type:"MemberExpression",computed:!1,object:t,property:L()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:g()},E(),93!==(e=m(h))&&r("Unclosed [",h),h++):40===e&&(t={type:"CallExpression",arguments:j(41),callee:t}),E(),e=m(h);return t},P=function(){h++;var e=g();if(E(),41===m(h))return h++,e;r("Unclosed (",h)},S=function(){return h++,{type:"ArrayExpression",elements:j(93)}},B=[];h<b;)59===(o=m(h))||44===o?h++:(d=g())?B.push(d):h<b&&r('Unexpected "'+y(h)+'"',h);return 1===B.length?B[0]:{type:"Compound",body:B}};if(d.version="0.3.2",d.toString=function(){return"JavaScript Expression Parser (JSEP) v"+d.version},d.addUnaryOp=function(e){return i=Math.max(e.length,i),t[e]=!0,this},d.addBinaryOp=function(e,r){return a=Math.max(e.length,a),n[e]=r,this},d.addLiteral=function(e,r){return u[e]=r,this},d.removeUnaryOp=function(e){return delete t[e],e.length===i&&(i=o(t)),this},d.removeAllUnaryOps=function(){return t={},i=0,this},d.removeBinaryOp=function(e){return delete n[e],e.length===a&&(a=o(n)),this},d.removeAllBinaryOps=function(){return n={},a=0,this},d.removeLiteral=function(e){return delete u[e],this},d.removeAllLiterals=function(){return u={},this},"undefined"==typeof exports){var h=e.jsep;e.jsep=d,d.noConflict=function(){return e.jsep===d&&(e.jsep=h),d}}else"undefined"!=typeof module&&module.exports?exports=module.exports=d:exports.parse=d}(this);
//# sourceMappingURL=jsep.min.js.map
!function(){function e(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[])}if(self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)){var t=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text number url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||e("script").pop(),resize:function(e){if(t.resizes(e)){var i,n=getComputedStyle(e),o=0;!e.value&&e.placeholder&&(i=!0,e.value=e.placeholder);var l=e.nodeName.toLowerCase();if("textarea"==l)e.style.height="0","border-box"==n.boxSizing?o=e.offsetHeight:"content-box"==n.boxSizing&&(o=-e.clientHeight+parseFloat(n.minHeight)),
e.style.height=e.scrollHeight+o+"px";else if("input"==l)if(e.style.width="1000px",e.offsetWidth){e.style.width="0","border-box"==n.boxSizing?o=e.offsetWidth:"padding-box"==n.boxSizing?o=e.clientWidth:"content-box"==n.boxSizing&&(o=parseFloat(n.minWidth));var r=Math.max(o,e.scrollWidth-e.clientWidth);e.style.width=r+"px";for(var s=0;s<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);s++)r+=e.scrollLeft,e.style.width=r+"px"}else e.style.width=e.value.length+1+"ch";else if("select"==l){var c=e.selectedIndex>0?e.selectedIndex:0,a=document.createElement("_");a.textContent=e.options[c].textContent,e.parentNode.insertBefore(a,e.nextSibling);var d;for(var h in n){var p=n[h];/^(width|webkitLogicalWidth|length)$/.test(h)||"string"!=typeof p||(a.style[h]=p,/appearance$/i.test(h)&&(d=h))}a.style.width="",a.offsetWidth>0&&(e.style.width=a.offsetWidth+"px",n[d]&&"none"===n[d]||(e.style.width="calc("+e.style.width+" + 2em)")),a.parentNode.removeChild(a),a=null}i&&(e.value="")}},resizeAll:function(i){
e(i||t.selectors.base).forEach(function(e){t.resize(e)})},active:!0,resizes:function(e){return e&&e.parentNode&&e.matches&&e.matches(t.selectors.base)&&e.matches(t.selectors.filter)},init:function(){t.selectors.filter=t.script.getAttribute("data-filter")||(e("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||Stretchy.selectors.filter||"*",t.resizeAll()},$$:e};"loading"!==document.readyState?t.init():document.addEventListener("DOMContentLoaded",t.init);var i=function(e){t.active&&t.resize(e.target)};document.documentElement.addEventListener("input",i),document.documentElement.addEventListener("change",i),self.MutationObserver&&new MutationObserver(function(e){t.active&&e.forEach(function(e){"childList"==e.type&&Stretchy.resizeAll(e.addedNodes)})}).observe(document.documentElement,{childList:!0,subtree:!0})}}();
//# sourceMappingURL=stretchy.min.js.map

(function(e,t){var a=self.Mavo=e.Class({constructor:function(n){this.treeBuilt=Mavo.defer(),this.dataLoaded=Mavo.defer(),this.element=n,this.inProgress=!1,this.index=Object.keys(a.all).length+1,Object.defineProperty(a.all,this.index-1,{value:this});var o=a.attributes.map(e=>`[data-${e}]`).join(", ");if([this.element,...t(o,this.element)].forEach(e=>{a.attributes.forEach(t=>{var a=e.getAttribute("data-"+t);null!==a&&e.setAttribute(t,a)})}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||`mavo${this.index}`,this.id in a.all){for(var r=2;this.id+r in a.all;r++);this.id+=r}a.all[this.id]=this,this.element.setAttribute("mv-app",this.id);var i=e.value(this.element.closest("[lang]"),"lang")||Mavo.locale;this.locale=Mavo.Locale.get(i),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||3),this.element.setAttribute("typeof",""),Mavo.hooks.run("init-start",this),t(a.selectors.primitive+","+a.selectors.multiple,this.element).forEach(t=>{var n=e(`${a.selectors.not(a.selectors.formControl)}, ${a.selectors.property}`,t);if(n){var o=Mavo.Primitive.getConfig(t),i=Mavo.is("multiple",t);!i&&(o.attribute||o.hasChildren)||t.setAttribute("typeof","")}}),this.expressions=new Mavo.Expressions(this),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var s=["source","storage","init"];s.forEach(e=>this.updateBackend(e)),this.backendObserver=new Mavo.Observer(this.element,s.map(e=>"mv-"+e),e=>{var t={},a=e.map(e=>{var a=e.attributeName.replace(/^mv-/,"");return t[a]=this.updateBackend(a),a});t.source?this.load():!this.source&&(t.storage||t.init&&!this.root.data)&&this.load()}),this.permissions.can("login",()=>{(null!==Mavo.Functions.url("login")&&1==this.index||null!==Mavo.Functions.url(this.id+"-login"))&&this.primaryBackend.login()}),e.bind(this.element,"mv-login.mavo",e=>{e.backend!=(this.source||this.storage)||this.root.data||this.unsavedChanges||this.load()}),this.bar=new Mavo.UI.Bar(this),e("summary [property]:not([typeof])")&&this.element.addEventListener("click",e=>{e.target!=document.activeElement&&e.preventDefault()}),this.needsEdit=this.calculateNeedsEdit(),this.setUnsavedChanges(!1),this.permissions.onchange(({action:e,value:t})=>{var a=this.element.getAttribute("mv-permissions")||"";a=a.trim().split(/\s+/).filter(t=>t!=e),t&&a.push(e),this.element.setAttribute("mv-permissions",a.join(" "))}),this.needsEdit&&this.permissions.can(["edit","add","delete"],()=>{this.modeObserver=new Mavo.Observer(this.element,"mv-mode",e=>{e.forEach(e=>{let t=e.target,n=a.Node.children(t);nodeloop:for(let e=0;e<n.length;e++){let o,i=n[e],r=i.mode;if(i.element==t)o=i.element.getAttribute("mv-mode"),i.modes=o;else{if(i.modes)continue nodeloop;o=a.getStyle(i.element.parentNode,"--mv-mode")}i.mode=o,r!=i.mode&&i["edit"==i.mode?"edit":"done"]()}})},{subtree:!0}),this.autoEdit&&this.edit()},()=>{this.modeObserver&&this.modeObserver.destroy()}),this.storage||this.source?this.permissions.can("read",()=>this.load()):requestAnimationFrame(()=>{this.dataLoaded.resolve(),e.fire(this.element,"mv-load")}),e.bind(this.element,"mv-load.mavo",()=>{if(location.hash){var e=()=>{var e=document.getElementById(location.hash.slice(1));return(e||!location.hash)&&(this.element.contains(e)&&requestAnimationFrame(()=>{Mavo.scrollIntoViewIfNeeded(e)}),t&&(t.destroy(),t=null)),e};if(!e())var t=new Mavo.Observer(this.element,"id",e,{subtree:!0})}requestAnimationFrame(()=>Stretchy.resizeAll())}),this.autoSave&&this.dataLoaded.then(()=>{var t=a.debounce(()=>{this.save()},this.autoSaveDelay),n=e=>{e.node.saved&&t()};requestAnimationFrame(()=>{this.permissions.can("save",()=>{e.bind(this.element,"mv-change.mavo:autosave",n)},()=>{e.unbind(this.element,"mv-change.mavo:autosave",n)})})}),this.element.addEventListener("keydown",e=>{if(this.permissions.save&&83==e.keyCode&&e[a.superKey]&&!e.altKey)e.preventDefault(),this.save();else if(38==e.keyCode||40==e.keyCode){var t=e.target;if(t.matches("textarea, input[type=range], input[type=number]"))return;if(t.matches(".mv-editor")){t=t.parentNode}var n=Mavo.Node.get(t);if(n&&n.closestCollection){var o=n.getCousin(38==e.keyCode?-1:1,{wrap:!0});o&&(o.editing?o.edit({immediately:!0}).then(()=>o.editor.focus()):o.element.focus(),e.preventDefault())}}}),Mavo.hooks.run("init-end",this)},get editing(){return this.root.editing},getData:function(e){return this.root.getData(e)},toJSON:function(){return a.toJSON(this.getData())},message:function(e,t){return new a.UI.Message(this,e,t)},error:function(e,...t){this.message(e,{type:"error",dismiss:["button","timeout"]}),0<t.length&&console.log(`%c${this.id}: ${e}`,"color: red; font-weight: bold",...t)},render:function(e){this.expressions.active=!1;var t={context:this,data:e};a.hooks.run("render-start",t),t.data&&this.root.render(t.data),this.unsavedChanges=!1,this.expressions.active=!0,requestAnimationFrame(()=>this.expressions.update()),a.hooks.run("render-end",t)},edit:function(){this.root.edit(),e.bind(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",e=>{if(e.target.matches(a.selectors.multiple)){e.target.classList.remove("mv-has-hovered-item");var t=e.target.parentNode.closest(a.selectors.multiple);t&&t.classList.toggle("mv-has-hovered-item","mouseenter"==e.type)}},!0),this.setUnsavedChanges()},setUnsavedChanges:function(e){var t=!!e;return e||this.walk(a=>{if(a.unsavedChanges)return t=!0,!1===e&&(a.unsavedChanges=!1),!1}),this.unsavedChanges=t},done:function(){this.root.done(),e.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1},updateBackend:function(e){var t,n,o=this[e];if(1==this.index&&(t=a.Functions.url(e)),t||(t=a.Functions.url(`${this.id}-${e}`)||this.element.getAttribute("mv-"+e)||null),t&&(t=t.trim(),"none"==t&&(t=null)),!t||o&&o.equals(t)?!t&&(this[e]=null):(this[e]=t=a.Backend.create(t,{mavo:this,format:this.element.getAttribute(`mv-${e}-format`)||this.element.getAttribute("mv-format")},this.element.getAttribute(`mv-${e}-type`),this[e]),n=!0),n=n||(t?!t.equals(o):!!o),n){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);var i=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});i.parent=this.source&&this.source.permissions,this.permissions.parent=i,this.primaryBackend=this.storage||this.source}return n},load:function(){var t=this.source||this.storage;return t?(this.inProgress="Loading",t.ready.then(()=>t.load()).catch(e=>this.init&&this.init!=t?(t=this.init,this.init.ready.then(()=>this.init.load())):Promise.reject(e)).catch(e=>{if(e){var t=e instanceof XMLHttpRequest?e:e.xhr;if(t&&404==t.status)this.render(null);else{var a=this._("problem-loading");t&&(a+=t.status?this._("http-error",e):": "+this._("cant-connect")),this.error(a,e)}}return null}).then(e=>this.render(e)).then(()=>{this.inProgress=!1,requestAnimationFrame(()=>{this.dataLoaded.resolve(),e.fire(this.element,"mv-load")})})):Promise.resolve()},store:function(){return this.storage?(this.inProgress="Saving",this.storage.store(this.getData()).catch(e=>{if(e){var t=this._("problem-saving");e instanceof XMLHttpRequest&&(t+=": "+(e.status?this._("http-error",e):this._("cant-connect"))),this.error(t,e)}return null}).then(e=>(this.inProgress=!1,e))):Promise.resolve()},upload:function(e,t="images/"+e.name){return this.uploadBackend?(this.inProgress=this._("uploading"),this.uploadBackend.upload(e,t).then(e=>(this.inProgress=!1,e)).catch(e=>(this.error(this._("error-uploading"),e),this.inProgress=!1,null))):Promise.reject()},save:function(){return this.store().then(t=>{t&&(e.fire(this.element,"mv-save",t),this.lastSaved=Date.now(),this.root.save(),this.unsavedChanges=!1)})},walk:function(){return this.root.walk(...arguments)},calculateNeedsEdit:function(){var e=!1;return this.walk(t=>!e&&(e=!t.modes&&"Group"!=t.nodeType,!t.modes),void 0,{descentReturn:!0}),e},live:{inProgress:function(t){e.toggleAttribute(this.element,"mv-progress",t,t),e.toggleAttribute(this.element,"aria-busy",!!t,!!t),this.element.style.setProperty("--mv-progress-text",t?`"${this._(t)}"`:"")},unsavedChanges:function(e){this.element.classList.toggle("mv-unsaved-changes",e)},needsEdit:function(e){this.bar.toggle("edit",e&&this.permissions.edit)},storage:function(e){if(e!==this._storage&&!e){var t=new Mavo.Permissions({edit:!0,save:!1});t.parent=this.permissions.parent,this.permissions.parent=t}},primaryBackend:function(e){if(e=e||null,e!=this._primaryBackend)return e},uploadBackend:{get:function(){if(this.storage&&this.storage.upload)return this.storage}}},static:{version:"v0.1.5",all:{},get:function(e){if(e instanceof Element){for(var t in a.all)if(a.all[t].element==e)return a.all[t];return null}var t="number"==typeof e?Object.keys(a.all)[e]:e;return a.all[t]||null},superKey:0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey",base:"about:"==location.protocol?document.currentScript?document.currentScript.src:"http://mavo.io":location,dependencies:[],init:function(e=document){var n=Array.isArray(arguments[0])?arguments[0]:t(a.selectors.init,e),o=n.filter(e=>!a.get(e)).map(e=>new a(e));return o},UI:{},hooks:new e.Hooks,attributes:["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-multiple-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-permisssions","mv-rel","mv-value"],lazy:{locale:()=>document.documentElement.lang||"en-GB",toNode:()=>Symbol("toNode"),toProxy:()=>Symbol("toProxy")}}});Object.defineProperty(a.all,"length",{get:function(){return Object.keys(this).length}});{let t=a.selectors={init:".mv-app, [mv-app], [data-mv-app]",property:"[property], [itemprop]",specificProperty:e=>`[property=${e}], [itemprop=${e}]`,group:"[typeof], [itemscope], [itemtype], [mv-group]",multiple:"[mv-multiple]",formControl:"input, select, option, textarea",textInput:["text","email","url","tel","search"].map(e=>`input[type=${e}]`).join(", ")+", input:not([type]), textarea",ui:".mv-ui",container:{tr:"table",option:"select"}},n=t.arr=e=>e.split(/\s*,\s*/g),o=t.not=e=>n(e).map(e=>`:not(${e})`).join(""),i=t.or=(e,t)=>e+", "+t,r=t.and=(e,t)=>{var a=[],o=n(t);return n(e).forEach(e=>a.push(...o.map(t=>e+t))),a.join(", ")},s=t.andNot=(e,t)=>r(e,o(t));e.extend(a.selectors,{primitive:s(t.property,t.group),rootGroup:s(t.group,t.property),item:i(t.multiple,t.group),output:i(t.specificProperty("output"),".mv-output")})}requestAnimationFrame(()=>{var n=[];e.each({blissfuljs:Array.from&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype,"Intl.~locale.en":self.Intl,IntersectionObserver:self.IntersectionObserver,Symbol:self.Symbol,"Element.prototype.remove":Element.prototype.remove},(e,t)=>{t||n.push(e)});var o="https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features="+n.map(e=>e+"|gated").join(",");a.dependencies.push(e.ready().then(()=>a.Plugins.load()),e.include(!n.length,o)),a.inited=e.ready().then(()=>(e.attributes(t(a.selectors.init),{"mv-progress":"Loading"}),a.ready)).catch(console.error).then(()=>Mavo.init()),a.ready=a.thenAll(a.dependencies)}),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize",self.$=self.$||e,self.$$=self.$$||t})(Bliss,Bliss.$),function(e,t){function a(){var e=n.getTarget();for(t(".mv-target-within").forEach(e=>e.classList.remove("mv-target-within"));e&&e.classList;)e.classList.add("mv-target-within"),e=e.parentNode}var n=e.extend(Mavo,{load:(t,a=document.currentScript?document.currentScript.src:location)=>{if(n.loaded=n.loaded||new Set,!n.loaded.has(t+""))return t=new URL(t,a),/\.css$/.test(t.pathname)?(e.create("link",{href:t,rel:"stylesheet",inside:document.head}),Promise.resolve()):e.include(t)},readFile:(e,t="DataURL")=>{var a=new FileReader;return new Promise((n,o)=>{a.onload=()=>n(a.result),a.onerror=a.onabort=o,a["readAs"+t](e)})},toJSON:e=>null===e?"":"string"==typeof e?e:JSON.stringify(e,null,"\t"),safeToJSON:function(e){var t=self.WeakSet?new WeakSet:new Set;return JSON.stringify(e,(e,a)=>{if("object"==typeof a&&null!==a){if(t.has(a))return;t.add(a)}return a})},objectify:(t,a)=>{var n=Mavo.value(t);if("object"!=typeof t||null===t){if(null===t)t={[Symbol.toStringTag]:"Null",toJSON:()=>null};else{var o=t.constructor;t=new o(n),t[Symbol.toStringTag]=o.name}t.valueOf=t[Symbol.toPrimitive]=()=>n}return e.extend(t,a)},value:e=>e&&e.valueOf?e.valueOf():e,toArray:e=>void 0===e?[]:Array.isArray(e)?e:[e],delete:(e,t,a)=>{do{var n=e&&e.indexOf(t);-1<n&&e.splice(n,1)}while(-1<n&&a)},flatten:e=>Array.isArray(e)?e.reduce((e,t)=>n.toArray(e).concat(n.flatten(t)),[]):[e],pushUnique:(e,t)=>{-1===e.indexOf(t)&&e.push(t)},union:(e,t)=>new Set([...(e||[]),...(t||[])]),filter:(e,t)=>{for(var a=0;a<e.length;a++)t(e[a])||(e.splice(a,1),a--)},is:function(e,...t){for(let a,o=0;o<t.length;o++)if(a=t[o],a&&a.matches&&a.matches(n.selectors[e]))return!0;return!1},getStyle:(e,t)=>{if(e){var a=getComputedStyle(e).getPropertyValue(t);if(a)return a.trim()}},data:function(e,t,a){var o,i=n.elementData.get(e)||{};return 2==arguments.length?o=i[t]:void 0===a?delete i[t]:o=i[t]=a,n.elementData.set(e,i),o},elementData:new WeakMap,elementPath:function(e,t){if(Array.isArray(t)){var a=t,n=a.reduce((e,t)=>e.children[t>>0]||e,e),o=a[a.length-1];if(o!=o>>0){var r=+(o+"").split(".")[1];0>o>>0&&(n=n.firstChild,r--);for(var s=0;s<r;s++)n=n.nextSibling}return n}for(var a=[],i=t;i&&i!=e;i=i.parentNode){for(var l=0,d=i===t&&1!==t.nodeType,r=d?1:0,m=i;m=m[`previous${d?"":"Element"}Sibling`];)d?(r++,1==m.nodeType&&(d=!1)):l++;0<r&&(l=l-1+"."+r),a.unshift(l)}return i?a:null},revocably:{add:function(e,t){var a=n.revocably.isRemoved(e);return a&&a.parentNode?a.parentNode.replaceChild(e,a):e&&t&&!e.parentNode&&t.appendChild(e),a},remove:function(e,t){if(e){var a=n.data(e,"commentstub");return a||(t=t||e.id||e.className||e.nodeName,a=n.data(e,"commentstub",document.createComment(t))),e.parentNode&&e.parentNode.replaceChild(a,e),a}},isRemoved:function(e){if(!e||e.parentNode)return!1;var t=n.data(e,"commentstub");return!!(t&&t.parentNode)&&t},setAttribute:function(e,t,a){var o=n.data(e,"attribute-"+t);o===void 0&&n.data(e,"attribute-"+t,e.getAttribute(t)),e.setAttribute(t,a)},restoreAttribute:function(t,a){var o=n.data(t,"attribute-"+a);o!==void 0&&(e.toggleAttribute(t,a,o),n.data(t,"attribute-"+a,void 0))}},inView:{is:e=>{var t=e.getBoundingClientRect();return(0<=t.bottom&&t.bottom<=innerHeight||0<=t.top&&t.top<=innerHeight)&&(0<=t.right&&t.right<=innerWidth||0<=t.left&&t.left<=innerWidth)},when:t=>{var a=n.inView.observer=n.inView.observer||new IntersectionObserver(function(t){t.forEach(t=>{this.unobserve(t.target),e.fire(t.target,"mv-inview",{entry:t})})});return new Promise(e=>{n.is(t)&&e(),a.observe(t);var o=a=>{t.removeEventListener("mv-inview",o),a.stopPropagation(),e()};t.addEventListener("mv-inview",o)})}},scrollIntoViewIfNeeded:e=>{e&&!Mavo.inView.is(e)&&e.scrollIntoView({behavior:"smooth"})},setAttributeShy:function(e,t,a){e.hasAttribute(t)||e.setAttribute(t,a)},getAttribute:function(e,...t){for(let a,n,o=0;a=t[o];o++)if(n=e.getAttribute(a),n)return n;return null},getTarget:function(){var e=location.hash.substr(1);return document.getElementById(e)},in:function(e,t){if(e)return"object"==typeof e&&t in e||void 0!==e[t]},getCanonicalProperty:function(e,t){if(e&&(t||0===t)){if(n.in(e,t))return t;if(t.toLowerCase){var a=t.toLowerCase();if(n.in(e,a))return a;var o=Object.keys(e),r=o.map(e=>e.toLowerCase()).indexOf(a);if(-1<r)return o[r]}}},subset:function(t,a,n){if(3==arguments.length){if(a.length){var o=a[a.length-1],i=e.value(t,...a.slice(0,-1));return Array.isArray(i)&&Array.isArray(n)?i.splice(o,1,...n):i&&(i[a[a.length-1]]=n),t}return n}return"object"==typeof t&&a&&a.length?a.reduce((e,t,n)=>{var o={},i=Mavo.Functions.get(e,t,o);return a[n]=Array.isArray(o.property)?o.property[0]:o.property,void 0===i&&o.query&&(i={[o.query.property]:o.query.value}),i},t):t},clone:function(e){return JSON.parse(n.safeToJSON(e))},debounce:function(e,t){if(!t)return e;var a,n=null;return function(){var o=this,i=arguments;a=function(){e.apply(o,i),removeEventListener("beforeunload",a)},clearTimeout(n),n=setTimeout(a,t),addEventListener("beforeunload",a)}},timeout:e=>new Promise(t=>setTimeout(t,e)),escapeRegExp:e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),matches:(e,t)=>{var a=(e+"").match(t);return a?a:[]},match:(e,t,a=0)=>n.matches(e,t)[a]||"",observeResize:function(e,t){if(self.ResizeObserver){var a=null,n=t instanceof ResizeObserver?t:new ResizeObserver(e=>{var n=e[e.length-1].contentRect;a&&a.width==n.width&&a.height==n.height||(t(e),a=n)});return n.observe(e),n}},Observer:e.Class({constructor:function(t,a,n,i={}){n instanceof MutationObserver&&(this.observer=n),this.observer=this.observer||new MutationObserver(n),this.element=t,this.callback=n,this.attribute=a,this.options=e.extend({},i),a&&e.extend(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!i.oldValue}),this.attribute&&"all"!=this.attribute||e.extend(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!i.oldValue}),this.run()},stop:function(){return this.observer&&this.observer.disconnect(),this.running=!1,this},run:function(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this},sneak:function(e){if(this.running){this.stop();var t=e();this.run()}else var t=e();return t},destroy:function(){this.stop(),this.observer=this.element=null},static:{sneak:function(e,t){return e?e.sneak(t):t()}}}),defer:function(e){var t,n,o=new Promise((a,o)=>{e&&e(a,o),t=a,n=o});return o.resolve=e=>(t(e),o),o.reject=e=>(n(e),o),o},thenAll:function(a){return t(a).forEach(t=>{"promise"==e.type(t)&&(t=t.catch(e=>e))}),Promise.all(a).then(e=>a.length==e.length?e:n.thenAll(a))},rr:function(e){return e(),e},wrap:(e,t)=>0>e?t-1:e>=t?0:e,options:e=>{var t={};return(e.trim().match(/(?:\\[,;]|[^,;])+/g)||[]).forEach(e=>{if(e){e=e.trim().replace(/\\([,;])/g,"$1");var a=e.match(/^\s*((?:\\:|[^:])+?)\s*:\s*(.+)$/);a?t[a[1].replace(/\\:/g,":")]=a[2]:t[e]=!0}}),t}});e.add("toggleAttribute",function(e,t,a=null!==t){a?this.setAttribute(e,t):this.removeAttribute(e)}),e.proxy=e.classProps.proxy=e.overload(function(e,t,a){return Object.defineProperty(e,t,{get:function(){return this[a][t]},set:function(e){this[a][t]=e},configurable:!0,enumerable:!0}),e}),e.classProps.propagated=function(e,t){Mavo.toArray(t).forEach(t=>{var a=e[t];e[t]=function(){var e=a&&a.apply(this,arguments);this.propagate&&!1!==e&&this.propagate(t)}})};addEventListener("hashchange",a);new Mavo.Observer(document.documentElement,"id",a)}(Bliss,Bliss.$),function(e,t){var a=Mavo.Locale=e.Class({constructor:function(e,t){this.lang=e,this.phrases={},this.extend(t)},get fallback(){return a.all[this.baseLang]?a.all[this.baseLang]:this===a.default?void 0:a.default},extend:function(t){e.extend(this.phrases,t)},phrase:function(e,t){var a=e.toLowerCase(),n=this.phrases[a];if(void 0===n&&this.fallback&&(n=this.fallback.phrase(a)),void 0===n)n=Mavo.Functions.readable(a);else if(t){var o=Mavo.matches(n,/\{\w+(?=\})/g).map(e=>e.slice(1));Mavo.Functions.unique(o).forEach(e=>{e in t&&(n=n.replace(RegExp(`{${e}}`,"gi"),t[e]))})}return n},live:{lang:function(e){this.baseLang=a.getBaseLang(e),e==this.baseLang&&(this.baseLang=null)}},static:{all:{},register:function(e,t){a.all[e]?a.all[e].extend(t):a.all[e]=new a(e,t)},match:function(e=""){return a.all[e]||a.all[a.getBaseLang(e)]},get:function(e){return a.match(e)||a.default},getBaseLang:function(e){return e.split("-")[0]},lazy:{default:()=>a.match(Mavo.locale)||a.all.en}}});Mavo.prototype._=function(e,t){return this.locale&&e?this.locale.phrase(e,t):e},e.ready().then(()=>{t("datalist.mv-phrases[lang]").forEach(e=>{var a=t("option",e).reduce((e,t)=>(e[t.value]=t.textContent.trim(),e),{});Mavo.Locale.register(e.lang,a)})})}(Bliss,Bliss.$),Mavo.Locale.register("en",{edit:"Edit",save:"Save",import:"Import",export:"Export",logout:"Logout",login:"Login",loading:"Loading",uploading:"Uploading",saving:"Saving","logged-in-as":"Logged in to {id} as ","login-to":"Login to {id}","error-uploading":"Error uploading file","cannot-load-uploaded-file":"Cannot load uploaded file",filename:"Filename?","problem-saving":"Problem saving data","problem-loading":"Problem loading data","cannot-parse":"Can\u2019t understand this file","http-error":"HTTP error {status}: {statusText}","cant-connect":"Can\u2019t connect to the Internet","add-item":"Add {name}","add-item-before":"Add new {name} before","add-item-after":"Add new {name} after","drag-to-reorder":"Drag to reorder {name}","delete-item":"Delete this {name}","gh-updated-file":"Updated {name}","gh-edit-suggestion-saved-in-profile":"Your edits are saved to <a href=\"{previewURL}\" target=\"_blank\">your own profile</a>, because you are not allowed to edit this page.","gh-edit-suggestion-instructions":"Write a short description of your edits below to suggest them to the page admins:","gh-edit-suggestion-notreviewed":"You have selected to suggest your edits to the page admins. Your suggestions have not been reviewed yet.","gh-edit-suggestion-send":"Send edit suggestion","gh-edit-suggestion-revoke":"Revoke edit suggestion","gh-edit-suggestion-reason-placeholder":"I added / corrected / deleted ...","gh-edit-suggestion-cancelled":"Edit suggestion cancelled successfully!","gh-edit-suggestion-title":"Suggested edits to data","gh-edit-suggestion-body":`Hello there! I used Mavo to suggest the following edits:
{description}
Preview my changes here: {previewURL}`,"gh-edit-suggestion-sent":"Edit suggestion sent successfully!"}),function(e,t){Mavo.attributes.push("mv-plugins");var a=Mavo.Plugins={loaded:{},load:function(){return a.plugins=new Set,t("[mv-plugins]").forEach(e=>{e.getAttribute("mv-plugins").trim().split(/\s+/).forEach(e=>a.plugins.add(e))}),a.plugins.size?e.fetch(a.url+"/plugins.json",{responseType:"json"}).then(t=>Mavo.thenAll(t.response.plugin.filter(e=>a.plugins.has(e.id)).map(t=>{var n=`mavo-${t.id}.js`;if(t.repo){var o=`https://raw.githubusercontent.com/${t.repo}/master/${n}`;return a.loaded[t.id]?Promise.resolve():e.fetch(o).then(t=>{e.create("script",{textContent:t.responseText,inside:document.head})})}var o=`${a.url}/${t.id}/${n}`;return e.include(a.loaded[t.id],o)}))):Promise.resolve()},register:function(t,n={}){if(!a.loaded[t]){for(let t in Mavo.hooks.add(n.hooks),n.extend){let a="Mavo"==t?Mavo:Mavo[t];"function"===e.type(a)?e.Class(a,n.extend[t]):e.extend(a,n.extend[t])}var o=[];if(n.ready&&o.push(n.ready),n.dependencies){var i=document.currentScript?document.currentScript.src:location,r=n.dependencies.map(e=>Mavo.load(e,i));o.push(...r)}o.length&&Mavo.dependencies.push(...o),a.loaded[t]=n,n.init&&Promise.all(o).then(()=>n.init())}},url:"https://plugins.mavo.io"}}(Bliss,Bliss.$),function(e){var t=Math.max;Mavo.attributes.push("mv-bar");var a=Mavo.UI.Bar=e.Class({constructor:function(t){if(this.mavo=t,this.element=e(".mv-bar",this.mavo.element),this.template=this.mavo.element.getAttribute("mv-bar")||"",this.element)for(let t in this.custom=!0,this.template+=" "+(this.element.getAttribute("mv-bar")||""),this.template=this.template.trim(),a.controls)this[t]=e(`.mv-${t}`,this.element),this[t]&&(this.template=this.template||"with",this.template+=` ${t}`);else this.element=e.create({className:"mv-bar mv-ui",start:this.mavo.element,innerHTML:"<button>&nbsp;</button>"});for(let n in this.element.classList.contains("mv-compact")&&(this.noResize=!0),/\byes-\w+/.test(this.template)&&console.warn(`${this.mavo.id}: You used mv-bar="${this.template}". Note that yes-* in mv-bar is deprecated and will be removed in v0.1.6. Please use the new syntax: http://mavo.io/docs/ui/#bar`),this.controls=a.getControls(this.template),this.controls.length&&(this.targetHeight=this.element.offsetHeight),this.custom||(this.element.innerHTML=""),this.controls.forEach(t=>{let n=a.controls[t];for(var o in this[t]&&this[t].remove(),n.create?this[t]=n.create.call(this.mavo,this[t]):!this[t]&&(this[t]=e.create("button",{className:`mv-${t}`,textContent:this.mavo._(t)})),this.add(t),n.permission?this.permissions.can(n.permission,()=>{this.toggle(t,!n.condition||n.condition.call(this.mavo))},()=>{this.remove(t)}):n.condition&&!n.condition.call(this.mavo)&&this.remove(t),n.events)e.bind(this[t],o,n.events[o].bind(this.mavo))}),a.controls){let t=a.controls[n];t.action&&e.delegate(this.mavo.element,"click",".mv-"+n,e=>{(!t.permission||this.permissions.is(t.permission))&&(t.action.call(this.mavo),e.preventDefault())})}this.controls.length&&!this.noResize&&(this.resize(),self.ResizeObserver&&(this.resizeObserver=Mavo.observeResize(this.element,()=>{this.resize()})))},resize:function(){return this.targetHeight?void(this.resizeObserver&&this.resizeObserver.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),this.element.offsetHeight>1.6*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight&&this.element.classList.add("mv-tiny")),this.resizeObserver&&this.resizeObserver.observe(this.element)):void(this.targetHeight=this.element.offsetHeight)},add:function(e){var t=a.controls[e];t.prepare&&t.prepare.call(this.mavo),Mavo.revocably.add(this[e],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())},remove:function(e){var t=a.controls[e];Mavo.revocably.remove(this[e],"mv-"+e),t.cleanup&&t.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())},toggle:function(e,t){return this[t?"add":"remove"](e)},proxy:{permissions:"mavo"},static:{getControls:function(e){var n=Object.keys(a.controls);if(e&&(e=e.trim())){if("none"==e)return[];var o=/^with\s|\b(yes|no)-\w+\b/.test(e);e=e.replace(/\byes-|^with\s+/g,"");var i=e.split(/\s+/);return i=Mavo.Functions.unique(i.reverse()).reverse(),o?n.filter(e=>{var n=i.lastIndexOf(e),o=i.lastIndexOf("no-"+e),r=n>t(-1,o),s=o>t(-1,n);return r||!a.controls[e].optional&&!s}):i}return n.filter(e=>!a.controls[e].optional)},controls:{status:{create:function(t){return t||e.create({className:"mv-status"})},prepare:function(){var e=this.primaryBackend;if(e&&e.user){var t=e.user,a=t.name||"";t.avatar&&(a=`<img class="mv-avatar" src="${t.avatar}" /> ${a}`),t.url&&(a=`<a href="${t.url}" target="_blank">${a}</a>`),this.bar.status.innerHTML=`<span>${this._("logged-in-as",e)}</span> `+a}},permission:"logout"},edit:{action:function(){this.editing?this.done():this.edit()},permission:["edit","add","delete"],cleanup:function(){this.editing&&this.done()},condition:function(){return this.needsEdit}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},export:{create:function(t){var n;return n=t?t.matches("a")?t:e.create("a",{className:"mv-button",around:t}):e.create("a",{className:"mv-export mv-button",textContent:this._("export")}),n.setAttribute("download",this.id+".json"),n},events:{mousedown:function(){this.bar.export.href="data:application/json;charset=UTF-8,"+encodeURIComponent(this.toJSON())}},permission:"edit",optional:!0},import:{create:function(t){var a=t||e.create("span",{role:"button",tabIndex:"0",className:"mv-import mv-button",textContent:this._("import"),events:{focus:()=>{n.focus()}}}),n=e.create("input",{type:"file",inside:a,events:{change:t=>{var a=t.target.files[0];if(a){var n=e.extend(new FileReader,{onload:()=>{this.inProgress=!1;try{var e=JSON.parse(n.result);this.render(e)}catch(t){this.error(this._("cannot-parse"))}},onerror:()=>{this.error(this._("problem-loading"))}});this.inProgress=this._("uploading"),n.readAsText(a)}}}});return a},optional:!0},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}})}(Bliss,Bliss.$),function(e){Mavo.UI.Message=e.Class({constructor:function(t,a,n){if(this.mavo=t,this.message=a,this.closed=Mavo.defer(),this.element=e.create({className:"mv-ui mv-message"+(n.type?" mv-"+n.type:""),innerHTML:this.message,events:{click:()=>Mavo.scrollIntoViewIfNeeded(this.mavo.element)},[this.mavo.bar?"after":"start"]:(this.mavo.bar||this.mavo).element}),n.classes&&this.element.classList.add(n.classes),"error"==n.type?this.element.setAttribute("role","alert"):this.element.setAttribute("aria-live","polite"),n.dismiss=n.dismiss||{},"string"==typeof n.dismiss||Array.isArray(n.dismiss)){var o={};Mavo.toArray(n.dismiss).forEach(e=>{o[e]=!0}),n.dismiss=o}if(n.dismiss.button&&e.create("button",{className:"mv-close mv-ui",textContent:"\xD7",events:{click:()=>this.close()},start:this.element}),n.dismiss.timeout){var i,r="number"==typeof n.dismiss.timeout?n.dismiss.timeout:5e3;e.bind(this.element,{mouseenter:()=>clearTimeout(i),mouseleave:Mavo.rr(()=>i=setTimeout(()=>this.close(),r))})}n.dismiss.submit&&this.element.addEventListener("submit",e=>{e.preventDefault(),this.close(e.target)})},close:function(t){e.transition(this.element,{opacity:0}).then(()=>{e.remove(this.element),this.closed.resolve(t)})}})}(Bliss,Bliss.$),function(e){var t=Mavo.Permissions=e.Class({constructor:function(a){this.triggers=[],this.hooks=new e.Hooks,this.parentChanged=t.prototype.parentChanged.bind(this),this.set(a)},set:function(e){for(var t in e)this[t]=e[t]},on:function(e){return Mavo.toArray(e).forEach(e=>this[e]=!0),this},off:function(e){return e=Array.isArray(e)?e:[e],e.forEach(e=>this[e]=!1),this},can:function(e,t,a){this.observe(e,!0,t),a&&this.cannot(e,a)},cannot:function(e,t){this.observe(e,!1,t)},observe:function(e,t,a){e=Mavo.toArray(e),this.is(e,t)&&a(),this.triggers.push({actions:e,value:t,callback:a,active:!0})},is:function(e,t=!0){var a=Mavo.toArray(e).map(e=>!!this[e]).reduce((e,t)=>e||t);return t?a:!a},onchange:function(e){this.hooks.add("change",e),t.actions.forEach(t=>{e.call(this,{action:t,value:this[t]})})},parentChanged:function(t={}){var a=this["_"+t.action];void 0!==a||t.from==t.value||(this.fireTriggers(t.action),this.hooks.run("change",e.extend({context:this},t)))},changed:function(e,t,a){a=!!a,t=!!t;t==a||(this["_"+e]=t,this.fireTriggers(e),this.hooks.run("change",{action:e,value:t,from:a,context:this}))},fireTriggers:function(e){this.triggers.forEach(t=>{var a=this.is(t.actions,t.value);t.active&&-1<t.actions.indexOf(e)&&a?(t.active=!1,t.callback()):!a&&(t.active=!0)})},or:function(e){return t.actions.forEach(t=>{this[t]=this[t]||e[t]}),this},live:{parent:function(e){var a=this._parent;a==e||(this._parent=e,a&&Mavo.delete(a.hooks.change,this.parentChanged),t.actions.forEach(t=>{this.parentChanged({action:t,value:e?e[t]:void 0,from:a?a[t]:void 0})}),e&&e.onchange(this.parentChanged))}},static:{actions:[],register:function(a,n){return Array.isArray(a)?void a.forEach(e=>t.register(e,n)):void(e.live(t.prototype,a,{get:function(){var e=this["_"+a];return void 0===e&&this.parent?this.parent[a]:e},set:function(e,t){n&&n.call(this,e,t),this.changed(a,e,t)}}),t.actions.push(a))}}});t.register(["read","save"]),t.register("login",function(e){e&&this.logout&&(this.logout=!1)}),t.register("logout",function(e){e&&this.login&&(this.login=!1)}),t.register("edit",function(e){e&&(this.add=this.delete=!0)}),t.register(["add","delete"],function(e){e||(this.edit=!1)})}(Bliss,Bliss.$),function(e){var t=Math.min,a=Mavo.Backend=e.Class({constructor:function(e,t={}){this.update(e,t),this.permissions=new Mavo.Permissions},update:function(e,t={}){this.source=e,this.url=new URL(this.source,Mavo.base),this.mavo=t.mavo,this.format=Mavo.Formats.create(t.format,this)},get:function(t=new URL(this.url)){return t.searchParams.set("timestamp",Date.now()),e.fetch(t.href).then(e=>Promise.resolve(e.responseText),()=>Promise.resolve(null))},load:function(){return this.ready.then(()=>this.get()).then(e=>"string"==typeof e?(e=e.replace(/^\ufeff/,""),this.format.parse(e)):e)},store:function(e,{path:t,format:a=this.format}={}){return this.ready.then(()=>{var n="string"==typeof e?Promise.resolve(e):a.stringify(e);return n.then(a=>this.put(a,t).then(()=>({data:e,serialized:a})))})},ready:Promise.resolve(),login:()=>Promise.resolve(),logout:()=>Promise.resolve(),put:()=>Promise.reject(),isAuthenticated:function(){return!!this.accessToken},oAuthParams:()=>"",toString:function(){return`${this.id} (${this.url})`},equals:function(e){return e===this||e&&this.id==e.id&&this.source==e.source},request:function(t,a,n="GET",o={}){return o=e.extend({},o),o.method=o.method||n,o.responseType=o.responseType||"json",o.headers=e.extend({"Content-Type":"application/json; charset=utf-8"},o.headers||{}),o.data=a,this.isAuthenticated()&&(o.headers.Authorization=o.headers.Authorization||`Bearer ${this.accessToken}`),"object"===e.type(o.data)&&("GET"==o.method?o.data=Object.keys(o.data).map(e=>e+"="+encodeURIComponent(o.data[e])).join("&"):o.data=JSON.stringify(o.data)),t=new URL(t,this.constructor.apiDomain),"GET"==o.method&&t.searchParams.set("timestamp",Date.now()),e.fetch(t,o).catch(e=>e&&e.xhr?Promise.reject(e.xhr):void this.mavo.error("Something went wrong while connecting to "+this.id,e)).then(e=>"HEAD"==o.method?e:e.response)},oAuthenticate:function(e){return this.ready.then(()=>this.isAuthenticated()?Promise.resolve():new Promise((a,n)=>{var o=this.id.toLowerCase();if(e)this.accessToken=localStorage[`mavo:${o}token`],this.accessToken&&a(this.accessToken);else{var i={width:t(1e3,innerWidth-100),height:t(800,innerHeight-100)};i.top=(screen.height-i.height)/2,i.left=(screen.width-i.width)/2;var r={url:location.href,backend:this.id};(this.authPopup=open(`${this.constructor.oAuth}?client_id=${this.key}&state=${encodeURIComponent(JSON.stringify(r))}`+this.oAuthParams(),"popup",`width=${i.width},height=${i.height},left=${i.left},top=${i.top}`),!this.authPopup)&&(this.mavo.error("Login popup was blocked! Please check your popup blocker settings."),n(Error("Login popup was blocked! Please check your popup blocker settings."))),addEventListener("message",e=>{if(e.source===this.authPopup)for(var t in e.data.backend==this.id&&(this.accessToken=localStorage[`mavo:${o}token`]=e.data.token),this.accessToken||n(Error("Authentication error")),a(this.accessToken),Mavo.all){var i=Mavo.all[t].primaryBackend;i&&i.id===this.id&&i!==this&&!i.isAuthenticated()&&i.login(!0)}})}}))},oAuthLogout:function(){if(this.isAuthenticated()){var t=this.id.toLowerCase();localStorage.removeItem(`mavo:${t}token`),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),e.fire(this.mavo.element,"mv-logout",{backend:this})}return Promise.resolve()},static:{create:function(e,t,n,o){var i;return n&&(i=Mavo.Functions.get(a,n)),e&&!i&&(i=a.types.filter(t=>t.test(e))[0]||a.Remote),i&&o&&o.constructor===i&&o.constructor.prototype.hasOwnProperty("update")?(o.update(e,t),o):i?new i(e,t):null},types:[],register:function(e){return a[e.prototype.id]=e,a.types.push(e),e}}});a.register(e.Class({id:"Element",extends:a,constructor:function(){this.permissions.on(["read","edit","save"])},update:function(t,a){this.super.update.call(this,t,a),this.element=e(this.source)||e.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body})},get:function(){return Promise.resolve(this.element.textContent)},put:function(e){return Promise.resolve(this.element.textContent=e)},static:{test:e=>0===e.indexOf("#")}})),a.register(e.Class({id:"Remote",extends:a,constructor:function(){this.permissions.on("read")},static:{test:()=>!1}})),a.register(e.Class({extends:a,id:"Local",constructor:function(){this.permissions.on(["read","edit","save"]),this.key=this.mavo.id},get:function(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])},put:function(e){return e?localStorage[this.key]=e:delete localStorage[this.key],Promise.resolve(e)},static:{test:e=>"local"==e}}))}(Bliss,Bliss.$),function(e){var t=Mavo.Formats={},a=t.Base=e.Class({abstract:!0,constructor:function(e){this.backend=e},proxy:{mavo:"backend"},parse:function(e){return this.constructor.parse(e,this)},stringify:function(e){return this.constructor.stringify(e,this)},static:{parse:e=>Promise.resolve(e),stringify:e=>Promise.resolve(e),extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(t=>e.include(t.test(),t.url)))}}}),n=t.JSON=e.Class({extends:t.Base,static:{parse:e=>Promise.resolve(e?JSON.parse(e):null),stringify:e=>Promise.resolve(Mavo.toJSON(e)),extensions:[".json",".jsonld"]}}),o=t.Text=e.Class({extends:t.Base,constructor:function(){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:(e,t)=>Promise.resolve({[t?t.property:"content"]:e}),stringify:(e,t)=>Promise.resolve(e[t?t.property:"content"])}}),i=t.CSV=e.Class({extends:t.Base,constructor:function(){this.property=this.mavo.root.getNames("Collection")[0],this.options=e.extend({},t.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:()=>self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:a.ready,parse:(e,t)=>i.ready().then(()=>{var a=Papa.parse(e,i.defaultOptions),n=t?t.property:"content";if(t&&(t.options.delimiter=a.meta.delimiter,t.options.linebreak=a.meta.linebreak),a.meta.aborted)throw a.meta.errors.pop();return{[n]:a.data}}),stringify:(e,t)=>i.ready().then(()=>{var a=t?t.property:"content",n=t?t.options:i.defaultOptions;return Papa.unparse(e[a],n)})}});Object.defineProperty(t,"create",{value:function(e,a){if(e&&"object"==typeof e)return e;if("string"==typeof e)for(var n in e=e.toLowerCase(),t){var o=t[n];if(n.toLowerCase()==e)return new o(a)}if(!e){var i=a.url?a.url.pathname:a.source,r=Mavo.match(i,/\.\w+$/)||".json",o=t.JSON;for(var n in t)-1<t[n].extensions.indexOf(r)&&(o=t[n]);return new o(a)}}})}(Bliss,Bliss.$),function(e,t){var a=Mavo.Node=e.Class({abstract:!0,constructor:function(t,n,o={}){if(!t||!n)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");var i={context:this,options:o};this.uid=++a.maxId,this.nodeType=this.nodeType,this.property=null,this.element=t,e.extend(this,i.options),a.all.set(t,[...(a.all.get(this.element)||[]),this]),this.mavo=n,this.group=this.parentGroup=i.options.group,this.template=i.options.template,this.alias=this.element.getAttribute("mv-alias"),this.template?this.template.copies.push(this):this.copies=[],this.fromTemplate("property","type")||(this.property=a.getProperty(t),this.type=Mavo.Group.normalize(t),this.storage=this.element.getAttribute("mv-storage")),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",i),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=i.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup);var r=this.template;if(r&&r.expressions&&(this.expressions=r.expressions.map(e=>new Mavo.DOMExpression({template:e,item:this,mavo:this.mavo}))),this instanceof Mavo.Group||this.collection){var s=Mavo.DOMExpression.search(this.element).filter(e=>"mv-value"==e.originalAttribute)[0];s&&(s.mavoNode=this,this.expressionText=s,this.storage=this.storage||"none",this.modes="read",this.collection&&(this.collection.expressions=[...(this.collection.expressions||[]),s],s.mavoNode=this.collection,this.collection.storage=this.collection.storage||"none",this.collection.modes="read"))}Mavo.hooks.run("node-init-end",i)},get editing(){return"edit"==this.mode},get isRoot(){return!this.property},get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()},get saved(){return"none"!==this.storage},get parent(){return this.collection||this.parentGroup},postInit:function(){"edit"==this.modes&&this.edit()},destroy:function(){this.template&&Mavo.delete(this.template.copies,this),this.expressions&&this.expressions.forEach(e=>e.destroy()),this.itembar&&this.itembar.destroy()},getData:function(e={}){if(this.isDataNull(e))return e.forceObjects?Mavo.objectify(null):null},isDataNull:function(e){var t={context:this,options:e,result:this.deleted||!this.saved&&!e.live};return Mavo.hooks.run("unit-isdatanull",t),t.result},walk:function(e,t=[],a={}){var n=(t,o)=>{var r=e(t,o);if(!1!==r)for(let e in t.children){let i=t.children[e];if(i instanceof Mavo.Node){var r=n.call(i,i,[...o,e]);if(!1===r&&!a.descentReturn)return!1}}return!1!==r};return n(this,t)},walkUp:function(e){for(var t=this;t=t.parentGroup;){var a=e(t);if(a!==void 0)return a}},edit:function(){return this.mode="edit","edit"==this.mode&&void(e.fire(this.element,"mv-edit",{mavo:this.mavo,node:this}),Mavo.hooks.run("node-edit-end",this))},done:function(){return this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read","read"==this.mode&&void(e.unbind(this.element,".mavo:edit"),e.fire(this.element,"mv-done",{mavo:this.mavo,node:this}),this.propagate("done"),Mavo.hooks.run("node-done-end",this))},propagate:function(e){for(let t in this.children){let a=this.children[t];a instanceof Mavo.Node&&("function"==typeof e?e.call(a,a):e in a&&a[e]())}},propagated:["save","destroy"],toJSON:Mavo.prototype.toJSON,fromTemplate:function(...e){return this.template&&e.forEach(e=>this[e]=this.template[e]),!!this.template},render:function(e){this.oldData=this.data,this.data=e,e=Mavo.subset(e,this.inPath);var t={context:this,data:e};if(Mavo.hooks.run("node-render-start",t),"Collection"!=this.nodeType&&Array.isArray(e)){var a;this.isRoot&&1===(a=this.getNames("Collection")).length?t.data={[a[0]]:t.data}:(this.inPath.push("0"),t.data=t.data[0])}this.editing?(this.done(),this.dataRender(t.data),this.edit()):this.dataRender(t.data),this.save(),Mavo.hooks.run("node-render-end",t)},dataChanged:function(t,a={}){e.fire(a.element||this.element,"mv-change",e.extend({property:this.property,action:t,mavo:this.mavo,node:this},a))},toString:function(){return`#${this.uid}: ${this.nodeType} (${this.property})`},getClosestCollection:function(){var e=this.closestItem;return e?e.collection:null},getClosestItem:function(){return this.collection&&this.collection.mutable?this:this.parentGroup?this.parentGroup.closestItem:null},isDeleted:function(){this.deleted;return!!this.deleted||!!this.parentGroup&&this.parentGroup.isDeleted()},resolve:function(e,t={}){var a=this.find(e,t);return void 0===a&&(a=this.walkUp(t=>t.property==e?t:e in t.children?t.children[e]:void 0)),void 0===a&&(a=this.mavo.root.find(e,t)),a},relativizeData:self.Proxy?function(e,t={live:!0}){return new Proxy(e,{get:(e,t,a)=>t in e?e[t]:t in a&&t in this.proxyCache?this.proxyCache[t]:void 0,has:(e,a)=>{if(a in e||a in this.proxyCache)return!0;switch(a){case"$index":return this.proxyCache[a]=this.index||0,!0;case"$next":case"$previous":return this.closestCollection?(this.proxyCache[a]=this.closestCollection.getData(t)[this.index+("$next"==a?1:-1)],!0):(this.proxyCache[a]=null,!1);}var n=this.resolve(a);return void 0===n?!!(a in Mavo.all&&isNaN(a)&&Mavo.all[a].root)&&(this.proxyCache[a]=Mavo.all[a].root.getData(t)):(Array.isArray(n)?n=n.map(e=>e.getData(t)).filter(e=>null!==e):n instanceof Mavo.Node&&(n=n.getData(t)),this.proxyCache[a]=n,!0)},set:function(e,t="",a){return console.warn(`You cannot set data via expressions. Attempt to set ${t.toString()} to ${a} ignored.`),a}})}:e=>e,createLiveData:function(e={}){return this.liveData=e,this.liveData[Mavo.toNode]=this,this.liveData[Mavo.toProxy]=this.relativizeData(this.liveData),this.liveData},pathFrom:function(e){for(var t=this.path,a=e.path,n=0;n<t.length&&a[n]==t[n];n++);return t.slice(n)},getDescendant:function(e){return e.reduce((e,t)=>e.children[t],this)},getCousin:function(e,t={}){if(!this.closestCollection)return null;var a=this.closestCollection,n=Math.abs(e),o=0>e?-1:1;if(a.length<n+1)return null;var r=this.closestItem.index+e;t.wrap&&(r=Mavo.wrap(r,a.length));for(var s,l=0;l<a.length;l++){s=r+l*o,s=t.wrap?Mavo.wrap(s,a.length):s;var i=a.children[s];if(!i||!i.isDeleted())break}if(!i||i.isDeleted()||i==this.closestItem)return null;if(this.collection)return i;var d=this.pathFrom(this.closestItem);return i.getDescendant(d)},contains:function(e){do{if(e===this)return!0;e=e.parent}while(e);return!1},lazy:{closestCollection:function(){return this.getClosestCollection()},closestItem:function(){return this.getClosestItem()},inPath:function(){var e="Collection"==this.nodeType?"mv-multiple-path":"mv-path";return(this.element.getAttribute(e)||"").split("/").filter(e=>e.length)},properties:function(){if(this.template)return this.template.properties;var e=new Set(this.property&&[this.property]);if("Group"==this.nodeType)for(var t in this.children)e=Mavo.union(e,this.children[t].properties);else"Collection"==this.nodeType&&(e=Mavo.union(e,this.itemTemplate.properties));return e},proxyCache:function(){return{}}},live:{store:function(t){e.toggleAttribute(this.element,"mv-storage",t)},unsavedChanges:function(e){return!e||this.saved&&this.editing||(e=!1),this.element.classList.toggle("mv-unsaved-changes",e),e},mode:function(t){if(this._mode!=t){if(this.modes&&t!=this.modes&&(t=this.modes),this._mode=t,!(this instanceof Mavo.Collection)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))){var a=this.modes||"edit"==t;Mavo.Observer.sneak(this.mavo.modeObserver,()=>{e.toggleAttribute(this.element,"mv-mode",t,a)})}return t}},modes:function(e){return e&&"read"!=e&&"edit"!=e?null:void(this._modes=e,e&&this.mode!=e&&(this.mode=e))},deleted:function(a){this.element.classList.toggle("mv-deleted",a),a?(this.elementContents=document.createDocumentFragment(),t(this.element.childNodes).forEach(e=>{this.elementContents.appendChild(e)}),e.contents(this.element,[{tag:"button",className:"mv-close mv-ui",textContent:"\xD7",events:{click:function(){e.remove(this.parentNode)}}},"Deleted "+this.name,{tag:"button",className:"mv-undo mv-ui",textContent:"Undo",events:{click:()=>this.deleted=!1}}]),this.element.classList.remove("mv-highlight"),this.itembar.remove()):this.deleted&&(this.element.textContent="",this.element.appendChild(this.elementContents),this._deleted=!1,this.dataChanged("undelete"),this.itembar.add())},path:{get:function(){var e=this.parent?this.parent.path:[];return this.property?[...e,this.property]:e}}},static:{maxId:0,all:new WeakMap,create:function(e,t,a={}){return Mavo.is("multiple",e)&&!a.collection?new Mavo.Collection(e,t,a):new Mavo[Mavo.is("group",e)?"Group":"Primitive"](e,t,a)},getProperty:function(e){var t=e.getAttribute("property")||e.getAttribute("itemprop");return t||(e.hasAttribute("property")?t=e.name||e.id||e.classList[0]:e.matches(Mavo.selectors.multiple)&&(t=e.getAttribute("mv-multiple")||"collection")),t&&e.setAttribute("property",t),t},get:function(e,t){var n=(a.all.get(e)||[]).filter(e=>!(e instanceof Mavo.Collection));return 2>n.length||!t?n[0]:n[0]instanceof Mavo.Group?node[1]:void 0},getClosest:function(e,t){var n;do n=a.get(e,t);while(!n&&(e=e.parentNode));return n},children:function(a){var e=Mavo.Node.get(a);return e?[e]:(e=t(Mavo.selectors.property,a).map(t=>Mavo.Node.get(t)).filter(t=>!a.contains(t.parentGroup.element)).map(t=>t.collection||t),Mavo.Functions.unique(e))}}})}(Bliss,Bliss.$),function(e,t){var a=Mavo.Group=e.Class({extends:Mavo.Node,nodeType:"Group",constructor:function(){if(this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element))this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this});var e=t(Mavo.selectors.property+", "+Mavo.selectors.multiple,this.element).filter(e=>this.element===e.parentNode.closest(Mavo.selectors.group)),a=e.map(e=>Mavo.Node.getProperty(e));e.forEach((e,t)=>{var n=a[t],o=this.template?this.template.children[n]:null,i={template:o,group:this};if(this.children[n]){var r=this.children[n];r.add(e),r.mutable=r.mutable||Mavo.is("multiple",e)}else this.children[n]=a.indexOf(n)==a.lastIndexOf(n)?Mavo.Node.create(e,this.mavo,i):new Mavo.Collection(e,this.mavo,i)}),this.childrenNames=Object.keys(this.children);var n=(this.isRoot?this.element.closest("[vocab]"):null)||this.element;this.vocab=n.getAttribute("vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)},get isRoot(){return!this.property},getNames:function(e="Node"){return Object.keys(this.children).filter(t=>this.children[t]instanceof Mavo[e])},getData:function(t={}){var n={context:this,options:t,data:this.super.getData.call(this,t)};if(void 0!==n.data)return n.data;if(n.data=this.liveData,1==this.childrenNames.length&&this.childrenNames[0]==this.property){var o=e.extend(e.extend({},n.options),{forceObjects:!0});n.data=this.children[this.property].getData(o)}else for(var i in this.children){var r=this.children[i];if(r.saved||n.options.live)var s=r.getData(n.options);n.options.live||r.saved&&null!==Mavo.value(s)?n.data[r.property]=s:delete n.data[r.property]}return n.options.live?this.proxyCache={}:(n.data=Mavo.subset(this.data,this.inPath,n.data),this.childrenNames.length||this.isRoot?n.data&&"object"==typeof n.data&&(this.type&&this.type!=a.DEFAULT_TYPE&&(n.data["@type"]=this.type),this.vocab&&(n.data["@context"]=this.vocab)):n.data=null),Mavo.hooks.run("node-getdata-end",n),(n.options.live?n.data[Mavo.toProxy]:n.data)||n.data},find:function(e,t={}){if(t.exclude!==this){if(this.property==e)return this;if(e in this.children)return this.children[e].find(e,t);if(this.properties.has(e)){var a,n,o=[];for(var i in this.children)n=this.children[i].find(e,t),void 0!==n&&(Array.isArray(n)?(o.push(...n),a=!0):o.push(n));return a||1<o.length?o:o[0]}}},edit:function(e={}){return!1!==this.super.edit.call(this)&&Promise.all(Object.keys(this.children).map(t=>this.children[t].edit(e)))},save:function(){this.unsavedChanges=!1},propagated:["save","import"],dataRender:function(t){if(t){if("object"!=typeof t){if(this.property in this.children)var a=this.property;else var n=e.type(t),o=e=>(this.children[e]instanceof Mavo.Primitive)+(this.children[e].datatype==n),a=Object.keys(this.children).filter(e=>!this.children[e].expressionText).sort((e,t)=>o(e)-o(t)).reverse()[0];t={[a]:t},this.data=Mavo.subset(this.data,this.inPath,t)}var i;this.propagate(a=>{var n=t[a.property];a.alias&&void 0!==t[a.alias]&&(i=i||e.extend({},t),n=t[a.alias]),a.render(n)}),i&&this.propagate(e=>{e.alias&&(t[e.property]=i[e.alias],!(e.alias in this.children)&&delete t[e.alias])});var a;this.createLiveData(t)}},lazy:{liveData:function(){return this.createLiveData()}},static:{all:new WeakMap,DEFAULT_TYPE:"Item",normalize:function(e){if(Mavo.is("group",e)){var t=Mavo.getAttribute(e,"typeof","itemtype")||a.DEFAULT_TYPE;return e.setAttribute("typeof",t),t}return null}}})}(Bliss,Bliss.$),function(e,t){var a=Mavo.Primitive=e.Class({extends:Mavo.Node,nodeType:"Primitive",constructor:function(n){this.fromTemplate("config","attribute","templateValue","originalEditor")||(this.config=a.getConfig(n),this.attribute=this.config.attribute),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=this.expressionText||Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&(this.expressionText.primitive=this,this.storage=this.storage||"none",this.modes="read",this.element.setAttribute("aria-live","polite")),!this.editor&&this.element.hasAttribute("mv-edit")&&(!this.originalEditor&&(this.originalEditor=e(this.element.getAttribute("mv-edit"))),this.originalEditor&&!this.template&&(this.originalEditorObserver=new Mavo.Observer(this.originalEditor,"all",()=>{this.copies.concat(this).forEach(e=>{"editor"==e.defaultSource&&(e.default=this.originalEditor.value),e.editor&&(e.editor=this.originalEditor.cloneNode(!0)),e.setValue(e.value,{force:!0,silent:!0})})}))),this.editor||this.originalEditor||this.attribute||(this.editor=t(this.element.children).filter(function(e){return e.matches(Mavo.selectors.formControl)&&!e.matches(Mavo.selectors.property)})[0],this.editor&&e.remove(this.editor));var o=this.editorValue;this.datatype||"number"!=typeof o&&"boolean"!=typeof o||(this.datatype=typeof o),this.config.init&&this.config.init.call(this,this.element),this.config.changeEvents&&e.bind(this.element,this.config.changeEvents,e=>{e.target===this.element&&(this.value=this.getValue())}),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?(this._default=this.modes?this.templateValue:o,this.defaultSource=this.modes?"template":"editor"):""===this.default?(this._default=this.templateValue,this.defaultSource="template"):(this.defaultObserver=new Mavo.Observer(this.element,"mv-default",()=>{this.default=this.element.getAttribute("mv-default")}),this.defaultSource="attribute");var i=!this.template||this.template.templateValue!=this.templateValue||"edit"==this.modes;this.initialValue=void 0===this.default&&i?this.templateValue:this.default,this.initialValue===void 0&&(this.initialValue=this.emptyValue),this.setValue(this.initialValue,{silent:!0}),Mavo.setAttributeShy(this.element,"aria-label",this.label),this.attribute||Mavo.setAttributeShy(this.element,"mv-attribute","none"),!1!==this.config.observer&&(this.observer=new Mavo.Observer(this.element,this.attribute,()=>{this.observer.running&&(this.attribute||!this.editing||this.config.subtree)&&(this.value=this.getValue())},{subtree:this.config.subtree,childList:this.config.subtree})),this.postInit(),Mavo.hooks.run("primitive-init-end",this)},get editorValue(){var t=this.editor||this.originalEditor;if(t){if(t.matches(Mavo.selectors.formControl))return a.getValue(t,{datatype:this.datatype});var n=e(Mavo.selectors.output+", "+Mavo.selectors.formControl,t);if(n)return a.getValue(n)}},set editorValue(t){if(this.config.setEditorValue&&"boolean"!==this.datatype)return this.config.setEditorValue.call(this,t);if(this.editor)if(this.editor.matches(Mavo.selectors.formControl))a.setValue(this.editor,t,{config:this.editorDefaults});else{var n=e(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor);n&&a.setValue(n,t)}},destroy:function(){this.super.destroy.call(this),this.defaultObserver&&this.defaultObserver.destroy(),this.observer&&this.observer.destroy()},getData:function(e={}){var t={context:this,options:e,data:this.super.getData.call(this,e)};if(void 0===t.data&&(t.data=this.value,""===t.data&&(t.data=null)),!t.options.live)this.inPath.length&&(t.data=Mavo.subset(this.data,this.inPath,t.data));else if(this.collection||e.forceObjects)return t.data=Mavo.objectify(t.data,{[Mavo.toNode]:this}),t.data[Mavo.toProxy]=this.relativizeData(t.data),this.collection&&(t.data[this.property]=t.data),Mavo.hooks.run("node-getdata-end",t),this.proxyCache={},t.data[Mavo.toProxy];return Mavo.hooks.run("node-getdata-end",t),t.data},sneak:function(e){return Mavo.Observer.sneak(this.observer,e)},save:function(){this.savedValue=this.value,this.unsavedChanges=!1},initEdit:function(){if(!this.editor&&this.originalEditor&&(this.editor=this.originalEditor.cloneNode(!0)),!this.editor){var a=this.config.editor;a&&"boolean"!=this.datatype||(a=Mavo.Elements.defaultConfig[this.datatype||"string"].editor),this.editor=e.create("function"===e.type(a)?a.call(this):a),this.editorValue=this.value}e.bind(this.editor,{"input change":()=>{this.value=this.editorValue},"mv-change":t=>{"output"===t.property&&(t.stopPropagation(),e.fire(this.editor,"input"))}});var n=this.editor.matches("textarea");n||this.editor.addEventListener("focus",()=>{this.editor.select&&this.editor.select()}),!this.popup&&this.closestCollection&&this.editor.matches(Mavo.selectors.textInput)&&this.editor.addEventListener("keydown",e=>{if(13==e.keyCode&&this.closestCollection.editing&&(e.shiftKey||!n)){var t=this.getCousin(1);if(!t){if(this.bottomUp)return;var a=this.closestCollection.add();this.closestCollection.editItem(a,{immediately:!0})}t=this.getCousin(1),t.edit({immediately:!0}).then(()=>t.editor.focus()),n&&e.preventDefault()}else if(8==e.keyCode&&(this.empty&&this.collection||e[Mavo.superKey])){this.closestCollection.delete(this.closestItem);var o=this.getCousin(1)||this.getCousin(-1);o&&o.edit({immediately:!0}).then(()=>o.editor.focus())}}),"placeholder"in this.editor&&(this.editor.placeholder="("+this.label+")");var o=/^mv-edit-/i;t(this.element.attributes).forEach(function(e){o.test(e.name)&&this.editor.setAttribute(e.name.replace(o,""),e.value)},this),(this.attribute||this.config.popup)&&(this.popup=new Mavo.UI.Popup(this)),this.popup||this.editor.classList.add("mv-editor"),this.initEdit=null},edit:function(t={}){return!1!==this.super.edit.call(this)&&(-1===this.element.tabIndex&&Mavo.revocably.setAttribute(this.element,"tabindex","0"),this.modes||e.bind(this.element,"click.mavo:edit",e=>e.preventDefault()),this.preEdit=Mavo.defer(a=>{if(t.immediately)return a();var n=["click","focus","dragover","dragenter"].map(t=>t+".mavo:preedit").join(" ");e.bind(this.element,n,a)}).then(()=>e.unbind(this.element,".mavo:preedit")),this.config.edit?void this.config.edit.call(this):this.preEdit.then(()=>{this.sneak(()=>{this.initEdit&&this.initEdit(),this.popup&&(this.popup.prepare(),this.popup.show()),this.attribute||this.popup||(this.editor.parentNode!=this.element&&(this.editorValue=this.value,this.element.textContent="",this.element.appendChild(this.editor)),!this.collection&&(document.activeElement===this.element&&this.editor.focus(),Mavo.revocably.restoreAttribute(this.element,"tabindex")))})}))},done:function(){return!1!==this.super.done.call(this)&&void("preEdit"in this&&e.unbind(this.element,".mavo:preedit .mavo:edit"),this.sneak(()=>this.config.done?void this.config.done.call(this):void(this.popup?this.popup.close():!this.attribute&&this.editor&&(e.remove(this.editor),a.setValue(this.element,this.editorValue,{config:this.config,attribute:this.attribute,datatype:this.datatype,map:this.originalEditor||this.editor})))),!this.collection&&Mavo.revocably.restoreAttribute(this.element,"tabindex"))},dataRender:function(e){if(e&&"object"==typeof e)if(Symbol.toPrimitive in e)e=e[Symbol.toPrimitive]();else{var t,a=Object.keys(e);if(1===a.length)t=a[0];else for(let a of[this.property,"value","content"])if(a in e){t=a;break}t&&(e=e[t],this.inPath.push(t))}e===void 0?!this.modes&&(this.value=this.closestCollection?this.default:this.templateValue):this.value=e},find:function(e,t={}){if(this.property==e&&t.exclude!==this)return this},getValue:function(){return a.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})},lazy:{label:function(){return Mavo.Functions.readable(this.property)},emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0;}return""},editorDefaults:function(){return this.editor&&a.getConfig(this.editor)}},setValue:function(e,t={}){return this.sneak(()=>{e=e||0===e||!1===e?e:"";var n=this.datatype;return this.datatype||"number"!=typeof e&&"boolean"!=typeof e||(this.datatype=typeof e),e=a.safeCast(e,this.datatype),t.force||e!=this._value||n!=this.datatype?void(this.editor&&document.activeElement!=this.editor&&(this.editorValue=e),(this.popup||!this.editor||this.editor!==document.activeElement)&&(this.config.setValue?this.config.setValue.call(this,this.element,e):!t.dataOnly&&a.setValue(this.element,e,{config:this.config,attribute:this.attribute,datatype:this.datatype,map:this.originalEditor||this.editor})),this.empty=!e&&0!==e,this._value=e,!t.silent&&(this.saved&&(this.unsavedChanges=this.mavo.unsavedChanges=!0),this.dataChanged("propertychange",{value:e}))):e}),e},dataChanged:function(e="propertychange",t){return this.super.dataChanged.call(this,e,t)},live:{default:function(e){this.value==this._default&&(this.value=e)},value:function(e){return this.setValue(e)},datatype:function(t){t!==this._datatype&&("boolean"==t&&!this.attribute&&(this.attribute=Mavo.Elements.defaultConfig.boolean.attribute),e.toggleAttribute(this.element,"datatype",t,t&&"string"!==t))},empty:function(t){var a=t&&!this.modes&&!(this.attribute&&e(Mavo.selectors.property,this.element));this.element.classList.toggle("mv-empty",!!a)}},static:{all:new WeakMap,getValueAttribute:function(e,t=Mavo.Elements.search(e)){var a=e.getAttribute("mv-attribute")||t.attribute;return a&&"null"!==a&&"none"!==a||(a=null),a},safeCast:function(e,t){var n=a.cast(e,t);return null===e||void 0===e?e:"boolean"==t?"false"!==e&&0!==e&&""!==e&&(!!("true"===e||0<e)||e):"number"==t?/^[-+]?[0-9.e]+$/i.test(e+"")?n:e:n},cast:function(e,t){return"number"===t?+e:"boolean"===t?!!e:"string"===t?e+"":e},getValue:function(e,{config:t,attribute:n,datatype:o}={}){if(t||(t=a.getConfig(e,n)),n=t.attribute,o=t.datatype,t.getValue&&n==t.attribute)return t.getValue(e);var i;return i=n in e&&a.useProperty(e,n)?e[n]:n?e.getAttribute(n):e.getAttribute("content")||e.textContent||null,a.safeCast(i,o)},getConfig:function(e,t,n){void 0===t&&(t=e.getAttribute("mv-attribute")||void 0),("null"==t||"none"==t)&&(t=null),n||t!=a.getValueAttribute(e)||(n=e.getAttribute("datatype")||void 0);var o=Mavo.Elements.search(e,t,n);return void 0===o.attribute&&(o.attribute=t||null),void 0===o.datatype&&(o.datatype=n),o},setValue:function(t,n,i={}){if(1===t.nodeType&&(i.config||(i.config=a.getConfig(t,i.attribute)),i.attribute=void 0===i.attribute?i.config.attribute:i.attribute,i.datatype=void 0===i.datatype?i.config.datatype:i.datatype,i.config.setValue&&i.attribute==i.config.attribute))return i.config.setValue(t,n,i.attribute);if(i.attribute){if(i.attribute in t&&a.useProperty(t,i.attribute)&&t[i.attribute]!==n){try{var o=t[i.attribute],r=t[i.attribute]=n}catch(t){}o!=r&&i.config.changeEvents&&i.config.changeEvents.split(/\s+/).forEach(a=>e.fire(t,a))}"boolean"==i.datatype?n!=t.hasAttribute(i.attribute)&&e.toggleAttribute(t,i.attribute,n,n):t.getAttribute(i.attribute)!=n&&t.setAttribute(i.attribute,n)}else{var s=a.format(n,i);s===n?t.textContent=n:(t.textContent=s,t.setAttribute&&t.setAttribute("content",n))}},useProperty:function(e,t){return!(-1<["href","src"].indexOf(t))&&"http://www.w3.org/2000/svg"!=e.namespaceURI},format:(t,n={})=>{if(n.map&&/^select$/i.test(n.map.nodeName))for(var o,r=0;o=n.map.options[r];r++)if(o.value==t)return o.textContent;if("number"===e.type(t)||"number"==n.datatype){var i=n.attribute||n.element&&n.element.matches("style, pre");if(!i)return a.formatNumber(t)}return Array.isArray(t)?t.map(a.format).join(", "):"object"===e.type(t)?Mavo.toJSON(t):t},lazy:{formatNumber:()=>{var e=new Intl.NumberFormat(Mavo.locale,{maximumFractionDigits:2});return function(t){return t===Infinity||t===-Infinity?0>t?"-\u221E":"\u221E":e.format(t)}}}}})}(Bliss,Bliss.$),function(e){Mavo.UI.Popup=e.Class({constructor:function(t){this.primitive=t,this.position=()=>{var t=this.primitive.element.getBoundingClientRect(),a=t.left,n=t.bottom,o=!1;if(this.element.offsetHeight&&(this.height=this.element.getBoundingClientRect().height||this.height),this.height+n+20>innerHeight)if(20<t.top-this.height){var o=!0;n=t.top-this.height-20}else n=innerHeight-this.height-20;this.element.classList.toggle("mv-point-down",o),e.style(this.element,{top:`${n}px`,left:`${a}px`})},this.element=e.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:e=>{(13==e.keyCode||27==e.keyCode)&&(this.element.contains(document.activeElement)&&this.primitive.element.focus(),e.stopPropagation(),this.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length))},show:function(){e.unbind([this.primitive.element,this.element],".mavo:showpopup"),this.shown=!0,this.hideCallback=e=>{this.element.contains(e.target)||this.primitive.element.contains(e.target)||this.hide()},this.element.style.transition="none",this.element.removeAttribute("hidden"),this.position(),this.element.setAttribute("hidden",""),this.element.style.transition="",document.body.appendChild(this.element),setTimeout(()=>{this.element.removeAttribute("hidden")},100),e.bind(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position,{passive:!0})},hide:function(){e.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position,{passive:!0}),this.element.setAttribute("hidden",""),this.shown=!1,setTimeout(()=>{e.remove(this.element)},1e3*parseFloat(getComputedStyle(this.element).transitionDuration)||400)},prepare:function(){e.bind(this.primitive.element,{"click.mavo:edit":()=>{this.show()},"keyup.mavo:edit":e=>{-1<[13,113].indexOf(e.keyCode)&&(this.show(),this.editor.focus())}})},close:function(){this.hide(),e.unbind(this.primitive.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive"}})}(Bliss,Bliss.$),function(e){var t=Math.min,a=Math.max,n=Mavo.Elements={};Object.defineProperties(n,{register:{value:function(t,a){if("object"==typeof arguments[0]){for(let e in arguments[0])n.register(e,arguments[0][e]);return}if(a.extend){var o=n[a.extend];a=e.extend(e.extend({},o),a)}if(-1<t.indexOf("@")){var i=t.split("@");a.selector=a.selector||i[0]||"*",void 0===a.attribute&&(a.attribute=i[1])}return a.selector=a.selector||t,a.id=t,Array.isArray(a.attribute)?a.attribute.forEach(i=>{var r=e.extend({},a);r.attribute=i,n[`${t}@${i}`]=r}):n[t]=a,n}},search:{value:function(t,a,o){var i=n.matches(t,a,o),r=i[i.length-1];if(r)return r;var s=e.extend({},n.defaultConfig[o||"string"]);return s.attribute=void 0===a?s.attribute:a,s}},matches:{value:function(e,t,a){var i=[];selectorloop:for(var r in n){var s=n[r],o=void 0===t&&s.default||t===s.attribute;if(o&&(void 0===a||"string"===a||a===s.datatype)){var l=s.selector||r;e.matches(l)&&(!s.test||s.test(e,t,a))&&i.push(s)}}return i}},isSVG:{value:t=>"http://www.w3.org/2000/svg"==t.namespaceURI},defaultConfig:{value:{string:{editor:{tag:"input"}},number:{editor:{tag:"input",type:"number"}},boolean:{attribute:"content",editor:{tag:"input",type:"checkbox"}}}}}),n.register({"@hidden":{datatype:"boolean"},"@y":{test:n.isSVG,datatype:"number"},"@x":{default:!0,test:n.isSVG,datatype:"number"},media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var t=e.create("input",{type:"url",placeholder:"http://example.com/image.png",className:"mv-output","aria-label":"URL to image"});if(this.mavo.uploadBackend&&self.FileReader){var a,n=this.element.nodeName.toLowerCase();n="img"==n?"image":n;var o=this.element.getAttribute("mv-uploads")||n+"s",i=(e,a=e.name)=>{if(e&&0===e.type.indexOf(n+"/")){var i=URL.createObjectURL(e);this.sneak(()=>this.element.src=i),this.mavo.upload(e,o+"/"+a).then(e=>{var a=0,n=Mavo.rr(()=>Mavo.timeout(1e3+500*a).then(()=>{a++,this.element.src=e})),o=()=>{URL.revokeObjectURL(i),this.element.removeEventListener("load",r),this.element.removeEventListener("error",r)},r=()=>{this.element.src!=i&&(this.element.src=e,o())},s=()=>{10>=a?(this.sneak(()=>this.element.src=i),n()):(this.mavo.error(this.mavo._("cannot-load-uploaded-file")+" "+e),o())};t.value=e,this.element.addEventListener("load",r),this.element.addEventListener("error",s)})}},r={paste:e=>{var t=e.clipboardData.items[0];if("file"==t.kind&&0===t.type.indexOf(n+"/")){var a=`pasted-${n}-${Date.now()}.${t.type.slice(6)}`,o=prompt(this.mavo._("filename"),a);""===o&&(o=a),null!==o&&(i(t.getAsFile(),o),e.preventDefault())}},"drag dragstart dragend dragover dragenter dragleave drop":e=>{e.preventDefault(),e.stopPropagation()},"dragover dragenter":()=>{a.classList.add("mv-dragover"),this.element.classList.add("mv-dragover")},"dragleave dragend drop":()=>{a.classList.remove("mv-dragover"),this.element.classList.remove("mv-dragover")},drop:e=>{i(e.dataTransfer.files[0])}};return e.bind(this.element,r),a=e.create({className:"mv-upload-popup",contents:[t,{tag:"input",type:"file","aria-label":"Upload image",accept:n+"/*",events:{change:e=>{var t=e.target.files[0];t&&i(t)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:r})}return t}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},details:{attribute:"open",datatype:"boolean"},"a, link":{default:!0,attribute:"href"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},formControl:{selector:"input",default:!0,attribute:"value",modes:"edit",changeEvents:"input change",edit:()=>{},done:()=>{},init:function(){this.editor=this.element}},select:{extend:"formControl",selector:"select",subtree:!0},textarea:{extend:"formControl",selector:"textarea",attribute:null,getValue:e=>e.value,setValue:(e,t)=>e.value=t},formNumber:{extend:"formControl",selector:"input[type=range], input[type=number]",datatype:"number",setValue:function(t,a){t.value=a,t.setAttribute("value",a);var n=a>t.value?"max":"min";if(!isNaN(a)&&t.value!=a&&!Mavo.data(t,"boundObserver")){var o=new Mavo.Observer(t,n,()=>{t.value=a});requestAnimationFrame(()=>{e.bind(t,"input mv-change",function a(){o.destroy(),Mavo.data(t,"boundObserver",void 0),e.unbind(t,"input mv-change",a)})}),Mavo.data(t,"boundObserver",o)}}},checkbox:{extend:"formControl",selector:"input[type=checkbox]",attribute:"checked",datatype:"boolean",changeEvents:"click"},radio:{extend:"formControl",selector:"input[type=radio]",attribute:"checked",modes:"edit",getValue:t=>{if(t.form)return t.form[t.name].value;var a=e(`input[type=radio][name="${t.name}"]:checked`);return a&&a.value},setValue:(t,a)=>{if(t.form)return void(t.form[t.name].value=a);var n=e(`input[type=radio][name="${t.name}"][value="${a}"]`);e.properties(n,{checked:!0})},init:function(e){this.mavo.element.addEventListener("change",t=>{t.target.name==e.name&&(this.value=this.getValue())})}},counter:{extend:"formControl",selector:"button, .counter",attribute:"mv-clicked",datatype:"number",init:function(e){"mv-clicked"===this.attribute&&(e.setAttribute("mv-clicked","0"),e.addEventListener("click",()=>{let t=+e.getAttribute("mv-clicked")||0;this.value=++t}))}},"meter, progress":{default:!0,attribute:"value",datatype:"number",edit:function(){var n=+this.element.getAttribute("min")||0,o=+this.element.getAttribute("max")||1,i=o-n,r=+this.element.getAttribute("mv-edit-step")||(1<i?1:i/100);e.bind(this.element,"mousemove.mavo:edit",e=>{var s=this.element.getBoundingClientRect().left,l=a(0,(e.clientX-s)/this.element.offsetWidth),d=n+i*l,m=d%r;d+=m>r/2?r-m:-m,d=a(n,t(d,o)),this.sneak(()=>this.element.setAttribute("value",d))}),e.bind(this.element,"mouseleave.mavo:edit",()=>{this.sneak(()=>this.element.setAttribute("value",this.value))}),e.bind(this.element,"click.mavo:edit",()=>{this.value=this.getValue()}),e.bind(this.element,"keydown.mavo:edit",e=>{if(e.target==this.element&&(37==e.keyCode||39==e.keyCode)){var i=r*(39==e.keyCode?1:-1)*(e.shiftKey?10:1),s=this.value+i;s=a(n,t(s,o)),this.element.setAttribute("value",s),e.preventDefault()}})},done:function(){e.unbind(this.element,".mavo:edit")}},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address",editor:function(){var t=getComputedStyle(this.element),a=t.display,n=0===a.indexOf("inline")?"input":"textarea",o=e.create(n);if("textarea"==n){var i=this.element.offsetWidth;i&&(o.width=i),o.style.whiteSpace={normal:"pre-wrap",nowrap:"pre"}[t.whiteSpace]||"inherit"}return o},setEditorValue:function(e){this.datatype&&"string"!=this.datatype&&(e+="");var t=getComputedStyle(this.element);return e=e||"",-1<["normal","nowrap"].indexOf(t.whiteSpace)&&(e=e.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(t.whiteSpace)&&(e=e.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=e,!0}},time:{attribute:"datetime",default:!0,init:function(){if(!this.fromTemplate("dateType")){var e=Mavo.DOMExpression.search(this.element,null),t=this.element.getAttribute("datetime")||"YYYY-MM-DD";for(var a in this.config.dateTypes)if(this.config.dateTypes[a].test(t))break;this.dateType=a,e||(this.element.textContent=this.config.defaultFormats[this.dateType](this.property),this.mavo.expressions.extract(this.element,null))}},dateTypes:{month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[Mi\d]{2}/i,date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i},defaultFormats:{date:e=>`[day(${e})] [month(${e}).shortname] [year(${e})]`,month:e=>`[month(${e}).name] [year(${e})]`,time:e=>`[hour(${e}).twodigit]:[minute(${e}).twodigit]`,"datetime-local":function(e){return this.date(e)+" "+this.time(e)}},editor:function(){return{tag:"input",type:this.dateType}}},"circle@r":{default:!0,datatype:"number"},circle:{attribute:["cx","cy"],datatype:"number"},text:{default:!0,popup:!0},".mv-toggle":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){Mavo.revocably.setAttribute(this.element,"role","checkbox"),e.bind(this.element,"click.mavo:edit keyup.mavo:edit keydown.mavo:edit",e=>{("click"==e.type||" "==e.key||"Enter"==e.key)&&("keydown"!=e.type&&(this.value=!this.value),e.preventDefault(),e.stopPropagation())})},done:function(){Mavo.revocably.restoreAttribute(this.element,"role"),e.unbind(this.element,".mavo:edit")}}})}(Bliss,Bliss.$),function(e,t){Mavo.attributes.push("mv-multiple","mv-order","mv-accepts");var a=Mavo.Collection=e.Class({extends:Mavo.Node,nodeType:"Collection",constructor:function(){if(this.templateElement=this.element,this.children=[],this.fromTemplate("mutable","templateElement","accepts","optional","like","likeNode")||(this.mutable=this.templateElement.matches(Mavo.selectors.multiple),this.accepts=(this.templateElement.getAttribute("mv-accepts")||"").split(/\s+/),this.like=this.templateElement.getAttribute("mv-like"),this.like&&(this.likeNode=this.resolve(this.like,{exclude:this}),this.likeNode=this.likeNode||this.likeNode.template,!this.likeNode&&(this.like=null)),this.optional=!!this.like||this.templateElement.hasAttribute("mv-optional"),this.templateElement=this.templateElement.cloneNode(!0)),this.likeNode){this.itemTemplate=this.likeNode;var t=e.value(this.likeNode.collection,"templateElement")||this.likeNode.element;this.templateElement=t.cloneNode(!0),this.templateElement.setAttribute("property",this.property),this.properties=this.likeNode.properties}else if(!this.optional||!this.template){var a=this.createItem(this.element);this.add(a,void 0,{silent:!0}),this.optional&&this.delete(a,!0)}this.optional&&this.element.remove(),this.postInit(),Mavo.hooks.run("collection-init-end",this)},get length(){return this.children.length},getData:function(e={}){var t={context:this,options:e,data:this.liveData};t.options.live&&(this.proxyCache={});for(var a=0,n=0;item=this.children[a];a++)if(!item.deleted||t.options.live){var o=item.getData(t.options);(t.options.live||null!==Mavo.value(o))&&(t.data[n]=o,n++)}if(t.data.length=n,!this.mutable)if(Mavo.filter(t.data,e=>null!==Mavo.value(e)),t.options.live&&1===t.data.length)t.data=t.data[0];else if(this.data&&!t.options.live){var i=Mavo.subset(this.data,this.inPath);t.data=t.data.concat(i.slice(t.data.length))}return t.options.live||(t.data=Mavo.subset(this.data,this.inPath,t.data)),Mavo.hooks.run("node-getdata-end",t),(t.options.live?t.data[Mavo.toProxy]:t.data)||t.data},createItem:function(e){e||(e=this.templateElement.cloneNode(!0));var t=this.itemTemplate||(this.template?this.template.itemTemplate:null),a=Mavo.Node.create(e,this.mavo,{collection:this,template:t,property:this.property,type:this.type});return this.itemTemplate||(this.itemTemplate=t||a),a},add:function(t,a,n={}){if(t=t instanceof Node?Mavo.Node.get(t)||this.createItem(t):t||this.createItem(),t.collection!=this&&this.adopt(t),this.mutable){var o=this.children[a]?this.children[a].element:this.marker;e[this.bottomUp?"after":"before"](t.element,o),void 0===a&&(a=this.bottomUp?0:this.length)}else a=this.length;var r={context:this,item:t};return r.previousIndex=t.index,r.changed=this.splice({remove:r.item},{index:a,add:r.item}),r.item.itembar&&r.item.itembar.reposition(),this.mavo.expressions.active&&!n.silent&&requestAnimationFrame(()=>{r.changed.forEach(e=>{e.dataChanged(e==r.item&&void 0===r.previousIndex?"add":"move"),e.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0,this.mavo.expressions.update(r.item)}),Mavo.hooks.run("collection-add-end",r),r.item},splice:function(...e){e.forEach(e=>{e.index===void 0&&e.remove&&isNaN(e.remove)&&(e.index=this.children.indexOf(e.remove),e.remove=1)}),e.sort((e,t)=>t.index-e.index),e.forEach(e=>{-1<e.index&&(e.remove||e.add)&&(e.remove=e.remove||0,e.add=Mavo.toArray(e.add),this.children.splice(e.index,+e.remove,...e.add))});var t=[];for(let a,n=0;n<this.length;n++)a=this.children[n],a&&a.index!==n&&(a.index=n,t.push(a));return t},adopt:function(e){e.collection&&(e.collection.splice({remove:e}),e.collection.dataChanged("delete")),this.walk(t=>{t.closestCollection===e.collection&&(t.closestCollection=this),e.mavo!=this.mavo&&(e.mavo=this.mavo)}),e.collection=this,e.template&&(Mavo.delete(e.template.copies,e),e.template=this.itemTemplate)},delete:function(t,a){return a?(e.remove(t.element),this.splice({remove:t}),void t.destroy()):e.transition(t.element,{opacity:0}).then(()=>{t.deleted=!0,t.element.style.opacity="",t.dataChanged("delete"),this.unsavedChanges=t.unsavedChanges=this.mavo.unsavedChanges=!0})},move:function(e,t){var a=e.index+t+(0<t);a=Mavo.wrap(a,this.children.length+1),this.add(e,a),e instanceof Mavo.Primitive&&e.itembar&&e.itembar.reposition()},editItem:function(e,t={}){var a=t.immediately?Promise.resolve():Mavo.inView.when(e.element);return a.then(()=>(this.mutable&&(!e.itembar&&(e.itembar=new Mavo.UI.Itembar(e)),e.itembar.add()),e.edit(t)))},edit:function(t={}){if(!1===this.super.edit.call(this))return!1;if(this.mutable){if(!this.addButton.parentNode){var n=this.element.tagName.toLowerCase(),o=Mavo.selectors.container[n],i=o?this.marker.parentNode.closest(o):this.marker;e[this.bottomUp?"before":"after"](this.addButton,i)}a.dragula.then(()=>{this.getDragula()})}return Promise.all(this.children.map(e=>this.editItem(e,t)))},done:function(){return!1!==this.super.done.call(this)&&void(this.mutable&&(this.addButton.parentNode&&this.addButton.remove(),this.propagate(e=>{e.itembar&&e.itembar.remove()})))},dataChanged:function(e,t={}){return t.element=t.element||this.marker,this.super.dataChanged.call(this,e,t)},save:function(){this.children.forEach(e=>{e.deleted?this.delete(e,!0):e.unsavedChanges=!1})},propagated:["save"],dataRender:function(t){if(void 0!==t){if(t=null===t?[]:Mavo.toArray(t).filter(e=>null!==e),!this.mutable)this.children.forEach((e,a)=>e.render(t&&t[a]));else{for(var a,n=0;n<this.children.length;n++)a=this.children[n],n<t.length?a.render(t[n]):(a.dataChanged("delete"),this.delete(a,!0),n--);if(t.length>n){for(var a,o=document.createDocumentFragment(),i=n;i<t.length;i++){a=this.createItem(),a.render(t[i]),this.children.push(a),a.index=i,o.appendChild(a.element);var r={context:this,item:a};Mavo.hooks.run("collection-add-end",r)}this.bottomUp?e.after(o,0<n?this.children[n-1].element:this.marker):e.before(o,this.marker);for(var i=n;i<this.children.length;i++)this.children[i].dataChanged("add"),this.mavo.expressions.active&&requestAnimationFrame(()=>this.mavo.expressions.update(this.children[i]))}}this.createLiveData(t||[])}},find:function(e,t={}){if(t.exclude!==this){var a=this.children.filter(e=>!e.deleted&&!e.hidden);if(this.property==e)return t.collections?this:a;if(this.properties.has(e)){var n=a.map(a=>a.find(e,t));return Mavo.flatten(n)}}},isCompatible:function(e){return e&&this.itemTemplate.nodeType==e.itemTemplate.nodeType&&(e===this||e.template==this||this.template==e||this.template&&this.template==e.template||-1<this.accepts.indexOf(e.property))},live:{mutable:function(t){if(t&&t!==this.mutable){this._mutable=t,this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this);var a=this.templateElement.parentNode?this.templateElement:this.children[this.length-1].element;e.after(this.marker,a)}}},getDragula:function(){if(this.dragula)return this.dragula;if(this.template)return Mavo.pushUnique(this.template.getDragula().containers,this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this;return this.dragula=dragula({containers:[this.marker.parentNode],isContainer:e=>!!this.accepts.length&&-1<Mavo.flatten(this.accepts.map(e=>this.mavo.root.find(e,{collections:!0}))).filter(e=>e&&e instanceof a).map(e=>e.marker.parentNode).indexOf(e),moves:(e,t,a)=>a.classList.contains("mv-drag-handle")&&a.closest(Mavo.selectors.multiple)==e,accepts:function(e,t,n,o){if(e.contains(t))return!1;var i=o?o.previousElementSibling:t.lastElementChild,r=a.get(i)||a.get(o);if(!r)return!1;var s=Mavo.Node.get(e);return s&&s.collection.isCompatible(r)}}),this.dragula.on("drop",e=>{var t=Mavo.Node.get(e),n=t&&t.index,o=e.nextElementSibling,i=e.previousElementSibling,r=a.get(i)||a.get(o),s=Mavo.Node.get(i)||Mavo.Node.get(o);if(s&&s.collection!=r&&(s=null),t.collection.isCompatible(r)){var l=s?s.index+(s.element===i):r.length;r.add(t,l)}else return this.dragula.cancel(!0)}),a.dragulas.push(this.dragula),this.dragula},lazy:{bottomUp:function(){if(!this.mutable)return!1;var e=this.templateElement.getAttribute("mv-order");return null===e?!!this.addButton.parentNode&&!!(this.addButton.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING):/^desc\b/i.test(e)},closestCollection:function(){var e=this.marker?this.marker.parentNode:this.templateElement.parentNode;return e.closest(Mavo.selectors.multiple)},addButton:function(){var a=`button.mv-add-${this.property}`,n=this.closestCollection||this.marker.parentNode.closest(Mavo.selectors.group);if(n)var o=t(a,n).filter(e=>!this.templateElement.contains(e)&&!Mavo.data(e,"collection"))[0];return o||(o=e.create("button",{className:"mv-add",textContent:this.mavo._("add-item",this)})),o.classList.add("mv-ui","mv-add"),Mavo.data(o,"collection",this),this.property&&o.classList.add(`mv-add-${this.property}`),o.addEventListener("click",e=>{e.preventDefault(),this.editItem(this.add())}),o},liveData:function(){return this.createLiveData([])}},static:{dragulas:[],get:e=>{var t=Mavo.data(e,"collection");if(t)return t;var a=Mavo.Node.get(e);return a&&a.collection||null},lazy:{dragula:()=>e.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}})}(Bliss,Bliss.$),function(e,t){var a=Mavo.UI.Itembar=e.Class({constructor:function(a){if(this.item=a,this.element=t(`.mv-item-bar:not([mv-rel]), .mv-item-bar[mv-rel="${this.item.property}"]`,this.item.element).filter(e=>e.closest(Mavo.selectors.multiple)==this.item.element&&!Mavo.data(e,"item"))[0],!this.element&&this.item.template&&this.item.template.itembar)this.element=this.item.template.itembar.element.cloneNode(!0),this.dragHandle=e(".mv-drag-handle",this.element)||this.item.element;else{this.element=this.element||e.create({className:"mv-item-bar mv-ui"});var n=[{tag:"button",title:this.mavo._("delete-item",this.item),className:"mv-delete"},{tag:"button",title:this.mavo._(`add-item-${this.collection.bottomUp?"after":"before"}`,this.item),className:"mv-add"}];this.item instanceof Mavo.Group?(this.dragHandle=e.create({tag:"button",title:this.mavo._("drag-to-reorder",this.item),className:"mv-drag-handle"}),n.push(this.dragHandle)):this.dragHandle=this.item.element,e.set(this.element,{"mv-rel":this.item.property,contents:n})}this.element.setAttribute("hidden",""),e.bind([this.item.element,this.element],"focusin mouseover",this),e.bind(this.element,{mouseenter:()=>{this.item.element.classList.add("mv-highlight")},mouseleave:()=>{this.item.element.classList.remove("mv-highlight")}}),this.dragHandle.addEventListener("keydown",e=>{e.target===this.dragHandle&&this.item.editing&&37<=e.keyCode&&40>=e.keyCode&&(this.collection.move(this.item,38>=e.keyCode?-1:1),e.stopPropagation(),e.preventDefault(),e.target.focus())});var o={add:this.buttonSelector("add"),delete:this.buttonSelector("delete"),drag:this.buttonSelector("drag")};this.element.addEventListener("click",e=>{if(this.item.collection.editing){if(e.target.matches(o.add)){var t=this.collection.add(null,this.item.index);return e[Mavo.superKey]&&t.render(this.item.getData()),Mavo.scrollIntoViewIfNeeded(t.element),this.collection.editItem(t)}e.target.matches(o.delete)?this.item.collection.delete(a):e.target.matches(o["drag-handle"])&&(e=>e.target.focus())}}),Mavo.data(this.element,"item",this.item)},destroy:function(){this.hide()},show:function(t){a.visible.forEach(e=>{e!=this&&(!this.sticky||e.sticky)&&(clearTimeout(e.hideTimeout),e.hide(t,a.DELAY))}),a.visible.add(this),(this.element.hasAttribute("hidden")||t&&!this.sticky)&&(this.element.removeAttribute("hidden"),this.sticky=this.sticky||t,e.bind([this.item.element,this.element],"focusout mouseleave",this),this.adjacent&&e.style(this.element,{"--mv-item-width":this.item.element.offsetWidth+"px","--mv-item-height":this.item.element.offsetHeight+"px","--mv-item-left":this.item.element.offsetLeft+"px","--mv-item-top":this.item.element.offsetTop+"px"}))},hide:function(t,n=0){(!this.sticky||t)&&(n?this.hideTimeout=setTimeout(()=>this.hide(t),n):(this.element.setAttribute("hidden",""),e.unbind([this.item.element,this.element],"focusout mouseleave",this),this.sticky=!1,a.visible.delete(this)))},handleEvent:function(e){var t=-1===e.type.indexOf("mouse");this.isWithinItem(e.target)&&(clearTimeout(this.hideTimeout),-1<["mouseleave","focusout","blur"].indexOf(e.type)?!this.isWithinItem(e.relatedTarget)&&this.hide(t,a.DELAY):(this.show(t),e.stopPropagation()))},isWithinItem:function(e){if(!e)return!1;var t=e.closest(".mv-item-bar");return t?t===this.element:e.closest(Mavo.selectors.item)===this.item.element},add:function(){this.element.parentNode||Mavo.revocably.add(this.element)||(this.item instanceof Mavo.Primitive&&!this.item.attribute?(this.adjacent=!0,e.after(this.element,this.item.element)):this.item.element.appendChild(this.element)),this.dragHandle==this.item.element&&this.item.element.classList.add("mv-drag-handle")},remove:function(){Mavo.revocably.remove(this.element),this.dragHandle==this.item.element&&this.item.element.classList.remove("mv-drag-handle")},reposition:function(){this.item instanceof Mavo.Primitive&&(this.element.remove(),this.add())},buttonSelector:function(e){return`.mv-${e}[mv-rel="${this.item.property}"], [mv-rel="${this.item.property}"] > .mv-${e}`},live:{sticky:function(e){this.element.classList.toggle("mv-sticky",e)},adjacent:function(e){this.element.classList.toggle("mv-adjacent",e)}},proxy:{collection:"item",mavo:"item"},static:{DELAY:100,visible:new Set}})}(Bliss,Bliss.$),function(e){Mavo.attributes.push("mv-expressions");var t=Mavo.Expression=e.Class({constructor:function(e){this.expression=e},eval:function(e){Mavo.hooks.run("expression-eval-beforeeval",this);try{return this.function||(this.function=Mavo.Script.compile(this.expression)),this.function(e)}catch(e){return console.info("%cExpression error!","color: red; font-weight: bold",`${e.message} in expression ${this.expression}`,`
Not an expression? Use mv-expressions="none" to disable expressions on an element and its descendants.`),Mavo.hooks.run("expression-eval-error",{context:this,exception:e}),e}},toString(){return this.expression},changedBy:function(e){return t.changedBy(this.identifiers,e)},live:{expression:function(e){this.function=null,this.identifiers=e.match(/[$a-z][$\w]*/ig)||[]}},static:{changedBy:function(e,t){if(!t)return!0;if(!e)return!1;if(-1<e.indexOf(t.property))return!0;if(Mavo.Functions.intersects(t.properties,e))return!0;if("propertychange"==t.action)return Mavo.Functions.intersects(e,t.node.path);if(Mavo.Functions.intersects(["$index","$previous","$next"],e))return!0;var a=t.node.collection||t.node;return!!Mavo.Functions.intersects(a.properties,e)}}});t.Syntax=e.Class({constructor:function(e,t){this.start=e,this.end=t,this.regex=RegExp(`${Mavo.escapeRegExp(e)}([\\S\\s]+?)${Mavo.escapeRegExp(t)}`,"gi")},test:function(e){return this.regex.lastIndex=0,this.regex.test(e)},tokenize:function(e){var t,a=[],n=0;for(this.regex.lastIndex=0;null!==(t=this.regex.exec(e));)t.index>n&&a.push(e.substring(n,t.index)),n=this.regex.lastIndex,a.push(new Mavo.Expression(t[1]));return n<e.length&&a.push(e.substring(n)),a},static:{create:function(e){if(e){var a=e.getAttribute("mv-expressions");if(a)return a=a.trim(),/\s/.test(a)?new t.Syntax(...a.split(/\s+/)):t.Syntax.ESCAPE}},ESCAPE:-1}}),t.Syntax.default=new t.Syntax("[","]")}(Bliss,Bliss.$),function(e){var t=Mavo.DOMExpression=e.Class({constructor:function(a={}){this.mavo=a.mavo,this.template=a.template&&a.template.template||a.template;for(let e of["item","path","syntax","fallback","attribute","originalAttribute","expression","parsed"])this[e]=void 0===a[e]&&this.template?this.template[e]:a[e];if(this.node=a.node,this.node||(this.node=Mavo.elementPath(this.item.element,this.path)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),"mv-value"==this.attribute){this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute});var n=this.element.getAttribute("mv-value");this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(n)],this.expression=this.syntax.start+n+this.syntax.end}if(3===this.node.nodeType&&this.element===this.node&&(this.element=this.node.parentNode,(!this.node.parentNode.children.length||this.attribute)&&(this.node=this.element,this.element.normalize())),!this.expression){if(this.attribute){var o=Element.prototype.getAttribute.call(this.node,this.attribute);this.expression=(o||"").trim()}else{if(this.node.normalize(),this.node.firstChild&&1===this.node.childNodes.length&&3===this.node.firstChild.nodeType){var i=this.node.firstChild.textContent.match(/^\s*|\s*$/g);i[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-i[1].length),e.after(this.node.lastChild,this.node)),i[0]&&(this.node.firstChild.splitText(i[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node))}this.expression=this.node.textContent}this.parsed=a.template?a.template.parsed:this.syntax.tokenize(this.expression)}this.oldValue=this.value=this.parsed.map(e=>e instanceof Mavo.Expression?e.expression:e),this.item=Mavo.Node.get(this.element.closest(Mavo.selectors.item)),this.mavo.treeBuilt.then(()=>{this.template||this.item||(this.item=Mavo.Node.getClosest(this.element),"Primitive"===this.item.nodeType&&!this.item.collection&&(this.item=this.item.parent)),"mv-value"==this.originalAttribute&&this.mavoNode&&this.mavoNode==this.item.collection&&Mavo.delete(this.item.expressions,this),Mavo.hooks.run("domexpression-init-treebuilt",this)}),Mavo.hooks.run("domexpression-init-end",this),t.elements.set(this.element,[...(t.elements.get(this.element)||[]),this])},destroy:function(){t.special.delete(this)},changedBy:function(e){return"mv-value"==this.originalAttribute&&this.mavoNode&&!(this.mavoNode instanceof Mavo.Primitive)?!e||!this.mavoNode.contains(e.node):(this.identifiers||(this.identifiers=Mavo.flatten(this.parsed.map(e=>e.identifiers||[])),t.special.add(this)),Mavo.Expression.changedBy(this.identifiers,e))},update:function(e=this.data,t){var a={context:this,event:t},n=a;this.data=e,Mavo.hooks.run("domexpression-update-start",a),this.oldValue=this.value;var o=!1;a.value=this.value=this.parsed.map((t,a)=>{if(t instanceof Mavo.Expression){if(t.changedBy(n.event)){var i={context:this,expr:t,parentEnv:n};return Mavo.hooks.run("domexpression-update-beforeeval",i),i.value=Mavo.value(i.expr.eval(e)),Mavo.hooks.run("domexpression-update-aftereval",i),o=!0,i.value instanceof Error?void 0===this.fallback?this.syntax.start+i.expr.expression+this.syntax.end:this.fallback:void 0===i.value||null===i.value?"":i.value}return this.oldValue[a]}return t});o&&(a.value=1===a.value.length?a.value[0]:a.value.map(e=>Mavo.Primitive.format(e,{attribute:this.attribute,element:this.element})).join(""),this.output(a.value),Mavo.hooks.run("domexpression-update-end",a))},output:function(e){this.primitive?this.primitive.value=e:this.mavoNode?this.mavoNode.render(e):Mavo.Primitive.setValue(this.node,e,{attribute:this.attribute})},live:{item:function(e){e&&this._item!=e&&(this._item&&Mavo.delete(this._item.expressions,this),e.expressions=e.expressions||[],e.expressions.push(this))}},static:{elements:new WeakMap,search:function(e,a){if(null===e)return e;var n=t.elements.get(e)||[];return 1<arguments.length?n.length?n.filter(e=>e.attribute===a)[0]||null:null:n},special:{add:function(e,t){if(t){var a=this.vars[t];a&&-1<e.identifiers.indexOf(t)&&(a.all=a.all||new Set,a.all.add(e),1===a.all.size?a.observe():!a.all.size&&a.unobserve())}else for(var t in this.vars)this.add(e,t)},delete:function(e,t){if(t){var a=this.vars[t];a.all=a.all||new Set,a.all.delete(e),a.all.size||a.unobserve()}else for(var t in this.vars)this.delete(e,t)},update:function(){this.update&&this.update(...arguments),this.all.forEach(e=>e.update())},event:function(e,{type:a,update:n,target:o=document}={}){this.vars[e]={observe:function(){this.callback=this.callback||t.special.update.bind(this),o.addEventListener(a,this.callback)},unobserve:function(){o.removeEventListener(a,this.callback)}},n&&(this.vars[e].update=function(t){Mavo.Functions[e]=n(t)})},vars:{$now:{observe:function(){var e=()=>{t.special.update.call(this),this.timer=requestAnimationFrame(e)};this.timer=requestAnimationFrame(e)},unobserve:function(){cancelAnimationFrame(this.timer)}}}}}});t.special.event("$mouse",{type:"mousemove",update:function(e){return{x:e.clientX,y:e.clientY}}}),t.special.event("$hash",{type:"hashchange",target:window})}(Bliss,Bliss.$),function(e,t){var a=Mavo.Expressions=e.Class({constructor:function(e){this.mavo=e,this.active=!0,this.expressions=[];var t=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,t),this.scheduled={},this.mavo.treeBuilt.then(()=>{this.expressions=[],document.documentElement.addEventListener("mv-change",e=>{if(this.active){var t=this.scheduled[e.action]=this.scheduled[e.action]||new Set;e.node.template?!t.has(e.node.template)&&(setTimeout(()=>{t.delete(e.node.template),this.update(e)},a.THROTTLE),t.add(e.node.template)):requestAnimationFrame(()=>this.update(e))}}),this.update()})},update:function(t){if(this.active){var a,n;t instanceof Mavo.Node?(n=t,t=null):t instanceof Element?(a=t.closest(Mavo.selectors.item),n=Mavo.Node.get(a),t=null):n=this.mavo.root;var o=n.getData({live:!0});n.walk((a,n)=>{if(a.expressions&&a.expressions.length&&!a.isDeleted()){var i=e.value(o,...n);a.expressions.forEach(e=>{e.changedBy(t)&&e.update(i,t)})}})}},extract:function(e,t,n,o=Mavo.Expression.Syntax.default){t&&"mv-expressions"==t.name||(t&&-1<a.directives.indexOf(t.name)||o!==Mavo.Expression.Syntax.ESCAPE&&o.test(t?t.value:e.textContent))&&(n===void 0&&(n=Mavo.elementPath(e.closest(Mavo.selectors.item),e)),this.expressions.push(new Mavo.DOMExpression({node:e,syntax:o,path:n,attribute:t&&t.name,mavo:this.mavo})))},traverse:function(e,a=[],n){if(8!==e.nodeType)if(3===e.nodeType)this.extract(e,null,a,n);else{e.normalize(),n=Mavo.Expression.Syntax.create(e)||n,Mavo.is("item",e)&&(a=[]),t(e.attributes).forEach(t=>this.extract(e,t,a,n));var o=-1,i=0;e.matches("script:not([mv-expressions])")||t(e.childNodes).forEach(e=>{if(1==e.nodeType?(i=0,o++):i++,1==e.nodeType||3==e.nodeType){var t=0<i?`${o}.${i}`:o;this.traverse(e,[...(a||[]),t],n)}})}},static:{directives:["mv-value"],THROTTLE:50,directive:function(e,t){a.directives.push(e),Mavo.attributes.push(e),Mavo.Plugins.register(e,t)}}})}(Bliss,Bliss.$),function(e,t){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(e){this._hidden!==e&&(this._hidden=e,this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var e=t(Mavo.selectors.property,this.element).filter(e=>e.closest("[mv-if]")==this.element).map(e=>Mavo.Node.get(e));return this.element.addEventListener("mv-change",e=>{requestAnimationFrame(()=>{this.element.parentNode||this.item.element.dispatchEvent(e)})}),e}}}},hooks:{"domexpression-init-start":function(){"mv-if"!=this.attribute||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end,this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this)))},"domexpression-update-end":function(){if("mv-if"==this.attribute){var e=this.value[0],t=this.oldValue[0];this.item.mavo.treeBuilt.then(()=>{if(this.parentIf){var a=this.parentIf.value[0];this.value[0]=e=e&&a}!1!==a&&(e?Mavo.revocably.add(this.element):this.element.parentNode&&Mavo.revocably.remove(this.element,"mv-if")),e!==t&&(this.childProperties&&this.childProperties.forEach(t=>t.hidden=!e),this.childIfs&&this.childIfs.forEach(e=>e.update()))})}},"unit-isdatanull":function(e){e.result=e.result||this.hidden&&e.options.live}}})}(Bliss,Bliss.$),function(e,t){function a(e=""){return e=t(e),e||0===e?e+"":""}function n(e){return e=Mavo.value(e),null===e||!1===e||""===e}function o(e){return!t(e)}function i(e,t){var a=e.toLocaleString(Mavo.locale,t);return a=a.replace(/\u200e/g,""),a}function r(e){return function(t){if(t=p.date(t),!t)return"";var a=u[e](t);return a=new self["year"==e?"String":"Number"](a),("month"==e||"weekday"==e)&&(a.name=i(t,{[e]:"long"}),a.shortname=i(t,{[e]:"short"})),"weekday"!=e&&(a.twodigit=(10>a%100?"0":"")+a%100),a}}var s=Math.floor,l=Math.abs,d=Math.min,m=Mavo.Functions={operators:{"=":"eq"},get:function(e,a,n={}){a=n.property=t(a);var o=Mavo.getCanonicalProperty(e,a);if(void 0!==o){n.property=o;var i=e[o];return"function"==typeof i&&0!==i.name.indexOf("bound")?i.bind(e):i}if(Array.isArray(e)&&a&&isNaN(a)){var r=a.indexOf("=");return-1<r?(n.query={property:a.slice(0,r),value:a.slice(r+1)},n.property=[],i=e.filter((t,e)=>{var a=m.get(t,n.query.property)==n.query.value;return a&&n.property.push(e),a}),"id"==n.query.property&&(n.property=n.property[0],i=i[0]),void 0===i?n.property=e.length:0===i.length&&(n.property=[e.length]),i):e.map(t=>m.get(t,a))}return null},url:(e,t=location)=>{if(void 0===e)return location.href;if(e){e=a(e).replace(/[^\w-:]/g);var n=t.search.match(RegExp(`[?&]${e}(?:=(.+?))?(?=$|&)`))||t.pathname.match(RegExp(`(?:^|\\/)${e}\\/([^\\/]*)`))}return null!==n&&e?decodeURIComponent(n[1])||"":null},first:e=>e&&e[0]||"",last:e=>e&&e[e.length-1]||"",unique:function(e){return Array.isArray(e)?[...new Set(e.map(t))]:e},intersects:function(e,a){if(e&&a){var n=new Set(a.map?a.map(t):a);return e=e.map?e.map(t):[...e],!e.every(e=>!n.has(e))}},sum:function(e){return p.numbers(e,arguments).reduce((e,t)=>+e+(+t||0),0)},average:function(e){return e=p.numbers(e,arguments),e.length&&m.sum(e)/e.length},min:function(e){return d(...p.numbers(e,arguments))},max:function(e){return Math.max(...p.numbers(e,arguments))},count:function(e){return Mavo.toArray(e).filter(e=>!n(e)).length},reverse:function(e){return Mavo.toArray(e).slice().reverse()},round:function(e,t){return o(e)||o(t)||!isFinite(e)?Math.round(e):+e.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t})},ordinal:function(e){if(n(e))return"";if(10>t||20<t)var t=["th","st","nd","th"][e%10];return t||"th"},iff:function(e,a=e,n=""){return Array.isArray(e)?e.map((e,o)=>{var i=t(e)?a:n;return Array.isArray(i)?i[d(o,i.length-1)]:i}):t(e)?a:n},replace:function(e,t,a="",n=1){if(Array.isArray(e))return e.map(e=>m.replace(e,t,a));for(var o,i=RegExp(Mavo.escapeRegExp(t),"g"),r=e,s=0;r!=o&&s++<n;)o=r,r=r.replace(i,a);return r},len:e=>a(e).length,search:(e,t)=>e&&t?a(e).toLowerCase().indexOf((t+"").toLowerCase()):-1,starts:(e,t)=>0===m.search(a(e),a(t)),ends:function(e,t){[e,t]=[a(e),a(t)];var n=m.search(e,t);return-1<n&&n===e.length-t.length},join:function(e,t){return Mavo.toArray(e).join(a(t))},idify:function(e){return a(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").toLowerCase()},readable:function(e){return a(e).replace(/([a-z])([A-Z])(?=[a-z])/g,(e,t,a)=>t+" "+a.toLowerCase()).replace(/([a-z0-9])[_\/-](?=[a-z0-9])/g,"$1 ").replace(/^[a-z]/,e=>e.toUpperCase())},uppercase:e=>a(e).toUpperCase(),lowercase:e=>a(e).toLowerCase(),from:(e,t)=>m.between(e,t),fromlast:(e,t)=>m.between(e,t,"",!0),to:(e,t)=>m.between(e,"",t),tofirst:(e,t)=>m.between(e,"",t,!0),between:(e,t,n,o)=>{[e,t,n]=[a(e),a(t),a(n)];var i=t?e[o?"lastIndexOf":"indexOf"](t):-1,r=e[o?"indexOf":"lastIndexOf"](n);return t&&-1===i||-1===r?"":e.slice(i+1,-1!==r&&n?r:e.length)},filename:e=>Mavo.match(new URL(a(e),Mavo.base).pathname,/[^/]+?$/),json:e=>Mavo.safeToJSON(e),get $now(){return new Date},$startup:new Date,get $today(){return m.date(new Date)},year:r("year"),month:r("month"),day:r("day"),weekday:r("weekday"),hour:r("hour"),minute:r("minute"),second:r("second"),ms:r("ms"),date:e=>(e=p.date(e),e?`${m.year(e)}-${m.month(e).twodigit}-${m.day(e).twodigit}`:""),time:e=>(e=p.date(e),e?`${m.hour(e).twodigit}:${m.minute(e).twodigit}:${m.second(e).twodigit}`:""),minutes:e=>s(l(e)/60)||0,hours:e=>s(l(e)/3600)||0,days:e=>s(l(e)/86400)||0,weeks:e=>s(l(e)/604800)||0,months:e=>s(l(e)/(30.4368*86400))||0,years:e=>s(l(e)/(12*(30.4368*86400)))||0,localTimezone:-new Date().getTimezoneOffset(),log:(...e)=>(console.log(...e.map(t)),e[0]),$mouse:{x:0,y:0},get $hash(){return location.hash.slice(1)},util:{numbers:function(e,a){return e=Array.isArray(e)?e:a?$$(a):[e],e.filter(e=>!isNaN(e)&&""!==t(e)&&null!==t(e)).map(e=>+e)},fixDateString:function(e){e=e.trim();var t=/^\d{4}-\d{2}(-\d{2})?/.test(e),a=-1<e.indexOf(":");return t||a?(e=t?e.replace(/^(\d{4}-\d{2})(?!-\d{2})/,"$1-01"):m.$today+" "+e,a?e=e.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"):e+="T00:00:00",e=e.replace(/\s+/g,""),e):null},date:function(a){if(a=t(a),!a)return null;if("string"===e.type(a)){if(a=p.fixDateString(a),null===a)return null;var n=Mavo.match(a,/[+-]\d{2}:?\d{2}|Z$/);if(n)a=new Date(a);else{var o=a.match(/\d+/g);a=new Date(o[0],(o[1]||1)-1,o[2]||1,o[3]||0,o[4]||0,o[5]||0,o[6]||0)}}else a=new Date(a);return isNaN(a)?null:a}}},p=m.util;m._Trap=self.Proxy?new Proxy(m,{get:(e,t)=>{var a,n=Mavo.getCanonicalProperty(e,t)||Mavo.getCanonicalProperty(Math,t);return n&&(a=e[n],void 0===a&&(a=Math[n])),void 0===a?t in self?self[t]:t:("function"==typeof a&&(a.toString=()=>t),a)},has:(e,t)=>"data"!=t}):m;var u={year:e=>e.getFullYear(),month:e=>e.getMonth()+1,day:e=>e.getDate(),weekday:e=>e.getDay()||7,hour:e=>e.getHours(),minute:e=>e.getMinutes(),second:e=>e.getSeconds(),ms:e=>e.getMilliseconds()}}(Bliss,Mavo.value),function(e,t,n){var a=Mavo.Script={addUnaryOperator:function(e,a){return a.symbol&&Mavo.toArray(a.symbol).forEach(t=>{Mavo.Script.unarySymbols[t]=e,jsep.addUnaryOp(t)}),Mavo.Functions[e]=e=>Array.isArray(e)?e.map(t).map(a.scalar):a.scalar(t(e))},addBinaryOperator:function(e,r){return r.symbol&&Mavo.toArray(r.symbol).forEach(t=>{Mavo.Script.symbols[t]=e,r.precedence&&jsep.addBinaryOp(t,r.precedence)}),r.identity=void 0===r.identity?0:r.identity,Mavo.Functions[e]=r.code||function(...e){1===e.length&&Array.isArray(e[0])&&(e=[...e[0]]),r.raw||(e=e.map(t));var o,s=r.logical?r.identity:e[0];for(let t=1;t<e.length;t++){let l=r.logical?e[t-1]:s,a=e[t];Array.isArray(a)?("number"==typeof r.identity&&(a=n.numbers(a)),o=Array.isArray(l)?[...a.map((e,t)=>r.scalar(void 0===l[t]?r.identity:l[t],e)),...l.slice(a.length)]:a.map(e=>r.scalar(l,e))):Array.isArray(l)?o=l.map(e=>r.scalar(e,a)):o=r.scalar(l,a),s=r.reduce?r.reduce(s,o,l,a):r.logical?s&&o:o}return s}},symbols:{},unarySymbols:{},getOperatorName:(e,t)=>Mavo.Script[t?"unarySymbols":"symbols"][e]||e,operators:{not:{symbol:"!",scalar:e=>!e},multiply:{scalar:(e,t)=>e*t,identity:1,symbol:"*"},divide:{scalar:(e,t)=>e/t,identity:1,symbol:"/"},add:{scalar:(e,t)=>+e+ +t,symbol:"+"},plus:{scalar:e=>+e,symbol:"+"},subtract:{scalar:(e,t)=>{if(isNaN(e)||isNaN(t)){var a=n.date(e),o=n.date(t);if(a&&o)return(a-o)/1e3}return e-t},symbol:"-"},minus:{scalar:e=>-e,symbol:"-"},mod:{scalar:(e,t)=>{var a=e%t;return a+=0>a?t:0,a},symbol:"mod",precedence:6},lte:{logical:!0,scalar:(e,t)=>([e,t]=Mavo.Script.getNumericalOperands(e,t),e<=t),identity:!0,symbol:"<="},lt:{logical:!0,scalar:(e,t)=>([e,t]=Mavo.Script.getNumericalOperands(e,t),e<t),identity:!0,symbol:"<"},gte:{logical:!0,scalar:(e,t)=>([e,t]=Mavo.Script.getNumericalOperands(e,t),e>=t),identity:!0,symbol:">="},gt:{logical:!0,scalar:(e,t)=>([e,t]=Mavo.Script.getNumericalOperands(e,t),e>t),identity:!0,symbol:">"},eq:{logical:!0,scalar:(e,t)=>e==t,symbol:["=","=="],identity:!0,precedence:6},neq:{logical:!0,scalar:(e,t)=>e!=t,symbol:["!="],identity:!0},and:{logical:!0,scalar:(e,t)=>!!e&&!!t,identity:!0,symbol:["&&","and"],precedence:2},or:{logical:!0,scalar:(e,t)=>e||t,reduce:(e,t)=>e||t,identity:!1,symbol:["||","or"],precedence:2},concatenate:{symbol:"&",identity:"",scalar:(e,t)=>""+(e||"")+(t||""),precedence:10},filter:{scalar:(e,a)=>t(a)?e:null,raw:!0}},getNumericalOperands:function(e,t){if(isNaN(e)||isNaN(t)){var a=n.date(e),o=n.date(t);if(a&&o)return[a,o]}return[e,t]},serializers:{BinaryExpression:e=>`${a.serialize(e.left)} ${e.operator} ${a.serialize(e.right)}`,UnaryExpression:e=>`${e.operator}${a.serialize(e.argument)}`,CallExpression:e=>`${a.serialize(e.callee)}(${e.arguments.map(a.serialize).join(", ")})`,ConditionalExpression:e=>`${a.serialize(e.test)}? ${a.serialize(e.consequent)} : ${a.serialize(e.alternate)}`,MemberExpression:e=>{var t=e.computed?a.serialize(e.property):`"${e.property.name}"`;return`get(${a.serialize(e.object)}, ${t})`},ArrayExpression:e=>`[${e.elements.map(a.serialize).join(", ")}]`,Literal:e=>e.raw,Identifier:e=>e.name,ThisExpression:()=>"this",Compound:e=>e.body.map(a.serialize).join(" ")},transformations:{BinaryExpression:e=>{let t=Mavo.Script.getOperatorName(e.operator);var n=e,o=[];do o.unshift(n.right),n=n.left;while(Mavo.Script.getOperatorName(n.operator)===t);if(o.unshift(n),1<o.length)return`${t}(${o.map(a.serialize).join(", ")})`},UnaryExpression:e=>{var t=Mavo.Script.getOperatorName(e.operator,!0);if(t)return`${t}(${a.serialize(e.argument)})`},CallExpression:e=>{"Identifier"==e.callee.type&&("if"==e.callee.name&&(e.callee.name="iff"),e.callee.name="Mavo.Functions._Trap."+e.callee.name)}},serialize:e=>{var t=a.transformations[e.type]&&a.transformations[e.type](e);return void 0===t?a.serializers[e.type](e):t},rewrite:function(t){try{return a.serialize(a.parse(t))}catch(a){return t}},compile:function(e){return e=a.rewrite(e),new Function("data",`with(Mavo.Functions._Trap)
				with (data || {}) {
					return (${e});
				}`)},parse:self.jsep};for(let o in a.serializers.LogicalExpression=a.serializers.BinaryExpression,a.transformations.LogicalExpression=a.transformations.BinaryExpression,Mavo.Script.operators){let e=Mavo.Script.operators[o];2>e.scalar.length?Mavo.Script.addUnaryOperator(o,e):Mavo.Script.addBinaryOperator(o,e)}var o={average:"avg",iff:"iff IF",multiply:"mult product",divide:"div",lt:"smaller",gt:"larger bigger",eq:"equal equality",ordinal:"th"};for(let a in o)o[a].split(/\s+/g).forEach(e=>Mavo.Functions[e]=Mavo.Functions[a])}(Bliss,Mavo.value,Mavo.Functions.util),function(e){var t=Mavo.Backend.register(e.Class({extends:Mavo.Backend,id:"Dropbox",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-dropbox-key")||"2mx6061p054bpbp",this.login(!0)},update:function(e,a){this.super.update.call(this,e,a),this.url=t.fixShareURL(this.url)},upload:function(e,t){return t=this.path.replace(/[^/]+$/,"")+t,this.put(e,t).then(()=>this.getURL(t))},getURL:function(e){return this.request("sharing/create_shared_link_with_settings",{path:e},"POST").then(e=>t.fixShareURL(e.url))},put:function(e,t=this.path,a={}){return this.request("https://content.dropboxapi.com/2/files/upload",e,"POST",{headers:{"Dropbox-API-Arg":JSON.stringify({path:t,mode:"overwrite"}),"Content-Type":"application/octet-stream"}})},oAuthParams:()=>`&redirect_uri=${encodeURIComponent("https://auth.mavo.io")}&response_type=code`,getUser:function(){return this.user?Promise.resolve(this.user):this.request("users/get_current_account","null","POST").then(t=>{this.user={username:t.email,name:t.name.display_name,avatar:t.profile_photo_url,info:t},e.fire(this.mavo.element,"mv-login",{backend:this})})},login:function(e){return this.oAuthenticate(e).then(()=>this.getUser()).then(()=>{this.user&&(this.permissions.logout=!0,this.request("sharing/get_shared_link_metadata",{url:this.source},"POST").then(e=>{this.path=e.path_lower,this.permissions.on(["edit","save"])}))})},logout:function(){return this.oAuthLogout()},static:{apiDomain:"https://api.dropboxapi.com/2/",oAuth:"https://www.dropbox.com/oauth2/authorize",test:function(e){return e=new URL(e,Mavo.base),/dropbox.com/.test(e.host)},fixShareURL:e=>(e=new URL(e,Mavo.base),e.hostname="dl.dropboxusercontent.com",e.search=e.search.replace(/\bdl=0|^$/,"raw=1"),e)}}))}(Bliss,Bliss.$),function(e){var t=Mavo.Backend.register(e.Class({extends:Mavo.Backend,id:"Github",constructor:function(){this.permissions.on(["login","read"]),this.key=this.mavo.element.getAttribute("mv-github-key")||"7e08e016048000bc594e";var a=this.format.constructor.extensions[0]||".json";this.defaults={repo:"mv-data",filename:`${this.mavo.id}${a}`},this.info=t.parseURL(this.source,this.defaults),e.extend(this,this.info),this.login(!0)},update:function(a,n){this.super.update.call(this,a,n),this.info=t.parseURL(this.source,this.defaults),e.extend(this,this.info)},get:function(a){if(this.isAuthenticated()||!this.path||a){var n=a?t.parseURL(a):this.info;return n.apiData?this.request(n.apiCall,n.apiData,"POST").then(e=>e.errors&&e.errors.length?Promise.reject(e.errors.map(e=>e.message).join("\n")):e.data):this.request(n.apiCall,null,"GET",{headers:{Accept:"application/vnd.github.squirrel-girl-preview"}}).then(e=>Promise.resolve(n.repo?t.atob(e.content):e))}return a=new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch||"master"}/${this.path}`),a.searchParams.set("timestamp",Date.now()),e.fetch(a.href).then(e=>Promise.resolve(e.responseText),()=>Promise.resolve(null))},upload:function(e,t=this.path){return Mavo.readFile(e).then(e=>{var a=e.slice(5),n=a.match(/^\w+\/[\w+]+/)[0];return a=a.replace(RegExp(`^${n}(;base64)?,`),""),t=this.path.replace(/[^/]+$/,"")+t,this.put(a,t,{isEncoded:!0})}).then(e=>this.getURL(t,e.commit.sha))},put:function(e,a=this.path,n={}){if(a){var o=`repos/${this.username}/${this.repo}`,i=`${o}/contents/${a}`,r=this.mavo.element.getAttribute("mv-github-commit-prefix")||"",s=this.repoInfo||this.request("user/repos",{name:this.repo},"POST").then(e=>this.repoInfo=e);return e=n.isEncoded?e:t.btoa(e),Promise.resolve(s).then(e=>this.canPush()?e:this.request(`${o}/forks`,{name:this.repo},"POST").then(e=>(i=`repos/${e.full_name}/contents/${a}`,this.forkInfo=e)).then(e=>{var t,a=n=>{clearTimeout(t),this.request(`repos/${e.full_name}/commits`,{until:"1970-01-01T00:00:00Z"},"HEAD").then(()=>{n(e)}).catch(()=>{t=setTimeout(a,1e3)})};return new Promise(a)})).then(()=>this.request(i,{ref:this.branch}).then(t=>this.request(i,{message:r+this.mavo._("gh-updated-file",{name:t.name||"file"}),content:e,branch:this.branch,sha:t.sha},"PUT"),t=>404==t.status?this.request(i,{message:r+"Created file",content:e,branch:this.branch},"PUT"):t)).then(e=>(this.forkInfo&&this.request(`repos/${this.username}/${this.repo}/pulls`,{head:`${this.user.username}:${this.branch}`,base:this.branch}).then(e=>{this.pullRequest(e[0])}),e))}},pullRequest:function(e){var t=new URL(location);t.searchParams.set(this.mavo.id+"-storage",`https://github.com/${this.forkInfo.full_name}/${this.path}`);var a=this.mavo._("gh-edit-suggestion-saved-in-profile",{previewURL:t});this.notice&&this.notice.close(),e?(this.notice=this.mavo.message(`${a}
				${this.mavo._("gh-edit-suggestion-notreviewed")}
				<form onsubmit="return false">
					<button class="mv-danger">${this.mavo._("gh-edit-suggestion-revoke")}</button>
				</form>`,{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(t=>{t&&this.request(`repos/${this.username}/${this.repo}/pulls/${e.number}`,{state:"closed"},"POST").then(e=>{new Mavo.UI.Message(this.mavo,`<a href="${e.html_url}">${this.mavo._("gh-edit-suggestion-cancelled")}</a>`,{dismiss:["button","timeout"]}),this.pullRequest()})})):(this.notice=this.mavo.message(`${a}
				${this.mavo._("gh-edit-suggestion-instructions")}
				<form onsubmit="return false">
					<textarea name="edits" class="mv-autosize" placeholder="${this.mavo._("gh-edit-suggestion-reason-placeholder")}"></textarea>
					<button>${this.mavo._("gh-edit-suggestion-send")}</button>
				</form>`,{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(e=>{e&&this.request(`repos/${this.username}/${this.repo}/pulls`,{title:this.mavo._("gh-edit-suggestion-title"),body:this.mavo._("gh-edit-suggestion-body",{description:e.elements.edits.value,previewURL:t}),head:`${this.user.username}:${this.branch}`,base:this.branch},"POST").then(e=>{new Mavo.UI.Message(this.mavo,`<a href="${e.html_url}">${this.mavo._("gh-edit-suggestion-sent")}</a>`,{dismiss:["button","timeout"]}),this.pullRequest(e)})}))},login:function(e){return this.oAuthenticate(e).then(()=>this.getUser()).catch(e=>{401==e.status&&this.logout()}).then(()=>{if(this.user&&(this.permissions.on("logout"),this.info.path&&this.permissions.on(["edit","save"]),this.repo))return this.request(`repos/${this.username}/${this.repo}`).then(e=>(void 0===this.branch&&(this.branch=e.default_branch),this.repoInfo=e))})},canPush:function(){return this.repoInfo?this.repoInfo.permissions.push:this.user&&this.user.username.toLowerCase()==this.username.toLowerCase()},oAuthParams:()=>"&scope=repo,gist",logout:function(){return this.oAuthLogout().then(()=>{this.user=null})},getUser:function(){return this.user?Promise.resolve(this.user):this.request("user").then(t=>{this.user={username:t.login,name:t.name||t.login,avatar:t.avatar_url,url:"https://github.com/"+t.login,info:t},e.fire(this.mavo.element,"mv-login",{backend:this})})},getURL:function(e=this.path,t){var a=this.forkInfo||this.repoInfo,n=a.full_name;return e=e.replace(/ /g,"%20"),a.pagesInfo=a.pagesInfo||this.request(`repos/${n}/pages`,{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}),a.pagesInfo.then(t=>t.html_url+e).catch(()=>t?`https://cdn.rawgit.com/${n}/${t}/${e}`:`https://rawgit.com/${n}/${this.branch}/${e}`)},static:{apiDomain:"https://api.github.com/",oAuth:"https://github.com/login/oauth/authorize",test:function(e){return e=new URL(e,Mavo.base),/\bgithub.com|raw.githubusercontent.com/.test(e.host)},parseURL:function(e,t={}){var a={},n=new URL(e,Mavo.base),o=n.pathname.slice(1).split("/");if(a.username=o.shift(),a.repo=o.shift()||t.repo,/raw.githubusercontent.com$/.test(n.host))a.branch=o.shift();else{if(/api.github.com$/.test(n.host)){var i=n.pathname.slice(1)+n.search,r=Mavo.Functions.from(e,"#");return{apiCall:i,apiData:"graphql"==i?{query:r}:r}}"blob"==o[0]&&(o.shift(),a.branch=o.shift())}var s=o[o.length-1];return /\.\w+$/.test(s)?(a.filename=s,o.splice(o.length-1,1)):a.filename=t.filename,a.filepath=o.join("/")||t.filepath||"",a.path=(a.filepath?a.filepath+"/":"")+a.filename,a.apiCall=`repos/${a.username}/${a.repo}/contents/${a.path}`,a},btoa:e=>btoa(unescape(encodeURIComponent(e))),atob:e=>decodeURIComponent(escape(window.atob(e)))}}))}(Bliss,Bliss.$),console.log("local");
//# sourceMappingURL=maps/mavo.min.js.map
