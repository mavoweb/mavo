{"version":3,"sources":["wysie.es5.js"],"names":["_toConsumableArray","arr","Array","isArray","i","arr2","length","from","_typeof","Symbol","iterator","obj","constructor","$$","expr","con","Node","Window","slice","call","document","querySelectorAll","self","Element","prototype","matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","_","Stretchy","selectors","base","split","join","filter","script","currentScript","pop","resize","element","resizes","cs","getComputedStyle","offset","value","placeholder","empty","type","nodeName","toLowerCase","style","height","boxSizing","offsetHeight","clientHeight","scrollHeight","width","offsetWidth","clientWidth","scrollLeft","Math","max","scrollWidth","selectedIndex","option","createElement","textContent","options","parentNode","insertBefore","nextSibling","appearance","property","test","removeChild","resizeAll","elements","forEach","active","init","getAttribute","body","readyState","addEventListener","listener","evt","target","documentElement","MutationObserver","mutations","mutation","addedNodes","observe","childList","subtree","overload","callback","start","end","undefined","arguments","$","apply","this","ret","key","args","splice","extend","to","whitelist","hasOwnProperty","indexOf","descriptor","Object","getOwnPropertyDescriptor","writable","configurable","enumerable","get","set","defineProperty","Bliss","context","querySelector","sources","noop","toString","match","isNaN","defined","create","tag","o","each","ready","Promise","resolve","reject","Class","special","concat","keys","classProps","Error","specialFilter","lazy","getter","live","v","include","url","loaded","async","onload","remove","onerror","src","inside","head","fetch","TypeError","env","URL","location","data","method","headers","xhr","XMLHttpRequest","toUpperCase","hooks","run","search","setAttribute","open","href","user","password","e","console","error","setRequestHeader","header","removeAttribute","status","statusText","ontimeout","send","hasRoot","reduce","Hooks","add","name","first","subject","bliss","setProps","transition","props","duration","previous","transitionDuration","transitionProperty","once","clearTimeout","setTimeout","bind","fire","properties","createEvent","initEvent","dispatchEvent","unbind","events","className","listeners","ltype","l","removeEventListener","capture","val","attributes","attribute","me","onevent","event","delegate","selector","closest","contents","child","createTextNode","appendChild","before","after","firstChild","around","content","all","on","noOverwrite","array","map","shift","Type","dummy","HTMLElement","shy","clone","cloneNode","descendants","EventTarget","equal","notEqual","push","Wysie","_this","dataStore","store","id","normalizeProperty","autoEdit","has","is","rootScope","classList","scope","hasAttribute","wrapper","keyCode","superKey","preventDefault","save","primitive","isScope","Primitive","getValueAttribute","propertyNames","sort","a","b","needsEdit","root","permissions","Permissions","ui","bar","can","edit","onclick","editing","done","click","mouseenter focus","unsavedChanges","calculateUnsavedChanges","mouseleave blur","revert","disabled","everSaved","editButtons","requestAnimationFrame","clear","storage","Storage","load","off","getData","toJSON","render","confirm","item","toggle","parent","walk","static","navigator","platform","container","JSON","stringify","readable","identifier","replace","$0","$1","$2","queryJSON","path","oldValue","observer","attributeFilter","attributeOldValue","characterData","characterDataOldValue","toArray","flatten","prev","c","thing","s","specificProperty","multiple","required","formControl","computed","li","tr","dt","dd","not","or","selector1","selector2","and","s1","s2","andNot","output","autoMultiple","proxy","propagated","proto","names","existing","propagate","el","window","Intl","then","err","wysie","triggers","action","actions","_this2","_this3","cannot","when","_this4","able","_this5","current","changed","_this6","trigger","_this7","register","setter","logout","login","_this8","keywords","RegExp","Backend","backends","urls","backend","authControls","loginHash","hash","history","replaceState","title","innerHTML","getBackends","putBackends","put","authBackends","_this9","inProgress","getBackend","response","parse","param","log","stack","_this10","filename","params","isHash","origin","pathname","_this11","extends","_ref","_ref$data","responseType","localStorage","_ref2","_ref2$data","abstract","template","Scope","normalize","isRoot","getRelativeData","_this12","dirty","null","Proxy","index","walkUp","expressions","updateAlso","find","walker","parentScope","_len","_key","preEdit","_Wysie$Unit","collection","Collection","Unit","isDeleted","deleted","isNull","unit","closestCollection","_this13","elementContents","createDocumentFragment","childNodes","node","_deleted","prioritizePrimitive","Expression","expression","eval","createFunction","exception","ERROR","code","simpleOperation","operand1","operator","operand2","Functions","operators","lastIndex","Function","trim","operand","Text","nodeType","children","text","tokenize","oldText","setValue","update","_this14","formatNumber","datatype","regex","expressionRegex","exec","substring","findEnd","WeakMap","isEscape","insides","close","char","peek","numberFormat","NumberFormat","maximumFractionDigits","Infinity","format","rootFunctionRegExp","Expressions","rootFunctions","_this15","et","traverse","Set","_this16","lastUpdated","ref","exp","extract","_this17","escape","propertyRegex","getOwnPropertyNames","numbers","number","n","op","symbol","_len2","operands","_key2","identity","sum","average","min","_Math","_Math2","count","round","num","decimals","isFinite","toLocaleString","useGrouping","iff","condition","iftrue","iffalse","aliases","subtract","multiply","divide","lt","gt","eq","alias","_Trap","functions","propertyL","_this18","contains","mutable","unhandled","prop","_arguments","import","_this19","_this20","humanReadable","getDatatype","expressionText","editor","exposed","record","getValue","templateValue","editorValue","emptyValue","swapUI","unobserve","_this21","_this22","initialized","savedValue","popup","hidePopup","prevTabindex","tabIndex","_this23","timer","click.wysie:preedit","focus.wysie:preedit","focus","click.wysie:edit","mouseenter.wysie:preedit","mouseleave.wysie:preedit","initEdit","_this24","getMatch","editors","input change","select","keyup","activeElement","stopPropagation","wysie:datachange","label","dataInput","hidden","size","hideCallback","showPopup","x","offsetLeft","y","offsetTop","top","left","_this25","disconnect","cast","_value","selectedOptions","hide","cache","String","datatypes","useProperty","namespaceURI","img, video, audio","a, link","select, input, textarea, meter, progress","input[type=checkbox]","time","date","Date","day","month","year","hour","minute","datetime-local","timeZone","meta","checked","input[type=range], input[type=number], meter, progress","*",".number",".boolean","a, img, video, audio, .url","p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline","display","meter, progress","time, .date","types","week","datetime","img","dragenter dragover drop","drop","dataTransfer","accept","change","file","files","templateElement","items","containsTemplate","itemData","createItem","_this26","bottomUp","nextItem","marker","_item","silent","_arguments2","delete","hard","_this27","opacity","_this28","_this29","_this30","_this31","fragment","datum","_mutable","addButton","tagName","containerSelector","order","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","_this32","button","prettyPrint","util","txt","t","row","cells","cellType","td","colSpan","attrs","cell","shorten","hRow","table","headings","tbl","thead","tbody","addRow","_type","str","htmlentities","getElementsByTagName","within","common","circRef","settings","expander","prettyPrintThis","maxDepth","depthReached","message","clickFn","onmouseover","visibility","onmouseout","cursor","config","currentDepth","hasRunOnce","typeDealer","string","object","depth","stackKey","isEmpty","expanded","jquery","maxArray","_date","miniTable","sDate","Debug","friendlyError","elementLabel","printValue","timed","timeEnd","callee","objName","performance","now","timeTaken","calls","times","Time (ms)","Calls","reservedWords","debug","_ref3","debugRow","_ref4","_ref4$attribute","_ref4$tds","tds","mouseenter mouseleave","scrollIntoView","behavior","_this33","input","_this34","dropboxURL","_this35","protocol","hostname","Dropbox","referrer","AuthDriver","Popup","oauthReceiver","client","Client","_this36","writeFile","stat","versionTag","passive","_this37","isAuthenticated","authDriver","receiverUrl","authenticate","interactive","getAccountInfo","accountInfo","_this38","signOut","host","parseURL","repo","branch","username","authenticated","accessToken","req","Authorization","Remote","_this39","fileCall","repoInfo","fileInfo","btoa","sha","_this40","authPopup","source","getUser","u","removeItem","_this41","avatar_url"],"mappings":"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","file":"wysie.min.js","sourcesContent":["\"use strict\";\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\n/*\n * Stretchy: Form element autosizing, the way it should be.\n * by Lea Verou http://lea.verou.me\n * MIT license\n */\n(function () {\n\n\tif (!self.Element) {\n\t\treturn; // super old browser\n\t}\n\n\tif (!Element.prototype.matches) {\n\t\tElement.prototype.matches = Element.prototype.webkitMatchesSelector || Element.prototype.mozMatchesSelector || Element.prototype.msMatchesSelector || Element.prototype.oMatchesSelector || null;\n\t}\n\n\tif (!Element.prototype.matches) {\n\t\treturn;\n\t}\n\n\tfunction $$(expr, con) {\n\t\treturn expr instanceof Node || expr instanceof Window ? [expr] : [].slice.call(typeof expr == \"string\" ? (con || document).querySelectorAll(expr) : expr || []);\n\t}\n\n\tvar _ = self.Stretchy = {\n\t\tselectors: {\n\t\t\tbase: 'textarea, select:not([size]), input:not([type]), input[type=\"' + \"text url email tel\".split(\" \").join('\"], input[type=\"') + '\"]',\n\t\t\tfilter: \"*\"\n\t\t},\n\n\t\t// Script element this was included with, if any\n\t\tscript: document.currentScript || $$(\"script\").pop(),\n\n\t\t// Autosize one element. The core of Stretchy.\n\t\tresize: function resize(element) {\n\t\t\tif (!_.resizes(element)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar cs = getComputedStyle(element);\n\t\t\tvar offset = 0;\n\n\t\t\tif (!element.value && element.placeholder) {\n\t\t\t\tvar empty = true;\n\t\t\t\telement.value = element.placeholder;\n\t\t\t}\n\n\t\t\tvar type = element.nodeName.toLowerCase();\n\n\t\t\tif (type == \"textarea\") {\n\t\t\t\telement.style.height = \"0\";\n\n\t\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\t\toffset = element.offsetHeight;\n\t\t\t\t} else if (cs.boxSizing == \"content-box\") {\n\t\t\t\t\toffset = -element.clientHeight;\n\t\t\t\t}\n\n\t\t\t\telement.style.height = element.scrollHeight + offset + \"px\";\n\t\t\t} else if (type == \"input\") {\n\t\t\t\telement.style.width = \"0\";\n\n\t\t\t\tif (cs.boxSizing == \"border-box\") {\n\t\t\t\t\toffset = element.offsetWidth;\n\t\t\t\t} else if (cs.boxSizing == \"padding-box\") {\n\t\t\t\t\toffset = element.clientWidth;\n\t\t\t\t}\n\n\t\t\t\t// Safari misreports scrollWidth, so we will instead set scrollLeft to a\n\t\t\t\t// huge number, and read that back to see what it was clipped to\n\t\t\t\telement.scrollLeft = 1e+10;\n\n\t\t\t\tvar width = Math.max(element.scrollLeft + offset, element.scrollWidth - element.clientWidth);\n\n\t\t\t\telement.style.width = width + \"px\";\n\t\t\t} else if (type == \"select\") {\n\t\t\t\tvar selectedIndex = element.selectedIndex > 0 ? element.selectedIndex : 0;\n\n\t\t\t\t// Need to use dummy element to measure :(\n\t\t\t\tvar option = document.createElement(\"_\");\n\t\t\t\toption.textContent = element.options[selectedIndex].textContent;\n\t\t\t\telement.parentNode.insertBefore(option, element.nextSibling);\n\n\t\t\t\t// The name of the appearance property, as it might be prefixed\n\t\t\t\tvar appearance;\n\n\t\t\t\tfor (var property in cs) {\n\t\t\t\t\tvar value = cs[property];\n\t\t\t\t\tif (!/^(width|webkitLogicalWidth|length)$/.test(property) && typeof value == \"string\") {\n\t\t\t\t\t\t//console.log(property, option.offsetWidth, cs[property]);\n\t\t\t\t\t\toption.style[property] = value;\n\n\t\t\t\t\t\tif (/appearance$/i.test(property)) {\n\t\t\t\t\t\t\tappearance = property;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toption.style.width = \"\";\n\n\t\t\t\tif (option.offsetWidth > 0) {\n\t\t\t\t\telement.style.width = option.offsetWidth + \"px\";\n\n\t\t\t\t\tif (!cs[appearance] || cs[appearance] !== \"none\") {\n\t\t\t\t\t\t// Account for arrow\n\t\t\t\t\t\telement.style.width = \"calc(\" + element.style.width + \" + 2em)\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toption.parentNode.removeChild(option);\n\t\t\t\toption = null;\n\t\t\t}\n\n\t\t\tif (empty) {\n\t\t\t\telement.value = \"\";\n\t\t\t}\n\t\t},\n\n\t\t// Autosize multiple elements\n\t\tresizeAll: function resizeAll(elements) {\n\t\t\t$$(elements || _.selectors.base).forEach(function (element) {\n\t\t\t\t_.resize(element);\n\t\t\t});\n\t\t},\n\n\t\tactive: true,\n\n\t\t// Will stretchy do anything for this element?\n\t\tresizes: function resizes(element) {\n\t\t\treturn element && element.parentNode && element.matches && element.matches(_.selectors.base) && element.matches(_.selectors.filter);\n\t\t},\n\n\t\tinit: function init() {\n\t\t\t_.selectors.filter = _.script.getAttribute(\"data-filter\") || ($$(\"[data-stretchy-filter]\").pop() || document.body).getAttribute(\"data-stretchy-filter\") || Stretchy.selectors.filter || \"*\";\n\n\t\t\t_.resizeAll();\n\t\t},\n\n\t\t$$: $$\n\t};\n\n\t// Autosize all elements once the DOM is loaded\n\n\t// DOM already loaded?\n\tif (document.readyState !== \"loading\") {\n\t\t_.init();\n\t} else {\n\t\t// Wait for it\n\t\tdocument.addEventListener(\"DOMContentLoaded\", _.init);\n\t}\n\n\t// Listen for changes\n\tvar listener = function listener(evt) {\n\t\tif (_.active) {\n\t\t\t_.resize(evt.target);\n\t\t}\n\t};\n\n\tdocument.documentElement.addEventListener(\"input\", listener);\n\n\t// Firefox fires a change event instead of an input event\n\tdocument.documentElement.addEventListener(\"change\", listener);\n\n\t// Listen for new elements\n\tif (self.MutationObserver) {\n\t\tnew MutationObserver(function (mutations) {\n\t\t\tif (_.active) {\n\t\t\t\tmutations.forEach(function (mutation) {\n\t\t\t\t\tif (mutation.type == \"childList\") {\n\t\t\t\t\t\tStretchy.resizeAll(mutation.addedNodes);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}).observe(document.documentElement, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true\n\t\t});\n\t}\n})();\n\n(function () {\n\t\"use strict\";\n\n\tfunction overload(callback, start, end) {\n\t\tstart = start === undefined ? 1 : start;\n\t\tend = end || start + 1;\n\n\t\tif (end - start <= 1) {\n\t\t\treturn function () {\n\t\t\t\tif (arguments.length <= start || $.type(arguments[start]) === 'string') {\n\t\t\t\t\treturn callback.apply(this, arguments);\n\t\t\t\t}\n\n\t\t\t\tvar obj = arguments[start],\n\t\t\t\t    ret;\n\n\t\t\t\tfor (var key in obj) {\n\t\t\t\t\tvar args = Array.from(arguments);\n\t\t\t\t\targs.splice(start, 1, key, obj[key]);\n\t\t\t\t\tret = callback.apply(this, args);\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t};\n\t\t}\n\n\t\treturn overload(overload(callback, start + 1, end), start, end - 1);\n\t}\n\n\t// Copy properties from one object to another. Overwrites allowed.\n\tfunction extend(to, from, whitelist) {\n\t\tfor (var property in from) {\n\t\t\tif (whitelist) {\n\t\t\t\tvar type = $.type(whitelist);\n\n\t\t\t\tif (whitelist === \"own\" && !from.hasOwnProperty(property) || type === \"array\" && whitelist.indexOf(property) === -1 || type === \"regexp\" && !whitelist.test(property) || type === \"function\" && !whitelist.call(from, property)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// To copy gettters/setters, preserve flags etc\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(from, property);\n\n\t\t\tif (descriptor && (!descriptor.writable || !descriptor.configurable || !descriptor.enumerable || descriptor.get || descriptor.set)) {\n\t\t\t\tdelete to[property];\n\t\t\t\tObject.defineProperty(to, property, descriptor);\n\t\t\t} else {\n\t\t\t\tto[property] = from[property];\n\t\t\t}\n\t\t}\n\n\t\treturn to;\n\t}\n\n\tvar $ = self.Bliss = extend(function (expr, context) {\n\t\treturn $.type(expr) === \"string\" ? (context || document).querySelector(expr) : expr || null;\n\t}, self.Bliss);\n\n\textend($, {\n\t\textend: extend,\n\n\t\toverload: overload,\n\n\t\tproperty: $.property || \"_\",\n\n\t\tsources: {},\n\n\t\tnoop: function noop() {},\n\n\t\t$: function $(expr, context) {\n\t\t\tif (expr instanceof Node || expr instanceof Window) {\n\t\t\t\treturn [expr];\n\t\t\t}\n\n\t\t\treturn Array.from(typeof expr == \"string\" ? (context || document).querySelectorAll(expr) : expr || []);\n\t\t},\n\n\t\t/**\n   * Returns the [[Class]] of an object in lowercase (eg. array, date, regexp, string etc)\n   */\n\t\ttype: function type(obj) {\n\t\t\tif (obj === null) {\n\t\t\t\treturn 'null';\n\t\t\t}\n\n\t\t\tif (obj === undefined) {\n\t\t\t\treturn 'undefined';\n\t\t\t}\n\n\t\t\tvar ret = (Object.prototype.toString.call(obj).match(/^\\[object\\s+(.*?)\\]$/)[1] || \"\").toLowerCase();\n\n\t\t\tif (ret == 'number' && isNaN(obj)) {\n\t\t\t\treturn 'nan';\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t/*\n   * Return first non-undefined value. Mainly used internally.\n   */\n\t\tdefined: function defined() {\n\t\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\t\tif (arguments[i] !== undefined) {\n\t\t\t\t\treturn arguments[i];\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcreate: function create(tag, o) {\n\t\t\tif (tag instanceof Node) {\n\t\t\t\treturn $.set(tag, o);\n\t\t\t}\n\n\t\t\t// 4 signatures: (tag, o), (tag), (o), ()\n\t\t\tif (arguments.length === 1) {\n\t\t\t\tif ($.type(tag) === \"string\") {\n\t\t\t\t\to = {};\n\t\t\t\t} else {\n\t\t\t\t\to = tag;\n\t\t\t\t\ttag = o.tag;\n\t\t\t\t\to = $.extend({}, o, function (property) {\n\t\t\t\t\t\treturn property !== \"tag\";\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn $.set(document.createElement(tag || \"div\"), o);\n\t\t},\n\n\t\teach: function each(obj, callback, ret) {\n\t\t\tret = ret || {};\n\n\t\t\tfor (var property in obj) {\n\t\t\t\tret[property] = callback.call(obj, property, obj[property]);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tready: function ready(context) {\n\t\t\tcontext = context || document;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tif (context.readyState !== \"loading\") {\n\t\t\t\t\tresolve();\n\t\t\t\t} else {\n\t\t\t\t\tcontext.addEventListener(\"DOMContentLoaded\", function () {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Helper for defining OOP-like classes\n\t\tClass: function Class(o) {\n\t\t\tvar special = [\"constructor\", \"extends\", \"abstract\", \"static\"].concat(Object.keys($.classProps));\n\t\t\tvar init = o.hasOwnProperty(\"constructor\") ? o.constructor : $.noop;\n\n\t\t\tvar Class = function Class() {\n\t\t\t\tif (o.abstract && this.constructor === Class) {\n\t\t\t\t\tthrow new Error(\"Abstract classes cannot be directly instantiated.\");\n\t\t\t\t}\n\n\t\t\t\tClass.super && Class.super.apply(this, arguments);\n\n\t\t\t\tinit.apply(this, arguments);\n\t\t\t};\n\n\t\t\tClass.super = o.extends || null;\n\n\t\t\tClass.prototype = $.extend(Object.create(Class.super ? Class.super.prototype : Object), {\n\t\t\t\tconstructor: Class\n\t\t\t});\n\n\t\t\tvar specialFilter = function specialFilter(property) {\n\t\t\t\treturn this.hasOwnProperty(property) && special.indexOf(property) === -1;\n\t\t\t};\n\n\t\t\t// Static methods\n\t\t\tif (o.static) {\n\t\t\t\t$.extend(Class, o.static, specialFilter);\n\n\t\t\t\tfor (var property in $.classProps) {\n\t\t\t\t\tif (property in o.static) {\n\t\t\t\t\t\t$.classProps[property](Class, o.static[property]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Instance methods\n\t\t\t$.extend(Class.prototype, o, specialFilter);\n\n\t\t\tfor (var property in $.classProps) {\n\t\t\t\tif (property in o) {\n\t\t\t\t\t$.classProps[property](Class.prototype, o[property]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// For easier calling of super methods\n\t\t\t// This doesn't save us from having to use .call(this) though\n\t\t\tClass.prototype.super = Class.super ? Class.super.prototype : null;\n\n\t\t\treturn Class;\n\t\t},\n\n\t\t// Properties with special handling in classes\n\t\tclassProps: {\n\t\t\t// Lazily evaluated properties\n\t\t\tlazy: overload(function (obj, property, getter) {\n\t\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\t\tget: function get() {\n\t\t\t\t\t\tvar value = getter.call(this);\n\n\t\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\twritable: true\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn value;\n\t\t\t\t\t},\n\t\t\t\t\tset: function set(value) {\n\t\t\t\t\t\t// Blind write: skip running the getter\n\t\t\t\t\t\tObject.defineProperty(this, property, {\n\t\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\twritable: true\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: true,\n\t\t\t\t\tenumerable: true\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t}),\n\n\t\t\t// Properties that behave like normal properties but also execute code upon getting/setting\n\t\t\tlive: overload(function (obj, property, descriptor) {\n\t\t\t\tif ($.type(descriptor) === \"function\") {\n\t\t\t\t\tdescriptor = { set: descriptor };\n\t\t\t\t}\n\n\t\t\t\tObject.defineProperty(obj, property, {\n\t\t\t\t\tget: function get() {\n\t\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\t\tvar ret = descriptor.get && descriptor.get.call(this, value);\n\t\t\t\t\t\treturn ret !== undefined ? ret : value;\n\t\t\t\t\t},\n\t\t\t\t\tset: function set(v) {\n\t\t\t\t\t\tvar value = this[\"_\" + property];\n\t\t\t\t\t\tvar ret = descriptor.set && descriptor.set.call(this, v, value);\n\t\t\t\t\t\tthis[\"_\" + property] = ret !== undefined ? ret : v;\n\t\t\t\t\t},\n\t\t\t\t\tconfigurable: descriptor.configurable,\n\t\t\t\t\tenumerable: descriptor.enumerable\n\t\t\t\t});\n\n\t\t\t\treturn obj;\n\t\t\t})\n\n\t\t},\n\n\t\t// Includes a script, returns a promise\n\t\tinclude: function include() {\n\t\t\tvar url = arguments[arguments.length - 1];\n\t\t\tvar loaded = arguments.length === 2 ? arguments[0] : false;\n\n\t\t\tvar script = document.createElement(\"script\");\n\n\t\t\treturn loaded ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t$.set(script, {\n\t\t\t\t\tasync: true,\n\t\t\t\t\tonload: function onload() {\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t$.remove(script);\n\t\t\t\t\t},\n\t\t\t\t\tonerror: function onerror() {\n\t\t\t\t\t\treject();\n\t\t\t\t\t},\n\t\t\t\t\tsrc: url,\n\t\t\t\t\tinside: document.head\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t/*\n   * Fetch API inspired XHR wrapper. Returns promise.\n   */\n\t\tfetch: function fetch(url, o) {\n\t\t\tif (!url) {\n\t\t\t\tthrow new TypeError(\"URL parameter is mandatory and cannot be \" + url);\n\t\t\t}\n\n\t\t\t// Set defaults & fixup arguments\n\t\t\tvar env = extend({\n\t\t\t\turl: new URL(url, location),\n\t\t\t\tdata: \"\",\n\t\t\t\tmethod: \"GET\",\n\t\t\t\theaders: {},\n\t\t\t\txhr: new XMLHttpRequest()\n\t\t\t}, o);\n\n\t\t\tenv.method = env.method.toUpperCase();\n\n\t\t\t$.hooks.run(\"fetch-args\", env);\n\n\t\t\t// Start sending the request\n\n\t\t\tif (env.method === \"GET\" && env.data) {\n\t\t\t\tenv.url.search += env.data;\n\t\t\t}\n\n\t\t\tdocument.body.setAttribute('data-loading', env.url);\n\n\t\t\tenv.xhr.open(env.method, env.url.href, env.async !== false, env.user, env.password);\n\n\t\t\tfor (var property in o) {\n\t\t\t\tif (property in env.xhr) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tenv.xhr[property] = o[property];\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tself.console && console.error(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (env.method !== 'GET' && !env.headers['Content-type'] && !env.headers['Content-Type']) {\n\t\t\t\tenv.xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\t\t\t}\n\n\t\t\tfor (var header in env.headers) {\n\t\t\t\tenv.xhr.setRequestHeader(header, env.headers[header]);\n\t\t\t}\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tenv.xhr.onload = function () {\n\t\t\t\t\tdocument.body.removeAttribute('data-loading');\n\n\t\t\t\t\tif (env.xhr.status === 0 || env.xhr.status >= 200 && env.xhr.status < 300 || env.xhr.status === 304) {\n\t\t\t\t\t\t// Success!\n\t\t\t\t\t\tresolve(env.xhr);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treject($.extend(Error(env.xhr.statusText), {\n\t\t\t\t\t\t\txhr: env.xhr,\n\t\t\t\t\t\t\tget status() {\n\t\t\t\t\t\t\t\treturn this.xhr.status;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.onerror = function () {\n\t\t\t\t\tdocument.body.removeAttribute('data-loading');\n\t\t\t\t\treject($.extend(Error(\"Network Error\"), { xhr: env.xhr }));\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.ontimeout = function () {\n\t\t\t\t\tdocument.body.removeAttribute('data-loading');\n\t\t\t\t\treject($.extend(Error(\"Network Timeout\"), { xhr: env.xhr }));\n\t\t\t\t};\n\n\t\t\t\tenv.xhr.send(env.method === 'GET' ? null : env.data);\n\t\t\t});\n\t\t},\n\n\t\tvalue: function value(obj) {\n\t\t\tvar hasRoot = $.type(obj) !== \"string\";\n\n\t\t\treturn $.$(arguments).slice(+hasRoot).reduce(function (obj, property) {\n\t\t\t\treturn obj && obj[property];\n\t\t\t}, hasRoot ? obj : self);\n\t\t}\n\t});\n\n\t$.Hooks = new $.Class({\n\t\tadd: function add(name, callback, first) {\n\t\t\tthis[name] = this[name] || [];\n\t\t\tthis[name][first ? \"unshift\" : \"push\"](callback);\n\t\t},\n\n\t\trun: function run(name, env) {\n\t\t\tthis[name] = this[name] || [];\n\t\t\tthis[name].forEach(function (callback) {\n\t\t\t\tcallback.call(env && env.context ? env.context : env, env);\n\t\t\t});\n\t\t}\n\t});\n\n\t$.hooks = new $.Hooks();\n\n\tvar _ = $.property;\n\n\t$.Element = function (subject) {\n\t\tthis.subject = subject;\n\n\t\t// Author-defined element-related data\n\t\tthis.data = {};\n\n\t\t// Internal Bliss element-related data\n\t\tthis.bliss = {};\n\t};\n\n\t$.Element.prototype = {\n\t\tset: overload(function (property, value) {\n\n\t\t\tif (property in $.setProps) {\n\t\t\t\t$.setProps[property].call(this, value);\n\t\t\t} else if (property in this) {\n\t\t\t\tthis[property] = value;\n\t\t\t} else {\n\t\t\t\tthis.setAttribute(property, value);\n\t\t\t}\n\t\t}, 0),\n\n\t\t// Run a CSS transition, return promise\n\t\ttransition: function transition(props, duration) {\n\t\t\tduration = +duration || 400;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tif (\"transition\" in this.style) {\n\t\t\t\t\t// Get existing style\n\t\t\t\t\tvar previous = $.extend({}, this.style, /^transition(Duration|Property)$/);\n\n\t\t\t\t\t$.style(this, {\n\t\t\t\t\t\ttransitionDuration: (duration || 400) + \"ms\",\n\t\t\t\t\t\ttransitionProperty: Object.keys(props).join(\", \")\n\t\t\t\t\t});\n\n\t\t\t\t\t$.once(this, \"transitionend\", function () {\n\t\t\t\t\t\tclearTimeout(i);\n\t\t\t\t\t\t$.style(this, previous);\n\t\t\t\t\t\tresolve(this);\n\t\t\t\t\t});\n\n\t\t\t\t\t// Failsafe, in case transitionend doesnt fire\n\t\t\t\t\tvar i = setTimeout(resolve, duration + 50, this);\n\n\t\t\t\t\t$.style(this, props);\n\t\t\t\t} else {\n\t\t\t\t\t$.style(this, props);\n\t\t\t\t\tresolve(this);\n\t\t\t\t}\n\t\t\t}.bind(this));\n\t\t},\n\n\t\t// Fire a synthesized event on the element\n\t\tfire: function fire(type, properties) {\n\t\t\tvar evt = document.createEvent(\"HTMLEvents\");\n\n\t\t\tevt.initEvent(type, true, true);\n\n\t\t\t// Return the result of dispatching the event, so we\n\t\t\t// can know if `e.preventDefault` was called inside it\n\t\t\treturn this.dispatchEvent($.extend(evt, properties));\n\t\t},\n\n\t\tunbind: overload(function (events, callback) {\n\t\t\t(events || \"\").split(/\\s+/).forEach(function (type) {\n\t\t\t\tif (_ in this && (type.indexOf(\".\") > -1 || !callback)) {\n\t\t\t\t\t// Mass unbinding, need to go through listeners\n\t\t\t\t\ttype = (type || \"\").split(\".\");\n\t\t\t\t\tvar className = type[1];\n\t\t\t\t\ttype = type[0];\n\t\t\t\t\t// man, cant wait to be able to do [type, className] = type.split(\".\");\n\n\t\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\t\tfor (var ltype in listeners) {\n\t\t\t\t\t\tif (!type || ltype === type) {\n\t\t\t\t\t\t\t// No forEach, because were mutating the array\n\t\t\t\t\t\t\tfor (var i = 0, l; l = listeners[ltype][i]; i++) {\n\t\t\t\t\t\t\t\tif ((!className || className === l.className) && (!callback || callback === l.callback)) {\n\t\t\t\t\t\t\t\t\t// TODO what about capture?\n\t\t\t\t\t\t\t\t\tthis.removeEventListener.call(this, ltype, l.callback, l.capture);\n\t\t\t\t\t\t\t\t\ti--;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Normal event unbinding, defer to native JS\n\t\t\t\t\tthis.removeEventListener(type, callback);\n\t\t\t\t}\n\t\t\t}, this);\n\t\t}, 0)\n\t};\n\n\t/*\n  * Properties with custom handling in $.set()\n  * Also available as functions directly on element._ and on $\n  */\n\t$.setProps = {\n\t\t// Set a bunch of inline CSS styles\n\t\tstyle: function style(val) {\n\t\t\t$.extend(this.style, val);\n\t\t},\n\n\t\t// Set a bunch of attributes\n\t\tattributes: function attributes(o) {\n\t\t\tfor (var attribute in o) {\n\t\t\t\tthis.setAttribute(attribute, o[attribute]);\n\t\t\t}\n\t\t},\n\n\t\t// Set a bunch of properties on the element\n\t\tproperties: function properties(val) {\n\t\t\t$.extend(this, val);\n\t\t},\n\n\t\t// Bind one or more events to the element\n\t\tevents: function events(val) {\n\t\t\tif (val && val.addEventListener) {\n\t\t\t\t// Copy events from other element (requires Bliss Full)\n\t\t\t\tvar me = this;\n\n\t\t\t\t// Copy listeners\n\t\t\t\tif (val[_] && val[_].bliss) {\n\t\t\t\t\tvar listeners = val[_].bliss.listeners;\n\n\t\t\t\t\tfor (var type in listeners) {\n\t\t\t\t\t\tlisteners[type].forEach(function (l) {\n\t\t\t\t\t\t\tme.addEventListener(type, l.callback, l.capture);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Copy inline events\n\t\t\t\tfor (var onevent in val) {\n\t\t\t\t\tif (onevent.indexOf(\"on\") === 0) {\n\t\t\t\t\t\tthis[onevent] = val[onevent];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (arguments.length > 1 && $.type(val) === \"string\") {\n\t\t\t\tvar callback = arguments[1],\n\t\t\t\t    capture = arguments[2];\n\n\t\t\t\tval.split(/\\s+/).forEach(function (event) {\n\t\t\t\t\tthis.addEventListener(event, callback, capture);\n\t\t\t\t}, this);\n\t\t\t} else {\n\t\t\t\tfor (var events in val) {\n\t\t\t\t\t$.events(this, events, val[events]);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tonce: overload(function (events, callback) {\n\t\t\tevents = events.split(/\\s+/);\n\t\t\tvar me = this;\n\t\t\tvar once = function once() {\n\t\t\t\tevents.forEach(function (event) {\n\t\t\t\t\tme.removeEventListener(event, once);\n\t\t\t\t});\n\n\t\t\t\treturn callback.apply(me, arguments);\n\t\t\t};\n\n\t\t\tevents.forEach(function (event) {\n\t\t\t\tme.addEventListener(event, once);\n\t\t\t});\n\t\t}, 0),\n\n\t\t// Event delegation\n\t\tdelegate: overload(function (type, selector, callback) {\n\t\t\tthis.addEventListener(type, function (evt) {\n\t\t\t\tif (evt.target.closest(selector)) {\n\t\t\t\t\tcallback.call(this, evt);\n\t\t\t\t}\n\t\t\t});\n\t\t}, 0, 2),\n\n\t\t// Set the contents as a string, an element, an object to create an element or an array of these\n\t\tcontents: function contents(val) {\n\t\t\tif (val || val === 0) {\n\t\t\t\t(Array.isArray(val) ? val : [val]).forEach(function (child) {\n\t\t\t\t\tvar type = $.type(child);\n\n\t\t\t\t\tif (/^(string|number)$/.test(type)) {\n\t\t\t\t\t\tchild = document.createTextNode(child + \"\");\n\t\t\t\t\t} else if (type === \"object\") {\n\t\t\t\t\t\tchild = $.create(child);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (child instanceof Node) {\n\t\t\t\t\t\tthis.appendChild(child);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\t\t\t}\n\t\t},\n\n\t\t// Append the element inside another element\n\t\tinside: function inside(element) {\n\t\t\telement.appendChild(this);\n\t\t},\n\n\t\t// Insert the element before another element\n\t\tbefore: function before(element) {\n\t\t\telement.parentNode.insertBefore(this, element);\n\t\t},\n\n\t\t// Insert the element after another element\n\t\tafter: function after(element) {\n\t\t\telement.parentNode.insertBefore(this, element.nextSibling);\n\t\t},\n\n\t\t// Insert the element before another element's contents\n\t\tstart: function start(element) {\n\t\t\telement.insertBefore(this, element.firstChild);\n\t\t},\n\n\t\t// Wrap the element around another element\n\t\taround: function around(element) {\n\t\t\tif (element.parentNode) {\n\t\t\t\t$.before(this, element);\n\t\t\t}\n\n\t\t\t(/^template$/i.test(this.nodeName) ? this.content || this : this).appendChild(element);\n\t\t}\n\t};\n\n\t$.Array = function (subject) {\n\t\tthis.subject = subject;\n\t};\n\n\t$.Array.prototype = {\n\t\tall: function all(method) {\n\t\t\tvar args = $$(arguments).slice(1);\n\n\t\t\treturn this[method].apply(this, args);\n\t\t}\n\t};\n\n\t// Extends Bliss with more methods\n\t$.add = overload(function (method, callback, on, noOverwrite) {\n\t\ton = $.extend({ $: true, element: true, array: true }, on);\n\n\t\tif ($.type(callback) == \"function\") {\n\t\t\tif (on.element && (!(method in $.Element.prototype) || !noOverwrite)) {\n\t\t\t\t$.Element.prototype[method] = function () {\n\t\t\t\t\treturn this.subject && $.defined(callback.apply(this.subject, arguments), this.subject);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (on.array && (!(method in $.Array.prototype) || !noOverwrite)) {\n\t\t\t\t$.Array.prototype[method] = function () {\n\t\t\t\t\tvar args = arguments;\n\t\t\t\t\treturn this.subject.map(function (element) {\n\t\t\t\t\t\treturn element && $.defined(callback.apply(element, args), element);\n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (on.$) {\n\t\t\t\t$.sources[method] = $[method] = callback;\n\n\t\t\t\tif (on.array || on.element) {\n\t\t\t\t\t$[method] = function () {\n\t\t\t\t\t\tvar args = [].slice.apply(arguments);\n\t\t\t\t\t\tvar subject = args.shift();\n\t\t\t\t\t\tvar Type = on.array && Array.isArray(subject) ? \"Array\" : \"Element\";\n\n\t\t\t\t\t\treturn $[Type].prototype[method].apply({ subject: subject }, args);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}, 0);\n\n\t$.add($.Array.prototype, { element: false });\n\t$.add($.Element.prototype);\n\t$.add($.setProps);\n\t$.add($.classProps, { element: false, array: false });\n\n\t// Add native methods on $ and _\n\tvar dummy = document.createElement(\"_\");\n\t$.add($.extend({}, HTMLElement.prototype, function (method) {\n\t\treturn $.type(dummy[method]) === \"function\";\n\t}), null, true);\n})();\n\n(function ($) {\n\t\"use strict\";\n\n\tif (!Bliss || Bliss.shy) {\n\t\treturn;\n\t}\n\n\tvar _ = Bliss.property;\n\n\t// Methods requiring Bliss Full\n\t$.add({\n\t\t// Clone elements, with events and data\n\t\tclone: function clone() {\n\t\t\tvar clone = this.cloneNode(true);\n\t\t\tvar descendants = $.$(\"*\", clone).concat(clone);\n\n\t\t\t$.$(\"*\", this).concat(this).forEach(function (element, i, arr) {\n\t\t\t\t$.events(descendants[i], element);\n\t\t\t\tdescendants[i]._.data = $.extend({}, element._.data);\n\t\t\t});\n\n\t\t\treturn clone;\n\t\t}\n\t}, { array: false });\n\n\t// Define the _ property on arrays and elements\n\n\tObject.defineProperty(Node.prototype, _, {\n\t\t// Written for IE compatability (see #49)\n\t\tget: function getter() {\n\t\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\t\tget: undefined\n\t\t\t});\n\t\t\tObject.defineProperty(this, _, {\n\t\t\t\tvalue: new $.Element(this)\n\t\t\t});\n\t\t\tObject.defineProperty(Node.prototype, _, {\n\t\t\t\tget: getter\n\t\t\t});\n\t\t\treturn this[_];\n\t\t},\n\t\tconfigurable: true\n\t});\n\n\tObject.defineProperty(Array.prototype, _, {\n\t\tget: function get() {\n\t\t\tObject.defineProperty(this, _, {\n\t\t\t\tvalue: new $.Array(this)\n\t\t\t});\n\n\t\t\treturn this[_];\n\t\t},\n\t\tconfigurable: true\n\t});\n\n\t// Hijack addEventListener and removeEventListener to store callbacks\n\n\tif (self.EventTarget && \"addEventListener\" in EventTarget.prototype) {\n\t\tvar addEventListener = EventTarget.prototype.addEventListener,\n\t\t    removeEventListener = EventTarget.prototype.removeEventListener,\n\t\t    equal = function equal(callback, capture, l) {\n\t\t\treturn l.callback === callback && l.capture == capture;\n\t\t},\n\t\t    notEqual = function notEqual() {\n\t\t\treturn !equal.apply(this, arguments);\n\t\t};\n\n\t\tEventTarget.prototype.addEventListener = function (type, callback, capture) {\n\t\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tif (type.indexOf(\".\") > -1) {\n\t\t\t\t\ttype = type.split(\".\");\n\t\t\t\t\tvar className = type[1];\n\t\t\t\t\ttype = type[0];\n\t\t\t\t}\n\n\t\t\t\tlisteners[type] = listeners[type] || [];\n\n\t\t\t\tif (listeners[type].filter(equal.bind(null, callback, capture)).length === 0) {\n\t\t\t\t\tlisteners[type].push({ callback: callback, capture: capture, className: className });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn addEventListener.call(this, type, callback, capture);\n\t\t};\n\n\t\tEventTarget.prototype.removeEventListener = function (type, callback, capture) {\n\t\t\tif (this && this[_] && this[_].bliss && callback) {\n\t\t\t\tvar listeners = this[_].bliss.listeners = this[_].bliss.listeners || {};\n\n\t\t\t\tif (listeners[type]) {\n\t\t\t\t\tlisteners[type] = listeners[type].filter(notEqual.bind(null, callback, capture));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn removeEventListener.call(this, type, callback, capture);\n\t\t};\n\t}\n\n\t// Set $ and $$ convenience methods, if not taken\n\tself.$ = self.$ || $;\n\tself.$$ = self.$$ || $.$;\n})(Bliss);\n\n(function ($, $$) {\n\n\t\"use strict\";\n\n\tvar _ = self.Wysie = $.Class({\n\t\tconstructor: function constructor(element) {\n\t\t\tvar _this = this;\n\n\t\t\t_.all.push(this);\n\n\t\t\t// TODO escaping of # and \\\n\t\t\tvar dataStore = element.getAttribute(\"data-store\") || \"\";\n\t\t\tthis.store = dataStore === \"none\" ? null : dataStore;\n\n\t\t\t// Assign a unique (for the page) id to this wysie instance\n\t\t\tthis.id = Wysie.Node.normalizeProperty(element) || element.id || \"wysie-\" + _.all.length;\n\n\t\t\tthis.autoEdit = _.has(\"autoedit\", element);\n\n\t\t\tthis.element = _.is(\"scope\", element) ? element : $(_.selectors.rootScope, element);\n\n\t\t\tif (!this.element) {\n\t\t\t\telement.setAttribute(\"typeof\", element.getAttribute(\"property\") || \"\");\n\t\t\t\telement.removeAttribute(\"property\");\n\t\t\t\tthis.element = element;\n\t\t\t}\n\n\t\t\tthis.element.classList.add(\"wysie-root\");\n\n\t\t\t// Apply heuristic for collections\n\t\t\t$$(_.selectors.property + \", \" + _.selectors.scope).concat([this.element]).forEach(function (element) {\n\t\t\t\tif (_.is(\"autoMultiple\", element) && !element.hasAttribute(\"data-multiple\")) {\n\t\t\t\t\telement.setAttribute(\"data-multiple\", \"\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.wrapper = element.closest(\".wysie-wrapper\") || element;\n\n\t\t\t// Ctrl + S or Cmd + S to save\n\t\t\tthis.wrapper.addEventListener(\"keydown\", function (evt) {\n\t\t\t\tif (evt.keyCode == 83 && evt[_.superKey]) {\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t_this.save();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Apply heuristic for scopes\n\t\t\t$$(_.selectors.primitive).forEach(function (element) {\n\t\t\t\tvar isScope = $(Wysie.selectors.property, element) && ( // Contains other properties and...\n\t\t\t\tWysie.is(\"multiple\", element) || // is a collection...\n\t\t\t\tWysie.Primitive.getValueAttribute(element) === null); // ...or its content is not in an attribute\n\n\t\t\t\tif (isScope) {\n\t\t\t\t\telement.setAttribute(\"typeof\", \"\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.wrapper === this.element && _.is(\"multiple\", element)) {\n\t\t\t\t// Need to create a wrapper\n\t\t\t\tvar around = this.element;\n\n\t\t\t\t// Avoid producing invalid HTML\n\t\t\t\tif (this.element.matches(\"li, option\")) {\n\t\t\t\t\taround = around.parentNode;\n\t\t\t\t} else if (this.element.matches(\"td, tr, tbody, thead, tfoot\")) {\n\t\t\t\t\taround = around.closest(\"table\");\n\t\t\t\t}\n\n\t\t\t\tthis.wrapper = $.create({ around: around });\n\t\t\t}\n\n\t\t\tthis.wrapper.classList.add(\"wysie-wrapper\");\n\n\t\t\telement.removeAttribute(\"data-store\");\n\n\t\t\t// Normalize property names\n\t\t\tthis.propertyNames = $$(_.selectors.property, this.wrapper).map(function (element) {\n\t\t\t\treturn Wysie.Node.normalizeProperty(element);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn b.length - a.length;\n\t\t\t});\n\n\t\t\t// Is there any control that requires an edit button?\n\t\t\tthis.needsEdit = false;\n\n\t\t\t// Build wysie objects\n\t\t\tWysie.hooks.run(\"init-tree-before\", this);\n\t\t\tthis.root = Wysie.Node.create(this.element, this);\n\t\t\tWysie.hooks.run(\"init-tree-after\", this);\n\n\t\t\tthis.permissions = new Wysie.Permissions(null, this);\n\n\t\t\tthis.ui = {\n\t\t\t\tbar: $(\".wysie-bar\", this.wrapper) || $.create({\n\t\t\t\t\tclassName: \"wysie-bar wysie-ui\",\n\t\t\t\t\tstart: this.wrapper,\n\t\t\t\t\tcontents: {\n\t\t\t\t\t\ttag: \"span\",\n\t\t\t\t\t\tclassName: \"status\"\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t};\n\n\t\t\tthis.permissions.can([\"edit\", \"add\", \"delete\"], function () {\n\t\t\t\t_this.ui.edit = $.create(\"button\", {\n\t\t\t\t\tclassName: \"edit\",\n\t\t\t\t\ttextContent: \"Edit\",\n\t\t\t\t\tonclick: function onclick(e) {\n\t\t\t\t\t\treturn _this.editing ? _this.done() : _this.edit();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.ui.save = $.create(\"button\", {\n\t\t\t\t\tclassName: \"save\",\n\t\t\t\t\ttextContent: \"Save\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\treturn _this.save();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseenter focus\": function mouseenterFocus(e) {\n\t\t\t\t\t\t\t_this.wrapper.classList.add(\"save-hovered\");\n\t\t\t\t\t\t\t_this.unsavedChanges = _this.calculateUnsavedChanges();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": function mouseleaveBlur(e) {\n\t\t\t\t\t\t\treturn _this.wrapper.classList.remove(\"save-hovered\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.ui.revert = $.create(\"button\", {\n\t\t\t\t\tclassName: \"revert\",\n\t\t\t\t\ttextContent: \"Revert\",\n\t\t\t\t\tdisabled: true,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\treturn _this.revert();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseenter focus\": function mouseenterFocus(e) {\n\t\t\t\t\t\t\tif (_this.everSaved) {\n\t\t\t\t\t\t\t\t_this.wrapper.classList.add(\"revert-hovered\");\n\t\t\t\t\t\t\t\t_this.unsavedChanges = _this.calculateUnsavedChanges();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"mouseleave blur\": function mouseleaveBlur(e) {\n\t\t\t\t\t\t\treturn _this.wrapper.classList.remove(\"revert-hovered\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.ui.editButtons = [_this.ui.edit, _this.ui.save, _this.ui.revert];\n\n\t\t\t\t$.contents(_this.ui.bar, _this.ui.editButtons);\n\n\t\t\t\tif (_this.autoEdit) {\n\t\t\t\t\trequestAnimationFrame(function () {\n\t\t\t\t\t\treturn _this.ui.edit.click();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}, function () {\n\t\t\t\t// cannot\n\t\t\t\t$.remove(_this.ui.editButtons);\n\n\t\t\t\tif (_this.editing) {\n\t\t\t\t\t_this.done();\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.permissions.can([\"delete\"], function () {\n\t\t\t\t_this.ui.clear = $.create(\"button\", {\n\t\t\t\t\tclassName: \"clear\",\n\t\t\t\t\ttextContent: \"Clear\",\n\t\t\t\t\tonclick: function onclick(e) {\n\t\t\t\t\t\treturn _this.clear();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t_this.ui.editButtons.push(_this.ui.clear);\n\n\t\t\t\t_this.ui.bar.appendChild(_this.ui.clear);\n\t\t\t}, function () {\n\t\t\t\t// cannot\n\t\t\t\t$.remove(_this.ui.clear);\n\t\t\t});\n\n\t\t\t// Fetch existing data\n\n\t\t\tif (this.store) {\n\t\t\t\tthis.storage = new _.Storage(this);\n\n\t\t\t\tthis.permissions.can(\"read\", function () {\n\t\t\t\t\treturn _this.storage.load();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// No storage\n\t\t\t\tthis.permissions.on([\"read\", \"edit\"]);\n\n\t\t\t\tthis.root.import();\n\n\t\t\t\t$.fire(this.wrapper, \"wysie:load\");\n\t\t\t}\n\n\t\t\tif (!this.needsEdit) {\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]);\n\t\t\t}\n\n\t\t\tWysie.hooks.run(\"init-end\", this);\n\t\t},\n\n\t\tget data() {\n\t\t\treturn this.getData();\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\treturn this.root.getData(o);\n\t\t},\n\n\t\ttoJSON: function toJSON() {\n\t\t\tvar data = arguments.length <= 0 || arguments[0] === undefined ? this.data : arguments[0];\n\n\t\t\treturn _.toJSON(data);\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\t_.hooks.run(\"render-start\", { context: this, data: data });\n\n\t\t\tif (!data) {\n\t\t\t\tthis.root.import();\n\t\t\t} else {\n\t\t\t\tthis.everSaved = true;\n\t\t\t\tthis.root.render(data.data || data);\n\t\t\t}\n\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tclear: function clear() {\n\t\t\tif (confirm(\"This will delete all your data. Are you sure?\")) {\n\t\t\t\tthis.storage && this.storage.clear();\n\t\t\t\tthis.root.clear();\n\t\t\t}\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tthis.editing = true;\n\n\t\t\tthis.root.edit();\n\n\t\t\t$.events(this.wrapper, \"mouseenter.wysie:edit mouseleave.wysie:edit\", function (evt) {\n\t\t\t\tif (evt.target.matches(\".wysie-item-controls .delete\")) {\n\t\t\t\t\tvar item = evt.target.closest(_.selectors.item);\n\t\t\t\t\titem.classList.toggle(\"delete-hover\", evt.type == \"mouseenter\");\n\t\t\t\t}\n\n\t\t\t\tif (evt.target.matches(_.selectors.item)) {\n\t\t\t\t\tevt.target.classList.remove(\"has-hovered-item\");\n\n\t\t\t\t\tvar parent = evt.target.parentNode.closest(_.selectors.item);\n\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\tparent.classList.toggle(\"has-hovered-item\", evt.type == \"mouseenter\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, true);\n\n\t\t\tthis.unsavedChanges = this.calculateUnsavedChanges();\n\t\t},\n\n\t\tcalculateUnsavedChanges: function calculateUnsavedChanges() {\n\t\t\tvar unsavedChanges = false;\n\n\t\t\tthis.walk(function (obj) {\n\t\t\t\tif (obj.unsavedChanges) {\n\t\t\t\t\tunsavedChanges = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn unsavedChanges;\n\t\t},\n\n\t\t// Conclude editing\n\t\tdone: function done() {\n\t\t\tthis.root.done();\n\t\t\t$.unbind(this.wrapper, \".wysie:edit\");\n\t\t\tthis.editing = false;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tthis.root.save();\n\n\t\t\tif (this.storage) {\n\t\t\t\tthis.storage.save();\n\t\t\t}\n\n\t\t\tthis.everSaved = true;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\trevert: function revert() {\n\t\t\tthis.root.revert();\n\t\t},\n\n\t\twalk: function walk(callback) {\n\t\t\tthis.root.walk(callback);\n\t\t},\n\n\t\tlive: {\n\t\t\tediting: {\n\t\t\t\tset: function set(value) {\n\t\t\t\t\tthis.wrapper.classList.toggle(\"editing\", value);\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tthis.wrapper.setAttribute(\"data-editing\", \"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.wrapper.removeAttribute(\"data-editing\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tunsavedChanges: function unsavedChanges(value) {\n\t\t\t\tthis.wrapper.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\t\tif (this.ui && this.ui.save) {\n\t\t\t\t\tthis.ui.save.disabled = !value;\n\t\t\t\t\tthis.ui.revert.disabled = !this.everSaved || !value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\teverSaved: function everSaved(value) {\n\t\t\t\tif (this.ui && this.ui.revert) {\n\t\t\t\t\tthis.ui.revert.disabled = !value;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: [],\n\n\t\t\tsuperKey: navigator.platform.indexOf(\"Mac\") === 0 ? \"metaKey\" : \"ctrlKey\",\n\n\t\t\tinit: function init(container) {\n\t\t\t\treturn $$(\"[data-store]\", container).map(function (element) {\n\t\t\t\t\treturn new _(element);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\ttoJSON: function toJSON(data) {\n\t\t\t\tif (data === null) {\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\n\t\t\t\tif (typeof data === \"string\") {\n\t\t\t\t\t// Do not stringify twice!\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\n\t\t\t\treturn JSON.stringify(data, null, \"\\t\");\n\t\t\t},\n\n\t\t\t// Convert an identifier to readable text that can be used as a label\n\t\t\treadable: function readable(identifier) {\n\t\t\t\t// Is it camelCase?\n\t\t\t\treturn identifier && identifier.replace(/([a-z])([A-Z])(?=[a-z])/g, function ($0, $1, $2) {\n\t\t\t\t\treturn $1 + \" \" + $2.toLowerCase();\n\t\t\t\t}) // camelCase?\n\t\t\t\t.replace(/([a-z])[_\\/-](?=[a-z])/g, \"$1 \") // Hyphen-separated / Underscore_separated?\n\t\t\t\t.replace(/^[a-z]/, function ($0) {\n\t\t\t\t\treturn $0.toUpperCase();\n\t\t\t\t}); // Capitalize\n\t\t\t},\n\n\t\t\t// Inverse of _.readable(): Take a readable string and turn it into an identifier\n\t\t\tidentifier: function identifier(readable) {\n\t\t\t\treadable = readable + \"\";\n\t\t\t\treturn readable && readable.replace(/\\s+/g, \"-\") // Convert whitespace to hyphens\n\t\t\t\t.replace(/[^\\w-]/g, \"\") // Remove weird characters\n\t\t\t\t.toLowerCase();\n\t\t\t},\n\n\t\t\tqueryJSON: function queryJSON(data, path) {\n\t\t\t\tif (!path || !data) {\n\t\t\t\t\treturn data;\n\t\t\t\t}\n\n\t\t\t\treturn $.value.apply($, [data].concat(path.split(\"/\")));\n\t\t\t},\n\n\t\t\tobserve: function observe(element, attribute, callback, oldValue) {\n\t\t\t\tvar observer = $.type(callback) == \"function\" ? new MutationObserver(callback) : callback;\n\n\t\t\t\tvar options = attribute ? {\n\t\t\t\t\tattributes: true,\n\t\t\t\t\tattributeFilter: [attribute],\n\t\t\t\t\tattributeOldValue: !!oldValue\n\t\t\t\t} : {\n\t\t\t\t\tcharacterData: true,\n\t\t\t\t\tchildList: true,\n\t\t\t\t\tsubtree: true,\n\t\t\t\t\tcharacterDataOldValue: !!oldValue\n\t\t\t\t};\n\n\t\t\t\tobserver.observe(element, options);\n\n\t\t\t\treturn observer;\n\t\t\t},\n\n\t\t\t// If the passed value is not an array, convert to an array\n\t\t\ttoArray: function toArray(arr) {\n\t\t\t\treturn Array.isArray(arr) ? arr : [arr];\n\t\t\t},\n\n\t\t\t// Recursively flatten a multi-dimensional array\n\t\t\tflatten: function flatten(arr) {\n\t\t\t\tif (!Array.isArray(arr)) {\n\t\t\t\t\treturn [arr];\n\t\t\t\t}\n\n\t\t\t\treturn arr.reduce(function (prev, c) {\n\t\t\t\t\treturn _.toArray(prev).concat(_.flatten(c));\n\t\t\t\t}, []);\n\t\t\t},\n\n\t\t\tis: function is(thing, element) {\n\t\t\t\treturn element.matches && element.matches(_.selectors[thing]);\n\t\t\t},\n\n\t\t\thas: function has(option, element) {\n\t\t\t\treturn element.matches && element.matches(_.selectors.option(option));\n\t\t\t},\n\n\t\t\thooks: new $.Hooks()\n\t\t}\n\t});\n\n\t{\n\t\t(function () {\n\n\t\t\tvar s = _.selectors = {\n\t\t\t\tproperty: \"[property], [itemprop]\",\n\t\t\t\tspecificProperty: function specificProperty(name) {\n\t\t\t\t\treturn \"[property=\" + name + \"], [itemprop=\" + name + \"]\";\n\t\t\t\t},\n\t\t\t\tscope: \"[typeof], [itemscope], [itemtype], .scope\",\n\t\t\t\tmultiple: \"[multiple], [data-multiple], .multiple\",\n\t\t\t\trequired: \"[required], [data-required], .required\",\n\t\t\t\tformControl: \"input, select, textarea\",\n\t\t\t\tcomputed: \".computed\", // Properties or scopes with computed properties, will not be saved\n\t\t\t\titem: \".wysie-item\",\n\t\t\t\tui: \".wysie-ui\",\n\t\t\t\toption: function option(name) {\n\t\t\t\t\treturn \"[\" + name + \"], [data-\" + name + \"], [data-wysie-options~='\" + name + \"'], .\" + name;\n\t\t\t\t},\n\t\t\t\tcontainer: {\n\t\t\t\t\t\"li\": \"ul, ol\",\n\t\t\t\t\t\"tr\": \"table\",\n\t\t\t\t\t\"option\": \"select\",\n\t\t\t\t\t\"dt\": \"dl\",\n\t\t\t\t\t\"dd\": \"dl\"\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tvar arr = s.arr = function (selector) {\n\t\t\t\treturn selector.split(/\\s*,\\s*/g);\n\t\t\t};\n\t\t\tvar not = s.not = function (selector) {\n\t\t\t\treturn arr(selector).map(function (s) {\n\t\t\t\t\treturn \":not(\" + s + \")\";\n\t\t\t\t}).join(\"\");\n\t\t\t};\n\t\t\tvar or = s.or = function (selector1, selector2) {\n\t\t\t\treturn selector1 + \", \" + selector2;\n\t\t\t};\n\t\t\tvar and = s.and = function (selector1, selector2) {\n\t\t\t\treturn _.flatten(arr(selector1).map(function (s1) {\n\t\t\t\t\treturn arr(selector2).map(function (s2) {\n\t\t\t\t\t\treturn s1 + s2;\n\t\t\t\t\t});\n\t\t\t\t})).join(\", \");\n\t\t\t};\n\t\t\tvar andNot = s.andNot = function (selector1, selector2) {\n\t\t\t\treturn and(selector1, not(selector2));\n\t\t\t};\n\n\t\t\t$.extend(_.selectors, {\n\t\t\t\tprimitive: andNot(s.property, s.scope),\n\t\t\t\trootScope: andNot(s.scope, s.property),\n\t\t\t\toutput: or(s.specificProperty(\"output\"), \".output, .value\"),\n\t\t\t\tautoMultiple: and(\"li, tr, option\", \":only-of-type\")\n\t\t\t});\n\t\t})();\n\t}\n\n\t// Bliss plugins\n\n\t// Provide shortcuts to long property chains\n\t$.proxy = $.classProps.proxy = $.overload(function (obj, property, proxy) {\n\t\tObject.defineProperty(obj, property, {\n\t\t\tget: function get() {\n\t\t\t\treturn this[proxy][property];\n\t\t\t},\n\t\t\tset: function set(value) {\n\t\t\t\tthis[proxy][property] = value;\n\t\t\t},\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true\n\t\t});\n\n\t\treturn obj;\n\t});\n\n\t$.classProps.propagated = function (proto, names) {\n\t\tWysie.toArray(names).forEach(function (name) {\n\t\t\tvar existing = proto[name];\n\n\t\t\tproto[name] = function () {\n\t\t\t\tvar ret = existing && existing.apply(this, arguments);\n\n\t\t\t\tif (this.propagate && ret !== false) {\n\t\t\t\t\tthis.propagate(name);\n\t\t\t\t}\n\t\t\t};\n\t\t});\n\t};\n\n\t// :focus-within shim\n\tdocument.addEventListener(\"focus\", function (evt) {\n\t\t$$(\".focus-within\").forEach(function (el) {\n\t\t\treturn el.classList.remove(\"focus-within\");\n\t\t});\n\n\t\tvar element = evt.target;\n\n\t\twhile (element = element.parentNode) {\n\t\t\tif (element.classList) {\n\t\t\t\telement.classList.add(\"focus-within\");\n\t\t\t}\n\t\t}\n\t}, true);\n\n\t// Init wysie\n\tPromise.all([$.ready(), $.include(Array.from && window.Intl && document.documentElement.closest, \"https://cdn.polyfill.io/v2/polyfill.min.js?features=blissfuljs,Intl.~locale.en\")]).then(function () {\n\t\treturn Wysie.init();\n\t}).catch(function (err) {\n\t\tconsole.error(err);\n\t\tWysie.init();\n\t});\n\n\tStretchy.selectors.filter = \".wysie-editor:not([property])\";\n})(Bliss, Bliss.$);\n\n(function ($) {\n\n\tvar _ = Wysie.Permissions = $.Class({\n\t\tconstructor: function constructor(o, wysie) {\n\t\t\tthis.triggers = [];\n\t\t\tthis.wysie = wysie;\n\n\t\t\tthis.set(o);\n\t\t},\n\n\t\t// Set multiple permissions at once\n\t\tset: function set(o) {\n\t\t\tfor (var action in o) {\n\t\t\t\tthis[action] = o[action];\n\t\t\t}\n\t\t},\n\n\t\t// Set a bunch of permissions to true. Chainable.\n\t\ton: function on(actions) {\n\t\t\tvar _this2 = this;\n\n\t\t\tWysie.toArray(actions).forEach(function (action) {\n\t\t\t\treturn _this2[action] = true;\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t// Set a bunch of permissions to false. Chainable.\n\t\toff: function off(actions) {\n\t\t\tvar _this3 = this;\n\n\t\t\tactions = Array.isArray(actions) ? actions : [actions];\n\n\t\t\tactions.forEach(function (action) {\n\t\t\t\treturn _this3[action] = false;\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\t// Fired once at least one of the actions passed can be performed\n\t\t// Kind of like a Promise that can be resolved multiple times.\n\t\tcan: function can(actions, callback, cannot) {\n\t\t\tthis.observe(actions, true, callback);\n\n\t\t\tif (cannot) {\n\t\t\t\t// Fired once the action cannot be done anymore, even though it could be done before\n\t\t\t\tthis.observe(actions, false, cannot);\n\t\t\t}\n\t\t},\n\n\t\t// Like this.can(), but returns a promise\n\t\t// Useful for things that you want to do only once\n\t\twhen: function when(actions) {\n\t\t\tvar _this4 = this;\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this4.can(actions, resolve, reject);\n\t\t\t});\n\t\t},\n\n\t\t// Schedule a callback for when a set of permissions changes value\n\t\tobserve: function observe(actions, value, callback) {\n\t\t\tactions = Array.isArray(actions) ? actions : [actions];\n\n\t\t\tif (this.is(actions, value)) {\n\t\t\t\t// Should be fired immediately\n\t\t\t\tcallback();\n\t\t\t}\n\n\t\t\t// For future transitions\n\t\t\tthis.triggers.push({ actions: actions, value: value, callback: callback, active: true });\n\t\t},\n\n\t\t// Compare a set of permissions with true or false\n\t\t// If comparing with true, we want at least one to be true, i.e. OR\n\t\t// If comparing with false, we want ALL to be false, i.e. NOR\n\t\tis: function is(actions, able) {\n\t\t\tvar _this5 = this;\n\n\t\t\tvar or = actions.map(function (action) {\n\t\t\t\treturn !!_this5[action];\n\t\t\t}).reduce(function (prev, current) {\n\t\t\t\treturn prev || current;\n\t\t\t});\n\n\t\t\treturn able ? or : !or;\n\t\t},\n\n\t\t// A single permission changed value\n\t\tchanged: function changed(action, value, from) {\n\t\t\tvar _this6 = this;\n\n\t\t\tfrom = !!from;\n\t\t\tvalue = !!value;\n\n\t\t\tif (value == from) {\n\t\t\t\t// Nothing changed\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.wysie) {\n\t\t\t\tthis.wysie.wrapper.classList.toggle(\"can-\" + action, value);\n\t\t\t}\n\n\t\t\t// $.live() calls the setter before the actual property is set so we\n\t\t\t// need to set it manually, otherwise it still has its previous value\n\t\t\tthis[\"_\" + action] = value;\n\n\t\t\t// TODO add classes to wrapper\n\t\t\tthis.triggers.forEach(function (trigger) {\n\t\t\t\tvar match = _this6.is(trigger.actions, trigger.value);\n\n\t\t\t\tif (trigger.active && trigger.actions.indexOf(action) > -1 && match) {\n\n\t\t\t\t\ttrigger.active = false;\n\t\t\t\t\ttrigger.callback();\n\t\t\t\t} else if (!match) {\n\t\t\t\t\t// This is so that triggers can only be executed in an actual transition\n\t\t\t\t\t// And that if there is a trigger for [a,b] it won't be executed twice\n\t\t\t\t\t// if a and b are set to true one after the other\n\t\t\t\t\ttrigger.active = true;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tor: function or(permissions) {\n\t\t\tvar _this7 = this;\n\n\t\t\t_.actions.forEach(function (action) {\n\t\t\t\t_this7[action] = _this7[action] || permissions[action];\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\n\t\tstatic: {\n\t\t\tactions: [],\n\n\t\t\t// Register a new permission type\n\t\t\tregister: function register(action, setter) {\n\t\t\t\tif (Array.isArray(action)) {\n\t\t\t\t\taction.forEach(function (action) {\n\t\t\t\t\t\treturn _.register(action, setter);\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$.live(_.prototype, action, function (able, previous) {\n\t\t\t\t\tif (setter) {\n\t\t\t\t\t\tsetter.call(this, able, previous);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.changed(action, able, previous);\n\t\t\t\t});\n\n\t\t\t\t_.actions.push(action);\n\t\t\t}\n\t\t}\n\t});\n\n\t_.register(\"read\");\n\n\t_.register(\"login\", function (can) {\n\t\tif (can && this.logout) {\n\t\t\tthis.logout = false;\n\t\t}\n\t});\n\n\t_.register(\"logout\", function (can) {\n\t\tif (can && this.login) {\n\t\t\tthis.login = false;\n\t\t}\n\t});\n\n\t_.register(\"edit\", function (can) {\n\t\tif (can) {\n\t\t\tthis.add = this.delete = true;\n\t\t}\n\t});\n\n\t_.register([\"add\", \"delete\"], function (can) {\n\t\tif (!can) {\n\t\t\tthis.edit = false;\n\t\t}\n\t});\n})(Bliss);\n\n(function ($) {\n\n\tvar _ = Wysie.Storage = $.Class({\n\t\tconstructor: function constructor(wysie) {\n\t\t\tvar _this8 = this;\n\n\t\t\tthis.wysie = wysie;\n\n\t\t\tvar keywords = RegExp(\"^(?:\" + _.Backend.backends.map(function (a) {\n\t\t\t\treturn a.id;\n\t\t\t}).join(\"|\") + \")$\", \"i\");\n\t\t\tthis.urls = wysie.store.split(/\\s+/).map(function (url) {\n\t\t\t\treturn keywords.test(url) ? url : new URL(url, location);\n\t\t\t});\n\n\t\t\tthis.backends = Wysie.flatten(this.urls.map(function (url) {\n\t\t\t\treturn _.Backend.create(url, _this8);\n\t\t\t}));\n\n\t\t\tthis.backends[0].permissions = this.wysie.permissions.or(this.backends[0].permissions);\n\n\t\t\tthis.ready = Promise.all(this.backends.map(function (backend) {\n\t\t\t\treturn backend.ready;\n\t\t\t}));\n\n\t\t\tthis.loaded = new Promise(function (resolve, reject) {\n\t\t\t\t_this8.wysie.wrapper.addEventListener(\"wysie:load\", resolve);\n\t\t\t});\n\n\t\t\tthis.authControls = {};\n\n\t\t\tthis.permissions.can(\"login\", function () {\n\t\t\t\t// #login authenticates if only 1 wysie on the page, or if the first.\n\t\t\t\t// Otherwise, we have to generate a slightly more complex hash\n\t\t\t\t_this8.loginHash = \"#login\" + (Wysie.all[0] === _this8.wysie ? \"\" : \"-\" + _this8.wysie.id);\n\n\t\t\t\t_this8.authControls.login = $.create({\n\t\t\t\t\ttag: \"a\",\n\t\t\t\t\thref: _this8.loginHash,\n\t\t\t\t\ttextContent: \"Login\",\n\t\t\t\t\tclassName: \"login button\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function click(evt) {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t\t_this8.login();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tafter: $(\".status\", _this8.wysie.bar)\n\t\t\t\t});\n\n\t\t\t\t// We also support a hash to trigger login, in case the user doesn't want visible login UI\n\t\t\t\tvar login;\n\t\t\t\t(login = function login() {\n\t\t\t\t\tif (location.hash === _this8.loginHash) {\n\t\t\t\t\t\t// This just does location.hash = \"\" without getting a pointless # at the end of the URL\n\t\t\t\t\t\thistory.replaceState(null, document.title, new URL(\"\", location) + \"\");\n\t\t\t\t\t\t_this8.login();\n\t\t\t\t\t}\n\t\t\t\t})();\n\t\t\t\twindow.addEventListener(\"hashchange.wysie\", login);\n\t\t\t}, function () {\n\t\t\t\t$.remove(_this8.authControls.login);\n\t\t\t\t_this8.wysie.wrapper._.unbind(\"hashchange.wysie\");\n\t\t\t});\n\n\t\t\t// Update login status\n\t\t\tthis.wysie.wrapper.addEventListener(\"wysie:login.wysie\", function (evt) {\n\t\t\t\tvar status = $(\".status\", _this8.wysie.bar);\n\t\t\t\tstatus.innerHTML = \"\";\n\t\t\t\tstatus._.contents([\"Logged in to \" + evt.backend.id + \" as \", { tag: \"strong\", innerHTML: evt.name }, {\n\t\t\t\t\ttag: \"button\",\n\t\t\t\t\ttextContent: \"Logout\",\n\t\t\t\t\tclassName: \"logout\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tclick: function click(e) {\n\t\t\t\t\t\t\treturn evt.backend.logout();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]);\n\t\t\t});\n\n\t\t\tthis.wysie.wrapper.addEventListener(\"wysie:logout.wysie\", function (evt) {\n\t\t\t\t$(\".status\", _this8.wysie.bar).textContent = \"\";\n\t\t\t});\n\t\t},\n\n\t\tget getBackends() {\n\t\t\treturn this.backends.filter(function (backend) {\n\t\t\t\treturn !!backend.get;\n\t\t\t});\n\t\t},\n\n\t\tget putBackends() {\n\t\t\treturn this.backends.filter(function (backend) {\n\t\t\t\treturn !!backend.put;\n\t\t\t});\n\t\t},\n\n\t\tget authBackends() {\n\t\t\treturn this.backends.filter(function (backend) {\n\t\t\t\treturn !!backend.login;\n\t\t\t});\n\t\t},\n\n\t\tproxy: {\n\t\t\tpermissions: \"wysie\"\n\t\t},\n\n\t\t/**\n   * load - Fetch data from source and render it.\n   *\n   * @return {Promise}  A promise that resolves when the data is loaded.\n   */\n\t\tload: function load() {\n\t\t\tvar _this9 = this;\n\n\t\t\tvar ret = this.ready;\n\n\t\t\tthis.inProgress = \"Loading\";\n\n\t\t\tvar getBackend = this.getBackends[0];\n\n\t\t\tif (getBackend) {\n\t\t\t\tgetBackend.ready.then(function () {\n\t\t\t\t\treturn getBackend.get();\n\t\t\t\t}).then(function (response) {\n\t\t\t\t\t_this9.inProgress = false;\n\t\t\t\t\t_this9.wysie.wrapper._.fire(\"wysie:load\");\n\n\t\t\t\t\tif (response && $.type(response) == \"string\") {\n\t\t\t\t\t\tresponse = JSON.parse(response);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar data = Wysie.queryJSON(response, _this9.param(\"root\"));\n\n\t\t\t\t\t_this9.wysie.render(data);\n\t\t\t\t}).catch(function (err) {\n\t\t\t\t\t// TODO try more backends if this fails\n\t\t\t\t\t_this9.inProgress = false;\n\n\t\t\t\t\tif (err.xhr && err.xhr.status == 404) {\n\t\t\t\t\t\t_this9.wysie.render(\"\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\t_this9.wysie.wrapper._.fire(\"wysie:load\");\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tvar _this10 = this;\n\n\t\t\tvar data = arguments.length <= 0 || arguments[0] === undefined ? this.wysie.data : arguments[0];\n\n\t\t\tthis.inProgress = \"Saving\";\n\n\t\t\tPromise.all(this.putBackends.map(function (backend) {\n\t\t\t\treturn backend.login().then(function () {\n\t\t\t\t\treturn backend.put({\n\t\t\t\t\t\tname: backend.filename,\n\t\t\t\t\t\tpath: backend.path,\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})).then(function () {\n\t\t\t\t_this10.wysie.wrapper._.fire(\"wysie:save\");\n\n\t\t\t\t_this10.inProgress = false;\n\t\t\t}).catch(function (err) {\n\t\t\t\t_this10.inProgress = false;\n\n\t\t\t\tif (err) {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login() {\n\t\t\treturn this.authBackends[0] && this.authBackends[0].login();\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\treturn this.authBackends[0] && this.authBackends[0].logout();\n\t\t},\n\n\t\tclear: function clear() {\n\t\t\tthis.save(null);\n\t\t},\n\n\t\t// Get storage parameters from the main element and cache them. Used for API keys and the like.\n\t\tparam: function param(id) {\n\t\t\t// TODO traverse all properties and cache params in constructor, to avoid\n\t\t\t// collection items carrying all of these\n\t\t\tthis.params = this.params || {};\n\n\t\t\tif (!(id in this.params)) {\n\t\t\t\tvar attribute = \"data-store-\" + id;\n\n\t\t\t\tthis.params[id] = this.wysie.wrapper.getAttribute(attribute) || this.wysie.element.getAttribute(attribute);\n\n\t\t\t\tthis.wysie.wrapper.removeAttribute(attribute);\n\t\t\t\tthis.wysie.element.removeAttribute(attribute);\n\t\t\t}\n\n\t\t\treturn this.params[id];\n\t\t},\n\n\t\tlive: {\n\t\t\tinProgress: function inProgress(value) {\n\t\t\t\tif (value) {\n\t\t\t\t\tvar p = $.create(\"div\", {\n\t\t\t\t\t\ttextContent: value + \"\",\n\t\t\t\t\t\tclassName: \"progress\",\n\t\t\t\t\t\tinside: this.wysie.wrapper\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\t$.remove($(\".progress\", this.wysie.wrapper));\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tisHash: function isHash(url) {\n\t\t\t\treturn url.origin === location.origin && url.pathname === location.pathname && !!url.hash;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Base class for all backends\n\t_.Backend = $.Class({\n\t\tconstructor: function constructor(url, storage) {\n\t\t\tvar _this11 = this;\n\n\t\t\tthis.url = url;\n\t\t\tthis.storage = storage;\n\t\t\tthis.id = this.constructor.id;\n\n\t\t\t// Permissions of this particular backend.\n\t\t\t// Global permissions are OR(all permissions)\n\t\t\tthis.permissions = new Wysie.Permissions();\n\n\t\t\tWysie.Permissions.actions.forEach(function (action) {\n\t\t\t\t_this11.permissions.can(action, function () {\n\t\t\t\t\t_this11.storage.permissions.on(action);\n\t\t\t\t}, function () {\n\t\t\t\t\t// TODO off\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\t// To be be overriden by subclasses\n\t\tready: Promise.resolve(),\n\t\tlogin: function login() {\n\t\t\treturn Promise.resolve();\n\t\t},\n\t\tlogout: function logout() {\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tproxy: {\n\t\t\twysie: \"storage\"\n\t\t},\n\n\t\tstatic: {\n\t\t\t// Return the appropriate backend(s) for this url\n\t\t\tcreate: function create(url, storage) {\n\t\t\t\tvar ret = [];\n\n\t\t\t\t_.Backend.backends.forEach(function (Backend) {\n\t\t\t\t\tif (Backend && Backend.test(url)) {\n\t\t\t\t\t\tvar backend = new Backend(url, storage);\n\t\t\t\t\t\tbackend.id = Backend.id;\n\t\t\t\t\t\tret.push(backend);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tbackends: [],\n\n\t\t\tadd: function add(name, Class, first) {\n\t\t\t\t_.Backend[name] = Class;\n\t\t\t\t_.Backend.backends[first ? \"unshift\" : \"push\"](Class);\n\t\t\t\tClass.id = name;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Save in an element\n\t_.Backend.add(\"Element\", $.Class({ extends: _.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\n\t\t\tthis.element = $(this.url.hash);\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn Promise.resolve(this.element.textContent);\n\t\t},\n\n\t\tput: function put(_ref) {\n\t\t\tvar _ref$data = _ref.data;\n\t\t\tvar data = _ref$data === undefined ? \"\" : _ref$data;\n\n\t\t\tthis.element.textContent = this.wysie.toJSON(data);\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\tif (_.isHash(url)) {\n\t\t\t\t\treturn !!$(url.hash);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}));\n\n\t// Load from a remote URL, no save\n\t_.Backend.add(\"Remote\", $.Class({ extends: _.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on([\"read\"]);\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn $.fetch(this.url.href, {\n\t\t\t\tresponseType: \"json\"\n\t\t\t}).then(function (xhr) {\n\t\t\t\treturn Promise.resolve(xhr.response);\n\t\t\t}, function () {\n\t\t\t\treturn Promise.resolve(null);\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\treturn url instanceof URL && !_.isHash(url);\n\t\t\t}\n\t\t}\n\t}));\n\n\t// Save in localStorage\n\t_.Backend.add(\"Local\", $.Class({ extends: _.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on([\"read\", \"edit\", \"save\"]);\n\t\t\tthis.key = this.wysie.id;\n\t\t},\n\n\t\tget: function get() {\n\t\t\treturn Promise.resolve(localStorage[this.key]);\n\t\t},\n\n\t\tput: function put(_ref2) {\n\t\t\tvar _ref2$data = _ref2.data;\n\t\t\tvar data = _ref2$data === undefined ? \"\" : _ref2$data;\n\n\t\t\tlocalStorage[this.key] = this.wysie.toJSON(data);\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(value) {\n\t\t\t\treturn value == \"local\";\n\t\t\t}\n\t\t}\n\t}));\n})(Bliss);\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Node = $.Class({\n\t\tabstract: true,\n\t\tconstructor: function constructor(element, wysie) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tif (!element || !wysie) {\n\t\t\t\tthrow new Error(\"Wysie.Node constructor requires an element argument and a wysie object\");\n\t\t\t}\n\n\t\t\tthis.element = element;\n\t\t\tthis.template = o.template;\n\n\t\t\tthis.wysie = wysie;\n\t\t\tthis.property = element.getAttribute(\"property\");\n\t\t\tthis.type = Wysie.Scope.normalize(element);\n\n\t\t\tWysie.hooks.run(\"node-init-end\", this);\n\t\t},\n\n\t\tget isRoot() {\n\t\t\treturn !this.property;\n\t\t},\n\n\t\tget name() {\n\t\t\treturn Wysie.readable(this.property || this.type).toLowerCase();\n\t\t},\n\n\t\tget data() {\n\t\t\treturn this.getData();\n\t\t},\n\n\t\tgetRelativeData: function getRelativeData() {\n\t\t\tvar _this12 = this;\n\n\t\t\tvar o = arguments.length <= 0 || arguments[0] === undefined ? { dirty: true, computed: true, null: true } : arguments[0];\n\n\t\t\tvar ret = this.getData(o);\n\n\t\t\tif (self.Proxy && ret && (typeof ret === \"undefined\" ? \"undefined\" : _typeof(ret)) === \"object\") {\n\t\t\t\tret = new Proxy(ret, {\n\t\t\t\t\tget: function get(data, property) {\n\t\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\t\treturn data[property];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\t\treturn _this12.index + 1;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Look in ancestors\n\t\t\t\t\t\tvar ret = _this12.walkUp(function (scope) {\n\t\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t\t// TODO decouple\n\t\t\t\t\t\t\t\tscope.expressions.updateAlso.add(_this12.expressions);\n\n\t\t\t\t\t\t\t\treturn scope.properties[property].getRelativeData(o);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\thas: function has(data, property) {\n\t\t\t\t\t\tif (property in data) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Property does not exist, look for it elsewhere\n\t\t\t\t\t\tif (property == \"$index\") {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// First look in ancestors\n\t\t\t\t\t\tvar ret = _this12.walkUp(function (scope) {\n\t\t\t\t\t\t\tif (property in scope.properties) {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\treturn ret;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Still not found, look in descendants\n\t\t\t\t\t\tret = _this12.find(property);\n\n\t\t\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\t\t\tif (Array.isArray(ret)) {\n\t\t\t\t\t\t\t\tret = ret.map(function (item) {\n\t\t\t\t\t\t\t\t\treturn item.getData(o);\n\t\t\t\t\t\t\t\t}).filter(function (item) {\n\t\t\t\t\t\t\t\t\treturn item !== null;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tret = ret.getData(o);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdata[property] = ret;\n\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\n\t\t\t\t\tset: function set(data, property, value) {\n\t\t\t\t\t\tthrow Error(\"You cant set data via expressions.\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\twalk: function walk(callback) {\n\t\t\tvar walker = function walker(obj) {\n\t\t\t\tvar ret = callback(obj);\n\n\t\t\t\tif (ret !== false) {\n\t\t\t\t\tobj.propagate && obj.propagate(walker);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\twalker(this);\n\t\t},\n\n\t\twalkUp: function walkUp(callback) {\n\t\t\tvar scope = this;\n\n\t\t\twhile (scope = scope.parentScope) {\n\t\t\t\tvar ret = callback(scope);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcall: function call(callback) {\n\t\t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n\t\t\t\targs[_key - 1] = arguments[_key];\n\t\t\t}\n\n\t\t\targs = args || [];\n\n\t\t\tif (typeof callback === \"string\") {\n\t\t\t\treturn this[callback].apply(this, _toConsumableArray(args));\n\t\t\t} else {\n\t\t\t\treturn callback.apply(this, [this].concat(_toConsumableArray(args)));\n\t\t\t}\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\treturn obj[obj.preEdit ? \"preEdit\" : \"edit\"]();\n\t\t\t});\n\t\t},\n\n\t\tpropagated: [\"save\", \"revert\", \"done\", \"import\"],\n\n\t\ttoJSON: Wysie.prototype.toJSON,\n\n\t\tstatic: {\n\t\t\tcreate: function create(element, wysie) {\n\t\t\t\tvar _Wysie$Unit;\n\n\t\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\t\tif (Wysie.is(\"multiple\", element) && !o.collection) {\n\t\t\t\t\treturn new Wysie.Collection(element, wysie, o);\n\t\t\t\t}\n\n\t\t\t\treturn (_Wysie$Unit = Wysie.Unit).create.apply(_Wysie$Unit, arguments);\n\t\t\t},\n\n\t\t\tnormalizeProperty: function normalizeProperty(element) {\n\t\t\t\t// Get & normalize property name, if exists\n\t\t\t\tvar property = element.getAttribute(\"property\") || element.getAttribute(\"itemprop\");\n\n\t\t\t\tif (!property && element.hasAttribute(\"property\")) {\n\t\t\t\t\tproperty = element.name || element.id || element.classList[0];\n\t\t\t\t}\n\n\t\t\t\tif (property) {\n\t\t\t\t\telement.setAttribute(\"property\", property);\n\t\t\t\t}\n\n\t\t\t\treturn property;\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n/*\n * Wysie Unit: Super class that Scope and Primitive inherit from\n */\n(function ($, $$) {\n\n\tvar _ = Wysie.Unit = $.Class({\n\t\tabstract: true,\n\t\textends: Wysie.Node,\n\t\tconstructor: function constructor(element, wysie) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tthis.constructor.all.set(this.element, this);\n\n\t\t\tthis.collection = o.collection;\n\n\t\t\tif (this.collection) {\n\t\t\t\t// This is a collection item\n\t\t\t\tthis.scope = this.parentScope = this.collection.parentScope;\n\t\t\t}\n\n\t\t\tif (this.template) {\n\t\t\t\t$.extend(this, this.template, [\"computed\", \"required\"]);\n\t\t\t} else {\n\t\t\t\tthis.computed = Wysie.is(\"computed\", this.element);\n\t\t\t\tthis.required = Wysie.is(\"required\", this.element);\n\t\t\t}\n\n\t\t\tWysie.hooks.run(\"unit-init-end\", this);\n\t\t},\n\n\t\t/**\n   * Check if this unit is either deleted or inside a deleted scope\n   */\n\t\tisDeleted: function isDeleted() {\n\t\t\tvar ret = this.deleted;\n\n\t\t\tif (this.deleted) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn !!this.parentScope && this.parentScope.isDeleted();\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar isNull = function isNull(unit) {\n\t\t\t\treturn !unit.everSaved && !o.dirty || unit.deleted && o.dirty || unit.computed && !o.computed || unit.placeholder;\n\t\t\t};\n\n\t\t\tif (isNull(this)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Check if any of the parent scopes doesn't return data\n\t\t\tthis.walkUp(function (scope) {\n\t\t\t\tif (isNull(scope)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tlazy: {\n\t\t\tclosestCollection: function closestCollection() {\n\t\t\t\tif (this.collection) {\n\t\t\t\t\treturn this.collection;\n\t\t\t\t}\n\n\t\t\t\treturn this.walkUp(function (scope) {\n\t\t\t\t\tif (scope.collection) {\n\t\t\t\t\t\treturn scope.collection;\n\t\t\t\t\t}\n\t\t\t\t}) || null;\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tdeleted: function deleted(value) {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tthis.element.classList.toggle(\"deleted\", value);\n\n\t\t\t\tif (value) {\n\t\t\t\t\t// Soft delete, store element contents in a fragment\n\t\t\t\t\t// and replace them with an undo prompt.\n\t\t\t\t\tthis.elementContents = document.createDocumentFragment();\n\t\t\t\t\t$$(this.element.childNodes).forEach(function (node) {\n\t\t\t\t\t\t_this13.elementContents.appendChild(node);\n\t\t\t\t\t});\n\n\t\t\t\t\t$.contents(this.element, [\"Deleted \" + this.name, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttextContent: \"Undo\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\treturn _this13.deleted = false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}]);\n\n\t\t\t\t\tthis.element.classList.remove(\"delete-hover\");\n\t\t\t\t} else if (this.deleted) {\n\t\t\t\t\t// Undelete\n\t\t\t\t\tthis.element.textContent = \"\";\n\t\t\t\t\tthis.element.appendChild(this.elementContents);\n\n\t\t\t\t\t// otherwise expressions won't update because this will still seem as deleted\n\t\t\t\t\t// Alternatively, we could fire datachange with a timeout.\n\t\t\t\t\tthis._deleted = false;\n\n\t\t\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\t\t\tunit: this.collection,\n\t\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\t\taction: \"undelete\",\n\t\t\t\t\t\titem: this\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tunsavedChanges: function unsavedChanges(value) {\n\t\t\t\tif (this.placeholder) {\n\t\t\t\t\tvalue = false;\n\t\t\t\t}\n\n\t\t\t\tthis.element.classList.toggle(\"unsaved-changes\", value);\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tplaceholder: function placeholder(value) {\n\t\t\t\tthis.element.classList.toggle(\"placeholder\", value);\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tget: function get(element, prioritizePrimitive) {\n\t\t\t\tvar scope = Wysie.Scope.all.get(element);\n\n\t\t\t\treturn prioritizePrimitive || !scope ? Wysie.Primitive.all.get(element) : scope;\n\t\t\t},\n\n\t\t\tcreate: function create(element, wysie) {\n\t\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\t\tif (!element || !wysie) {\n\t\t\t\t\tthrow new TypeError(\"Wysie.Unit.create() requires an element argument and a wysie object\");\n\t\t\t\t}\n\n\t\t\t\treturn new Wysie[Wysie.is(\"scope\", element) ? \"Scope\" : \"Primitive\"](element, wysie, o);\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Expression = $.Class({\n\t\tconstructor: function constructor(expression) {\n\t\t\tthis.expression = expression;\n\t\t},\n\n\t\teval: function _eval(data) {\n\t\t\tthis.oldValue = this.value;\n\n\t\t\t// TODO convert to new Function() which is more optimizable by JS engines.\n\t\t\t// Also, cache the function, since only data changes across invocations.\n\t\t\tWysie.hooks.run(\"expression-eval-beforeeval\", this);\n\n\t\t\ttry {\n\t\t\t\tif (!this.function) {\n\t\t\t\t\tthis.function = this.createFunction();\n\t\t\t\t}\n\n\t\t\t\tthis.value = this.function(data);\n\t\t\t} catch (exception) {\n\t\t\t\tWysie.hooks.run(\"expression-eval-error\", { context: this, exception: exception });\n\n\t\t\t\tthis.value = _.ERROR;\n\t\t\t}\n\n\t\t\treturn this.value;\n\t\t},\n\n\t\ttoString: function toString() {\n\t\t\treturn \"=(\" + this.expression + \")\";\n\t\t},\n\n\n\t\tcreateFunction: function createFunction() {\n\t\t\tvar code = this.expression;\n\n\t\t\tif (/^if\\([\\S\\s]+\\)$/i.test(code)) {\n\t\t\t\tcode = code.replace(/^if\\(/, \"iff(\");\n\t\t\t}\n\n\t\t\t// Transform simple operators to array-friendly math functions\n\t\t\tcode = code.replace(_.simpleOperation, function (expr, operand1, operator, operand2) {\n\t\t\t\tvar ret = \"(\" + Wysie.Functions.operators[operator] + \"(\" + operand1 + \", \" + operand2 + \"))\";\n\t\t\t\treturn ret;\n\t\t\t});\n\n\t\t\t_.simpleOperation.lastIndex = 0;\n\n\t\t\treturn new Function(\"data\", \"with(Wysie.Functions._Trap)\\n\\t\\t\\t\\twith(data) {\\n\\t\\t\\t\\t\\treturn \" + code + \";\\n\\t\\t\\t\\t}\");\n\t\t},\n\n\t\tlive: {\n\t\t\texpression: function expression(value) {\n\t\t\t\tvar code = value = value.trim();\n\n\t\t\t\tthis.function = null;\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tERROR: \"N/A\",\n\n\t\t\tlazy: {\n\t\t\t\tsimpleOperation: function simpleOperation() {\n\t\t\t\t\tvar operator = Object.keys(Wysie.Functions.operators).map(function (o) {\n\t\t\t\t\t\treturn o.replace(/[|*+]/g, \"\\\\$&\");\n\t\t\t\t\t}).join(\"|\");\n\t\t\t\t\tvar operand = \"\\\\s*(\\\\b[\\\\w.]+\\\\b)\\\\s*\";\n\n\t\t\t\t\treturn RegExp(\"(?:^|\\\\()\" + operand + \"(\" + operator + \")\" + operand + \"(?:$|\\\\))\", \"g\");\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\t(function () {\n\n\t\tvar _ = Wysie.Expression.Text = $.Class({\n\t\t\tconstructor: function constructor(o) {\n\t\t\t\tthis.all = o.all; // the Wysie.Expressions object that this belongs to\n\t\t\t\tthis.node = o.node;\n\t\t\t\tthis.path = o.path;\n\n\t\t\t\tif (!this.node) {\n\t\t\t\t\t// No node provided, figure it out from path\n\t\t\t\t\tthis.node = this.path.reduce(function (node, index) {\n\t\t\t\t\t\treturn node.childNodes[index];\n\t\t\t\t\t}, this.all.scope.element);\n\t\t\t\t}\n\n\t\t\t\tthis.element = this.node;\n\n\t\t\t\tthis.attribute = o.attribute || null;\n\n\t\t\t\tif (this.node.nodeType === 3) {\n\t\t\t\t\tthis.element = this.node.parentNode;\n\n\t\t\t\t\t// If no element siblings make this.node the element, which is more robust\n\t\t\t\t\t// Same if attribute, there are no attributes on a text node!\n\t\t\t\t\tif (!this.node.parentNode.children.length || this.attribute) {\n\t\t\t\t\t\tthis.node = this.element;\n\t\t\t\t\t\tthis.element.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.expression = this.text.trim();\n\t\t\t\tthis.template = this.tokenize(this.expression);\n\n\t\t\t\tWysie.hooks.run(\"expressiontext-init-end\", this);\n\n\t\t\t\t_.elements.set(this.element, [].concat(_toConsumableArray(_.elements.get(this.element) || []), [this]));\n\t\t\t},\n\n\t\t\tget text() {\n\t\t\t\treturn this.attribute ? this.node.getAttribute(this.attribute) : this.node.textContent;\n\t\t\t},\n\n\t\t\tset text(value) {\n\t\t\t\tthis.oldText = this.text;\n\n\t\t\t\tWysie.Primitive.setValue(this.node, value, this.attribute);\n\t\t\t},\n\n\t\t\tupdate: function update(data) {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tthis.value = [];\n\t\t\t\tthis.data = data;\n\n\t\t\t\tthis.text = this.template.map(function (expr) {\n\t\t\t\t\tif (expr instanceof Wysie.Expression) {\n\t\t\t\t\t\tvar env = { context: _this14, expr: expr };\n\n\t\t\t\t\t\tWysie.hooks.run(\"expressiontext-update-beforeeval\", env);\n\n\t\t\t\t\t\tenv.value = env.expr.eval(data);\n\n\t\t\t\t\t\tWysie.hooks.run(\"expressiontext-update-aftereval\", env);\n\n\t\t\t\t\t\tif (env.value === undefined || env.value === null) {\n\t\t\t\t\t\t\t// Dont print things like \"undefined\" or \"null\"\n\t\t\t\t\t\t\t_this14.value.push(\"\");\n\t\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this14.value.push(env.value);\n\n\t\t\t\t\t\tif (typeof env.value === \"number\" && !_this14.attribute) {\n\t\t\t\t\t\t\tenv.value = _.formatNumber(env.value);\n\t\t\t\t\t\t} else if (Array.isArray(env.value)) {\n\t\t\t\t\t\t\tenv.value = env.value.join(\", \");\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn env.value;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this14.value.push(expr);\n\t\t\t\t\treturn expr;\n\t\t\t\t}).join(\"\");\n\n\t\t\t\tif (this.primitive) {\n\t\t\t\t\tif (this.template.length === 1 && typeof this.value[0] === \"number\") {\n\t\t\t\t\t\tthis.primitive.datatype = \"number\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.value = this.value.join(\"\");\n\n\t\t\t\tif (this.primitive) {\n\t\t\t\t\tif (!this.attribute) {\n\t\t\t\t\t\tWysie.Primitive.setValue(this.element, this.value, \"content\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ttokenize: function tokenize(template) {\n\t\t\t\tvar regex = this.expressionRegex;\n\t\t\t\tvar match,\n\t\t\t\t    ret = [],\n\t\t\t\t    lastIndex = 0;\n\n\t\t\t\tregex.lastIndex = 0;\n\n\t\t\t\twhile ((match = regex.exec(template)) !== null) {\n\t\t\t\t\t// Literal before the expression\n\t\t\t\t\tif (match.index > lastIndex) {\n\t\t\t\t\t\tret.push(template.substring(lastIndex, match.index));\n\t\t\t\t\t}\n\n\t\t\t\t\tlastIndex = regex.lastIndex = _.findEnd(template.slice(match.index)) + match.index + 1;\n\t\t\t\t\tvar expression = template.slice(match.index + 1, lastIndex - 1);\n\n\t\t\t\t\tret.push(new Wysie.Expression(expression));\n\t\t\t\t}\n\n\t\t\t\t// Literal at the end\n\t\t\t\tif (lastIndex < template.length) {\n\t\t\t\t\tret.push(template.substring(lastIndex));\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tlazy: {},\n\n\t\t\tproxy: {\n\t\t\t\tscope: \"all\",\n\t\t\t\texpressionRegex: \"all\"\n\t\t\t},\n\n\t\t\tstatic: {\n\t\t\t\telements: new WeakMap(),\n\n\t\t\t\t// Find where a ( or [ or { ends.\n\t\t\t\tfindEnd: function findEnd(expr) {\n\t\t\t\t\tvar stack = [];\n\t\t\t\t\tvar inside,\n\t\t\t\t\t    insides = \"\\\"'`\";\n\t\t\t\t\tvar open = \"([{\",\n\t\t\t\t\t    close = \")]}\";\n\t\t\t\t\tvar isEscape;\n\n\t\t\t\t\tfor (var i = 0; expr[i]; i++) {\n\t\t\t\t\t\tvar char = expr[i];\n\n\t\t\t\t\t\tif (inside) {\n\t\t\t\t\t\t\tif (char === inside && !isEscape) {\n\t\t\t\t\t\t\t\tinside = \"\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (!isEscape && insides.indexOf(char) > -1) {\n\t\t\t\t\t\t\tinside = char;\n\t\t\t\t\t\t} else if (open.indexOf(char) > -1) {\n\t\t\t\t\t\t\tstack.push(char);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar peek = stack[stack.length - 1];\n\n\t\t\t\t\t\t\tif (char === close[open.indexOf(peek)]) {\n\t\t\t\t\t\t\t\tstack.pop();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (stack.length === 0) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tisEscape = char == \"\\\\\";\n\t\t\t\t\t}\n\n\t\t\t\t\treturn i;\n\t\t\t\t},\n\n\t\t\t\tlazy: {\n\t\t\t\t\tformatNumber: function formatNumber() {\n\t\t\t\t\t\tvar numberFormat = new Intl.NumberFormat(\"en-US\", { maximumFractionDigits: 2 });\n\n\t\t\t\t\t\treturn function (value) {\n\t\t\t\t\t\t\tif (value === Infinity || value === -Infinity) {\n\t\t\t\t\t\t\t\t// Pretty print infinity\n\t\t\t\t\t\t\t\treturn value < 0 ? \"-\" : \"\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn numberFormat.format(value);\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\n\t\t\t\t\trootFunctionRegExp: function rootFunctionRegExp() {\n\t\t\t\t\t\treturn RegExp(\"^=\\\\s*(?:\" + Wysie.Expressions.rootFunctions.join(\"|\") + \")\\\\($\", \"i\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t})();\n\n\t(function () {\n\n\t\tvar _ = Wysie.Expressions = $.Class({\n\t\t\tconstructor: function constructor(scope) {\n\t\t\t\tvar _this15 = this;\n\n\t\t\t\tif (scope) {\n\t\t\t\t\tthis.scope = scope;\n\t\t\t\t\tthis.scope.expressions = this;\n\t\t\t\t}\n\n\t\t\t\tthis.all = []; // all Expression.Text objects in this scope\n\n\t\t\t\tWysie.hooks.run(\"expressions-init-start\", this);\n\n\t\t\t\tif (this.scope) {\n\t\t\t\t\tvar template = this.scope.template;\n\t\t\t\t\tif (template && template.expressions) {\n\t\t\t\t\t\t// We know which expressions we have, don't traverse again\n\t\t\t\t\t\ttemplate.expressions.all.forEach(function (et) {\n\t\t\t\t\t\t\t_this15.all.push(new Wysie.Expression.Text({\n\t\t\t\t\t\t\t\tpath: et.path,\n\t\t\t\t\t\t\t\tattribute: et.attribute,\n\t\t\t\t\t\t\t\tall: _this15\n\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.traverse();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// TODO less stupid name?\n\t\t\t\tthis.updateAlso = new Set();\n\n\t\t\t\tthis.active = true;\n\t\t\t},\n\n\t\t\tinit: function init() {\n\t\t\t\tvar _this16 = this;\n\n\t\t\t\tif (this.all.length > 0) {\n\t\t\t\t\tthis.lastUpdated = 0;\n\n\t\t\t\t\tthis.update();\n\n\t\t\t\t\t// Watch changes and update value\n\t\t\t\t\tthis.scope.element.addEventListener(\"wysie:datachange\", function (evt) {\n\t\t\t\t\t\treturn _this16.update();\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    * Update all expressions in this scope\n    */\n\t\t\tupdate: function callee() {\n\t\t\t\tif (!this.active || this.scope.isDeleted()) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar env = { context: this, data: this.scope.getRelativeData() };\n\n\t\t\t\tWysie.hooks.run(\"expressions-update-start\", env);\n\n\t\t\t\t$$(this.all).forEach(function (ref) {\n\t\t\t\t\tref.update(env.data);\n\t\t\t\t});\n\n\t\t\t\tthis.updateAlso.forEach(function (exp) {\n\t\t\t\t\treturn exp.update();\n\t\t\t\t});\n\t\t\t},\n\n\t\t\textract: function extract(node, attribute, path) {\n\t\t\t\tthis.expressionRegex.lastIndex = 0;\n\n\t\t\t\tif (this.expressionRegex.test(attribute ? attribute.value : node.textContent)) {\n\t\t\t\t\tthis.all.push(new Wysie.Expression.Text({\n\t\t\t\t\t\tnode: node,\n\t\t\t\t\t\tpath: (path || \"\").slice(1).split(\"/\").map(function (i) {\n\t\t\t\t\t\t\treturn +i;\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tattribute: attribute && attribute.name,\n\t\t\t\t\t\tall: this\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// Traverse an element, including attribute nodes, text nodes and all descendants\n\t\t\ttraverse: function traverse(node, path) {\n\t\t\t\tvar _this17 = this;\n\n\t\t\t\tnode = node || this.scope.element;\n\t\t\t\tpath = path || \"\";\n\n\t\t\t\tif (node.matches && node.matches(_.escape)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (node.nodeType === 3) {\n\t\t\t\t\t// Text node\n\t\t\t\t\t// Leaf node, extract references from content\n\t\t\t\t\tthis.extract(node, null, path);\n\t\t\t\t}\n\n\t\t\t\t// Traverse children and attributes as long as this is NOT the root of a child scope\n\t\t\t\t// (otherwise, it will be taken care of its own Expressions object)\n\t\t\t\tif (node == this.scope.element || !Wysie.is(\"scope\", node)) {\n\t\t\t\t\t$$(node.attributes).forEach(function (attribute) {\n\t\t\t\t\t\treturn _this17.extract(node, attribute, path);\n\t\t\t\t\t});\n\t\t\t\t\t$$(node.childNodes).forEach(function (child, i) {\n\t\t\t\t\t\treturn _this17.traverse(child, path + \"/\" + i);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tlazy: {\n\t\t\t\t// Regex that loosely matches all possible expressions\n\t\t\t\t// False positives are ok, but false negatives are not.\n\t\t\t\texpressionRegex: function expressionRegex() {\n\t\t\t\t\tvar properties = this.scope.wysie.propertyNames.concat(_.special);\n\t\t\t\t\tvar propertyRegex = \"(?:\" + properties.join(\"|\").replace(/\\$/g, \"\\\\$\") + \")\";\n\n\t\t\t\t\treturn RegExp(\"\\\\[[\\\\S\\\\s]*?\" + propertyRegex + \"[\\\\S\\\\s]*?\\\\]\", \"gi\");\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tstatic: {\n\t\t\t\tescape: \".ignore-expressions\",\n\n\t\t\t\t// Special property names\n\t\t\t\tspecial: [\"$index\"],\n\n\t\t\t\tlazy: {\n\t\t\t\t\trootFunctions: function rootFunctions() {\n\t\t\t\t\t\treturn [].concat(_toConsumableArray(Object.keys(Wysie.Functions)), _toConsumableArray(Object.getOwnPropertyNames(Math)), [\"if\", \"\"]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t})();\n\n\tWysie.hooks.add(\"scope-init-start\", function () {\n\t\tnew Wysie.Expressions(this);\n\t});\n\n\tWysie.hooks.add(\"scope-init-end\", function () {\n\t\tthis.expressions.init();\n\t});\n})(Bliss, Bliss.$);\n\n/**\n * Functions available inside Wysie expressions\n */\n\n(function () {\n\n\tvar _ = Wysie.Functions = {\n\t\toperators: {},\n\n\t\t/**\n   * Aggregate sum\n   */\n\t\tsum: function sum(array) {\n\t\t\treturn numbers(array, arguments).reduce(function (prev, current) {\n\t\t\t\treturn +prev + (+current || 0);\n\t\t\t}, 0);\n\t\t},\n\n\t\t/**\n   * Average of an array of numbers\n   */\n\t\taverage: function average(array) {\n\t\t\tarray = numbers(array, arguments);\n\n\t\t\treturn array.length && _.sum(array) / array.length;\n\t\t},\n\n\t\t/**\n   * Min of an array of numbers\n   */\n\t\tmin: function min(array) {\n\t\t\tvar _Math;\n\n\t\t\treturn (_Math = Math).min.apply(_Math, _toConsumableArray(numbers(array, arguments)));\n\t\t},\n\n\t\t/**\n   * Max of an array of numbers\n   */\n\t\tmax: function max(array) {\n\t\t\tvar _Math2;\n\n\t\t\treturn (_Math2 = Math).max.apply(_Math2, _toConsumableArray(numbers(array, arguments)));\n\t\t},\n\n\t\tcount: function count(array) {\n\t\t\treturn Wysie.toArray(array).filter(function (a) {\n\t\t\t\treturn a !== null && a !== false;\n\t\t\t}).length;\n\t\t},\n\n\t\tround: function round(num, decimals) {\n\t\t\tif (!num || !decimals || !isFinite(num)) {\n\t\t\t\treturn Math.round(num);\n\t\t\t}\n\n\t\t\treturn +num.toLocaleString(\"en-US\", {\n\t\t\t\tuseGrouping: false,\n\t\t\t\tmaximumFractionDigits: decimals\n\t\t\t});\n\t\t},\n\n\t\tiff: function iff(condition, iftrue) {\n\t\t\tvar iffalse = arguments.length <= 2 || arguments[2] === undefined ? \"\" : arguments[2];\n\n\t\t\treturn condition ? iftrue : iffalse;\n\t\t}\n\t};\n\n\t/**\n  * Addition for elements and scalars.\n  * Addition between arrays happens element-wise.\n  * Addition between scalars returns their scalar sum (same as +)\n  * Addition between a scalar and an array will result in the scalar being added to every array element.\n  * Ordered by precedence (higher to lower)\n  */\n\toperator(\"not\", function (a) {\n\t\treturn function (a) {\n\t\t\treturn !a;\n\t\t};\n\t});\n\toperator(\"multiply\", function (a, b) {\n\t\treturn a * b;\n\t}, { identity: 1, symbol: \"*\" });\n\toperator(\"divide\", function (a, b) {\n\t\treturn a / b;\n\t}, { identity: 1, symbol: \"/\" });\n\toperator(\"add\", function (a, b) {\n\t\treturn +a + +b;\n\t}, { symbol: \"+\" });\n\toperator(\"subtract\", function (a, b) {\n\t\treturn a - b;\n\t}, { symbol: \"-\" });\n\toperator(\"lte\", function (a, b) {\n\t\treturn a <= b;\n\t}, { symbol: \"<=\" });\n\toperator(\"lt\", function (a, b) {\n\t\treturn a < b;\n\t}, { symbol: \"<\" });\n\toperator(\"gte\", function (a, b) {\n\t\treturn a >= b;\n\t}, { symbol: \">=\" });\n\toperator(\"gt\", function (a, b) {\n\t\treturn a > b;\n\t}, { symbol: \">\" });\n\toperator(\"eq\", function (a, b) {\n\t\treturn a == b;\n\t}, { symbol: \"==\" });\n\toperator(\"and\", function (a, b) {\n\t\treturn !!a && !!b;\n\t}, { identity: true, symbol: \"&&\" });\n\toperator(\"or\", function (a, b) {\n\t\treturn !!a || !!b;\n\t}, { identity: false, symbol: \"||\" });\n\n\tvar aliases = {\n\t\taverage: \"avg\",\n\t\tiff: \"iff IF\",\n\t\tsubtract: \"minus\",\n\t\tmultiply: \"mult product\",\n\t\tdivide: \"div\",\n\t\tlt: \"lessThan smaller\",\n\t\tgt: \"moreThan greater greaterThan bigger\",\n\t\teq: \"equal equality\"\n\t};\n\n\tfor (name in aliases) {\n\t\taliases[name].split(/\\s+/g).forEach(function (alias) {\n\t\t\treturn _[alias] = _[name];\n\t\t});\n\t}\n\n\t// Make function names case insensitive\n\tWysie.Functions._Trap = self.Proxy ? new Proxy(_, {\n\t\tget: function get(functions, property) {\n\t\t\tif (property in functions) {\n\t\t\t\treturn functions[property];\n\t\t\t}\n\n\t\t\tvar propertyL = property.toLowerCase && property.toLowerCase();\n\n\t\t\tif (propertyL && functions.hasOwnProperty(propertyL)) {\n\t\t\t\treturn functions[propertyL];\n\t\t\t}\n\n\t\t\tif (property in Math || propertyL in Math) {\n\t\t\t\treturn Math[property] || Math[propertyL];\n\t\t\t}\n\n\t\t\tif (property in self) {\n\t\t\t\treturn self[property];\n\t\t\t}\n\n\t\t\t// Prevent undefined at all costs\n\t\t\treturn property;\n\t\t},\n\n\t\t// Super ugly hack, but otherwise data is not\n\t\t// the local variable it should be, but the string \"data\"\n\t\t// so all property lookups fail.\n\t\thas: function has(functions, property) {\n\t\t\treturn property != \"data\";\n\t\t}\n\t}) : Wysie.Functions;\n\n\t/**\n  * Private helper methods\n  */\n\tfunction numbers(array, args) {\n\t\tarray = Array.isArray(array) ? array : args ? $$(args) : [array];\n\n\t\treturn array.filter(function (number) {\n\t\t\treturn !isNaN(number);\n\t\t}).map(function (n) {\n\t\t\treturn +n;\n\t\t});\n\t}\n\n\t/**\n  * Extend a scalar operator to arrays, or arrays and scalars\n  * The operation between arrays is applied element-wise.\n  * The operation operation between a scalar and an array will result in\n  * the operation being applied between the scalar and every array element.\n  * @param op {Function} The operation between two scalars\n  * @param identity The operations identity element. Defaults to 0.\n  */\n\tfunction operator(name, op) {\n\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\tif (op.length < 2) {\n\t\t\t// Unary operator\n\t\t\treturn function (operand) {\n\t\t\t\treturn Array.isArray(operand) ? operand.map(op) : op(operand);\n\t\t\t};\n\t\t}\n\n\t\tif (o.symbol) {\n\t\t\t_.operators[o.symbol] = name;\n\t\t}\n\n\t\treturn _[name] = function () {\n\t\t\tfor (var _len2 = arguments.length, operands = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n\t\t\t\toperands[_key2] = arguments[_key2];\n\t\t\t}\n\n\t\t\tif (operands.length === 1) {\n\t\t\t\toperands = [].concat(_toConsumableArray(operands), [o.identity]);\n\t\t\t}\n\n\t\t\treturn operands.reduce(function (a, b) {\n\t\t\t\tif (Array.isArray(b)) {\n\t\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\t\tb = numbers(b);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\treturn [].concat(_toConsumableArray(b.map(function (n, i) {\n\t\t\t\t\t\t\treturn op(a[i] === undefined ? o.identity : a[i], n);\n\t\t\t\t\t\t})), _toConsumableArray(a.slice(b.length)));\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn b.map(function (n) {\n\t\t\t\t\t\t\treturn op(a, n);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Operand is scalar\n\t\t\t\t\tif (typeof o.identity == \"number\") {\n\t\t\t\t\t\tb = +b;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (Array.isArray(a)) {\n\t\t\t\t\t\treturn a.map(function (n) {\n\t\t\t\t\t\t\treturn op(n, b);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn op(a, b);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\t}\n})();\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Scope = $.Class({\n\t\textends: Wysie.Unit,\n\t\tconstructor: function constructor(element, wysie, o) {\n\t\t\tvar _this18 = this;\n\n\t\t\tthis.properties = {};\n\n\t\t\tthis.scope = this;\n\n\t\t\tWysie.hooks.run(\"scope-init-start\", this);\n\n\t\t\t// Should this element also create a primitive?\n\t\t\tif (Wysie.Primitive.getValueAttribute(this.element)) {\n\t\t\t\tvar obj = this.properties[this.property] = new Wysie.Primitive(this.element, this.wysie);\n\t\t\t\tobj.scope = obj.parentScope = this;\n\t\t\t}\n\n\t\t\t// Create Wysie objects for all properties in this scope (primitives or scopes),\n\t\t\t// but not properties in descendant scopes (they will be handled by their scope)\n\t\t\t$$(Wysie.selectors.property, this.element).forEach(function (element) {\n\t\t\t\tvar property = element.getAttribute(\"property\");\n\n\t\t\t\tif (_this18.contains(element)) {\n\t\t\t\t\tvar existing = _this18.properties[property];\n\t\t\t\t\tvar template = _this18.template ? _this18.template.properties[property] : null;\n\n\t\t\t\t\tif (existing) {\n\t\t\t\t\t\t// Two scopes with the same property, convert to static collection\n\t\t\t\t\t\tvar collection = existing;\n\n\t\t\t\t\t\tif (!(existing instanceof Wysie.Collection)) {\n\t\t\t\t\t\t\tcollection = new Wysie.Collection(existing.element, _this18.wysie, { template: template });\n\t\t\t\t\t\t\tcollection.parentScope = _this18;\n\t\t\t\t\t\t\t_this18.properties[property] = existing.collection = collection;\n\t\t\t\t\t\t\tcollection.add(existing);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!collection.mutable && Wysie.is(\"multiple\", element)) {\n\t\t\t\t\t\t\tcollection.mutable = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tcollection.add(element);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// No existing properties with this id, normal case\n\t\t\t\t\t\tvar obj = Wysie.Node.create(element, _this18.wysie, { template: template });\n\t\t\t\t\t\tobj.scope = obj instanceof _ ? obj : _this18;\n\n\t\t\t\t\t\tobj.parentScope = _this18;\n\t\t\t\t\t\t_this18.properties[property] = obj;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tWysie.hooks.run(\"scope-init-end\", this);\n\t\t},\n\n\t\tget propertyNames() {\n\t\t\treturn Object.keys(this.properties);\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar ret = this.super.getData.call(this, o);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tret = {};\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\tif ((!obj.computed || o.computed) && !(obj.property in ret)) {\n\t\t\t\t\tvar data = obj.getData(o);\n\n\t\t\t\t\tif (data !== null || o.null) {\n\t\t\t\t\t\tret[obj.property] = data;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!o.dirty) {\n\t\t\t\t$.extend(ret, this.unhandled);\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\t/**\n   * Search entire subtree for property, return relative value\n   * @return {Wysie.Unit}\n   */\n\t\tfind: function find(property) {\n\t\t\tif (this.property == property) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tif (property in this.properties) {\n\t\t\t\treturn this.properties[property].find(property);\n\t\t\t}\n\n\t\t\tfor (var prop in this.properties) {\n\t\t\t\tvar ret = this.properties[prop].find(property);\n\n\t\t\t\tif (ret !== undefined) {\n\t\t\t\t\treturn ret;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tpropagate: function propagate(callback) {\n\t\t\tvar _arguments = arguments;\n\n\t\t\t$.each(this.properties, function (property, obj) {\n\t\t\t\tobj.call.apply(obj, _arguments);\n\t\t\t});\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tif (this.placeholder) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.everSaved = true;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tdone: function done() {\n\t\t\t$.unbind(this.element, \".wysie:edit\");\n\t\t},\n\n\t\timport: function _import() {\n\t\t\tthis.everSaved = true;\n\t\t},\n\n\t\tpropagated: [\"save\", \"done\", \"import\", \"clear\"],\n\n\t\t// Inject data in this element\n\t\trender: function render(data) {\n\t\t\tvar _this19 = this;\n\n\t\t\tif (!data) {\n\t\t\t\tthis.clear();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.expressions.active = false;\n\n\t\t\tdata = data.isArray ? data[0] : data;\n\n\t\t\t// TODO what if it was a primitive and now it's a scope?\n\t\t\t// In that case, render the this.properties[this.property] with it\n\n\t\t\tthis.unhandled = $.extend({}, data, function (property) {\n\t\t\t\treturn !(property in _this19.properties);\n\t\t\t});\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\tobj.render(data[obj.property]);\n\t\t\t});\n\n\t\t\tthis.save();\n\n\t\t\trequestAnimationFrame(function () {\n\t\t\t\t_this19.expressions.active = true;\n\t\t\t\t_this19.expressions.update();\n\t\t\t});\n\t\t},\n\n\t\t// Check if this scope contains a property\n\t\t// property can be either a Wysie.Unit or a Node\n\t\tcontains: function contains(property) {\n\t\t\tif (property instanceof Wysie.Unit) {\n\t\t\t\treturn property.parentScope === this;\n\t\t\t}\n\n\t\t\treturn property.parentNode && this.element === property.parentNode.closest(Wysie.selectors.scope);\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: new WeakMap(),\n\n\t\t\tnormalize: function normalize(element) {\n\t\t\t\t// Get & normalize typeof name, if exists\n\t\t\t\tif (Wysie.is(\"scope\", element)) {\n\t\t\t\t\tvar type = element.getAttribute(\"typeof\") || element.getAttribute(\"itemtype\") || \"Item\";\n\n\t\t\t\t\telement.setAttribute(\"typeof\", type);\n\n\t\t\t\t\treturn type;\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Primitive = $.Class({\n\t\textends: Wysie.Unit,\n\t\tconstructor: function constructor(element, wysie, o) {\n\t\t\tvar _this20 = this;\n\n\t\t\tif (this.template) {\n\t\t\t\t$.extend(this, this.template, [\"attribute\", \"datatype\", \"humanReadable\"]);\n\t\t\t} else {\n\t\t\t\t// Which attribute holds the data, if any?\n\t\t\t\t// \"null\" or null for none (i.e. data is in content).\n\t\t\t\tthis.attribute = _.getValueAttribute(this.element);\n\n\t\t\t\tif (this.attribute) {\n\t\t\t\t\tthis.humanReadable = this.attribute.humanReadable;\n\t\t\t\t} else {\n\t\t\t\t\tthis.element.normalize();\n\t\t\t\t}\n\n\t\t\t\tthis.datatype = _.getDatatype(this.element, this.attribute);\n\t\t\t}\n\n\t\t\t// Primitives containing an expression as their value are implicitly computed\n\t\t\tvar expressions = Wysie.Expression.Text.elements.get(this.element);\n\t\t\tvar expressionText = expressions && expressions.filter(function (e) {\n\t\t\t\treturn e.attribute == _this20.attribute;\n\t\t\t})[0];\n\n\t\t\tif (expressionText) {\n\t\t\t\texpressionText.primitive = this;\n\t\t\t\tthis.computed = true;\n\t\t\t}\n\n\t\t\t/**\n    * Set up input widget\n    */\n\n\t\t\t// Exposed widgets (visible always)\n\t\t\tif (Wysie.is(\"formControl\", this.element)) {\n\t\t\t\tthis.editor = this.element;\n\n\t\t\t\tthis.edit();\n\t\t\t}\n\t\t\t// Nested widgets\n\t\t\telse if (!this.editor) {\n\n\t\t\t\t\tthis.editor = $$(this.element.children).filter(function (el) {\n\t\t\t\t\t\treturn el.matches(Wysie.selectors.formControl) && !el.matches(Wysie.selectors.property);\n\t\t\t\t\t})[0];\n\n\t\t\t\t\t$.remove(this.editor);\n\t\t\t\t}\n\n\t\t\tif (!this.exposed && !this.computed) {\n\t\t\t\tthis.wysie.needsEdit = true;\n\t\t\t}\n\n\t\t\tthis.default = this.element.getAttribute(\"data-default\");\n\n\t\t\t// Observe future mutations to this property, if possible\n\t\t\t// Properties like input.checked or input.value cannot be observed that way\n\t\t\t// so we cannot depend on mutation observers for everything :(\n\t\t\tthis.observer = Wysie.observe(this.element, this.attribute, function (record) {\n\t\t\t\tif (_this20.attribute || !_this20.wysie.editing || _this20.computed) {\n\t\t\t\t\t_this20.value = _this20.getValue();\n\t\t\t\t}\n\t\t\t}, true);\n\n\t\t\tthis.templateValue = this.getValue();\n\n\t\t\tif (this.computed || this.default === \"\") {\n\t\t\t\t// attribute exists, no value, default is template value\n\t\t\t\tthis.default = this.templateValue;\n\t\t\t} else {\n\t\t\t\tif (this.default === null) {\n\t\t\t\t\t// attribute does not exist\n\t\t\t\t\tthis.default = this.editor ? this.editorValue : this.emptyValue;\n\t\t\t\t}\n\n\t\t\t\tthis.value = this.default;\n\t\t\t}\n\n\t\t\tif (this.collection) {\n\t\t\t\t// Collection of primitives, deal with setting textContent etc without the UI interfering.\n\t\t\t\tvar swapUI = function swapUI(callback) {\n\t\t\t\t\t_this20.unobserve();\n\t\t\t\t\tvar ui = $.remove($(Wysie.selectors.ui, _this20.element));\n\n\t\t\t\t\tvar ret = callback();\n\n\t\t\t\t\t$.inside(ui, _this20.element);\n\t\t\t\t\t_this20.observe();\n\n\t\t\t\t\treturn ret;\n\t\t\t\t};\n\n\t\t\t\t// Intercept certain properties so that any Wysie UI inside this primitive will not be destroyed\n\t\t\t\t[\"textContent\", \"innerHTML\"].forEach(function (property) {\n\t\t\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, property);\n\n\t\t\t\t\tObject.defineProperty(_this20.element, property, {\n\t\t\t\t\t\tget: function get() {\n\t\t\t\t\t\t\tvar _this21 = this;\n\n\t\t\t\t\t\t\treturn swapUI(function () {\n\t\t\t\t\t\t\t\treturn descriptor.get.call(_this21);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\n\t\t\t\t\t\tset: function set(value) {\n\t\t\t\t\t\t\tvar _this22 = this;\n\n\t\t\t\t\t\t\tswapUI(function () {\n\t\t\t\t\t\t\t\treturn descriptor.set.call(_this22, value);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.initialized = true;\n\n\t\t\tthis.value = this.getValue();\n\t\t},\n\n\t\tget editorValue() {\n\t\t\tif (this.editor) {\n\t\t\t\tif (this.editor.matches(Wysie.selectors.formControl)) {\n\t\t\t\t\treturn _.getValue(this.editor, undefined, this.datatype);\n\t\t\t\t}\n\n\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\tvar output = $(Wysie.selectors.output + \", \" + Wysie.selectors.formControl, this.editor);\n\n\t\t\t\tif (output) {\n\t\t\t\t\treturn _.all.has(output) ? _.all.get(output).value : _.getValue(output);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tset editorValue(value) {\n\t\t\tif (this.editor) {\n\t\t\t\tif (this.editor.matches(Wysie.selectors.formControl)) {\n\t\t\t\t\t_.setValue(this.editor, value);\n\t\t\t\t} else {\n\t\t\t\t\t// if we're here, this.editor is an entire HTML structure\n\t\t\t\t\tvar output = $(Wysie.selectors.output + \", \" + Wysie.selectors.formControl, this.editor);\n\n\t\t\t\t\tif (output) {\n\t\t\t\t\t\tif (_.all.has(output)) {\n\t\t\t\t\t\t\t_.all.get(output).value = value;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_.setValue(output, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tget exposed() {\n\t\t\treturn this.editor === this.element;\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar ret = this.super.getData.call(this, o);\n\n\t\t\tif (ret !== undefined) {\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tvar ret = !o.dirty && !this.exposed ? this.savedValue : this.value;\n\n\t\t\tif (!o.dirty && ret === \"\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tupdate: function update() {\n\t\t\tvar value = _.getValue(this.element, this.attribute, this.datatype);\n\t\t\tvalue = value || value === 0 ? value : \"\";\n\n\t\t\tif (value == this.oldValue) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.value = value;\n\n\t\t\tthis.empty = value === \"\";\n\n\t\t\tif (this.humanReadable && this.attribute) {\n\t\t\t\tthis.element.textContent = this.humanReadable(value);\n\t\t\t}\n\n\t\t\tif (this.initialized) {\n\t\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\t\tproperty: this.property,\n\t\t\t\t\tvalue: value,\n\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\tnode: this,\n\t\t\t\t\tdirty: this.editing,\n\t\t\t\t\taction: \"propertychange\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tif (this.placeholder) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.savedValue = this.value;\n\t\t\tthis.everSaved = true;\n\t\t\tthis.unsavedChanges = false;\n\t\t},\n\n\t\tdone: function done() {\n\t\t\tthis.unobserve();\n\n\t\t\tif (this.popup) {\n\t\t\t\tthis.hidePopup();\n\t\t\t} else if (!this.attribute && !this.exposed && this.editing) {\n\t\t\t\t$.remove(this.editor);\n\t\t\t\tthis.element.textContent = this.editorValue;\n\t\t\t}\n\n\t\t\tif (!this.exposed) {\n\t\t\t\tthis.editing = false;\n\t\t\t}\n\n\t\t\t// Revert tabIndex\n\t\t\tif (this.element._.data.prevTabindex !== null) {\n\t\t\t\tthis.element.tabIndex = this.element._.data.prevTabindex;\n\t\t\t} else {\n\t\t\t\tthis.element.removeAttribute(\"tabindex\");\n\t\t\t}\n\n\t\t\tthis.element._.unbind(\".wysie:edit .wysie:preedit .wysie:showpopup\");\n\n\t\t\tthis.observe();\n\t\t},\n\n\t\trevert: function revert() {\n\t\t\tif (this.unsavedChanges && this.savedValue !== undefined) {\n\t\t\t\t// FIXME if we have a collection of properties (not scopes), this will cause\n\t\t\t\t// cancel to not remove new unsaved items\n\t\t\t\t// This should be fixed by handling this on the collection level.\n\t\t\t\tthis.value = this.savedValue;\n\t\t\t\tthis.unsavedChanges = false;\n\t\t\t}\n\t\t},\n\n\t\t// Prepare to be edited\n\t\t// Called when root edit button is pressed\n\t\tpreEdit: function preEdit() {\n\t\t\tvar _this23 = this;\n\n\t\t\tif (this.computed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Empty properties should become editable immediately\n\t\t\t// otherwise they could be invisible!\n\t\t\tif (this.empty && !this.attribute) {\n\t\t\t\tthis.edit();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar timer;\n\n\t\t\tthis.element._.events({\n\t\t\t\t// click is needed too because it works with the keyboard as well\n\t\t\t\t\"click.wysie:preedit\": function clickWysiePreedit(e) {\n\t\t\t\t\treturn _this23.edit();\n\t\t\t\t},\n\t\t\t\t\"focus.wysie:preedit\": function focusWysiePreedit(e) {\n\t\t\t\t\t_this23.edit();\n\n\t\t\t\t\tif (!_this23.popup) {\n\t\t\t\t\t\t_this23.editor.focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"click.wysie:edit\": function clickWysieEdit(evt) {\n\t\t\t\t\t// Prevent default actions while editing\n\t\t\t\t\t// e.g. following links etc\n\t\t\t\t\tif (!_this23.exposed) {\n\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!this.attribute) {\n\t\t\t\tthis.element._.events({\n\t\t\t\t\t\"mouseenter.wysie:preedit\": function mouseenterWysiePreedit(e) {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t\ttimer = setTimeout(function () {\n\t\t\t\t\t\t\treturn _this23.edit();\n\t\t\t\t\t\t}, 150);\n\t\t\t\t\t},\n\t\t\t\t\t\"mouseleave.wysie:preedit\": function mouseleaveWysiePreedit(e) {\n\t\t\t\t\t\tclearTimeout(timer);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// Make element focusable, so it can actually receive focus\n\t\t\tthis.element._.data.prevTabindex = this.element.getAttribute(\"tabindex\");\n\t\t\tthis.element.tabIndex = 0;\n\t\t},\n\n\t\t// Called only the first time this primitive is edited\n\t\tinitEdit: function initEdit() {\n\t\t\tvar _this24 = this;\n\n\t\t\t// Linked widgets\n\t\t\tif (this.element.hasAttribute(\"data-input\")) {\n\t\t\t\tvar selector = this.element.getAttribute(\"data-input\");\n\n\t\t\t\tif (selector) {\n\t\t\t\t\tthis.editor = $.clone($(selector));\n\n\t\t\t\t\tif (!Wysie.is(\"formControl\", this.editor)) {\n\t\t\t\t\t\tif ($(Wysie.selectors.output, this.editor)) {\n\t\t\t\t\t\t\t// has output element?\n\t\t\t\t\t\t\t// Process it as a wysie instance, so people can use references\n\t\t\t\t\t\t\tthis.editor.setAttribute(\"data-store\", \"none\");\n\t\t\t\t\t\t\tnew Wysie(this.editor);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.editor = null; // Cannot use this, sorry bro\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.editor) {\n\t\t\t\t// No editor provided, use default for element type\n\t\t\t\t// Find default editor for datatype\n\t\t\t\tvar editor = _.getMatch(this.element, _.editors);\n\n\t\t\t\tif (editor.create) {\n\t\t\t\t\t$.extend(this, editor, function (property) {\n\t\t\t\t\t\treturn property != \"create\";\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tvar create = editor.create || editor;\n\t\t\t\tthis.editor = $.create($.type(create) === \"function\" ? create.call(this) : create);\n\t\t\t\tthis.editorValue = this.value;\n\t\t\t}\n\n\t\t\tthis.editor._.events({\n\t\t\t\t\"input change\": function inputChange(evt) {\n\t\t\t\t\tvar unsavedChanges = _this24.wysie.unsavedChanges;\n\n\t\t\t\t\t_this24.value = _this24.editorValue;\n\n\t\t\t\t\t// Editing exposed elements outside edit mode is instantly saved\n\t\t\t\t\tif (_this24.exposed && !_this24.wysie.editing && // must not be in edit mode\n\t\t\t\t\t_this24.wysie.permissions.save && // must be able to save\n\t\t\t\t\t_this24.scope.everSaved // must not cause unsaved items to be saved\n\t\t\t\t\t) {\n\t\t\t\t\t\t\t// TODO what if change event never fires? What if user\n\t\t\t\t\t\t\t_this24.unsavedChanges = false;\n\t\t\t\t\t\t\t_this24.wysie.unsavedChanges = unsavedChanges;\n\n\t\t\t\t\t\t\t// Must not save too many times (e.g. not while dragging a slider)\n\t\t\t\t\t\t\tif (evt.type == \"change\") {\n\t\t\t\t\t\t\t\t_this24.save(); // Save current element\n\n\t\t\t\t\t\t\t\t// Dont call this.wysie.save() as it will save other fields too\n\t\t\t\t\t\t\t\t// We only want to save exposed controls, so save current status\n\t\t\t\t\t\t\t\t_this24.wysie.storage.save();\n\n\t\t\t\t\t\t\t\t// Are there any unsaved changes from other properties?\n\t\t\t\t\t\t\t\t_this24.wysie.unsavedChanges = _this24.wysie.calculateUnsavedChanges();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"focus\": function focus(evt) {\n\t\t\t\t\t_this24.editor.select && _this24.editor.select();\n\t\t\t\t},\n\t\t\t\t\"keyup\": function keyup(evt) {\n\t\t\t\t\tif (_this24.popup && evt.keyCode == 13 || evt.keyCode == 27) {\n\t\t\t\t\t\tif (_this24.popup.contains(document.activeElement)) {\n\t\t\t\t\t\t\t_this24.element.focus();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\t_this24.hidePopup();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"wysie:datachange\": function wysieDatachange(evt) {\n\t\t\t\t\tif (evt.property === \"output\") {\n\t\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\t\t$.fire(_this24.editor, \"input\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (\"placeholder\" in this.editor) {\n\t\t\t\tthis.editor.placeholder = \"(\" + this.label + \")\";\n\t\t\t}\n\n\t\t\tif (!this.exposed) {\n\t\t\t\t// Copy any data-input-* attributes from the element to the editor\n\t\t\t\tvar dataInput = /^data-input-/i;\n\t\t\t\t$$(this.element.attributes).forEach(function (attribute) {\n\t\t\t\t\tif (dataInput.test(attribute.name)) {\n\t\t\t\t\t\tthis.editor.setAttribute(attribute.name.replace(dataInput, \"\"), attribute.value);\n\t\t\t\t\t}\n\t\t\t\t}, this);\n\n\t\t\t\tif (this.attribute) {\n\t\t\t\t\t// Set up popup\n\t\t\t\t\tthis.element.classList.add(\"using-popup\");\n\n\t\t\t\t\tthis.popup = this.popup || $.create(\"div\", {\n\t\t\t\t\t\tclassName: \"wysie-popup\",\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tcontents: [this.label + \":\", this.editor]\n\t\t\t\t\t});\n\n\t\t\t\t\t// No point in having a dropdown in a popup\n\t\t\t\t\tif (this.editor.matches(\"select\")) {\n\t\t\t\t\t\tthis.editor.size = Math.min(10, this.editor.children.length);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Toggle popup events & methods\n\t\t\t\t\tvar hideCallback = function hideCallback(evt) {\n\t\t\t\t\t\tif (!_this24.popup.contains(evt.target) && !_this24.element.contains(evt.target)) {\n\t\t\t\t\t\t\t_this24.hidePopup();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.showPopup = function () {\n\t\t\t\t\t\t$.unbind([this.element, this.popup], \".wysie:showpopup\");\n\t\t\t\t\t\tthis.popup._.after(this.element);\n\n\t\t\t\t\t\tvar x = this.element.offsetLeft;\n\t\t\t\t\t\tvar y = this.element.offsetTop + this.element.offsetHeight;\n\n\t\t\t\t\t\t// TODO what if it doesnt fit?\n\t\t\t\t\t\tthis.popup._.style({ top: y + \"px\", left: x + \"px\" });\n\n\t\t\t\t\t\tthis.popup._.removeAttribute(\"hidden\"); // trigger transition\n\n\t\t\t\t\t\t$.events(document, \"focus click\", hideCallback, true);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.hidePopup = function () {\n\t\t\t\t\t\tvar _this25 = this;\n\n\t\t\t\t\t\t$.unbind(document, \"focus click\", hideCallback, true);\n\n\t\t\t\t\t\tthis.popup.setAttribute(\"hidden\", \"\"); // trigger transition\n\n\t\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\t\t$.remove(_this25.popup);\n\t\t\t\t\t\t}, 400); // TODO transition-duration could override this\n\n\t\t\t\t\t\t$.events(this.element, \"focus.wysie:showpopup click.wysie:showpopup\", function (evt) {\n\t\t\t\t\t\t\t_this25.showPopup();\n\t\t\t\t\t\t}, true);\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.popup) {\n\t\t\t\tthis.editor.classList.add(\"wysie-editor\");\n\t\t\t}\n\n\t\t\tthis.initEdit = null;\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tif (this.computed || this.editing) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.element._.unbind(\".wysie:preedit\");\n\n\t\t\tif (this.initEdit) {\n\t\t\t\tthis.initEdit();\n\t\t\t}\n\n\t\t\tif (this.popup) {\n\t\t\t\tthis.showPopup();\n\t\t\t}\n\n\t\t\tif (!this.attribute) {\n\t\t\t\tif (this.editor.parentNode != this.element && !this.exposed) {\n\t\t\t\t\tthis.editorValue = this.value;\n\t\t\t\t\tthis.element.textContent = \"\";\n\n\t\t\t\t\tif (!this.exposed) {\n\t\t\t\t\t\tthis.element.appendChild(this.editor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.editing = true;\n\t\t}, // edit\n\n\t\tclear: function clear() {\n\t\t\tthis.value = this.emptyValue;\n\t\t},\n\n\t\timport: function _import() {\n\t\t\tif (!this.computed) {\n\t\t\t\tthis.value = this.templateValue;\n\t\t\t}\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\tif (Array.isArray(data)) {\n\t\t\t\tdata = data[0]; // TODO what is gonna happen to the rest? Lost?\n\t\t\t}\n\n\t\t\tif ((typeof data === \"undefined\" ? \"undefined\" : _typeof(data)) === \"object\") {\n\t\t\t\tdata = data[this.property];\n\t\t\t}\n\n\t\t\tthis.value = data === undefined ? this.default : data;\n\n\t\t\tthis.save();\n\t\t},\n\n\t\tfind: function find(property) {\n\t\t\tif (this.property == property) {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t},\n\n\t\tobserve: function observe() {\n\t\t\tWysie.observe(this.element, this.attribute, this.observer);\n\t\t},\n\n\t\tunobserve: function unobserve() {\n\t\t\tthis.observer.disconnect();\n\t\t},\n\n\t\tgetValue: function getValue() {\n\t\t\treturn _.getValue(this.element, this.attribute, this.datatype);\n\t\t},\n\n\t\tlazy: {\n\t\t\tlabel: function label() {\n\t\t\t\treturn Wysie.readable(this.property);\n\t\t\t},\n\n\t\t\temptyValue: function emptyValue() {\n\t\t\t\tswitch (this.datatype) {\n\t\t\t\t\tcase \"boolean\":\n\t\t\t\t\t\treturn false;\n\t\t\t\t\tcase \"number\":\n\t\t\t\t\t\treturn 0;\n\t\t\t\t}\n\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tvalue: {\n\t\t\t\tget: function get() {\n\t\t\t\t\t// if (this.editing) {\n\t\t\t\t\t// \tvar ret = this.editorValue;\n\t\t\t\t\t//\n\t\t\t\t\t// \treturn ret === \"\"? null : ret;\n\t\t\t\t\t// }\n\t\t\t\t},\n\n\t\t\t\tset: function set(value) {\n\t\t\t\t\tvalue = value || value === 0 ? value : \"\";\n\t\t\t\t\tvalue = _.cast(value, this.datatype);\n\n\t\t\t\t\tif (value == this._value) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.editor) {\n\t\t\t\t\t\tthis.editorValue = value;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.editing || this.attribute) {\n\t\t\t\t\t\tif (this.datatype == \"number\" && !this.attribute) {\n\t\t\t\t\t\t\t_.setValue(this.element, value, \"content\", this.datatype);\n\t\t\t\t\t\t\t_.setValue(this.element, Wysie.Expression.Text.formatNumber(value), null, this.datatype);\n\t\t\t\t\t\t} else if (this.editor && this.editor.matches(\"select\")) {\n\t\t\t\t\t\t\tthis.editorValue = value;\n\t\t\t\t\t\t\t_.setValue(this.element, value, \"content\", this.datatype);\n\t\t\t\t\t\t\t_.setValue(this.element, this.editor.selectedOptions[0] ? this.editor.selectedOptions[0].textContent : value, this.attribute, this.datatype);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_.setValue(this.element, value, this.attribute, this.datatype);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.empty = value === \"\";\n\n\t\t\t\t\tif (this.humanReadable && this.attribute) {\n\t\t\t\t\t\tthis.element.textContent = this.humanReadable(value);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._value = value;\n\n\t\t\t\t\tthis.unsavedChanges = this.wysie.unsavedChanges = true;\n\n\t\t\t\t\t$.fire(this.element, \"wysie:datachange\", {\n\t\t\t\t\t\tproperty: this.property,\n\t\t\t\t\t\tvalue: value,\n\t\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\tdirty: this.editing,\n\t\t\t\t\t\taction: \"propertychange\"\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.oldValue = this.value;\n\n\t\t\t\t\treturn value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tempty: function empty(value) {\n\t\t\t\tvar hide = value && !this.exposed && !(this.attribute && $(Wysie.selectors.property, this.element));\n\t\t\t\tthis.element.classList.toggle(\"empty\", hide);\n\t\t\t},\n\n\t\t\tediting: function editing(value) {\n\t\t\t\tthis.element.classList.toggle(\"editing\", value);\n\t\t\t},\n\n\t\t\tcomputed: function computed(value) {\n\t\t\t\tthis.element.classList.toggle(\"computed\", value);\n\t\t\t},\n\n\t\t\tdatatype: function datatype(value) {\n\t\t\t\t// Purge caches if datatype changes\n\t\t\t\tif (_.getValue.cache) {\n\t\t\t\t\t_.getValue.cache.delete(this.element);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tstatic: {\n\t\t\tall: new WeakMap(),\n\n\t\t\tgetMatch: function getMatch(element, all) {\n\t\t\t\t// TODO specificity\n\t\t\t\tvar ret = null;\n\n\t\t\t\tfor (var selector in all) {\n\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\tret = all[selector];\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tgetValueAttribute: function getValueAttribute(element) {\n\t\t\t\tvar ret = element.getAttribute(\"data-attribute\") || _.getMatch(element, _.attributes);\n\n\t\t\t\t// TODO refactor this\n\t\t\t\tif (ret && ret.value) {\n\t\t\t\t\tret = $.extend(new String(ret.value), ret);\n\t\t\t\t}\n\n\t\t\t\tif (!ret || ret === \"null\") {\n\t\t\t\t\tret = null;\n\t\t\t\t}\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tgetDatatype: function getDatatype(element, attribute) {\n\t\t\t\tvar ret = element.getAttribute(\"datatype\");\n\n\t\t\t\tif (!ret) {\n\t\t\t\t\tfor (var selector in _.datatypes) {\n\t\t\t\t\t\tif (element.matches(selector)) {\n\t\t\t\t\t\t\tret = _.datatypes[selector][attribute];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tret = ret || \"string\";\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tcast: function cast(value, datatype) {\n\t\t\t\tif (datatype == \"number\") {\n\t\t\t\t\treturn +value;\n\t\t\t\t}\n\n\t\t\t\tif (datatype == \"boolean\") {\n\t\t\t\t\treturn !!value;\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t},\n\n\t\t\tgetValue: function getValue(element, attribute, datatype) {\n\t\t\t\tattribute = attribute || attribute === null ? attribute : _.getValueAttribute(element);\n\t\t\t\tdatatype = datatype || _.getDatatype(element, attribute);\n\n\t\t\t\tvar ret;\n\n\t\t\t\tif (attribute in element && _.useProperty(element, attribute)) {\n\t\t\t\t\t// Returning properties (if they exist) instead of attributes\n\t\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\t\tret = element[attribute];\n\t\t\t\t} else if (attribute) {\n\t\t\t\t\tret = element.getAttribute(attribute);\n\t\t\t\t} else {\n\t\t\t\t\tret = element.getAttribute(\"content\") || element.textContent || null;\n\t\t\t\t}\n\n\t\t\t\treturn _.cast(ret, datatype);\n\t\t\t},\n\n\t\t\tsetValue: function setValue(element, value, attribute) {\n\t\t\t\tif (attribute !== null) {\n\t\t\t\t\tattribute = attribute || _.getValueAttribute(element);\n\t\t\t\t}\n\n\t\t\t\tif (attribute in element && _.useProperty(element, attribute) && element[attribute] != value) {\n\t\t\t\t\t// Setting properties (if they exist) instead of attributes\n\t\t\t\t\t// is needed for dynamic elements such as checkboxes, sliders etc\n\t\t\t\t\ttry {\n\t\t\t\t\t\telement[attribute] = value;\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t}\n\n\t\t\t\t// Set attribute anyway, even if we set a property because when\n\t\t\t\t// they're not in sync it gets really fucking confusing.\n\t\t\t\tif (attribute) {\n\t\t\t\t\tif (element.getAttribute(attribute) != value) {\n\t\t\t\t\t\t// intentionally non-strict, e.g. \"3.\" !== 3\n\t\t\t\t\t\telement.setAttribute(attribute, value);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\telement.textContent = value;\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t/**\n    *  Set/get a property or an attribute?\n    * @return {Boolean} true to use a property, false to use the attribute\n    */\n\t\t\tuseProperty: function useProperty(element, attribute) {\n\t\t\t\tif ([\"href\", \"src\"].indexOf(attribute) > -1) {\n\t\t\t\t\t// URL properties resolve \"\" as location.href, fucking up emptiness checks\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (element.namespaceURI == \"http://www.w3.org/2000/svg\") {\n\t\t\t\t\t// SVG has a fucked up DOM, do not use these properties\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Define default attributes\n\t_.attributes = {\n\t\t\"img, video, audio\": \"src\",\n\t\t\"a, link\": \"href\",\n\t\t\"select, input, textarea, meter, progress\": \"value\",\n\t\t\"input[type=checkbox]\": \"checked\",\n\t\t\"time\": {\n\t\t\tvalue: \"datetime\",\n\t\t\thumanReadable: function humanReadable(value) {\n\t\t\t\tvar date = new Date(value);\n\n\t\t\t\tif (!value || isNaN(date)) {\n\t\t\t\t\treturn \"(No \" + this.label + \")\";\n\t\t\t\t}\n\n\t\t\t\t// TODO do this properly (account for other datetime datatypes and different formats)\n\t\t\t\tvar options = {\n\t\t\t\t\t\"date\": { day: \"numeric\", month: \"short\", year: \"numeric\" },\n\t\t\t\t\t\"month\": { month: \"long\" },\n\t\t\t\t\t\"time\": { hour: \"numeric\", minute: \"numeric\" },\n\t\t\t\t\t\"datetime-local\": { day: \"numeric\", month: \"short\", year: \"numeric\", hour: \"numeric\", minute: \"numeric\" }\n\t\t\t\t};\n\n\t\t\t\tvar format = options[this.editor && this.editor.type] || options.date;\n\t\t\t\tformat.timeZone = \"UTC\";\n\n\t\t\t\treturn date.toLocaleString(\"en-GB\", format);\n\t\t\t}\n\t\t},\n\t\t\"meta\": \"content\"\n\t};\n\n\t// Basic datatypes per attribute\n\t// Only number, boolean\n\t_.datatypes = {\n\t\t\"input[type=checkbox]\": {\n\t\t\t\"checked\": \"boolean\"\n\t\t},\n\t\t\"input[type=range], input[type=number], meter, progress\": {\n\t\t\t\"value\": \"number\"\n\t\t}\n\t};\n\n\t_.editors = {\n\t\t\"*\": { \"tag\": \"input\" },\n\n\t\t\".number\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"number\"\n\t\t},\n\n\t\t\".boolean\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"checkbox\"\n\t\t},\n\n\t\t\"a, img, video, audio, .url\": {\n\t\t\t\"tag\": \"input\",\n\t\t\t\"type\": \"url\",\n\t\t\t\"placeholder\": \"http://\"\n\t\t},\n\n\t\t// Block elements\n\t\t\"p, div, li, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, .multiline\": {\n\t\t\tcreate: function create() {\n\t\t\t\tvar display = getComputedStyle(this.element).display;\n\t\t\t\tvar tag = display.indexOf(\"inline\") === 0 ? \"input\" : \"textarea\";\n\t\t\t\tvar editor = $.create(tag);\n\n\t\t\t\tif (tag == \"textarea\") {\n\t\t\t\t\tvar width = this.element.offsetWidth;\n\n\t\t\t\t\tif (width) {\n\t\t\t\t\t\teditor.width = width;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn editor;\n\t\t\t},\n\n\t\t\tget editorValue() {\n\t\t\t\treturn this.editor && _.cast(this.editor.value, this.datatype);\n\t\t\t},\n\n\t\t\tset editorValue(value) {\n\t\t\t\tif (this.editor) {\n\t\t\t\t\tthis.editor.value = value ? value.replace(/\\r?\\n/g, \"\") : \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"meter, progress\": function meterProgress() {\n\t\t\treturn $.create({\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"range\",\n\t\t\t\tmin: this.element.getAttribute(\"min\") || 0,\n\t\t\t\tmax: this.element.getAttribute(\"max\") || 100\n\t\t\t});\n\t\t},\n\n\t\t\"time, .date\": function timeDate() {\n\t\t\tvar types = {\n\t\t\t\t\"date\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2}$/i,\n\t\t\t\t\"month\": /^[Y\\d]{4}-[M\\d]{2}$/i,\n\t\t\t\t\"time\": /^[H\\d]{2}:[M\\d]{2}/i,\n\t\t\t\t\"week\": /[Y\\d]{4}-W[W\\d]{2}$/i,\n\t\t\t\t\"datetime-local\": /^[Y\\d]{4}-[M\\d]{2}-[D\\d]{2} [H\\d]{2}:[M\\d]{2}/i\n\t\t\t};\n\n\t\t\tvar datetime = this.element.getAttribute(\"datetime\") || \"YYYY-MM-DD\";\n\n\t\t\tfor (var type in types) {\n\t\t\t\tif (types[type].test(datetime)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn $.create(\"input\", { type: type });\n\t\t}\n\t};\n})(Bliss, Bliss.$);\n\n// Image upload widget via imgur\nWysie.Primitive.editors.img = {\n\tcreate: function create() {\n\t\tvar root = $.create(\"div\", {\n\t\t\tclassName: \"image-popup\",\n\t\t\tevents: {\n\t\t\t\t\"dragenter dragover drop\": function dragenterDragoverDrop(evt) {\n\t\t\t\t\tevt.stopPropagation();\n\t\t\t\t\tevt.preventDefault();\n\t\t\t\t},\n\n\t\t\t\tdrop: function drop(evt) {\n\t\t\t\t\tvar file = $.value(evt.dataTransfer, \"files\", 0);\n\n\t\t\t\t\t// Do upload stuff\n\t\t\t\t}\n\t\t\t},\n\t\t\tcontents: [{\n\t\t\t\ttag: \"input\",\n\t\t\t\ttype: \"url\",\n\t\t\t\tclassName: \"value\"\n\t\t\t}, {\n\t\t\t\ttag: \"label\",\n\t\t\t\tclassName: \"upload\",\n\t\t\t\tcontents: [\"Upload: \", {\n\t\t\t\t\ttag: \"input\",\n\t\t\t\t\ttype: \"file\",\n\t\t\t\t\taccept: \"image/*\",\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tchange: function change(evt) {\n\t\t\t\t\t\t\tvar file = this.files[0];\n\n\t\t\t\t\t\t\tif (!file) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Show image locally\n\t\t\t\t\t\t\t$(\"img\", root).file = file;\n\n\t\t\t\t\t\t\t// Upload\n\n\t\t\t\t\t\t\t// Once uploaded, share and get public URL\n\n\t\t\t\t\t\t\t// Set public URL as the value of the URL input\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"image-preview\",\n\t\t\t\tcontents: [{\n\t\t\t\t\ttag: \"progress\",\n\t\t\t\t\tvalue: \"0\",\n\t\t\t\t\tmax: \"100\"\n\t\t\t\t}, {\n\t\t\t\t\ttag: \"img\"\n\t\t\t\t}]\n\t\t\t}, {\n\t\t\t\tclassName: \"tip\",\n\t\t\t\tinnerHTML: \"<strong>Tip:</strong> You can also drag & drop or paste the image to be uploaded!\"\n\t\t\t}] });\n\n\t\treturn root;\n\t}\n};\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Collection = $.Class({\n\t\textends: Wysie.Node,\n\t\tconstructor: function constructor(element, wysie, o) {\n\t\t\t/*\n    * Create the template, remove it from the DOM and store it\n    */\n\t\t\tthis.templateElement = element;\n\n\t\t\tthis.items = [];\n\n\t\t\t// ALL descendant property names as an array\n\t\t\tif (this.template) {\n\t\t\t\tthis.properties = this.template.properties;\n\t\t\t\tthis.mutable = this.template.mutable;\n\t\t\t} else {\n\t\t\t\tthis.properties = $$(Wysie.selectors.property, this.templateElement)._.getAttribute(\"property\");\n\t\t\t\tthis.mutable = this.templateElement.matches(Wysie.selectors.multiple);\n\t\t\t}\n\n\t\t\tWysie.hooks.run(\"collection-init-end\", this);\n\t\t},\n\n\t\tget length() {\n\t\t\treturn this.items.length;\n\t\t},\n\n\t\t// Collection still contains its template as data\n\t\tget containsTemplate() {\n\t\t\treturn this.items.length && this.items[0].element === this.element;\n\t\t},\n\n\t\tgetData: function getData(o) {\n\t\t\to = o || {};\n\n\t\t\tvar data = [];\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (!item.deleted) {\n\t\t\t\t\tvar itemData = item.getData(o);\n\n\t\t\t\t\tif (itemData) {\n\t\t\t\t\t\tdata.push(itemData);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!o.dirty && this.unhandled) {\n\t\t\t\tdata = this.unhandled.before.concat(data, this.unhandled.after);\n\t\t\t}\n\n\t\t\treturn data;\n\t\t},\n\n\t\t// Create item but don't insert it anywhere\n\t\t// Mostly used internally\n\t\tcreateItem: function createItem(element) {\n\t\t\tvar _this26 = this;\n\n\t\t\tvar element = element || this.templateElement.cloneNode(true);\n\n\t\t\tvar item = Wysie.Unit.create(element, this.wysie, {\n\t\t\t\tcollection: this,\n\t\t\t\ttemplate: this.items[0] || (this.template ? this.template.items[0] : null)\n\t\t\t});\n\n\t\t\t// Add delete & add buttons\n\t\t\tif (this.mutable) {\n\t\t\t\t$.create({\n\t\t\t\t\tclassName: \"wysie-item-controls wysie-ui\",\n\t\t\t\t\tcontents: [{\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Delete this \" + this.name,\n\t\t\t\t\t\tclassName: \"delete\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\treturn _this26.delete(item);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\ttag: \"button\",\n\t\t\t\t\t\ttitle: \"Add new \" + this.name.replace(/s$/i, \"\"),\n\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\t\t\treturn _this26.add(null, _this26.items.indexOf(item)).edit();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}],\n\t\t\t\t\tinside: element\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn item;\n\t\t},\n\n\t\t/**\n   * Add a new item to this collection\n   * @param item {Node|Wysie.Unit} Optional. Element or Wysie object for the new item\n   * @param index {Number} Optional. Index of existing item, will be added opposite to list direction\n   * @param silent {Boolean} Optional. Throw a datachange event? Mainly used internally.\n   */\n\t\tadd: function add(item, index) {\n\t\t\tvar o = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n\t\t\tif (item instanceof Node) {\n\t\t\t\titem = Wysie.Unit.get(item) || this.createItem(item);\n\t\t\t} else {\n\t\t\t\titem = item || this.createItem();\n\t\t\t}\n\n\t\t\tif (index in this.items) {\n\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\tindex++;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tindex = this.bottomUp ? 0 : this.length;\n\t\t\t}\n\n\t\t\tif (!item.element.parentNode) {\n\t\t\t\t// Add it to the DOM, if not already in\n\t\t\t\tvar nextItem = this.items[index];\n\t\t\t\titem.element._.before(nextItem && nextItem.element || this.marker);\n\t\t\t}\n\n\t\t\t// Update internal data model\n\t\t\tthis.items.splice(index, 0, item);\n\n\t\t\tfor (var i = index - 1; i < this.length; i++) {\n\t\t\t\tvar _item = this.items[i];\n\n\t\t\t\tif (_item) {\n\t\t\t\t\t_item.index = i;\n\n\t\t\t\t\tif (!o.silent) {\n\t\t\t\t\t\t_item.element._.fire(\"wysie:datachange\", {\n\t\t\t\t\t\t\tnode: this,\n\t\t\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\t\t\taction: \"add\",\n\t\t\t\t\t\t\titem: _item\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!o.silent) {\n\t\t\t\titem.unsavedChanges = this.wysie.unsavedChanges = true;\n\t\t\t}\n\n\t\t\treturn item;\n\t\t},\n\n\t\tpropagate: function propagate() {\n\t\t\tvar _arguments2 = arguments;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\treturn item.call.apply(item, _arguments2);\n\t\t\t});\n\t\t},\n\n\t\tdelete: function _delete(item, hard) {\n\t\t\tvar _this27 = this;\n\n\t\t\tif (hard) {\n\t\t\t\t// Hard delete\n\t\t\t\t$.remove(item.element);\n\t\t\t\tthis.items.splice(this.items.indexOf(item), 1);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn $.transition(item.element, { opacity: 0 }).then(function () {\n\t\t\t\titem.deleted = true; // schedule for deletion\n\t\t\t\titem.element.style.opacity = \"\";\n\n\t\t\t\titem.element._.fire(\"wysie:datachange\", {\n\t\t\t\t\tnode: _this27,\n\t\t\t\t\twysie: _this27.wysie,\n\t\t\t\t\taction: \"delete\",\n\t\t\t\t\titem: item\n\t\t\t\t});\n\n\t\t\t\titem.unsavedChanges = _this27.wysie.unsavedChanges = true;\n\t\t\t});\n\t\t},\n\n\t\tedit: function edit() {\n\t\t\tif (this.length === 0 && this.required) {\n\t\t\t\t// Nested collection with no items, add one\n\t\t\t\tvar item = this.add(null, null, true);\n\n\t\t\t\titem.placeholder = true;\n\t\t\t\titem.walk(function (obj) {\n\t\t\t\t\treturn obj.unsavedChanges = false;\n\t\t\t\t});\n\n\t\t\t\t$.once(item.element, \"wysie:datachange\", function (evt) {\n\t\t\t\t\titem.unsavedChanges = true;\n\t\t\t\t\titem.placeholder = false;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\treturn obj[obj.preEdit ? \"preEdit\" : \"edit\"]();\n\t\t\t});\n\t\t},\n\n\t\t/**\n   * Delete all items in the collection.\n   */\n\t\tclear: function clear() {\n\t\t\tif (this.mutable) {\n\t\t\t\tthis.propagate(function (item) {\n\t\t\t\t\treturn item.element.remove();\n\t\t\t\t});\n\n\t\t\t\tthis.items = [];\n\n\t\t\t\tthis.marker._.fire(\"wysie:datachange\", {\n\t\t\t\t\tnode: this,\n\t\t\t\t\twysie: this.wysie,\n\t\t\t\t\taction: \"clear\"\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tsave: function save() {\n\t\t\tvar _this28 = this;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (item.deleted) {\n\t\t\t\t\t_this28.delete(item, true);\n\t\t\t\t} else {\n\t\t\t\t\titem.unsavedChanges = false;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tdone: function done() {\n\t\t\tvar _this29 = this;\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\tif (item.placeholder) {\n\t\t\t\t\t_this29.delete(item, true);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tpropagated: [\"save\", \"done\"],\n\n\t\trevert: function revert() {\n\t\t\tvar _this30 = this;\n\n\t\t\tthis.items.forEach(function (item, i) {\n\t\t\t\t// Delete added items\n\t\t\t\tif (!item.everSaved && !item.placeholder) {\n\t\t\t\t\t_this30.delete(item, true);\n\t\t\t\t} else {\n\t\t\t\t\t// Bring back deleted items\n\t\t\t\t\tif (item.deleted) {\n\t\t\t\t\t\titem.deleted = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Revert all properties\n\t\t\t\t\titem.revert();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\timport: function _import() {\n\t\t\tif (this.mutable) {\n\t\t\t\tthis.add(this.element);\n\t\t\t}\n\n\t\t\tthis.items.forEach(function (item) {\n\t\t\t\treturn item.import();\n\t\t\t});\n\t\t},\n\n\t\trender: function render(data) {\n\t\t\tvar _this31 = this;\n\n\t\t\tthis.unhandled = { before: [], after: [] };\n\n\t\t\tif (!data) {\n\t\t\t\tif (data === null || data === undefined) {\n\t\t\t\t\tif (!this.closestCollection || this.closestCollection.containsTemplate) {\n\t\t\t\t\t\t// This is not contained in any other collection, display template data\n\t\t\t\t\t\tthis.clear();\n\t\t\t\t\t\tthis.import();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tdata = data && Wysie.toArray(data);\n\n\t\t\tif (!this.mutable) {\n\t\t\t\tthis.items.forEach(function (item, i) {\n\t\t\t\t\treturn item.render(data && data[i]);\n\t\t\t\t});\n\n\t\t\t\tif (data) {\n\t\t\t\t\tthis.unhandled.after = data.slice(this.items.length);\n\t\t\t\t}\n\t\t\t} else if (data && data.length > 0) {\n\t\t\t\t// Using document fragments improved rendering performance by 60%\n\t\t\t\tvar fragment = document.createDocumentFragment();\n\n\t\t\t\tdata.forEach(function (datum, i) {\n\t\t\t\t\tvar item = _this31.createItem();\n\n\t\t\t\t\titem.render(datum);\n\n\t\t\t\t\t_this31.items.push(item);\n\t\t\t\t\titem.index = i;\n\n\t\t\t\t\tfragment.appendChild(item.element);\n\t\t\t\t});\n\n\t\t\t\tthis.marker.parentNode.insertBefore(fragment, this.marker);\n\t\t\t}\n\n\t\t\tthis.save();\n\t\t},\n\n\t\tfind: function find(property) {\n\t\t\tvar items = this.items.filter(function (item) {\n\t\t\t\treturn !item.deleted;\n\t\t\t});\n\n\t\t\tif (this.property == property) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif (this.properties.indexOf(property) > -1) {\n\t\t\t\tvar ret = items.map(function (item) {\n\t\t\t\t\treturn item.find(property);\n\t\t\t\t});\n\n\t\t\t\treturn Wysie.flatten(ret);\n\t\t\t}\n\t\t},\n\n\t\tlive: {\n\t\t\tmutable: function mutable(value) {\n\t\t\t\tif (value && value !== this.mutable) {\n\t\t\t\t\t// Why is all this code here? Because we want it executed\n\t\t\t\t\t// every time mutable changes, not just in the constructor\n\t\t\t\t\t// (think multiple elements with the same property name, where only one has data-multiple)\n\t\t\t\t\tthis._mutable = value;\n\n\t\t\t\t\tthis.wysie.needsEdit = true;\n\n\t\t\t\t\tthis.required = this.templateElement.matches(Wysie.selectors.required);\n\n\t\t\t\t\t// Keep position of the template in the DOM, since were gonna remove it\n\t\t\t\t\tthis.marker = $.create(\"div\", {\n\t\t\t\t\t\thidden: true,\n\t\t\t\t\t\tclassName: \"wysie-marker\",\n\t\t\t\t\t\tafter: this.templateElement\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.templateElement.classList.add(\"wysie-item\");\n\n\t\t\t\t\tthis.templateElement.remove();\n\n\t\t\t\t\t// Insert the add button if it's not already in the DOM\n\t\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\t\tif (this.bottomUp) {\n\t\t\t\t\t\t\tthis.addButton._.before($.value(this.items[0], \"element\") || this.marker);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar tag = this.element.tagName.toLowerCase();\n\t\t\t\t\t\t\tvar containerSelector = Wysie.selectors.container[tag];\n\n\t\t\t\t\t\t\tif (containerSelector) {\n\t\t\t\t\t\t\t\tvar after = this.marker.closest(containerSelector);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.addButton._.after(after && after.parentNode ? after : this.marker);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.templateElement = this.element.cloneNode(true);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tlazy: {\n\t\t\tbottomUp: function bottomUp() {\n\t\t\t\t/*\n     * Add new items at the top or bottom?\n     */\n\n\t\t\t\tif (!this.mutable) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar order = this.templateElement.getAttribute(\"data-order\");\n\t\t\t\tif (order !== null) {\n\t\t\t\t\t// Attribute data-bottomup has the highest priority and overrides any heuristics\n\t\t\t\t\treturn (/^desc\\b/i.test(order)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (!this.addButton.parentNode) {\n\t\t\t\t\t// If add button not in DOM, do the default\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If add button is already in the DOM and *before* our template, then we default to prepending\n\t\t\t\treturn !!(this.addButton.compareDocumentPosition(this.templateElement) & Node.DOCUMENT_POSITION_FOLLOWING);\n\t\t\t},\n\n\t\t\tclosestCollection: function closestCollection() {\n\t\t\t\tvar parent = this.marker ? this.marker.parentNode : this.templateElement.parentNode;\n\n\t\t\t\treturn parent.closest(Wysie.selectors.item);\n\t\t\t},\n\n\t\t\taddButton: function addButton() {\n\t\t\t\tvar _this32 = this;\n\n\t\t\t\t// Find add button if provided, or generate one\n\t\t\t\tvar selector = \"button.add-\" + this.property;\n\t\t\t\tvar scope = this.closestCollection || this.marker.closest(Wysie.selectors.scope);\n\n\t\t\t\tif (scope) {\n\t\t\t\t\tvar button = $$(selector, scope).filter(function (button) {\n\t\t\t\t\t\treturn !_this32.templateElement.contains(button);\n\t\t\t\t\t})[0];\n\t\t\t\t}\n\n\t\t\t\tif (!button) {\n\t\t\t\t\tbutton = $.create(\"button\", {\n\t\t\t\t\t\tclassName: \"add\",\n\t\t\t\t\t\ttextContent: \"Add \" + this.name\n\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\tbutton.classList.add(\"wysie-ui\", \"wysie-add\");\n\n\t\t\t\tif (this.property) {\n\t\t\t\t\tbutton.classList.add(\"add-\" + this.property);\n\t\t\t\t}\n\n\t\t\t\tbutton.addEventListener(\"click\", function (evt) {\n\t\t\t\t\tevt.preventDefault();\n\n\t\t\t\t\t_this32.add().edit();\n\t\t\t\t});\n\n\t\t\t\treturn button;\n\t\t\t}\n\t\t}\n\t});\n})(Bliss, Bliss.$);\n\n/*\nCopyright (c) 2009 James Padolsey.  All rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions\nare met:\n\n   1. Redistributions of source code must retain the above copyright\n\t  notice, this list of conditions and the following disclaimer.\n\n   2. Redistributions in binary form must reproduce the above copyright\n\t  notice, this list of conditions and the following disclaimer in the\n\t  documentation and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY James Padolsey ``AS IS\"\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\nIMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\nARE DISCLAIMED. IN NO EVENT SHALL James Padolsey OR CONTRIBUTORS BE LIABLE\nFOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\nDAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\nSERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\nCAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT\nLIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY\nOUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF\nSUCH DAMAGE.\n\nThe views and conclusions contained in the software and documentation are\nthose of the authors and should not be interpreted as representing official\npolicies, either expressed or implied, of James Padolsey.\n\n AUTHOR James Padolsey (http://james.padolsey.com)\n VERSION 1.03.0\n UPDATED 29-10-2011\n CONTRIBUTORS\n\tDavid Waller\n    Benjamin Drucker\n\n*/\n\nvar prettyPrint = function () {\n\n\t/* These \"util\" functions are not part of the core\n    functionality but are  all necessary - mostly DOM helpers */\n\n\tvar util = {\n\n\t\ttxt: function txt(t) {\n\t\t\t/* Create text node */\n\t\t\tt = t + \"\";\n\t\t\treturn document.createTextNode(t);\n\t\t},\n\n\t\trow: function row(cells, type, cellType) {\n\n\t\t\t/* Creates new <tr> */\n\t\t\tcellType = cellType || \"td\";\n\n\t\t\t/* colSpan is calculated by length of null items in array */\n\t\t\tvar colSpan = util.count(cells, null) + 1,\n\t\t\t    tr = $.create(\"tr\"),\n\t\t\t    td,\n\t\t\t    attrs = {\n\t\t\t\tcolSpan: colSpan\n\t\t\t};\n\n\t\t\t$$(cells).forEach(function (cell) {\n\t\t\t\tif (cell === null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/* Default cell type is <td> */\n\t\t\t\ttd = $.create(cellType, attrs);\n\n\t\t\t\tif (cell.nodeType) {\n\t\t\t\t\t/* IsDomElement */\n\t\t\t\t\ttd.appendChild(cell);\n\t\t\t\t} else {\n\t\t\t\t\t/* IsString */\n\t\t\t\t\ttd.innerHTML = util.shorten(cell.toString());\n\t\t\t\t}\n\n\t\t\t\ttr.appendChild(td);\n\t\t\t});\n\n\t\t\treturn tr;\n\t\t},\n\n\t\thRow: function hRow(cells, type) {\n\t\t\t/* Return new <th> */\n\t\t\treturn util.row(cells, type, \"th\");\n\t\t},\n\n\t\ttable: function table(headings, type) {\n\n\t\t\theadings = headings || [];\n\n\t\t\t/* Creates new table: */\n\t\t\tvar tbl = $.create(\"table\");\n\t\t\tvar thead = $.create(\"thead\");\n\t\t\tvar tbody = $.create(\"tbody\");\n\n\t\t\ttbl.classList.add(type);\n\n\t\t\tif (headings.length) {\n\t\t\t\ttbl.appendChild(thead);\n\t\t\t\tthead.appendChild(util.hRow(headings, type));\n\t\t\t}\n\n\t\t\ttbl.appendChild(tbody);\n\n\t\t\treturn {\n\t\t\t\t/* Facade for dealing with table/tbody\n       Actual table node is this.node: */\n\t\t\t\tnode: tbl,\n\t\t\t\ttbody: tbody,\n\t\t\t\tthead: thead,\n\t\t\t\tappendChild: function appendChild(node) {\n\t\t\t\t\tthis.tbody.appendChild(node);\n\t\t\t\t},\n\t\t\t\taddRow: function addRow(cells, _type, cellType) {\n\t\t\t\t\tthis.appendChild(util.row(cells, _type || type, cellType));\n\t\t\t\t\treturn this;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tshorten: function shorten(str) {\n\t\t\tvar max = 40;\n\t\t\tstr = str.replace(/^\\s\\s*|\\s\\s*$|\\n/g, \"\");\n\t\t\treturn str.length > max ? str.substring(0, max - 1) + \"...\" : str;\n\t\t},\n\n\t\thtmlentities: function htmlentities(str) {\n\t\t\treturn str.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n\t\t},\n\n\t\tcount: function count(arr, item) {\n\t\t\tvar count = 0;\n\t\t\tfor (var i = 0, l = arr.length; i < l; i++) {\n\t\t\t\tif (arr[i] === item) {\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn count;\n\t\t},\n\n\t\tthead: function thead(tbl) {\n\t\t\treturn tbl.getElementsByTagName(\"thead\")[0];\n\t\t},\n\n\t\twithin: function within(ref) {\n\t\t\t/* Check existence of a val within an object\n      RETURNS KEY */\n\t\t\treturn {\n\t\t\t\tis: function is(o) {\n\t\t\t\t\tfor (var i in ref) {\n\t\t\t\t\t\tif (ref[i] === o) {\n\t\t\t\t\t\t\treturn i;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn \"\";\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\tcommon: {\n\t\t\tcircRef: function circRef(obj, key, settings) {\n\t\t\t\treturn util.expander(\"[POINTS BACK TO <strong>\" + key + \"</strong>]\", \"Click to show this item anyway\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, { maxDepth: 1 }));\n\t\t\t\t});\n\t\t\t},\n\t\t\tdepthReached: function depthReached(obj, settings) {\n\t\t\t\treturn util.expander(\"[DEPTH REACHED]\", \"Click to show this item anyway\", function () {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.parentNode.appendChild(prettyPrintThis(obj, { maxDepth: 1 }));\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tthis.parentNode.appendChild(util.table([\"ERROR OCCURED DURING OBJECT RETRIEVAL\"], \"error\").addRow([e.message]).node);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\texpander: function expander(text, title, clickFn) {\n\t\t\treturn $.create(\"a\", {\n\t\t\t\tinnerHTML: util.shorten(text) + ' <b style=\"visibility:hidden;\">[+]</b>',\n\t\t\t\ttitle: title,\n\t\t\t\tonmouseover: function onmouseover() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"visible\";\n\t\t\t\t},\n\t\t\t\tonmouseout: function onmouseout() {\n\t\t\t\t\tthis.getElementsByTagName(\"b\")[0].style.visibility = \"hidden\";\n\t\t\t\t},\n\t\t\t\tonclick: function onclick() {\n\t\t\t\t\tthis.style.display = \"none\";\n\t\t\t\t\tclickFn.call(this);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tstyle: {\n\t\t\t\t\tcursor: \"pointer\"\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\t// Main..\n\tvar prettyPrintThis = function prettyPrintThis(obj, options) {\n\n\t\t/*\n  *\t  obj :: Object to be printed\n  *  options :: Options (merged with config)\n  */\n\n\t\toptions = options || {};\n\n\t\tvar settings = $.extend({}, prettyPrintThis.config, options),\n\t\t    container = $.create(\"div\"),\n\t\t    config = prettyPrintThis.config,\n\t\t    currentDepth = 0,\n\t\t    stack = {},\n\t\t    hasRunOnce = false;\n\n\t\t/* Expose per-call settings.\n     Note: \"config\" is overwritten (where necessary) by options/\"settings\"\n     So, if you need to access/change *DEFAULT* settings then go via \".config\" */\n\t\tprettyPrintThis.settings = settings;\n\n\t\tvar typeDealer = {\n\t\t\tstring: function string(item) {\n\t\t\t\treturn util.txt('\"' + util.shorten(item.replace(/\"/g, '\\\\\"')) + '\"');\n\t\t\t},\n\n\t\t\tobject: function object(obj, depth, key) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(obj);\n\n\t\t\t\tif (stackKey) {\n\t\t\t\t\treturn util.common.circRef(obj, stackKey, settings);\n\t\t\t\t}\n\n\t\t\t\tstack[key || \"TOP\"] = obj;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(obj, settings);\n\t\t\t\t}\n\n\t\t\t\tvar table = util.table([\"Group\", null], \"object\"),\n\t\t\t\t    isEmpty = true;\n\n\t\t\t\tfor (var i in obj) {\n\t\t\t\t\tif (!obj.hasOwnProperty || obj.hasOwnProperty(i)) {\n\t\t\t\t\t\tvar item = obj[i],\n\t\t\t\t\t\t    type = $.type(item);\n\t\t\t\t\t\tisEmpty = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\ttable.addRow([i, typeDealer[type](item, depth + 1, i)], type);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t/* Security errors are thrown on certain Window/DOM properties */\n\t\t\t\t\t\t\tif (window.console && window.console.log) {\n\t\t\t\t\t\t\t\tconsole.log(e.message);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvar ret = settings.expanded || hasRunOnce ? table.node : util.expander(JSON.stringify(obj), \"Click to show more\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t});\n\n\t\t\t\thasRunOnce = true;\n\n\t\t\t\treturn ret;\n\t\t\t},\n\n\t\t\tarray: function array(arr, depth, key, jquery) {\n\n\t\t\t\t/* Checking depth + circular refs */\n\t\t\t\t/* Note, check for circular refs before depth; just makes more sense */\n\t\t\t\tvar stackKey = util.within(stack).is(arr);\n\n\t\t\t\tif (stackKey) {\n\t\t\t\t\treturn util.common.circRef(arr, stackKey);\n\t\t\t\t}\n\n\t\t\t\tstack[key || \"TOP\"] = arr;\n\n\t\t\t\tif (depth === settings.maxDepth) {\n\t\t\t\t\treturn util.common.depthReached(arr);\n\t\t\t\t}\n\n\t\t\t\t/* Accepts a table and modifies it */\n\t\t\t\tvar table = util.table([\"List (\" + arr.length + \" items)\", null], \"list\");\n\t\t\t\tvar isEmpty = true;\n\t\t\t\tvar count = 0;\n\n\t\t\t\t$$(arr).forEach(function (item, i) {\n\t\t\t\t\tif (settings.maxArray >= 0 && ++count > settings.maxArray) {\n\t\t\t\t\t\ttable.addRow([i + \"..\" + (arr.length - 1), typeDealer[$.type(item)](\"...\", depth + 1, i)]);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tisEmpty = false;\n\t\t\t\t\ttable.addRow([i, typeDealer[$.type(item)](item, depth + 1, i)]);\n\t\t\t\t});\n\n\t\t\t\treturn settings.expanded ? table.node : util.expander(JSON.stringify(arr), \"Click to show more\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(table.node);\n\t\t\t\t});\n\t\t\t},\n\n\t\t\t\"date\": function date(_date) {\n\n\t\t\t\tvar miniTable = util.table([\"Date\", null], \"date\"),\n\t\t\t\t    sDate = _date.toString().split(/\\s/);\n\n\t\t\t\t/* TODO: Make this work well in IE! */\n\t\t\t\tminiTable.addRow([\"Time\", sDate[4]]).addRow([\"Date\", sDate.slice(0, 4).join(\"-\")]);\n\n\t\t\t\treturn settings.expanded ? miniTable.node : util.expander(\"Date (timestamp): \" + +_date, \"Click to see a little more info about this date\", function () {\n\t\t\t\t\tthis.parentNode.appendChild(miniTable.node);\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\n\t\ttypeDealer.number = typeDealer.boolean = typeDealer.undefined = typeDealer.null = typeDealer.default = function (value) {\n\t\t\treturn util.txt(value);\n\t\t}, container.appendChild(typeDealer[$.type(obj)](obj, currentDepth));\n\n\t\treturn container;\n\t};\n\n\t/* Configuration */\n\n\t/* All items can be overwridden by passing an\n    \"options\" object when calling prettyPrint */\n\tprettyPrintThis.config = {\n\t\t/* Try setting this to false to save space */\n\t\texpanded: true,\n\n\t\tmaxDepth: 10,\n\t\tmaxArray: -1 // default is unlimited\n\t};\n\n\treturn prettyPrintThis;\n}();\n\n(function ($, $$) {\n\n\tvar _ = Wysie.Debug = {\n\t\tfriendlyError: function friendlyError(e, expr) {\n\t\t\tvar type = e.constructor.name.replace(/Error$/, \"\").toLowerCase();\n\t\t\tvar message = e.message;\n\n\t\t\t// Friendlify common errors\n\n\t\t\t// Non-developers don't know wtf a token is.\n\t\t\tmessage = message.replace(/\\s+token\\s+/g, \" \");\n\n\t\t\tif (message == \"Unexpected }\" && !/[{}]/.test(expr)) {\n\t\t\t\tmessage = \"Missing a )\";\n\t\t\t} else if (message === \"Unexpected )\") {\n\t\t\t\tmessage = \"Missing a (\";\n\t\t\t} else if (message === \"Invalid left-hand side in assignment\") {\n\t\t\t\tmessage = \"Invalid assignment. Maybe you typed = instead of == ?\";\n\t\t\t} else if (message == \"Unexpected ILLEGAL\") {\n\t\t\t\tmessage = \"There is an invalid character somewhere.\";\n\t\t\t}\n\n\t\t\treturn \"<span class=\\\"type\\\">Oh noes, a \" + type + \" error!</span> \" + message;\n\t\t},\n\n\t\telementLabel: function elementLabel(element, attribute) {\n\t\t\tvar ret = element.nodeName.toLowerCase();\n\n\t\t\tif (element.hasAttribute(\"property\")) {\n\t\t\t\tret += \"[property=\" + element.getAttribute(\"property\") + \"]\";\n\t\t\t} else if (element.id) {\n\t\t\t\tret += \"#\" + element.id;\n\t\t\t} else if (element.classList.length) {\n\t\t\t\tret += $$(element.classList).map(function (c) {\n\t\t\t\t\treturn \".\" + c;\n\t\t\t\t}).join(\"\");\n\t\t\t}\n\n\t\t\tif (attribute) {\n\t\t\t\tret += \"@\" + attribute;\n\t\t\t}\n\n\t\t\treturn ret;\n\t\t},\n\n\t\tprintValue: function printValue(obj) {\n\t\t\tvar ret;\n\n\t\t\tif ((typeof obj === \"undefined\" ? \"undefined\" : _typeof(obj)) !== \"object\" || obj === null) {\n\t\t\t\treturn typeof obj == \"string\" ? \"\\\"\" + obj + \"\\\"\" : obj + \"\";\n\t\t\t}\n\n\t\t\tif (Array.isArray(obj)) {\n\t\t\t\tif (obj.length > 0) {\n\t\t\t\t\tif (_typeof(obj[0]) === \"object\") {\n\t\t\t\t\t\treturn \"List: \" + obj.length + \" group(s)\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"List: \" + obj.map(_.printValue).join(\", \");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn \"List: (Empty)\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (obj.constructor === Object) {\n\t\t\t\treturn \"Group with \" + Object.keys(obj).length + \" properties\";\n\t\t\t}\n\n\t\t\tif (obj instanceof Wysie.Primitive) {\n\t\t\t\treturn _.printValue(obj.value);\n\t\t\t} else if (obj instanceof Wysie.Collection) {\n\t\t\t\tif (obj.items.length > 0) {\n\t\t\t\t\tif (obj.items[0] instanceof Wysie.Scope) {\n\t\t\t\t\t\treturn \"List: \" + obj.items.length + \" group(s)\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn \"List: \" + obj.items.map(_.printValue).join(\", \");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn _.printValue([]);\n\t\t\t\t}\n\t\t\t} else if (obj instanceof Wysie.Scope) {\n\t\t\t\t// Group\n\t\t\t\treturn \"Group with \" + obj.propertyNames.length + \" properties\";\n\t\t\t}\n\t\t},\n\n\t\ttimed: function timed(id, callback) {\n\t\t\treturn function () {\n\t\t\t\tconsole.time(id);\n\t\t\t\tcallback.apply(this, arguments);\n\t\t\t\tconsole.timeEnd(id);\n\t\t\t};\n\t\t},\n\n\t\ttime: function callee(objName, name) {\n\t\t\tvar obj = eval(objName);\n\t\t\tvar callback = obj[name];\n\n\t\t\tobj[name] = function callee() {\n\t\t\t\tvar before = performance.now();\n\t\t\t\tvar ret = callback.apply(this, arguments);\n\t\t\t\tcallee.timeTaken += performance.now() - before;\n\t\t\t\tobj[name].calls++;\n\t\t\t\treturn ret;\n\t\t\t};\n\n\t\t\tobj[name].timeTaken = obj[name].calls = 0;\n\n\t\t\tcallee.all = callee.all || [];\n\t\t\tcallee.all.push({ obj: obj, objName: objName, name: name });\n\n\t\t\treturn obj[name];\n\t\t},\n\n\t\ttimes: function times() {\n\t\t\tif (!_.time.all) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.table(_.time.all.map(function (o) {\n\t\t\t\treturn {\n\t\t\t\t\t\"Function\": o.objName + \".\" + o.name,\n\t\t\t\t\t\"Time (ms)\": o.obj[o.name].timeTaken,\n\t\t\t\t\t\"Calls\": o.obj[o.name].calls\n\t\t\t\t};\n\t\t\t}));\n\t\t},\n\n\t\treservedWords: \"as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|var|void|while|with|yield\".split(\"|\")\n\t};\n\n\tWysie.prototype.render = _.timed(\"render\", Wysie.prototype.render);\n\n\tWysie.selectors.debug = \".debug\";\n\n\tvar selector = \", .wysie-debuginfo\";\n\tWysie.Expressions.escape += selector;\n\tStretchy.selectors.filter += selector;\n\n\t// Add element to show saved data\n\tWysie.hooks.add(\"init-tree-after\", function () {\n\t\tif (this.root.debug) {\n\t\t\tthis.wrapper.classList.add(\"debug-saving\");\n\t\t}\n\n\t\tif (this.store && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\t\tvar element;\n\n\t\t\tvar details = $.create(\"details\", {\n\t\t\t\tclassName: \"wysie-debug-storage\",\n\t\t\t\tcontents: [{ tag: \"Summary\", textContent: \"Saved data\" }, element = $.create(\"pre\", { id: this.id + \"-debug-storage\" })],\n\t\t\t\tafter: this.wrapper\n\t\t\t});\n\n\t\t\t// Intercept textContent\n\n\t\t\tvar descriptor = Object.getOwnPropertyDescriptor(Node.prototype, \"textContent\");\n\n\t\t\tObject.defineProperty(element, \"textContent\", {\n\t\t\t\tget: function get() {\n\t\t\t\t\treturn descriptor.get.call(this);\n\t\t\t\t},\n\n\t\t\t\tset: function set(value) {\n\t\t\t\t\tthis.innerHTML = \"\";\n\n\t\t\t\t\tif (value) {\n\t\t\t\t\t\tthis.appendChild(prettyPrint(JSON.parse(value)));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.store += \" #\" + element.id;\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"render-start\", function (_ref3) {\n\t\tvar data = _ref3.data;\n\n\t\tif (this.storage && this.wrapper.classList.contains(\"debug-saving\")) {\n\t\t\tvar element = $(\"#\" + this.id + \"-debug-storage\");\n\n\t\t\tif (element) {\n\t\t\t\telement.textContent = data ? this.toJSON(data) : \"\";\n\t\t\t}\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"scope-init-start\", function () {\n\t\tthis.debug = this.debug || this.walkUp(function (scope) {\n\t\t\tif (scope.debug) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}) || /[?&]debug\\b/i.test(location.search);\n\n\t\tif (!this.debug && this.element.closest(Wysie.selectors.debug)) {\n\t\t\tthis.debug = true;\n\t\t}\n\n\t\tif (this.debug) {\n\t\t\tthis.debug = $.create(\"tbody\", {\n\t\t\t\tinside: $.create(\"table\", {\n\t\t\t\t\tinnerHTML: \"<thead><tr>\\n\\t\\t\\t\\t\\t<th></th>\\n\\t\\t\\t\\t\\t<th>Expression</th>\\n\\t\\t\\t\\t\\t<th>Value</th>\\n\\t\\t\\t\\t\\t<th>Element</th>\\n\\t\\t\\t\\t</tr></thead>\",\n\t\t\t\t\tstyle: {\n\t\t\t\t\t\tdisplay: \"none\"\n\t\t\t\t\t},\n\t\t\t\t\tinside: $.create(\"details\", {\n\t\t\t\t\t\tclassName: \"wysie-ui wysie-debuginfo\",\n\t\t\t\t\t\tinside: this.element,\n\t\t\t\t\t\tcontents: $.create(\"summary\", {\n\t\t\t\t\t\t\ttextContent: \"Debug\"\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t});\n\t\t}\n\t}, true);\n\n\tWysie.hooks.add(\"unit-init-end\", function () {\n\t\tif (this.collection) {\n\t\t\tthis.debug = this.collection.debug;\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"expressions-init-start\", function () {\n\t\tthis.debug = this.scope.debug;\n\t});\n\n\tWysie.hooks.add(\"expression-eval-beforeeval\", function () {\n\t\tif (this.debug) {\n\t\t\tthis.debug.classList.remove(\"error\");\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"expression-eval-error\", function (env) {\n\t\tif (this.debug) {\n\t\t\tthis.debug.innerHTML = _.friendlyError(env.exception, env.expression);\n\t\t\tthis.debug.classList.add(\"error\");\n\t\t}\n\t});\n\n\tWysie.Scope.prototype.debugRow = function (_ref4) {\n\t\tvar element = _ref4.element;\n\t\tvar _ref4$attribute = _ref4.attribute;\n\t\tvar attribute = _ref4$attribute === undefined ? null : _ref4$attribute;\n\t\tvar _ref4$tds = _ref4.tds;\n\t\tvar tds = _ref4$tds === undefined ? [] : _ref4$tds;\n\n\t\tif (!this.debug) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.debug.parentNode.style.display = \"\";\n\n\t\tvar type = tds[0];\n\n\t\ttds[0] = $.create(\"td\", {\n\t\t\ttitle: type\n\t\t});\n\n\t\tif (!tds[3]) {\n\t\t\tvar elementLabel = _.elementLabel(element, attribute);\n\n\t\t\ttds[3] = $.create(\"td\", {\n\t\t\t\ttextContent: elementLabel,\n\t\t\t\ttitle: elementLabel,\n\t\t\t\tevents: {\n\t\t\t\t\t\"mouseenter mouseleave\": function mouseenterMouseleave(evt) {\n\t\t\t\t\t\telement.classList.toggle(\"wysie-highlight\", evt.type === \"mouseenter\");\n\t\t\t\t\t},\n\t\t\t\t\t\"click\": function click(evt) {\n\t\t\t\t\t\telement.scrollIntoView({ behavior: \"smooth\" });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\ttds = tds.map(function (td) {\n\t\t\tif (!(td instanceof Node)) {\n\t\t\t\treturn $.create(\"td\", (typeof td === \"undefined\" ? \"undefined\" : _typeof(td)) == \"object\" ? td : { textContent: td });\n\t\t\t}\n\n\t\t\treturn td;\n\t\t});\n\n\t\tif (type == \"Warning\") {\n\t\t\ttds[1].setAttribute(\"colspan\", 2);\n\t\t}\n\n\t\tvar tr = $.create(\"tr\", {\n\t\t\tclassName: \"debug-\" + type.toLowerCase(),\n\t\t\tcontents: tds,\n\t\t\tinside: this.debug\n\t\t});\n\t};\n\n\tWysie.hooks.add(\"expressiontext-init-end\", function () {\n\t\tvar _this33 = this;\n\n\t\tif (this.scope.debug) {\n\t\t\tthis.debug = {};\n\n\t\t\tthis.template.forEach(function (expr) {\n\t\t\t\tif (expr instanceof Wysie.Expression) {\n\t\t\t\t\t_this33.scope.debugRow({\n\t\t\t\t\t\telement: _this33.element,\n\t\t\t\t\t\tattribute: _this33.attribute,\n\t\t\t\t\t\ttds: [\"Expression\", {\n\t\t\t\t\t\t\ttag: \"td\",\n\t\t\t\t\t\t\tcontents: {\n\t\t\t\t\t\t\t\ttag: \"textarea\",\n\t\t\t\t\t\t\t\tvalue: expr.expression,\n\t\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\t\tinput: function input(evt) {\n\t\t\t\t\t\t\t\t\t\texpr.expression = evt.target.value;\n\t\t\t\t\t\t\t\t\t\t_this33.update(_this33.data);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tonce: {\n\t\t\t\t\t\t\t\t\tfocus: function focus(evt) {\n\t\t\t\t\t\t\t\t\t\treturn Stretchy.resize(evt.target);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, expr.debug = $.create(\"td\")]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"scope-init-end\", function () {\n\t\tvar _this34 = this;\n\n\t\t// TODO make properties update, collapse duplicate expressions\n\t\tif (this.debug instanceof Node) {\n\t\t\t// We have a debug table, add stuff to it\n\n\t\t\tvar selector = Wysie.selectors.andNot(Wysie.selectors.multiple, Wysie.selectors.property);\n\t\t\t$$(selector, this.element).forEach(function (element) {\n\t\t\t\t_this34.debugRow({\n\t\t\t\t\telement: element,\n\t\t\t\t\ttds: [\"Warning\", \"data-multiple without a property attribute\"]\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.propagate(function (obj) {\n\t\t\t\tvar value = _.printValue(obj);\n\n\t\t\t\t_this34.debugRow({\n\t\t\t\t\telement: obj.element,\n\t\t\t\t\ttds: [\"Property\", obj.property, obj.value]\n\t\t\t\t});\n\n\t\t\t\tif (_.reservedWords.indexOf(obj.property) > -1) {\n\t\t\t\t\t_this34.debugRow({\n\t\t\t\t\t\telement: obj.element,\n\t\t\t\t\t\ttds: [\"Warning\", \"You cant use \\\"\" + obj.property + \"\\\" as a property name, its a reserved word.\"]\n\t\t\t\t\t});\n\t\t\t\t} else if (/^\\d|[\\W$]/.test(obj.property)) {\n\t\t\t\t\t_this34.debugRow({\n\t\t\t\t\t\telement: obj.element,\n\t\t\t\t\t\ttds: [\"Warning\", {\n\t\t\t\t\t\t\ttextContent: \"You cant use \\\"\" + obj.property + \"\\\" as a property name.\",\n\t\t\t\t\t\t\ttitle: \"Property names can only contain letters, numbers and underscores and cannot start with a number.\"\n\t\t\t\t\t\t}]\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.scope.element.addEventListener(\"wysie:datachange\", function (evt) {\n\t\t\t\t$$(\"tr.debug-property\", _this34.debug).forEach(function (tr) {\n\t\t\t\t\tvar property = tr.cells[1].textContent;\n\t\t\t\t\tvar value = _.printValue(_this34.properties[property]);\n\n\t\t\t\t\tif (tr.cells[2]) {\n\t\t\t\t\t\tvar td = tr.cells[2];\n\t\t\t\t\t\ttd.textContent = td.title = value;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"expressiontext-update-beforeeval\", function (env) {\n\t\tif (this.debug) {\n\t\t\tenv.td = env.expr.debug;\n\n\t\t\tif (env.td) {\n\t\t\t\tenv.td.classList.remove(\"error\");\n\t\t\t}\n\t\t}\n\t});\n\n\tWysie.hooks.add(\"expressiontext-update-aftereval\", function (env) {\n\t\tif (env.td && !env.td.classList.contains(\"error\")) {\n\t\t\tvar value = _.printValue(env.value);\n\t\t\tenv.td.textContent = env.td.title = value;\n\t\t}\n\t});\n\n\t// Wysie.Debug.time(\"Wysie.Expressions.prototype\", \"update\");\n})(Bliss, Bliss.$);\n\n(function ($) {\n\n\tif (!self.Wysie) {\n\t\treturn;\n\t}\n\n\tvar dropboxURL = \"//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js\";\n\n\tWysie.Storage.Backend.add(\"Dropbox\", $.Class({ extends: Wysie.Storage.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tvar _this35 = this;\n\n\t\t\t// Transform the dropbox shared URL into something raw and CORS-enabled\n\t\t\tif (this.url.protocol != \"dropbox:\") {\n\t\t\t\tthis.url.hostname = \"dl.dropboxusercontent.com\";\n\t\t\t\tthis.url.search = this.url.search.replace(/\\bdl=0|^$/, \"raw=1\");\n\t\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\t\t\t}\n\n\t\t\tthis.permissions.on(\"login\");\n\n\t\t\tthis.ready = $.include(self.Dropbox, dropboxURL).then(function () {\n\t\t\t\tvar referrer = new URL(document.referrer, location);\n\n\t\t\t\tif (referrer.hostname === \"www.dropbox.com\" && location.hash.indexOf(\"#access_token=\") === 0) {\n\t\t\t\t\t// Were in an OAuth response popup, do what you need then close this\n\t\t\t\t\tDropbox.AuthDriver.Popup.oauthReceiver();\n\t\t\t\t\t$.fire(window, \"load\"); // hack because dropbox.js didn't foresee use cases like ours :/\n\t\t\t\t\tclose();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Internal filename (to be used for saving)\n\t\t\t\t_this35.filename = (_this35.storage.param(\"path\") || \"\") + new URL(_this35.url).pathname.match(/[^/]*$/)[0];\n\n\t\t\t\t_this35.key = _this35.storage.param(\"key\") || \"fle6gsc61w5v79j\";\n\n\t\t\t\t_this35.client = new Dropbox.Client({ key: _this35.key });\n\t\t\t}).then(function () {\n\t\t\t\t_this35.login(true);\n\t\t\t});\n\t\t},\n\n\t\t/**\n   * Saves a file to the backend.\n   * @param {Object} file - An object with name & data keys\n   * @return {Promise} A promise that resolves when the file is saved.\n   */\n\t\tput: function put(file) {\n\t\t\tvar _this36 = this;\n\n\t\t\tfile.data = Wysie.toJSON(file.data);\n\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t_this36.client.writeFile(file.name, file.data, function (error, stat) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn reject(Error(error));\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.log(\"File saved as revision \" + stat.versionTag);\n\t\t\t\t\tresolve(stat);\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login(passive) {\n\t\t\tvar _this37 = this;\n\n\t\t\treturn this.ready.then(function () {\n\t\t\t\treturn _this37.client.isAuthenticated() ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t\t_this37.client.authDriver(new Dropbox.AuthDriver.Popup({\n\t\t\t\t\t\treceiverUrl: new URL(location) + \"\"\n\t\t\t\t\t}));\n\n\t\t\t\t\t_this37.client.authenticate({ interactive: !passive }, function (error, client) {\n\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(Error(error));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (_this37.client.isAuthenticated()) {\n\t\t\t\t\t\t\t// TODO check if can actually edit the file\n\t\t\t\t\t\t\t_this37.permissions.on([\"logout\", \"edit\"]);\n\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t_this37.permissions.off([\"logout\", \"edit\", \"add\", \"delete\"]);\n\n\t\t\t\t\t\t\treject();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}).then(function () {\n\t\t\t\t// Not returning a promise here, since processes depending on login don't need to wait for this\n\t\t\t\t_this37.client.getAccountInfo(function (error, accountInfo) {\n\t\t\t\t\tif (!error) {\n\t\t\t\t\t\t_this37.wysie.wrapper._.fire(\"wysie:login\", $.extend({ backend: _this37 }, accountInfo));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}).catch(function () {});\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\tvar _this38 = this;\n\n\t\t\treturn !this.client.isAuthenticated() ? Promise.resolve() : new Promise(function (resolve, reject) {\n\t\t\t\t_this38.client.signOut(null, function () {\n\t\t\t\t\t_this38.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\t\t\t_this38.wysie.wrapper._.fire(\"wysie:logout\", { backend: _this38 });\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\treturn (/dropbox.com/.test(url.host) || url.protocol === \"dropbox:\"\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}), true);\n})(Bliss);\n\n(function ($) {\n\n\tif (!self.Wysie) {\n\t\treturn;\n\t}\n\n\tvar _;\n\n\tWysie.Storage.Backend.add(\"Github\", _ = $.Class({ extends: Wysie.Storage.Backend,\n\t\tconstructor: function constructor() {\n\t\t\tthis.permissions.on(\"login\");\n\n\t\t\tthis.key = this.storage.param(\"key\") || \"7e08e016048000bc594e\";\n\n\t\t\t// Extract info for username, repo, branch, filename, filepath from URL\n\t\t\t$.extend(this, _.parseURL(this.url));\n\t\t\tthis.repo = this.repo || \"wysie-data\";\n\t\t\tthis.branch = this.branch || \"master\";\n\t\t\tthis.path = this.path || this.wysie.id + \".json\";\n\t\t\tthis.filename = this.filename || this.path.match(/[^/]*$/)[0];\n\n\t\t\t// Transform the Github URL into something raw and CORS-enabled\n\t\t\tthis.url = new URL(\"https://raw.githubusercontent.com/\" + this.username + \"/\" + this.repo + \"/\" + this.branch + \"/\" + this.path + \"?ts=\" + Date.now());\n\t\t\tthis.permissions.on(\"read\"); // TODO check if file actually is publicly readable\n\n\t\t\tthis.login(true);\n\t\t},\n\n\t\tget authenticated() {\n\t\t\treturn !!this.accessToken;\n\t\t},\n\n\t\treq: function req(call, data) {\n\t\t\tvar method = arguments.length <= 2 || arguments[2] === undefined ? \"GET\" : arguments[2];\n\t\t\tvar o = arguments.length <= 3 || arguments[3] === undefined ? { method: method } : arguments[3];\n\n\t\t\tif (data) {\n\t\t\t\to.data = JSON.stringify(data);\n\t\t\t}\n\n\t\t\treturn $.fetch(\"https://api.github.com/\" + call, $.extend(o, {\n\t\t\t\tresponseType: \"json\",\n\t\t\t\theaders: {\n\t\t\t\t\t\"Authorization\": \"token \" + this.accessToken\n\t\t\t\t}\n\t\t\t})).catch(function (err) {\n\t\t\t\tif (err && err.xhr) {\n\t\t\t\t\treturn Promise.reject(err.xhr);\n\t\t\t\t} else {\n\t\t\t\t\tconsole.error(err);\n\t\t\t\t\tconsole.log(err.stack);\n\t\t\t\t}\n\t\t\t}).then(function (xhr) {\n\t\t\t\treturn Promise.resolve(xhr.response);\n\t\t\t});\n\t\t},\n\n\t\tget: Wysie.Storage.Backend.Remote.prototype.get,\n\n\t\t/**\n   * Saves a file to the backend.\n   * @param {Object} file - An object with name & data keys\n   * @return {Promise} A promise that resolves when the file is saved.\n   */\n\t\tput: function put(file) {\n\t\t\tvar _this39 = this;\n\n\t\t\tfile.data = Wysie.toJSON(file.data);\n\t\t\tfile.path = file.path || \"\";\n\n\t\t\tvar fileCall = \"repos/\" + this.username + \"/\" + this.repo + \"/contents/\" + file.path;\n\n\t\t\treturn Promise.resolve(this.repoInfo || this.req(\"user/repos\", {\n\t\t\t\tname: this.repo\n\t\t\t}, \"POST\")).then(function (repoInfo) {\n\t\t\t\t_this39.repoInfo = repoInfo;\n\n\t\t\t\treturn _this39.req(fileCall, {\n\t\t\t\t\tref: _this39.branch\n\t\t\t\t});\n\t\t\t}).then(function (fileInfo) {\n\t\t\t\treturn _this39.req(fileCall, {\n\t\t\t\t\tmessage: \"Updated \" + (file.name || \"file\"),\n\t\t\t\t\tcontent: btoa(file.data),\n\t\t\t\t\tbranch: _this39.branch,\n\t\t\t\t\tsha: fileInfo.sha\n\t\t\t\t}, \"PUT\");\n\t\t\t}, function (xhr) {\n\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t// File does not exist, create it\n\t\t\t\t\treturn _this39.req(fileCall, {\n\t\t\t\t\t\tmessage: \"Created file\",\n\t\t\t\t\t\tcontent: btoa(file.data),\n\t\t\t\t\t\tbranch: _this39.branch\n\t\t\t\t\t}, \"PUT\");\n\t\t\t\t}\n\t\t\t}).then(function (data) {\n\t\t\t\tconsole.log(\"success\");\n\t\t\t});\n\t\t},\n\n\t\tlogin: function login(passive) {\n\t\t\tvar _this40 = this;\n\n\t\t\treturn this.ready.then(function () {\n\t\t\t\tif (_this40.authenticated) {\n\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tif (passive) {\n\t\t\t\t\t\t_this40.accessToken = localStorage[\"wysie:githubtoken\"];\n\n\t\t\t\t\t\tif (_this40.accessToken) {\n\t\t\t\t\t\t\tresolve(_this40.accessToken);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Show window\n\t\t\t\t\t\t_this40.authPopup = open(\"https://github.com/login/oauth/authorize?client_id=\" + _this40.key + \"&scope=repo,gist&state=\" + location.href, \"popup\", \"width=900,height=500\");\n\n\t\t\t\t\t\taddEventListener(\"message\", function (evt) {\n\t\t\t\t\t\t\tif (evt.source === _this40.authPopup) {\n\t\t\t\t\t\t\t\t_this40.accessToken = localStorage[\"wysie:githubtoken\"] = evt.data;\n\n\t\t\t\t\t\t\t\tif (!_this40.accessToken) {\n\t\t\t\t\t\t\t\t\treject(Error(\"Authentication error\"));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(_this40.accessToken);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}).then(function () {\n\t\t\t\t\treturn _this40.getUser();\n\t\t\t\t}).then(function (u) {\n\t\t\t\t\t_this40.permissions.on(\"logout\");\n\n\t\t\t\t\treturn _this40.req(\"repos/\" + _this40.username + \"/\" + _this40.repo);\n\t\t\t\t}).then(function (repoInfo) {\n\t\t\t\t\t_this40.repoInfo = repoInfo;\n\n\t\t\t\t\tif (repoInfo.permissions.push) {\n\t\t\t\t\t\t_this40.permissions.on(\"edit\");\n\t\t\t\t\t}\n\t\t\t\t}).catch(function (xhr) {\n\t\t\t\t\tif (xhr.status == 404) {\n\t\t\t\t\t\t// Repo does not exist so we can't check permissions\n\t\t\t\t\t\t// Just check if authenticated user is the same as our URL username\n\t\t\t\t\t\tif (_this40.user.login == _this40.username) {\n\t\t\t\t\t\t\t_this40.permissions.on(\"edit\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tlogout: function logout() {\n\t\t\tif (this.authenticated) {\n\t\t\t\tlocalStorage.removeItem(\"wysie:githubtoken\");\n\t\t\t\tdelete this.accessToken;\n\n\t\t\t\tthis.permissions.off([\"edit\", \"add\", \"delete\"]).on(\"login\");\n\n\t\t\t\tthis.wysie.wrapper._.fire(\"wysie:logout\", { backend: this });\n\t\t\t}\n\n\t\t\treturn Promise.resolve();\n\t\t},\n\n\t\tgetUser: function getUser() {\n\t\t\tvar _this41 = this;\n\n\t\t\treturn this.req(\"user\").then(function (accountInfo) {\n\t\t\t\t_this41.user = accountInfo;\n\n\t\t\t\tvar name = accountInfo.name || accountInfo.login;\n\t\t\t\t_this41.wysie.wrapper._.fire(\"wysie:login\", {\n\t\t\t\t\tbackend: _this41,\n\t\t\t\t\tname: \"<a href=\\\"https://github.com/\" + accountInfo.login + \"\\\" target=\\\"_blank\\\">\\n\\t\\t\\t\\t\\t\\t\\t<img class=\\\"avatar\\\" src=\\\"\" + accountInfo.avatar_url + \"\\\" /> \" + name + \"\\n\\t\\t\\t\\t\\t\\t</a>\"\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\n\t\tstatic: {\n\t\t\ttest: function test(url) {\n\t\t\t\treturn (/\\bgithub.(com|io)|raw.githubusercontent.com/.test(url.host)\n\t\t\t\t);\n\t\t\t},\n\n\t\t\t/**\n    * Parse Github URLs, return username, repo, branch, path\n    */\n\t\t\tparseURL: function parseURL(url) {\n\t\t\t\tvar ret = {};\n\n\t\t\t\turl = new URL(url, location);\n\n\t\t\t\tvar path = url.pathname.slice(1).split(\"/\");\n\n\t\t\t\tif (/github.io$/.test(url.host)) {\n\t\t\t\t\tret.username = url.host.match(/([\\w-]+)\\.github\\.io$/)[1];\n\t\t\t\t\tret.branch = \"gh-pages\";\n\t\t\t\t} else {\n\t\t\t\t\tret.username = path.shift();\n\t\t\t\t}\n\n\t\t\t\tret.repo = path.shift();\n\n\t\t\t\tif (/raw.githubusercontent.com$/.test(url.host)) {\n\t\t\t\t\tret.branch = path.shift();\n\t\t\t\t} else if (/github.com$/.test(url.host) && path[0] == \"blob\") {\n\t\t\t\t\tpath.shift();\n\t\t\t\t\tret.branch = path.shift();\n\t\t\t\t}\n\n\t\t\t\tret.filename = path[path.length - 1];\n\n\t\t\t\tret.path = path.join(\"/\");\n\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t}), true);\n})(Bliss);\n\n//# sourceMappingURL=wysie.js.map\n//# sourceMappingURL=wysie.es5.js.map\n"],"sourceRoot":"/source/"}